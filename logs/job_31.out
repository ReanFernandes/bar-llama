Starting job 31 at Thu Mar  6 20:31:29 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_10_samples prompt=json_fact_first_zero_shot_unstructured train=json_fact_first_zero_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '31', 'training']
Updating job 31 to status training with exit code None
Status update completed for job 31
[2025-03-06 20:31:37,787][root][INFO] - Global seed set to 314
[2025-03-06 20:31:37,789][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 20:31:37,789][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 20:31:37,789][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 20:31:37,789][root][INFO] - Current training config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:31:37,789][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 20:31:37,822][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:31:37,826][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 20:31:37,828][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 20:31:37,833][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 20:31:38,240][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 20:31:47,250][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 20:32:18,996][root][INFO] - Model prepared for kbit training
[2025-03-06 20:32:18,997][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'o_proj', 'up_proj', 'down_proj', 'gate_proj', 'v_proj', 'q_proj', 'k_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 20:32:20,893][root][INFO] - Lora adapter added to model
[2025-03-06 20:32:20,896][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_zero_shot_unstructured
[2025-03-06 20:32:21,053][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.6653, 'grad_norm': 0.12771128118038177, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.7884, 'grad_norm': 0.18442566692829132, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.5692, 'grad_norm': 0.14750751852989197, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.5988, 'grad_norm': 0.20812185108661652, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.3913, 'grad_norm': 0.2279030680656433, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 1.2201, 'grad_norm': 0.36160793900489807, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 1.1823, 'grad_norm': 0.20029181241989136, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 1.0387, 'grad_norm': 0.28327903151512146, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 1.0256, 'grad_norm': 0.14316456019878387, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 1.0579, 'grad_norm': 0.21659481525421143, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 1.0275, 'grad_norm': 0.2635081708431244, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.9795, 'grad_norm': 0.2227732390165329, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.9415, 'grad_norm': 0.1486842930316925, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.9853, 'grad_norm': 0.17854459583759308, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.8576, 'grad_norm': 0.15969568490982056, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.8827, 'grad_norm': 0.2096489518880844, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.947, 'grad_norm': 0.18350887298583984, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.8244, 'grad_norm': 0.20993220806121826, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.858, 'grad_norm': 0.20573154091835022, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.8561, 'grad_norm': 0.2537371516227722, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.8493, 'grad_norm': 0.20460930466651917, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.7471, 'grad_norm': 0.2579030692577362, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.8421, 'grad_norm': 0.22926625609397888, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.7706, 'grad_norm': 0.2761501371860504, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.7689, 'grad_norm': 0.2347385138273239, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.8139, 'grad_norm': 0.2860785126686096, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.8554, 'grad_norm': 0.241934135556221, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.7463, 'grad_norm': 0.27100902795791626, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.768, 'grad_norm': 0.41373106837272644, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.6952, 'grad_norm': 0.4524078071117401, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.7058, 'grad_norm': 0.7123038172721863, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.5672, 'grad_norm': 0.5682886838912964, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.5922, 'grad_norm': 0.5326793193817139, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.4137, 'grad_norm': 0.49897900223731995, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.5092, 'grad_norm': 0.8239037990570068, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.3762, 'grad_norm': 0.6710854172706604, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.4846, 'grad_norm': 0.5875511765480042, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.2403, 'grad_norm': 0.5628089904785156, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.3567, 'grad_norm': 0.5518360733985901, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.2395, 'grad_norm': 0.541565477848053, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.266, 'grad_norm': 0.6065335869789124, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.1501, 'grad_norm': 0.5180844068527222, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.2032, 'grad_norm': 0.5270098447799683, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.1159, 'grad_norm': 0.3274448812007904, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.1588, 'grad_norm': 0.5162679553031921, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.1356, 'grad_norm': 0.43815770745277405, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.1571, 'grad_norm': 0.47316405177116394, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.1093, 'grad_norm': 0.3157249391078949, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.1106, 'grad_norm': 0.37738171219825745, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0864, 'grad_norm': 0.3283607065677643, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 2670.1675, 'train_samples_per_second': 0.393, 'train_steps_per_second': 0.056, 'train_loss': 0.7306445670127869, 'epoch': 15.0}
[2025-03-06 21:16:54,549][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_zero_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '31', 'trained', '0']
Updating job 31 to status trained with exit code 0
Status update completed for job 31
Starting evaluations for job 31
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 21:17:04,842][root][INFO] - Setting global seed to 206
[2025-03-06 21:17:04,848][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:17:04,848][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:17:04,849][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:17:04,868][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:17:04,870][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:17:04,870][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:17:05,020][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:17:05,291][root][INFO] - Full model selected, loading model
[2025-03-06 21:17:16,968][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:18:20,991][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:18:20,991][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:18:46,752][root][INFO] - Peft model loaded successfully
[2025-03-06 21:18:53,073][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:18:53,076][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:18:53,076][root][INFO] - Starting inference
[2025-03-06 21:18:53,295][root][INFO] - Processing question number 0
[2025-03-06 21:18:53,297][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:18:59,401][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:19:10,569][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:19:17,002][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:19:22,885][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:19:31,928][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:19:46,350][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:19:50,519][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:19:56,899][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:20:11,303][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:20:26,996][root][INFO] - Processing question number 10
[2025-03-06 21:20:26,999][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:20:35,868][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:20:43,846][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:20:57,697][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:21:05,085][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:21:12,168][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:21:28,591][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:21:32,311][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:21:48,785][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:21:56,826][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:22:13,290][root][INFO] - Processing question number 20
[2025-03-06 21:22:13,292][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:22:24,931][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:22:30,139][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:22:41,294][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:22:55,461][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:23:06,587][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:23:11,238][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:23:23,214][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:23:39,233][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:23:46,707][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:23:54,186][root][INFO] - Processing question number 30
[2025-03-06 21:23:54,188][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:24:12,417][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:24:29,793][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:24:46,141][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:24:55,746][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:25:02,021][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:25:10,551][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:25:19,500][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:25:34,350][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:25:48,165][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:25:58,202][root][INFO] - Processing question number 40
[2025-03-06 21:25:58,205][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:26:12,573][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:26:30,715][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:26:39,354][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:26:45,653][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:26:59,517][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:27:07,845][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:27:15,254][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:27:22,088][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:27:30,725][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:27:44,436][root][INFO] - Processing question number 50
[2025-03-06 21:27:44,439][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:27:55,331][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:28:07,417][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:28:17,233][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:28:30,109][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:28:37,264][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:28:48,269][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:29:12,291][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:29:20,745][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:29:31,061][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:29:37,955][root][INFO] - Processing question number 60
[2025-03-06 21:29:37,958][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:29:44,938][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:29:56,914][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:30:03,897][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:30:26,718][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:30:38,651][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:30:43,103][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:30:56,913][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:31:05,296][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:31:10,569][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:31:34,481][root][INFO] - Processing question number 70
[2025-03-06 21:31:34,484][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:31:49,279][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:31:53,590][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:32:00,573][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:32:11,937][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:32:20,978][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:32:26,735][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:32:36,423][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:32:53,819][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:32:58,274][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:33:03,963][root][INFO] - Processing question number 80
[2025-03-06 21:33:03,967][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:33:11,421][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:33:18,276][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:33:30,147][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:33:42,252][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:34:01,804][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:34:14,404][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:34:22,623][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:34:26,230][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:34:32,602][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:34:41,629][root][INFO] - Processing question number 90
[2025-03-06 21:34:41,633][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:34:52,802][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:34:59,739][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:35:08,892][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:35:15,904][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:35:21,722][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:35:31,925][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:35:38,461][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:35:47,584][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:36:00,801][root][INFO] - Inference complete
[2025-03-06 21:36:00,802][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,807][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,809][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,809][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,810][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,810][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,810][root][WARNING] - |Q. 56||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:36:00,811][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,811][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:36:00,812][root][WARNING] - |Q. 98||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,812][root][WARNING] - |Q. 98||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,812][root][INFO] - |Q. 98||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,812][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,813][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,813][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,813][root][WARNING] - |Q. 37||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,813][root][WARNING] - |Q. 37||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,813][root][INFO] - |Q. 37||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,813][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,814][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,814][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,814][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,814][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,814][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,815][root][WARNING] - |Q. 79||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,815][root][WARNING] - |Q. 79||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,815][root][INFO] - |Q. 79||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,816][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,816][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,816][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,816][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,816][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,816][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,817][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,817][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,817][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,819][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,819][root][WARNING] - |Q. 47||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,819][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,820][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,820][root][WARNING] - |Q. 95||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,820][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,821][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,821][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,821][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,822][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,822][root][WARNING] - |Q. 78||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,822][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,823][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,823][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,823][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,824][root][WARNING] - |Q. 83||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,824][root][WARNING] - |Q. 83||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,824][root][INFO] - |Q. 83||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,825][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,825][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:36:00,825][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,825][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:36:00,827][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,832][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,832][root][INFO] - Saved parsed outputs
[2025-03-06 21:36:00,832][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,833][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,833][root][INFO] - Saved parsing metadata
[2025-03-06 21:36:00,834][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,836][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,837][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:36:00,850][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_1
[2025-03-06 21:36:00,850][root][INFO] - Summary of metrics : {'label_accuracy': 0.32323232323232326, 'misclassification_rate': 0.6767676767676767, 'combined_accuracy': 0.30303030303030304, 'malformed_label': 2, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 32, 'correct_label_and_domain': 30, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.1717171717171717, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.1414141414141414, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.12121212121212122, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 2, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 21:36:07,339][root][INFO] - Setting global seed to 206
[2025-03-06 21:36:07,344][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:36:07,344][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:36:07,346][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:36:07,347][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:36:07,349][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:36:07,349][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:36:07,520][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:36:07,807][root][INFO] - Full model selected, loading model
[2025-03-06 21:36:21,903][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:37:27,002][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:37:27,002][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:37:53,882][root][INFO] - Peft model loaded successfully
[2025-03-06 21:38:00,305][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:38:00,307][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:38:00,307][root][INFO] - Starting inference
[2025-03-06 21:38:00,609][root][INFO] - Processing question number 0
[2025-03-06 21:38:00,611][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:38:12,657][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:38:24,703][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:38:33,913][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:38:40,442][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:38:49,773][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:39:12,283][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:39:16,479][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:39:24,439][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:39:44,285][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:40:11,362][root][INFO] - Processing question number 10
[2025-03-06 21:40:11,364][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:40:21,109][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:40:28,847][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:40:41,691][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:40:51,532][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:40:59,013][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:41:14,590][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:41:21,277][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:41:35,513][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:41:48,679][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:41:56,927][root][INFO] - Processing question number 20
[2025-03-06 21:41:56,929][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:42:12,074][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:42:19,572][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:42:25,681][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:42:37,238][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:43:04,130][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:43:14,173][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:43:22,466][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:43:31,209][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:43:37,713][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:43:43,076][root][INFO] - Processing question number 30
[2025-03-06 21:43:43,078][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:43:54,496][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:44:17,874][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:44:25,834][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:44:33,799][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:44:39,488][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:44:46,044][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:44:52,346][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:45:04,727][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:45:14,836][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:45:18,712][root][INFO] - Processing question number 40
[2025-03-06 21:45:18,715][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:45:27,765][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:45:39,114][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:45:48,215][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:45:56,782][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:46:06,859][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:46:18,270][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:46:25,604][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:46:32,917][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:46:44,787][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:47:01,373][root][INFO] - Processing question number 50
[2025-03-06 21:47:01,377][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:47:10,230][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:47:23,554][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:47:28,467][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:47:49,699][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:47:57,050][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:48:07,045][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:48:22,488][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:48:27,430][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:48:39,807][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:48:47,319][root][INFO] - Processing question number 60
[2025-03-06 21:48:47,324][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:48:53,640][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:49:07,003][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:49:21,305][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:49:30,432][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:49:36,337][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:49:45,122][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:50:02,273][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:50:14,521][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:50:22,085][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:50:49,424][root][INFO] - Processing question number 70
[2025-03-06 21:50:49,429][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:51:02,113][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:51:06,952][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:51:18,943][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:51:26,023][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:51:35,082][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:51:41,167][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:51:45,820][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:52:12,751][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:52:16,896][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:52:30,389][root][INFO] - Processing question number 80
[2025-03-06 21:52:30,392][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:52:38,664][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:52:46,594][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:52:55,058][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:53:07,849][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:53:14,551][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:53:23,457][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:53:38,657][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:53:46,359][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:53:55,612][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:54:03,510][root][INFO] - Processing question number 90
[2025-03-06 21:54:03,514][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:54:18,494][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:54:23,911][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:54:33,025][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:54:36,675][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:54:43,040][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:54:49,678][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:54:58,579][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:55:13,418][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:55:31,606][root][INFO] - Inference complete
[2025-03-06 21:55:31,606][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:55:31,611][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:55:31,613][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,613][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,613][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,614][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,614][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,614][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,614][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,615][root][WARNING] - |Q. 63||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:55:31,615][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,615][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:55:31,615][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,616][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,616][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,617][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,617][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,617][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,617][root][WARNING] - |Q. 60||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,618][root][WARNING] - |Q. 60||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:55:31,618][root][INFO] - |Q. 60||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,618][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:55:31,619][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,619][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,619][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,619][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,620][root][WARNING] - |Q. 46||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,620][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,620][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,620][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,620][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,621][root][WARNING] - |Q. 24||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,621][root][WARNING] - |Q. 24||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,621][root][INFO] - |Q. 24||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,622][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,622][root][WARNING] - |Q. 47||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,622][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,623][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,624][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,624][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,624][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,625][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:55:31,625][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,625][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:55:31,626][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,626][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,626][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,626][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,626][root][WARNING] - |Q. 48||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:55:31,626][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,627][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:55:31,627][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,627][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,627][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,628][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:55:31,629][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:55:31,629][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:55:31,630][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:55:31,635][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:55:31,635][root][INFO] - Saved parsed outputs
[2025-03-06 21:55:31,635][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:55:31,636][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:55:31,636][root][INFO] - Saved parsing metadata
[2025-03-06 21:55:31,637][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:55:31,638][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:55:31,640][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:55:31,668][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_1
[2025-03-06 21:55:31,668][root][INFO] - Summary of metrics : {'label_accuracy': 0.3333333333333333, 'misclassification_rate': 0.6666666666666667, 'combined_accuracy': 0.29292929292929293, 'malformed_label': 4, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 33, 'correct_label_and_domain': 29, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.14285714285714285, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.18181818181818182, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.1414141414141414, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 59, 'correct_label_wrong_domain': 4, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 21:55:38,953][root][INFO] - Setting global seed to 206
[2025-03-06 21:55:38,960][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:55:38,960][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:55:38,962][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:55:38,963][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:55:38,966][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:55:38,966][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:55:39,129][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:55:39,454][root][INFO] - Full model selected, loading model
[2025-03-06 21:55:59,292][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:57:04,871][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:57:04,872][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:57:32,283][root][INFO] - Peft model loaded successfully
[2025-03-06 21:57:38,571][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:57:38,573][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:57:38,573][root][INFO] - Starting inference
[2025-03-06 21:57:38,788][root][INFO] - Processing question number 0
[2025-03-06 21:57:38,791][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:57:42,959][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:57:59,010][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:58:03,381][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:58:11,286][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:58:24,028][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:58:32,627][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:58:41,268][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:58:52,415][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:59:05,175][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:59:20,341][root][INFO] - Processing question number 10
[2025-03-06 21:59:20,343][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:59:32,693][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:59:42,327][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:59:51,133][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:00:07,815][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:00:24,259][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:00:38,390][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:00:47,559][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:01:02,412][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:01:12,444][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:01:23,040][root][INFO] - Processing question number 20
[2025-03-06 22:01:23,042][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:01:30,453][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:01:46,479][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:01:51,293][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:02:01,563][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:02:15,153][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:02:22,876][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:02:30,339][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:02:53,986][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:03:01,259][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:03:06,783][root][INFO] - Processing question number 30
[2025-03-06 22:03:06,785][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:03:21,035][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:03:29,296][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:03:43,395][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:03:58,343][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:04:06,474][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:04:15,105][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:04:29,111][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:04:51,338][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:04:59,508][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:05:13,996][root][INFO] - Processing question number 40
[2025-03-06 22:05:13,999][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:05:24,738][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:05:47,861][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:05:59,649][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:06:10,704][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:06:18,117][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:06:24,242][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:06:36,639][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:06:43,980][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:06:53,239][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:07:07,637][root][INFO] - Processing question number 50
[2025-03-06 22:07:07,640][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:07:22,652][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:07:33,593][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:07:39,819][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:07:55,839][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:07:59,911][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:08:04,132][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:08:16,607][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:08:20,272][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:08:30,082][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:08:42,144][root][INFO] - Processing question number 60
[2025-03-06 22:08:42,147][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:08:49,852][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:08:59,836][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:09:15,173][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:09:30,557][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:09:40,269][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:09:44,415][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:09:53,900][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:10:03,602][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:10:12,080][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:10:20,686][root][INFO] - Processing question number 70
[2025-03-06 22:10:20,690][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:10:26,826][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:10:33,392][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:10:37,654][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:11:04,748][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:11:14,555][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:11:28,598][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:11:35,189][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:12:02,145][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:12:09,944][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:12:16,843][root][INFO] - Processing question number 80
[2025-03-06 22:12:16,847][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:12:23,447][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:12:34,121][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:12:47,825][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:13:00,194][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:13:06,950][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:13:21,479][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:13:30,633][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:13:39,151][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:13:47,858][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:14:02,336][root][INFO] - Processing question number 90
[2025-03-06 22:14:02,340][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:14:13,096][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:14:18,684][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:14:28,250][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:14:31,496][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:14:38,525][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:14:48,340][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:14:55,688][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:15:10,950][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:15:32,947][root][INFO] - Inference complete
[2025-03-06 22:15:32,947][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:15:32,954][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:15:32,957][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,957][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:15:32,958][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,959][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,959][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:15:32,959][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,960][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,960][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:15:32,960][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,961][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,961][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:15:32,961][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,963][root][WARNING] - |Q. 34||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,964][root][WARNING] - |Q. 34||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:15:32,964][root][INFO] - |Q. 34||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,965][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,965][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:15:32,966][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,966][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:15:32,966][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,966][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:15:32,966][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,967][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,967][root][WARNING] - |Q. 48||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:15:32,967][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,967][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:15:32,968][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,968][root][WARNING] - |Q. 100||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:15:32,968][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,969][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:15:32,969][root][WARNING] - |Q. 50||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:15:32,969][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:15:32,971][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:15:32,975][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:15:32,975][root][INFO] - Saved parsed outputs
[2025-03-06 22:15:32,975][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:15:32,977][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:15:32,977][root][INFO] - Saved parsing metadata
[2025-03-06 22:15:32,978][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:15:32,980][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:15:32,981][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:15:33,038][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_1
[2025-03-06 22:15:33,038][root][INFO] - Summary of metrics : {'label_accuracy': 0.36363636363636365, 'misclassification_rate': 0.6363636363636364, 'combined_accuracy': 0.3333333333333333, 'malformed_label': 2, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 36, 'correct_label_and_domain': 33, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1717171717171717, 'Contracts_confidence': 0.1717171717171717, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.1414141414141414, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.12121212121212122, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 3, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 22:15:41,276][root][INFO] - Setting global seed to 989
[2025-03-06 22:15:41,284][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:15:41,284][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:15:41,286][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:15:41,289][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:15:41,292][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:15:41,292][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:15:41,466][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:15:41,723][root][INFO] - Full model selected, loading model
[2025-03-06 22:15:57,067][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:17:03,715][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:17:03,716][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:17:29,639][root][INFO] - Peft model loaded successfully
[2025-03-06 22:17:35,902][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:17:35,904][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:17:35,904][root][INFO] - Starting inference
[2025-03-06 22:17:36,136][root][INFO] - Processing question number 0
[2025-03-06 22:17:36,138][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:17:42,025][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:17:53,187][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:17:59,620][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:18:05,500][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:18:14,549][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:18:28,965][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:18:33,131][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:18:39,503][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:18:53,900][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:19:09,587][root][INFO] - Processing question number 10
[2025-03-06 22:19:09,595][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:19:18,463][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:19:26,442][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:19:40,289][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:19:47,677][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:19:54,760][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:20:11,179][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:20:14,897][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:20:31,357][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:20:39,394][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:20:55,853][root][INFO] - Processing question number 20
[2025-03-06 22:20:55,856][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:21:07,487][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:21:12,696][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:21:23,844][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:21:38,014][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:21:49,145][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:21:53,803][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:22:05,779][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:22:21,799][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:22:29,272][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:22:36,748][root][INFO] - Processing question number 30
[2025-03-06 22:22:36,750][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:22:54,983][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:23:12,357][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:23:28,710][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:23:38,317][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:23:44,587][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:23:53,118][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:24:02,069][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:24:16,920][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:24:30,739][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:24:40,782][root][INFO] - Processing question number 40
[2025-03-06 22:24:40,785][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:24:55,154][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:25:13,293][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:25:21,933][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:25:28,234][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:25:42,105][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:25:50,434][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:25:57,843][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:26:04,678][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:26:13,316][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:26:27,038][root][INFO] - Processing question number 50
[2025-03-06 22:26:27,041][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:26:37,932][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:26:50,016][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:26:59,833][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:27:12,708][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:27:19,865][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:27:30,871][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:27:54,888][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:28:03,341][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:28:13,664][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:28:20,559][root][INFO] - Processing question number 60
[2025-03-06 22:28:20,562][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:28:27,544][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:28:39,523][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:28:46,510][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:29:09,336][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:29:21,265][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:29:25,717][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:29:39,530][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:29:47,911][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:29:53,179][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:30:17,060][root][INFO] - Processing question number 70
[2025-03-06 22:30:17,064][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:30:31,864][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:30:36,174][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:30:43,163][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:30:54,528][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:31:03,570][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:31:09,330][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:31:19,018][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:31:36,408][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:31:40,865][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:31:46,545][root][INFO] - Processing question number 80
[2025-03-06 22:31:46,548][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:31:54,000][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:32:00,851][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:32:12,729][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:32:24,833][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:32:44,374][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:32:56,973][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:33:05,194][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:33:08,805][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:33:15,173][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:33:24,203][root][INFO] - Processing question number 90
[2025-03-06 22:33:24,207][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:33:35,381][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:33:42,315][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:33:51,461][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:33:58,476][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:34:04,295][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:34:14,500][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:34:21,037][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:34:30,161][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:34:43,385][root][INFO] - Inference complete
[2025-03-06 22:34:43,385][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:34:43,392][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:34:43,394][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,394][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,395][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,395][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,395][root][WARNING] - |Q. 56||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:34:43,396][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,396][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:34:43,397][root][WARNING] - |Q. 98||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,397][root][WARNING] - |Q. 98||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,397][root][INFO] - |Q. 98||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,397][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,398][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,398][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,398][root][WARNING] - |Q. 37||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,398][root][WARNING] - |Q. 37||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,398][root][INFO] - |Q. 37||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,398][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,399][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,399][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,399][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,399][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,399][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,400][root][WARNING] - |Q. 79||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,400][root][WARNING] - |Q. 79||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,400][root][INFO] - |Q. 79||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,401][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,401][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,401][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,401][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,401][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,402][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,402][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,402][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,402][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,404][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,404][root][WARNING] - |Q. 47||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,404][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,405][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,405][root][WARNING] - |Q. 95||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,405][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,406][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,406][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,406][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,407][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,407][root][WARNING] - |Q. 78||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,407][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,408][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,408][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,408][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,409][root][WARNING] - |Q. 83||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,409][root][WARNING] - |Q. 83||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:43,409][root][INFO] - |Q. 83||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,410][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:43,410][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:34:43,410][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:43,410][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:34:43,412][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:34:43,417][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:34:43,417][root][INFO] - Saved parsed outputs
[2025-03-06 22:34:43,417][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:34:43,418][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:34:43,418][root][INFO] - Saved parsing metadata
[2025-03-06 22:34:43,420][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:34:43,422][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:34:43,423][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:34:43,465][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_1
[2025-03-06 22:34:43,465][root][INFO] - Summary of metrics : {'label_accuracy': 0.32323232323232326, 'misclassification_rate': 0.6767676767676767, 'combined_accuracy': 0.30303030303030304, 'malformed_label': 2, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 32, 'correct_label_and_domain': 30, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.1717171717171717, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.1414141414141414, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.12121212121212122, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 2, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 22:34:50,896][root][INFO] - Setting global seed to 989
[2025-03-06 22:34:50,903][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:34:50,903][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:34:50,905][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:34:50,907][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:34:50,909][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:34:50,909][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:34:51,068][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:34:51,339][root][INFO] - Full model selected, loading model
[2025-03-06 22:35:06,539][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:36:12,742][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:36:12,742][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:36:38,663][root][INFO] - Peft model loaded successfully
[2025-03-06 22:36:44,947][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:36:44,950][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:36:44,950][root][INFO] - Starting inference
[2025-03-06 22:36:45,164][root][INFO] - Processing question number 0
[2025-03-06 22:36:45,166][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:36:58,866][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:37:09,137][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:37:15,659][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:37:25,158][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:37:33,372][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:37:45,302][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:37:49,349][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:38:03,137][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:38:22,641][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:38:39,976][root][INFO] - Processing question number 10
[2025-03-06 22:38:39,978][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:38:50,398][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:38:59,721][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:39:16,109][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:39:32,336][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:39:39,081][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:40:01,256][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:40:07,564][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:40:18,240][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:40:28,086][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:40:31,904][root][INFO] - Processing question number 20
[2025-03-06 22:40:31,906][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:40:38,475][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:40:52,205][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:40:56,253][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:41:06,082][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:41:11,778][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:41:17,186][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:41:23,917][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:41:39,020][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:41:46,161][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:41:52,609][root][INFO] - Processing question number 30
[2025-03-06 22:41:52,611][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:42:05,901][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:42:18,593][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:42:26,974][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:42:32,871][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:42:41,036][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:42:59,161][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:43:06,686][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:43:20,591][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:43:29,827][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:43:43,966][root][INFO] - Processing question number 40
[2025-03-06 22:43:43,969][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:43:52,665][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:44:18,059][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:44:30,795][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:44:38,866][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:45:00,222][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:45:05,306][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:45:13,744][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:45:24,167][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:45:38,581][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:45:49,484][root][INFO] - Processing question number 50
[2025-03-06 22:45:49,487][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:45:58,321][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:46:11,611][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:46:18,390][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:46:29,621][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:46:46,436][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:46:54,443][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:47:04,015][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:47:14,598][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:47:31,257][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:47:44,436][root][INFO] - Processing question number 60
[2025-03-06 22:47:44,439][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:47:50,720][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:48:09,324][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:48:18,873][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:48:29,864][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:48:36,788][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:48:41,248][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:48:44,415][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:48:55,462][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:49:03,857][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:49:31,086][root][INFO] - Processing question number 70
[2025-03-06 22:49:31,090][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:49:38,618][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:49:46,199][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:49:53,104][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:50:02,740][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:50:22,184][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:50:28,446][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:50:34,743][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:51:01,553][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:51:10,950][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:51:22,112][root][INFO] - Processing question number 80
[2025-03-06 22:51:22,116][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:51:33,867][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:51:41,676][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:51:46,080][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:51:58,123][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:52:03,335][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:52:13,152][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:52:32,595][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:52:40,386][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:52:48,220][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:52:57,214][root][INFO] - Processing question number 90
[2025-03-06 22:52:57,218][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:53:08,535][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:53:19,040][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:53:25,113][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:53:32,422][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:53:38,032][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:53:44,225][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:54:00,606][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:54:09,920][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:54:19,505][root][INFO] - Inference complete
[2025-03-06 22:54:19,505][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:54:19,511][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:54:19,513][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,513][root][WARNING] - |Q. 21||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,513][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,514][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,514][root][WARNING] - |Q. 56||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:54:19,515][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,515][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:54:19,515][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,515][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,515][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,516][root][WARNING] - |Q. 98||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,516][root][WARNING] - |Q. 98||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,516][root][INFO] - |Q. 98||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,518][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,518][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,518][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,518][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,519][root][WARNING] - |Q. 22||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,519][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,519][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,519][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,520][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,522][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,522][root][WARNING] - |Q. 12||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,522][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,523][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,523][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,523][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,524][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,524][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:54:19,524][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,524][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:54:19,525][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,525][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,525][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,526][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,526][root][WARNING] - |Q. 48||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:54:19,526][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,526][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:54:19,527][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:54:19,527][root][WARNING] - |Q. 89||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:54:19,527][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:54:19,529][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:54:19,533][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:54:19,533][root][INFO] - Saved parsed outputs
[2025-03-06 22:54:19,534][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:54:19,535][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:54:19,535][root][INFO] - Saved parsing metadata
[2025-03-06 22:54:19,536][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:54:19,537][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:54:19,539][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:54:19,553][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_1
[2025-03-06 22:54:19,553][root][INFO] - Summary of metrics : {'label_accuracy': 0.2828282828282828, 'misclassification_rate': 0.7171717171717171, 'combined_accuracy': 0.25252525252525254, 'malformed_label': 3, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 28, 'correct_label_and_domain': 25, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.1717171717171717, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.1414141414141414, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.12121212121212122, 'correct_domain_wrong_label': 63, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 22:54:25,982][root][INFO] - Setting global seed to 989
[2025-03-06 22:54:25,987][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:54:25,987][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:54:25,989][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:54:25,990][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:54:25,992][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:54:25,992][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:54:26,160][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:54:26,596][root][INFO] - Full model selected, loading model
[2025-03-06 22:54:41,923][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:55:48,096][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:55:48,097][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:56:14,755][root][INFO] - Peft model loaded successfully
[2025-03-06 22:56:21,076][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:56:21,078][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 22:56:21,078][root][INFO] - Starting inference
[2025-03-06 22:56:21,300][root][INFO] - Processing question number 0
[2025-03-06 22:56:21,302][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:56:32,216][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:56:40,329][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:56:45,726][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:56:59,485][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:57:09,100][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:57:23,582][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:57:27,629][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:57:37,169][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:57:55,158][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:58:09,667][root][INFO] - Processing question number 10
[2025-03-06 22:58:09,669][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:58:19,456][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:58:41,822][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:58:59,452][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:59:12,592][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:59:21,459][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:59:38,611][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:59:45,555][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:59:59,004][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 23:00:10,209][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 23:00:16,259][root][INFO] - Processing question number 20
[2025-03-06 23:00:16,261][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 23:00:29,244][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 23:00:35,037][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 23:00:46,211][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 23:00:53,659][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 23:00:58,438][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 23:01:04,257][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 23:01:12,599][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 23:01:24,024][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 23:01:31,779][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 23:01:35,990][root][INFO] - Processing question number 30
[2025-03-06 23:01:35,992][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:01:54,581][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 23:02:00,374][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 23:02:24,546][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 23:02:32,458][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 23:02:37,526][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 23:02:44,692][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 23:02:47,920][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 23:03:03,066][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:03:12,216][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 23:03:30,617][root][INFO] - Processing question number 40
[2025-03-06 23:03:30,619][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:03:57,293][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 23:04:12,524][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 23:04:24,555][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 23:04:29,579][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 23:04:41,997][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:04:49,139][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 23:04:58,953][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:05:06,000][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 23:05:22,265][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 23:05:39,291][root][INFO] - Processing question number 50
[2025-03-06 23:05:39,294][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:05:52,558][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 23:06:09,527][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 23:06:14,487][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 23:06:32,367][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 23:06:41,592][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:07:03,907][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 23:07:15,202][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 23:07:21,241][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 23:07:32,052][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 23:07:40,727][root][INFO] - Processing question number 60
[2025-03-06 23:07:40,730][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:07:46,928][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:07:57,885][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 23:08:10,033][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 23:08:18,231][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 23:08:30,309][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 23:08:39,469][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 23:08:45,526][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 23:08:51,470][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:08:59,937][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 23:09:25,871][root][INFO] - Processing question number 70
[2025-03-06 23:09:25,875][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 23:09:32,145][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 23:09:38,420][root][INFO] - Domain : Property, Question : 6
[2025-03-06 23:09:44,790][root][INFO] - Domain : Property, Question : 13
[2025-03-06 23:09:59,804][root][INFO] - Domain : Property, Question : 20
[2025-03-06 23:10:11,341][root][INFO] - Domain : Property, Question : 33
[2025-03-06 23:10:17,895][root][INFO] - Domain : Property, Question : 39
[2025-03-06 23:10:26,342][root][INFO] - Domain : Property, Question : 48
[2025-03-06 23:10:44,076][root][INFO] - Domain : Property, Question : 54
[2025-03-06 23:11:02,364][root][INFO] - Domain : Property, Question : 61
[2025-03-06 23:11:13,958][root][INFO] - Processing question number 80
[2025-03-06 23:11:13,962][root][INFO] - Domain : Property, Question : 67
[2025-03-06 23:11:20,823][root][INFO] - Domain : Property, Question : 75
[2025-03-06 23:11:28,589][root][INFO] - Domain : Property, Question : 83
[2025-03-06 23:11:40,147][root][INFO] - Domain : Property, Question : 89
[2025-03-06 23:11:55,810][root][INFO] - Domain : Property, Question : 97
[2025-03-06 23:12:04,164][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:12:09,294][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 23:12:16,064][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:12:26,924][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 23:12:32,665][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 23:12:40,988][root][INFO] - Processing question number 90
[2025-03-06 23:12:40,991][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 23:12:57,038][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 23:13:01,937][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 23:13:09,688][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 23:13:17,169][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:13:21,299][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 23:13:27,741][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 23:13:35,589][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 23:13:47,843][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 23:13:55,501][root][INFO] - Inference complete
[2025-03-06 23:13:55,501][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 23:13:55,506][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 23:13:55,507][root][WARNING] - |Q. 1||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,507][root][WARNING] - |Q. 1||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,507][root][INFO] - |Q. 1||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,507][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,508][root][WARNING] - |Q. 7||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,508][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,508][root][WARNING] - |Q. 28||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,508][root][WARNING] - |Q. 28||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,508][root][INFO] - |Q. 28||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,509][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,509][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,509][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,509][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,509][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,510][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,511][root][WARNING] - |Q. 98||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,511][root][WARNING] - |Q. 98||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,511][root][INFO] - |Q. 98||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,511][root][WARNING] - |Q. 9||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,511][root][WARNING] - |Q. 9||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,511][root][INFO] - |Q. 9||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,512][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,512][root][WARNING] - |Q. 17||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:13:55,512][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,512][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:13:55,512][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,513][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,513][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,513][root][WARNING] - |Q. 71||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,514][root][WARNING] - |Q. 71||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,514][root][INFO] - |Q. 71||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,514][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,515][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,515][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,516][root][WARNING] - |Q. 72||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,516][root][WARNING] - |Q. 72||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:13:55,516][root][INFO] - |Q. 72||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,516][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:13:55,519][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,519][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,519][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,520][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,520][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:13:55,520][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,521][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:13:55,521][root][WARNING] - |Q. 20||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,521][root][WARNING] - |Q. 20||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,521][root][INFO] - |Q. 20||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,521][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,521][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,521][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,522][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,522][root][WARNING] - |Q. 48||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,522][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,523][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,524][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:13:55,524][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,524][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:13:55,525][root][WARNING] - |Q. 85||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:13:55,525][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:13:55,525][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:13:55,526][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 23:13:55,530][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 23:13:55,530][root][INFO] - Saved parsed outputs
[2025-03-06 23:13:55,530][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 23:13:55,532][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 23:13:55,532][root][INFO] - Saved parsing metadata
[2025-03-06 23:13:55,532][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 23:13:55,534][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 23:13:55,535][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 23:13:55,548][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_1
[2025-03-06 23:13:55,548][root][INFO] - Summary of metrics : {'label_accuracy': 0.3333333333333333, 'misclassification_rate': 0.6666666666666667, 'combined_accuracy': 0.32323232323232326, 'malformed_label': 4, 'malformed_domain': 9, 'total_predictions': 99, 'correct_predictions': 33, 'correct_label_and_domain': 32, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.18181818181818182, 'Criminal_Law_confidence': 0.13131313131313133, 'Evidence_confidence': 0.1414141414141414, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.12121212121212122, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 1, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 23:14:01,944][root][INFO] - Setting global seed to 206
[2025-03-06 23:14:01,949][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:14:01,950][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:14:01,951][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:14:01,952][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:14:01,954][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:14:01,954][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:14:02,120][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:14:02,381][root][INFO] - Full model selected, loading model
[2025-03-06 23:14:14,938][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:15:19,760][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:15:19,761][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:15:45,790][root][INFO] - Peft model loaded successfully
[2025-03-06 23:15:52,124][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:15:52,126][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:15:52,126][root][INFO] - Starting inference
[2025-03-06 23:15:52,322][root][INFO] - Processing question number 0
[2025-03-06 23:15:52,324][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:16:01,776][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:16:13,711][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:16:23,233][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:16:50,078][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:17:10,799][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:17:17,788][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:17:25,455][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:17:34,473][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:17:40,671][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:17:47,597][root][INFO] - Processing question number 10
[2025-03-06 23:17:47,599][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:17:54,195][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:17:59,898][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:18:07,056][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:18:14,389][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:18:24,477][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:18:29,901][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:18:36,512][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:18:45,602][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:18:54,986][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:19:05,571][root][INFO] - Processing question number 20
[2025-03-06 23:19:05,573][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:19:11,290][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:19:15,765][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:19:22,653][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:19:27,607][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:19:42,816][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:19:52,788][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:20:04,720][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:20:13,371][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:20:20,203][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:20:30,567][root][INFO] - Processing question number 30
[2025-03-06 23:20:30,570][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:20:43,860][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:20:53,770][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:21:04,261][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:21:13,274][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:21:18,472][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:21:25,815][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:21:40,430][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:21:49,127][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:21:58,337][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:22:07,284][root][INFO] - Processing question number 40
[2025-03-06 23:22:07,286][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:22:17,083][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:22:24,443][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:22:33,899][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:22:40,682][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:22:50,157][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:22:54,790][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:23:12,224][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:23:19,121][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:23:25,128][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:23:40,164][root][INFO] - Processing question number 50
[2025-03-06 23:23:40,167][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:23:46,330][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:23:51,246][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:24:09,700][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:24:16,125][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:24:26,475][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:24:35,090][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:24:46,042][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:24:57,392][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:25:05,929][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:25:24,613][root][INFO] - Processing question number 60
[2025-03-06 23:25:24,617][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:25:36,066][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:25:45,947][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:25:58,734][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:26:11,346][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:26:19,562][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:26:33,001][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:26:41,329][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:26:48,712][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:27:07,442][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:27:11,194][root][INFO] - Processing question number 70
[2025-03-06 23:27:11,197][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:27:23,253][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:27:33,486][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:27:47,385][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:28:00,005][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:28:20,783][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:28:29,909][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:28:38,152][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:29:02,369][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:29:18,570][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:29:26,556][root][INFO] - Processing question number 80
[2025-03-06 23:29:26,560][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:29:35,607][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:29:45,014][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:29:55,329][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:30:00,655][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:30:13,260][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:30:29,450][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:30:48,761][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:30:59,568][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:31:07,407][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:31:20,869][root][INFO] - Processing question number 90
[2025-03-06 23:31:20,873][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:31:33,146][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:31:39,166][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:31:50,588][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:32:04,472][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:32:18,934][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:32:31,391][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:32:41,066][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:32:49,635][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:33:04,818][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:33:16,568][root][INFO] - Inference complete
[2025-03-06 23:33:16,568][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:33:16,574][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:33:16,575][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,576][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,576][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,576][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,577][root][WARNING] - |Q. 20||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:33:16,577][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,577][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:33:16,578][root][WARNING] - |Q. 99||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,579][root][WARNING] - |Q. 99||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,579][root][INFO] - |Q. 99||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,580][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,580][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,580][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,580][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,580][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,580][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,581][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,581][root][WARNING] - |Q. 89||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,581][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,582][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,582][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,582][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,583][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,583][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,583][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,585][root][WARNING] - |Q. 12||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,585][root][WARNING] - |Q. 12||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,586][root][INFO] - |Q. 12||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,587][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,587][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,588][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,590][root][WARNING] - |Q. 92||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:33:16,590][root][WARNING] - |Q. 92||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:33:16,590][root][INFO] - |Q. 92||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:33:16,592][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:33:16,596][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:33:16,596][root][INFO] - Saved parsed outputs
[2025-03-06 23:33:16,596][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:33:16,597][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:33:16,598][root][INFO] - Saved parsing metadata
[2025-03-06 23:33:16,598][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:33:16,600][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:33:16,601][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:33:16,614][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_2
[2025-03-06 23:33:16,615][root][INFO] - Summary of metrics : {'label_accuracy': 0.27, 'misclassification_rate': 0.73, 'combined_accuracy': 0.23, 'malformed_label': 1, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 27, 'correct_label_and_domain': 23, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.14285714285714285, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.13333333333333333, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.15, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 66, 'correct_label_wrong_domain': 4, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 23:33:23,366][root][INFO] - Setting global seed to 206
[2025-03-06 23:33:23,371][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:33:23,371][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:33:23,373][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:33:23,374][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:33:23,376][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:33:23,376][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:33:23,539][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:33:23,794][root][INFO] - Full model selected, loading model
[2025-03-06 23:33:35,642][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:34:40,587][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:34:40,587][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:35:03,946][root][INFO] - Peft model loaded successfully
[2025-03-06 23:35:10,280][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:35:10,282][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:35:10,282][root][INFO] - Starting inference
[2025-03-06 23:35:10,500][root][INFO] - Processing question number 0
[2025-03-06 23:35:10,502][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:35:18,988][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:35:23,835][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:35:32,103][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:35:59,117][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:36:15,067][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:36:23,445][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:36:38,491][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:36:46,544][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:36:53,742][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:36:58,150][root][INFO] - Processing question number 10
[2025-03-06 23:36:58,152][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:37:04,469][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:37:21,005][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:37:25,947][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:37:32,386][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:37:39,216][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:37:44,667][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:37:54,153][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:38:03,077][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:38:11,133][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:38:21,075][root][INFO] - Processing question number 20
[2025-03-06 23:38:21,077][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:38:28,397][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:38:35,926][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:38:47,708][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:38:53,398][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:39:04,887][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:39:20,836][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:39:35,092][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:39:44,725][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:39:53,591][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:40:07,340][root][INFO] - Processing question number 30
[2025-03-06 23:40:07,343][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:40:21,831][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:40:31,027][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:40:40,890][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:40:55,281][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:40:59,930][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:41:06,470][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:41:20,563][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:41:30,360][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:41:39,707][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:41:56,744][root][INFO] - Processing question number 40
[2025-03-06 23:41:56,748][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:42:09,999][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:42:16,698][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:42:30,919][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:42:37,792][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:42:48,704][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:43:01,946][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:43:14,813][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:43:28,146][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:43:34,820][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:43:42,811][root][INFO] - Processing question number 50
[2025-03-06 23:43:42,814][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:43:49,490][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:43:56,686][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:44:06,044][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:44:15,686][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:44:27,563][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:44:37,427][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:44:47,077][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:45:04,253][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:45:19,760][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:45:40,136][root][INFO] - Processing question number 60
[2025-03-06 23:45:40,139][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:45:54,103][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:46:07,619][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:46:15,760][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:46:32,042][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:46:49,311][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:47:06,304][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:47:14,428][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:47:21,024][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:47:35,095][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:47:49,235][root][INFO] - Processing question number 70
[2025-03-06 23:47:49,238][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:47:57,164][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:48:08,148][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:48:21,678][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:48:34,639][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:48:42,699][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:48:51,185][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:48:59,383][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:49:17,762][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:49:30,486][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:49:36,811][root][INFO] - Processing question number 80
[2025-03-06 23:49:36,814][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:49:45,653][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:49:55,158][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:50:05,641][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:50:10,799][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:50:23,672][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:50:35,135][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:51:02,129][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:51:14,201][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:51:22,060][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:51:33,536][root][INFO] - Processing question number 90
[2025-03-06 23:51:33,540][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:51:44,804][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:51:50,771][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:52:00,864][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:52:10,617][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:52:25,557][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:52:36,281][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:52:50,950][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:52:58,610][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:53:12,976][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:53:24,677][root][INFO] - Inference complete
[2025-03-06 23:53:24,678][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:53:24,682][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:53:24,684][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,684][root][WARNING] - |Q. 20||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:53:24,685][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,685][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:53:24,685][root][WARNING] - |Q. 41||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,685][root][WARNING] - |Q. 41||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,685][root][INFO] - |Q. 41||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,687][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,688][root][WARNING] - |Q. 89||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,688][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,689][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,689][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,689][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,690][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,690][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,690][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,690][root][WARNING] - |Q. 87||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,690][root][WARNING] - |Q. 87||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,690][root][INFO] - |Q. 87||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,692][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,692][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,693][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,693][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,693][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,693][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,693][root][WARNING] - |Q. 26||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,693][root][WARNING] - |Q. 26||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,694][root][INFO] - |Q. 26||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,694][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,694][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,694][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,694][root][WARNING] - |Q. 47||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,695][root][WARNING] - |Q. 47||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,695][root][INFO] - |Q. 47||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,695][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,695][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,695][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,695][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,696][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,696][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,697][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,697][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,697][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,698][root][WARNING] - |Q. 81||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,698][root][WARNING] - |Q. 81||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:53:24,698][root][INFO] - |Q. 81||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,699][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:53:24,699][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:53:24,699][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:53:24,699][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:53:24,701][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:53:24,705][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:53:24,705][root][INFO] - Saved parsed outputs
[2025-03-06 23:53:24,705][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:53:24,707][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:53:24,707][root][INFO] - Saved parsing metadata
[2025-03-06 23:53:24,708][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:53:24,710][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:53:24,711][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:53:24,833][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_2
[2025-03-06 23:53:24,833][root][INFO] - Summary of metrics : {'label_accuracy': 0.31, 'misclassification_rate': 0.69, 'combined_accuracy': 0.27, 'malformed_label': 2, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 31, 'correct_label_and_domain': 27, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.6, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.15, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 62, 'correct_label_wrong_domain': 4, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 23:53:36,684][root][INFO] - Setting global seed to 206
[2025-03-06 23:53:36,705][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:53:36,705][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:53:36,706][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:53:36,708][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:53:36,713][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:53:36,714][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:53:36,898][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:53:37,193][root][INFO] - Full model selected, loading model
[2025-03-06 23:53:56,689][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:55:01,602][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:55:01,602][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:55:27,877][root][INFO] - Peft model loaded successfully
[2025-03-06 23:55:34,128][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:55:34,130][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:55:34,130][root][INFO] - Starting inference
[2025-03-06 23:55:34,382][root][INFO] - Processing question number 0
[2025-03-06 23:55:34,384][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:55:44,010][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:55:55,884][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:56:05,285][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:56:15,933][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:56:22,638][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:56:34,676][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:56:42,425][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:56:49,998][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:57:05,249][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:57:08,282][root][INFO] - Processing question number 10
[2025-03-06 23:57:08,284][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:57:13,367][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:57:29,839][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:57:34,986][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:57:47,380][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:58:00,462][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:58:13,128][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:58:21,815][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:58:28,886][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:58:40,851][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:58:50,622][root][INFO] - Processing question number 20
[2025-03-06 23:58:50,624][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:58:56,165][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:59:07,438][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:59:17,601][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:59:24,048][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:59:35,420][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:59:46,277][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:00:05,031][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:00:14,627][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:00:22,673][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:00:31,310][root][INFO] - Processing question number 30
[2025-03-07 00:00:31,312][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:00:46,174][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:01:00,727][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:01:09,395][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:01:36,420][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:01:44,382][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:01:52,144][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:01:57,125][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:02:07,489][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:02:20,162][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:02:46,840][root][INFO] - Processing question number 40
[2025-03-07 00:02:46,843][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:02:54,547][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:02:59,813][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:03:14,157][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:03:29,626][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:03:46,823][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:03:55,587][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:04:01,862][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:04:08,457][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:04:20,087][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:04:29,493][root][INFO] - Processing question number 50
[2025-03-07 00:04:29,495][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:04:36,595][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:04:41,788][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:04:50,142][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:05:07,392][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:05:20,377][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:05:30,022][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:05:39,226][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:05:52,235][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:06:11,816][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:06:31,862][root][INFO] - Processing question number 60
[2025-03-07 00:06:31,865][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:06:41,953][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:06:57,016][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:07:07,654][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:07:20,770][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:07:31,792][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:07:52,027][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:07:59,810][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:08:05,409][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:08:21,715][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:08:30,446][root][INFO] - Processing question number 70
[2025-03-07 00:08:30,449][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:08:37,607][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:08:46,261][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:08:58,681][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:09:14,111][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:09:28,675][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:09:39,103][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:09:50,144][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:10:06,983][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:10:21,477][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:10:28,420][root][INFO] - Processing question number 80
[2025-03-07 00:10:28,423][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:10:34,751][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:10:44,252][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:11:11,346][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:11:23,788][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:11:31,482][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:11:39,601][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:12:04,051][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:12:17,371][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:12:23,810][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:12:38,576][root][INFO] - Processing question number 90
[2025-03-07 00:12:38,580][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:12:44,388][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:12:49,495][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:12:59,327][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:13:11,283][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:13:24,825][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:13:36,382][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:13:48,491][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:14:04,498][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:14:20,155][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:14:28,386][root][INFO] - Inference complete
[2025-03-07 00:14:28,386][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:14:28,391][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:14:28,392][root][WARNING] - |Q. 6||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,392][root][WARNING] - |Q. 6||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,392][root][INFO] - |Q. 6||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,393][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,393][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,393][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,394][root][WARNING] - |Q. 56||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,394][root][WARNING] - |Q. 56||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,394][root][INFO] - |Q. 56||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,395][root][WARNING] - |Q. 21||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,395][root][WARNING] - |Q. 21||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,395][root][INFO] - |Q. 21||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,396][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,396][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,396][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,397][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,397][root][WARNING] - |Q. 89||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,397][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,397][root][WARNING] - |Q. 24||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,398][root][WARNING] - |Q. 24||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,398][root][INFO] - |Q. 24||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,398][root][WARNING] - |Q. 28||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,398][root][WARNING] - |Q. 28||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,398][root][INFO] - |Q. 28||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,398][root][WARNING] - |Q. 34||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,399][root][WARNING] - |Q. 34||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:14:28,399][root][INFO] - |Q. 34||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,399][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:14:28,400][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,400][root][WARNING] - |Q. 77||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:14:28,400][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,400][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:14:28,403][root][WARNING] - |Q. 12||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,403][root][WARNING] - |Q. 12||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,403][root][INFO] - |Q. 12||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,404][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,404][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,404][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,404][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,404][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,405][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,405][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,405][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,405][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,406][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,406][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,406][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,407][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,407][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,407][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,408][root][WARNING] - |Q. 88||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,408][root][WARNING] - |Q. 88||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:14:28,408][root][INFO] - |Q. 88||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,408][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:14:28,408][root][WARNING] - |Q. 91||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,409][root][WARNING] - |Q. 91||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,409][root][INFO] - |Q. 91||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,410][root][WARNING] - |Q. 79||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:14:28,410][root][WARNING] - |Q. 79||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:14:28,410][root][INFO] - |Q. 79||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:14:28,412][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:14:28,416][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:14:28,416][root][INFO] - Saved parsed outputs
[2025-03-07 00:14:28,416][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:14:28,417][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:14:28,417][root][INFO] - Saved parsing metadata
[2025-03-07 00:14:28,417][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:14:28,419][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:14:28,420][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:14:28,433][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_2
[2025-03-07 00:14:28,433][root][INFO] - Summary of metrics : {'label_accuracy': 0.3, 'misclassification_rate': 0.7, 'combined_accuracy': 0.25, 'malformed_label': 3, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 30, 'correct_label_and_domain': 25, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.16, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 63, 'correct_label_wrong_domain': 5, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-07 00:14:35,468][root][INFO] - Setting global seed to 989
[2025-03-07 00:14:35,475][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:14:35,475][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-07 00:14:35,476][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:14:35,478][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:14:35,480][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:14:35,480][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:14:35,676][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 00:14:35,923][root][INFO] - Full model selected, loading model
[2025-03-07 00:14:52,743][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:15:56,463][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:15:56,464][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:16:21,870][root][INFO] - Peft model loaded successfully
[2025-03-07 00:16:28,150][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:16:28,152][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:16:28,152][root][INFO] - Starting inference
[2025-03-07 00:16:28,372][root][INFO] - Processing question number 0
[2025-03-07 00:16:28,375][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:16:37,853][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:16:49,778][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:16:59,290][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:17:26,094][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:17:46,784][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:17:53,765][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:18:01,421][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:18:10,428][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:18:16,619][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:18:23,533][root][INFO] - Processing question number 10
[2025-03-07 00:18:23,535][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:18:30,123][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:18:35,817][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:18:42,965][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:18:50,293][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:19:00,377][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:19:05,789][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:19:12,392][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:19:21,462][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:19:30,835][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:19:41,404][root][INFO] - Processing question number 20
[2025-03-07 00:19:41,406][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:19:47,110][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:19:51,574][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:19:58,448][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:20:03,397][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:20:18,583][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:20:28,538][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:20:40,449][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:20:49,087][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:20:55,907][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:21:06,258][root][INFO] - Processing question number 30
[2025-03-07 00:21:06,260][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:21:19,529][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:21:29,423][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:21:39,895][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:21:48,893][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:21:54,084][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:22:01,417][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:22:16,010][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:22:24,698][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:22:33,890][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:22:42,830][root][INFO] - Processing question number 40
[2025-03-07 00:22:42,833][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:22:52,618][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:22:59,969][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:23:09,414][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:23:16,188][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:23:25,654][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:23:30,282][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:23:47,697][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:23:54,587][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:24:00,583][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:24:15,609][root][INFO] - Processing question number 50
[2025-03-07 00:24:15,612][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:24:21,769][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:24:26,679][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:24:45,113][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:24:51,531][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:25:01,867][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:25:10,469][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:25:21,407][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:25:32,745][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:25:41,273][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:25:59,935][root][INFO] - Processing question number 60
[2025-03-07 00:25:59,938][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:26:11,373][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:26:21,243][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:26:34,016][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:26:46,613][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:26:54,818][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:27:08,240][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:27:16,554][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:27:23,929][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:27:42,643][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:27:46,393][root][INFO] - Processing question number 70
[2025-03-07 00:27:46,396][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:27:58,436][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:28:08,652][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:28:22,530][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:28:35,132][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:28:55,882][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:29:04,999][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:29:13,232][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:29:37,422][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:29:53,606][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:30:01,583][root][INFO] - Processing question number 80
[2025-03-07 00:30:01,587][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:30:10,624][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:30:20,020][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:30:30,301][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:30:35,593][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:30:48,107][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:31:04,279][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:31:23,558][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:31:34,349][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:31:42,181][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:31:55,620][root][INFO] - Processing question number 90
[2025-03-07 00:31:55,624][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:32:07,882][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:32:13,892][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:32:25,303][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:32:39,138][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:32:53,540][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:33:05,952][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:33:15,594][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:33:24,130][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:33:39,255][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:33:50,962][root][INFO] - Inference complete
[2025-03-07 00:33:50,963][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:33:50,968][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:33:50,969][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,969][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,969][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,970][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,970][root][WARNING] - |Q. 20||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:33:50,970][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,970][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:33:50,971][root][WARNING] - |Q. 99||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,972][root][WARNING] - |Q. 99||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,972][root][INFO] - |Q. 99||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,973][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,973][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,973][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,973][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,973][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,973][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,974][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,974][root][WARNING] - |Q. 89||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,974][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,975][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,975][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,975][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,976][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,976][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,976][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,978][root][WARNING] - |Q. 12||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,978][root][WARNING] - |Q. 12||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,978][root][INFO] - |Q. 12||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,980][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,980][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,980][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,983][root][WARNING] - |Q. 92||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:33:50,983][root][WARNING] - |Q. 92||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:33:50,983][root][INFO] - |Q. 92||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:33:50,984][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:33:50,988][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:33:50,988][root][INFO] - Saved parsed outputs
[2025-03-07 00:33:50,988][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:33:50,990][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:33:50,990][root][INFO] - Saved parsing metadata
[2025-03-07 00:33:50,990][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:33:50,992][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:33:50,993][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:33:51,022][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_2
[2025-03-07 00:33:51,022][root][INFO] - Summary of metrics : {'label_accuracy': 0.27, 'misclassification_rate': 0.73, 'combined_accuracy': 0.23, 'malformed_label': 1, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 27, 'correct_label_and_domain': 23, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.14285714285714285, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.13333333333333333, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.15, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 66, 'correct_label_wrong_domain': 4, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-07 00:33:59,789][root][INFO] - Setting global seed to 989
[2025-03-07 00:33:59,811][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:33:59,811][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-07 00:33:59,812][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:33:59,814][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:33:59,817][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:33:59,817][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:33:59,990][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 00:34:00,247][root][INFO] - Full model selected, loading model
[2025-03-07 00:34:15,643][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:35:19,399][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:35:19,399][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:35:44,260][root][INFO] - Peft model loaded successfully
[2025-03-07 00:35:50,550][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:35:50,552][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:35:50,552][root][INFO] - Starting inference
[2025-03-07 00:35:50,797][root][INFO] - Processing question number 0
[2025-03-07 00:35:50,799][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:36:01,140][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:36:05,981][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:36:15,255][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:36:28,635][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:36:45,752][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:36:52,120][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:37:18,441][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:37:24,567][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:37:33,161][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:37:40,871][root][INFO] - Processing question number 10
[2025-03-07 00:37:40,873][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:37:51,453][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:37:57,185][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:38:02,035][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:38:07,787][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:38:16,280][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:38:22,350][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:38:30,297][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:38:39,429][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:38:44,287][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:38:49,117][root][INFO] - Processing question number 20
[2025-03-07 00:38:49,119][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:38:55,679][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:39:00,131][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:39:08,301][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:39:13,238][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:39:29,927][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:39:49,399][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:40:04,394][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:40:15,060][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:40:21,543][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:40:33,365][root][INFO] - Processing question number 30
[2025-03-07 00:40:33,367][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:40:39,146][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:40:46,132][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:41:03,331][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:41:20,263][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:41:26,333][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:41:36,183][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:41:54,640][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:42:09,553][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:42:18,281][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:42:32,712][root][INFO] - Processing question number 40
[2025-03-07 00:42:32,714][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:42:45,457][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:42:51,555][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:43:09,251][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:43:19,656][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:43:33,329][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:43:39,244][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:43:45,934][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:43:51,980][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:44:18,517][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:44:35,542][root][INFO] - Processing question number 50
[2025-03-07 00:44:35,545][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:44:43,069][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:44:48,012][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:45:00,010][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:45:06,469][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:45:18,189][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:45:39,753][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:45:44,845][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:45:54,936][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:46:08,692][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:46:22,705][root][INFO] - Processing question number 60
[2025-03-07 00:46:22,708][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:46:32,144][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:46:46,311][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:47:00,317][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:47:14,268][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:47:28,576][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:47:37,317][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:47:44,594][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:47:50,602][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:47:57,656][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:48:06,089][root][INFO] - Processing question number 70
[2025-03-07 00:48:06,092][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:48:14,947][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:48:29,297][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:48:39,691][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:48:49,091][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:49:09,644][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:49:17,782][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:49:28,194][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:49:34,540][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:49:40,912][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:49:47,600][root][INFO] - Processing question number 80
[2025-03-07 00:49:47,604][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:49:54,871][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:50:08,800][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:50:19,940][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:50:25,351][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:50:33,619][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:50:43,916][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:51:01,458][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:51:10,067][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:51:21,183][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:51:32,660][root][INFO] - Processing question number 90
[2025-03-07 00:51:32,663][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:51:48,695][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:52:02,365][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:52:10,955][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:52:28,689][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:52:44,130][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:52:55,628][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:53:08,076][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:53:31,164][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:53:44,320][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:53:51,426][root][INFO] - Inference complete
[2025-03-07 00:53:51,427][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:53:51,432][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:53:51,433][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,434][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:51,434][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,435][root][WARNING] - |Q. 41||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,435][root][WARNING] - |Q. 41||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:53:51,435][root][INFO] - |Q. 41||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,436][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:53:51,437][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,437][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:51,437][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,438][root][WARNING] - |Q. 83||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,438][root][WARNING] - |Q. 83||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:53:51,438][root][INFO] - |Q. 83||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,438][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:53:51,438][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,438][root][WARNING] - |Q. 89||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:51,439][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,440][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,440][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:51,440][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,440][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,441][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:51,441][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,442][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,442][root][WARNING] - |Q. 38||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:53:51,442][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,442][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:53:51,443][root][WARNING] - |Q. 80||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,443][root][WARNING] - |Q. 80||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:51,443][root][INFO] - |Q. 80||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,444][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,445][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:51,445][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,445][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,445][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:51,446][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,446][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,446][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:51,446][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,447][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:51,447][root][WARNING] - |Q. 30||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:53:51,447][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:51,447][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:53:51,451][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:53:51,455][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:53:51,455][root][INFO] - Saved parsed outputs
[2025-03-07 00:53:51,455][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:53:51,456][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:53:51,456][root][INFO] - Saved parsing metadata
[2025-03-07 00:53:51,457][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:53:51,459][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:53:51,460][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:53:51,474][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_2
[2025-03-07 00:53:51,474][root][INFO] - Summary of metrics : {'label_accuracy': 0.32, 'misclassification_rate': 0.6799999999999999, 'combined_accuracy': 0.28, 'malformed_label': 4, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 32, 'correct_label_and_domain': 28, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.15, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 61, 'correct_label_wrong_domain': 4, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-07 00:53:59,002][root][INFO] - Setting global seed to 989
[2025-03-07 00:53:59,008][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:53:59,008][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-07 00:53:59,009][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:53:59,011][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:53:59,013][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:53:59,013][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:53:59,195][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 00:53:59,467][root][INFO] - Full model selected, loading model
[2025-03-07 00:54:13,693][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:55:22,383][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:55:22,383][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:55:50,659][root][INFO] - Peft model loaded successfully
[2025-03-07 00:55:57,016][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:55:57,018][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 00:55:57,018][root][INFO] - Starting inference
[2025-03-07 00:55:57,200][root][INFO] - Processing question number 0
[2025-03-07 00:55:57,202][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:56:02,511][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:56:14,280][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:56:32,903][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:56:41,918][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:57:00,061][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:57:12,612][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:57:22,654][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:57:27,271][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:57:35,285][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:57:43,810][root][INFO] - Processing question number 10
[2025-03-07 00:57:43,812][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:57:49,871][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:57:55,434][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:58:12,632][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:58:19,626][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:58:34,997][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:58:40,901][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:58:48,985][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:58:55,007][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:59:01,603][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:59:05,931][root][INFO] - Processing question number 20
[2025-03-07 00:59:05,933][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:59:11,429][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:59:16,298][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:59:23,887][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:59:36,932][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:59:48,415][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 01:00:02,260][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 01:00:28,753][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 01:00:38,686][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 01:00:49,638][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 01:01:06,412][root][INFO] - Processing question number 30
[2025-03-07 01:01:06,414][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 01:01:12,030][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 01:01:22,587][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 01:01:30,408][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 01:01:38,468][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 01:01:50,792][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 01:01:59,061][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 01:02:12,705][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 01:02:22,314][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 01:02:30,317][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 01:02:40,734][root][INFO] - Processing question number 40
[2025-03-07 01:02:40,737][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 01:02:49,718][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 01:02:58,088][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 01:03:04,920][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 01:03:30,722][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 01:03:44,445][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 01:03:51,372][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 01:03:57,401][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 01:04:05,230][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 01:04:14,702][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 01:04:23,112][root][INFO] - Processing question number 50
[2025-03-07 01:04:23,115][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 01:04:31,635][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 01:04:37,534][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 01:04:57,452][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 01:05:09,774][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 01:05:17,939][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 01:05:37,518][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 01:06:04,830][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 01:06:12,157][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 01:06:27,420][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 01:06:42,423][root][INFO] - Processing question number 60
[2025-03-07 01:06:42,426][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 01:06:56,329][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 01:07:12,932][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 01:07:26,147][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 01:07:35,199][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 01:07:49,333][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 01:08:00,683][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 01:08:09,512][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 01:08:19,610][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 01:08:32,632][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 01:08:58,808][root][INFO] - Processing question number 70
[2025-03-07 01:08:58,812][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 01:09:07,118][root][INFO] - Domain : Property, Question : 9
[2025-03-07 01:09:18,528][root][INFO] - Domain : Property, Question : 17
[2025-03-07 01:09:30,416][root][INFO] - Domain : Property, Question : 25
[2025-03-07 01:09:57,800][root][INFO] - Domain : Property, Question : 30
[2025-03-07 01:10:04,178][root][INFO] - Domain : Property, Question : 36
[2025-03-07 01:10:19,217][root][INFO] - Domain : Property, Question : 46
[2025-03-07 01:10:29,536][root][INFO] - Domain : Property, Question : 53
[2025-03-07 01:10:41,144][root][INFO] - Domain : Property, Question : 59
[2025-03-07 01:10:48,141][root][INFO] - Domain : Property, Question : 66
[2025-03-07 01:10:53,669][root][INFO] - Processing question number 80
[2025-03-07 01:10:53,673][root][INFO] - Domain : Property, Question : 69
[2025-03-07 01:11:01,633][root][INFO] - Domain : Property, Question : 81
[2025-03-07 01:11:15,326][root][INFO] - Domain : Property, Question : 88
[2025-03-07 01:11:28,497][root][INFO] - Domain : Property, Question : 91
[2025-03-07 01:11:36,893][root][INFO] - Domain : Property, Question : 94
[2025-03-07 01:11:50,660][root][INFO] - Domain : Property, Question : 100
[2025-03-07 01:12:11,878][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 01:12:31,051][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 01:12:47,998][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 01:12:55,322][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 01:13:09,236][root][INFO] - Processing question number 90
[2025-03-07 01:13:09,240][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 01:13:19,407][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 01:13:25,838][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 01:13:37,133][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 01:13:50,261][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 01:14:02,462][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 01:14:09,132][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 01:14:17,974][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 01:14:30,775][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 01:14:45,503][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 01:14:53,203][root][INFO] - Inference complete
[2025-03-07 01:14:53,203][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 01:14:53,208][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 01:14:53,209][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,210][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,210][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,212][root][WARNING] - |Q. 71||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,212][root][WARNING] - |Q. 71||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,212][root][INFO] - |Q. 71||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,213][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,213][root][WARNING] - |Q. 89||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 01:14:53,213][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,214][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 01:14:53,214][root][WARNING] - |Q. 28||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,214][root][WARNING] - |Q. 28||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,214][root][INFO] - |Q. 28||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,216][root][WARNING] - |Q. 4||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,216][root][WARNING] - |Q. 4||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 01:14:53,216][root][INFO] - |Q. 4||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,216][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 01:14:53,217][root][WARNING] - |Q. 23||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,217][root][WARNING] - |Q. 23||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,217][root][INFO] - |Q. 23||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,217][root][WARNING] - |Q. 50||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,217][root][WARNING] - |Q. 50||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,217][root][INFO] - |Q. 50||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,218][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,218][root][WARNING] - |Q. 85||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,218][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,219][root][WARNING] - |Q. 90||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,219][root][WARNING] - |Q. 90||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 01:14:53,219][root][INFO] - |Q. 90||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,219][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 01:14:53,221][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,221][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,221][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,221][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,221][root][WARNING] - |Q. 82||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 01:14:53,221][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,221][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 01:14:53,222][root][WARNING] - |Q. 9||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,222][root][WARNING] - |Q. 9||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,222][root][INFO] - |Q. 9||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,222][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,223][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,223][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,223][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,224][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,224][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,226][root][WARNING] - |Q. 74||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,226][root][WARNING] - |Q. 74||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,226][root][INFO] - |Q. 74||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,226][root][WARNING] - |Q. 79||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,226][root][WARNING] - |Q. 79||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 01:14:53,226][root][INFO] - |Q. 79||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,226][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 01:14:53,227][root][WARNING] - |Q. 92||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 01:14:53,227][root][WARNING] - |Q. 92||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:14:53,227][root][INFO] - |Q. 92||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 01:14:53,228][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 01:14:53,232][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 01:14:53,232][root][INFO] - Saved parsed outputs
[2025-03-07 01:14:53,232][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 01:14:53,233][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 01:14:53,233][root][INFO] - Saved parsing metadata
[2025-03-07 01:14:53,234][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 01:14:53,235][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
[2025-03-07 01:14:53,236][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 01:14:53,252][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_2
[2025-03-07 01:14:53,252][root][INFO] - Summary of metrics : {'label_accuracy': 0.29, 'misclassification_rate': 0.71, 'combined_accuracy': 0.26, 'malformed_label': 6, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 29, 'correct_label_and_domain': 26, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.14285714285714285, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.2857142857142857, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.15, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 63, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Job 31 completed at Fri Mar  7 01:14:54 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n514
Job ID: 25358406
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 04:41:38
CPU Efficiency: 9.92% of 1-23:19:40 core-walltime
Job Wall-clock time: 04:43:58
Memory Utilized: 26.88 GB
Memory Efficiency: 74.67% of 36.00 GB
