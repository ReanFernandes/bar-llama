Starting job 31 at Thu Mar  6 20:31:29 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_10_samples prompt=json_fact_first_zero_shot_unstructured train=json_fact_first_zero_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '31', 'training']
Updating job 31 to status training with exit code None
Status update completed for job 31
[2025-03-06 20:31:37,787][root][INFO] - Global seed set to 314
[2025-03-06 20:31:37,789][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 20:31:37,789][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 20:31:37,789][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 20:31:37,789][root][INFO] - Current training config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:31:37,789][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 20:31:37,822][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:31:37,826][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 20:31:37,828][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 20:31:37,833][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 20:31:38,240][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 20:31:47,250][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 20:32:18,996][root][INFO] - Model prepared for kbit training
[2025-03-06 20:32:18,997][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'o_proj', 'up_proj', 'down_proj', 'gate_proj', 'v_proj', 'q_proj', 'k_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 20:32:20,893][root][INFO] - Lora adapter added to model
[2025-03-06 20:32:20,896][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_zero_shot_unstructured
[2025-03-06 20:32:21,053][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.6653, 'grad_norm': 0.12771128118038177, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.7884, 'grad_norm': 0.18442566692829132, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.5692, 'grad_norm': 0.14750751852989197, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.5988, 'grad_norm': 0.20812185108661652, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.3913, 'grad_norm': 0.2279030680656433, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 1.2201, 'grad_norm': 0.36160793900489807, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 1.1823, 'grad_norm': 0.20029181241989136, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 1.0387, 'grad_norm': 0.28327903151512146, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 1.0256, 'grad_norm': 0.14316456019878387, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 1.0579, 'grad_norm': 0.21659481525421143, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 1.0275, 'grad_norm': 0.2635081708431244, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.9795, 'grad_norm': 0.2227732390165329, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.9415, 'grad_norm': 0.1486842930316925, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.9853, 'grad_norm': 0.17854459583759308, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.8576, 'grad_norm': 0.15969568490982056, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.8827, 'grad_norm': 0.2096489518880844, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.947, 'grad_norm': 0.18350887298583984, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.8244, 'grad_norm': 0.20993220806121826, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.858, 'grad_norm': 0.20573154091835022, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.8561, 'grad_norm': 0.2537371516227722, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.8493, 'grad_norm': 0.20460930466651917, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.7471, 'grad_norm': 0.2579030692577362, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.8421, 'grad_norm': 0.22926625609397888, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.7706, 'grad_norm': 0.2761501371860504, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.7689, 'grad_norm': 0.2347385138273239, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.8139, 'grad_norm': 0.2860785126686096, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.8554, 'grad_norm': 0.241934135556221, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.7463, 'grad_norm': 0.27100902795791626, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.768, 'grad_norm': 0.41373106837272644, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.6952, 'grad_norm': 0.4524078071117401, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.7058, 'grad_norm': 0.7123038172721863, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.5672, 'grad_norm': 0.5682886838912964, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.5922, 'grad_norm': 0.5326793193817139, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.4137, 'grad_norm': 0.49897900223731995, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.5092, 'grad_norm': 0.8239037990570068, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.3762, 'grad_norm': 0.6710854172706604, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.4846, 'grad_norm': 0.5875511765480042, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.2403, 'grad_norm': 0.5628089904785156, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.3567, 'grad_norm': 0.5518360733985901, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.2395, 'grad_norm': 0.541565477848053, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.266, 'grad_norm': 0.6065335869789124, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.1501, 'grad_norm': 0.5180844068527222, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.2032, 'grad_norm': 0.5270098447799683, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.1159, 'grad_norm': 0.3274448812007904, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.1588, 'grad_norm': 0.5162679553031921, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.1356, 'grad_norm': 0.43815770745277405, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.1571, 'grad_norm': 0.47316405177116394, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.1093, 'grad_norm': 0.3157249391078949, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.1106, 'grad_norm': 0.37738171219825745, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0864, 'grad_norm': 0.3283607065677643, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 2670.1675, 'train_samples_per_second': 0.393, 'train_steps_per_second': 0.056, 'train_loss': 0.7306445670127869, 'epoch': 15.0}
[2025-03-06 21:16:54,549][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_zero_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '31', 'trained', '0']
Updating job 31 to status trained with exit code 0
Status update completed for job 31
Starting evaluations for job 31
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 21:17:04,842][root][INFO] - Setting global seed to 206
[2025-03-06 21:17:04,848][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:17:04,848][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:17:04,849][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:17:04,868][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:17:04,870][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:17:04,870][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:17:05,020][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:17:05,291][root][INFO] - Full model selected, loading model
[2025-03-06 21:17:16,968][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:18:20,991][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:18:20,991][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:18:46,752][root][INFO] - Peft model loaded successfully
[2025-03-06 21:18:53,073][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:18:53,076][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:18:53,076][root][INFO] - Starting inference
[2025-03-06 21:18:53,295][root][INFO] - Processing question number 0
[2025-03-06 21:18:53,297][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:18:59,401][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:19:10,569][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:19:17,002][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:19:22,885][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:19:31,928][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:19:46,350][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:19:50,519][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:19:56,899][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:20:11,303][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:20:26,996][root][INFO] - Processing question number 10
[2025-03-06 21:20:26,999][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:20:35,868][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:20:43,846][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:20:57,697][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:21:05,085][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:21:12,168][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:21:28,591][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:21:32,311][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:21:48,785][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:21:56,826][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:22:13,290][root][INFO] - Processing question number 20
[2025-03-06 21:22:13,292][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:22:24,931][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:22:30,139][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:22:41,294][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:22:55,461][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:23:06,587][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:23:11,238][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:23:23,214][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:23:39,233][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:23:46,707][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:23:54,186][root][INFO] - Processing question number 30
[2025-03-06 21:23:54,188][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:24:12,417][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:24:29,793][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:24:46,141][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:24:55,746][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:25:02,021][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:25:10,551][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:25:19,500][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:25:34,350][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:25:48,165][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:25:58,202][root][INFO] - Processing question number 40
[2025-03-06 21:25:58,205][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:26:12,573][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:26:30,715][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:26:39,354][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:26:45,653][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:26:59,517][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:27:07,845][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:27:15,254][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:27:22,088][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:27:30,725][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:27:44,436][root][INFO] - Processing question number 50
[2025-03-06 21:27:44,439][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:27:55,331][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:28:07,417][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:28:17,233][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:28:30,109][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:28:37,264][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:28:48,269][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:29:12,291][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:29:20,745][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:29:31,061][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:29:37,955][root][INFO] - Processing question number 60
[2025-03-06 21:29:37,958][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:29:44,938][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:29:56,914][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:30:03,897][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:30:26,718][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:30:38,651][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:30:43,103][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:30:56,913][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:31:05,296][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:31:10,569][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:31:34,481][root][INFO] - Processing question number 70
[2025-03-06 21:31:34,484][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:31:49,279][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:31:53,590][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:32:00,573][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:32:11,937][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:32:20,978][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:32:26,735][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:32:36,423][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:32:53,819][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:32:58,274][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:33:03,963][root][INFO] - Processing question number 80
[2025-03-06 21:33:03,967][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:33:11,421][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:33:18,276][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:33:30,147][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:33:42,252][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:34:01,804][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:34:14,404][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:34:22,623][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:34:26,230][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:34:32,602][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:34:41,629][root][INFO] - Processing question number 90
[2025-03-06 21:34:41,633][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:34:52,802][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:34:59,739][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:35:08,892][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:35:15,904][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:35:21,722][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:35:31,925][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:35:38,461][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:35:47,584][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:36:00,801][root][INFO] - Inference complete
[2025-03-06 21:36:00,802][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,807][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,809][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,809][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,810][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,810][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,810][root][WARNING] - |Q. 56||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:36:00,811][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,811][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:36:00,812][root][WARNING] - |Q. 98||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,812][root][WARNING] - |Q. 98||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,812][root][INFO] - |Q. 98||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,812][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,813][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,813][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,813][root][WARNING] - |Q. 37||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,813][root][WARNING] - |Q. 37||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,813][root][INFO] - |Q. 37||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,813][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,814][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,814][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,814][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,814][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,814][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,815][root][WARNING] - |Q. 79||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,815][root][WARNING] - |Q. 79||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,815][root][INFO] - |Q. 79||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,816][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,816][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,816][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,816][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,816][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,816][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,817][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,817][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,817][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,819][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,819][root][WARNING] - |Q. 47||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,819][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,820][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,820][root][WARNING] - |Q. 95||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,820][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,821][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,821][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,821][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,822][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,822][root][WARNING] - |Q. 78||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,822][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,823][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,823][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,823][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,824][root][WARNING] - |Q. 83||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,824][root][WARNING] - |Q. 83||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:36:00,824][root][INFO] - |Q. 83||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,825][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:36:00,825][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:36:00,825][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:36:00,825][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:36:00,827][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,832][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,832][root][INFO] - Saved parsed outputs
[2025-03-06 21:36:00,832][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,833][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,833][root][INFO] - Saved parsing metadata
[2025-03-06 21:36:00,834][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,836][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:36:00,837][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:36:00,850][root][INFO] - Evaluation completed for json_fact_first_zero_shot_unstructured, on test_set_1
[2025-03-06 21:36:00,850][root][INFO] - Summary of metrics : {'label_accuracy': 0.32323232323232326, 'misclassification_rate': 0.6767676767676767, 'combined_accuracy': 0.30303030303030304, 'malformed_label': 2, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 32, 'correct_label_and_domain': 30, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.1717171717171717, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.1414141414141414, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.12121212121212122, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 2, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 31 to status completed with exit code 0
Eval status update completed for job 31
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '31', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 31 to status running with exit code None
Eval status update completed for job 31
[2025-03-06 21:36:07,339][root][INFO] - Setting global seed to 206
[2025-03-06 21:36:07,344][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:36:07,344][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:36:07,346][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:36:07,347][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:36:07,349][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:36:07,349][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:36:07,520][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:36:07,807][root][INFO] - Full model selected, loading model
[2025-03-06 21:36:21,903][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:37:27,002][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:37:27,002][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:37:53,882][root][INFO] - Peft model loaded successfully
[2025-03-06 21:38:00,305][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:38:00,307][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:38:00,307][root][INFO] - Starting inference
[2025-03-06 21:38:00,609][root][INFO] - Processing question number 0
[2025-03-06 21:38:00,611][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:38:12,657][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:38:24,703][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:38:33,913][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:38:40,442][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:38:49,773][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:39:12,283][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:39:16,479][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:39:24,439][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:39:44,285][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:40:11,362][root][INFO] - Processing question number 10
[2025-03-06 21:40:11,364][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:40:21,109][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:40:28,847][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:40:41,691][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:40:51,532][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:40:59,013][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:41:14,590][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:41:21,277][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:41:35,513][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:41:48,679][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:41:56,927][root][INFO] - Processing question number 20
[2025-03-06 21:41:56,929][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:42:12,074][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:42:19,572][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:42:25,681][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:42:37,238][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:43:04,130][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:43:14,173][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:43:22,466][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:43:31,209][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:43:37,713][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:43:43,076][root][INFO] - Processing question number 30
[2025-03-06 21:43:43,078][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:43:54,496][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:44:17,874][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:44:25,834][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:44:33,799][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:44:39,488][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:44:46,044][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:44:52,346][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:45:04,727][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:45:14,836][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:45:18,712][root][INFO] - Processing question number 40
[2025-03-06 21:45:18,715][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:45:27,765][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:45:39,114][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:45:48,215][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:45:56,782][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:46:06,859][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:46:18,270][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:46:25,604][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:46:32,917][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:46:44,787][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:47:01,373][root][INFO] - Processing question number 50
[2025-03-06 21:47:01,377][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:47:10,230][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:47:23,554][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:47:28,467][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:47:49,699][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:47:57,050][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:48:07,045][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:48:22,488][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:48:27,430][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:48:39,807][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:48:47,319][root][INFO] - Processing question number 60
[2025-03-06 21:48:47,324][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:48:53,640][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:49:07,003][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:49:21,305][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:49:30,432][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:49:36,337][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:49:45,122][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:50:02,273][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:50:14,521][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:50:22,085][root][INFO] - Domain : Evidence, Question : 78
