Starting job 18 at Thu Mar  6 10:59:13 CET 2025
Configuration: model=llama3 tokenizer=llama3 dataset=all_domains_10_samples prompt=json_answer_first_few_shot_structured train=json_answer_first_few_shot_structured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '18', 'training']
Updating job 18 to status training with exit code None
Status update completed for job 18
[2025-03-06 10:59:21,334][root][INFO] - Global seed set to 314
[2025-03-06 10:59:21,336][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 10:59:21,336][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 10:59:21,336][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 10:59:21,336][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 10:59:21,336][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/distilled_dataset.json
[2025-03-06 10:59:21,376][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:59:21,381][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 10:59:21,382][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 10:59:21,412][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 10:59:22,235][root][INFO] - Tokenizer meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 10:59:45,445][root][INFO] - Quantised model meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 11:00:16,354][root][INFO] - Model prepared for kbit training
[2025-03-06 11:00:16,355][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'up_proj', 'q_proj', 'k_proj', 'o_proj', 'gate_proj', 'down_proj', 'v_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 11:00:18,107][root][INFO] - Lora adapter added to model
[2025-03-06 11:00:18,111][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_answer_first_few_shot_structured
[2025-03-06 11:00:18,435][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.6018, 'grad_norm': 0.44729071855545044, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.5547, 'grad_norm': 0.38354265689849854, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.4618, 'grad_norm': 0.3586123287677765, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.2132, 'grad_norm': 0.3908311724662781, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.0331, 'grad_norm': 0.38639146089553833, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.6942, 'grad_norm': 0.40421727299690247, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.5558, 'grad_norm': 0.23118537664413452, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.5024, 'grad_norm': 0.21523594856262207, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.5292, 'grad_norm': 0.18996462225914001, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.499, 'grad_norm': 0.15847551822662354, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.4938, 'grad_norm': 0.15387344360351562, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.4482, 'grad_norm': 0.15541240572929382, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.4602, 'grad_norm': 0.16731832921504974, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.4276, 'grad_norm': 0.16937492787837982, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.4143, 'grad_norm': 0.17482799291610718, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.3971, 'grad_norm': 0.178066223859787, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.3805, 'grad_norm': 0.17985540628433228, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.3614, 'grad_norm': 0.18067608773708344, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.3726, 'grad_norm': 0.19401748478412628, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.371, 'grad_norm': 0.19268524646759033, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.332, 'grad_norm': 0.1861453652381897, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.3216, 'grad_norm': 0.19934532046318054, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.3577, 'grad_norm': 0.2220047265291214, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.3162, 'grad_norm': 0.22345378994941711, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.3316, 'grad_norm': 0.21150048077106476, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.3102, 'grad_norm': 0.2244962900876999, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.308, 'grad_norm': 0.24359099566936493, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.3511, 'grad_norm': 0.20359845459461212, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.2733, 'grad_norm': 0.3009693920612335, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.2619, 'grad_norm': 0.29562488198280334, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.1904, 'grad_norm': 0.6029319763183594, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.1983, 'grad_norm': 0.4001995325088501, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.2095, 'grad_norm': 0.43051713705062866, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.1129, 'grad_norm': 0.31042811274528503, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.1082, 'grad_norm': 0.5334584712982178, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.1084, 'grad_norm': 0.3501066565513611, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.1076, 'grad_norm': 0.33948034048080444, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.0447, 'grad_norm': 0.3074069619178772, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.0715, 'grad_norm': 0.42456403374671936, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.0495, 'grad_norm': 0.4051143229007721, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.0325, 'grad_norm': 0.27349695563316345, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.0269, 'grad_norm': 0.1976107507944107, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.0251, 'grad_norm': 0.2700600028038025, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.0194, 'grad_norm': 0.13383331894874573, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.014, 'grad_norm': 0.1868250072002411, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.0157, 'grad_norm': 0.2291187196969986, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0143, 'grad_norm': 0.12129221856594086, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.0117, 'grad_norm': 0.09243077784776688, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0126, 'grad_norm': 0.11596925556659698, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0122, 'grad_norm': 0.07417072355747223, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 4103.0161, 'train_samples_per_second': 0.256, 'train_steps_per_second': 0.037, 'train_loss': 0.3664190744608641, 'epoch': 15.0}
[2025-03-06 12:08:49,230][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_answer_first_few_shot_structured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '18', 'trained', '0']
Updating job 18 to status trained with exit code 0
Status update completed for job 18
Starting evaluations for job 18
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 12:09:02,862][root][INFO] - Setting global seed to 206
[2025-03-06 12:09:02,868][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 12:09:02,868][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 12:09:02,869][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 12:09:02,871][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 12:09:02,876][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 12:09:02,876][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 12:09:03,056][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 12:09:03,726][root][INFO] - Full model selected, loading model
[2025-03-06 12:09:28,759][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 12:11:14,824][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 12:11:14,824][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 12:11:48,542][root][INFO] - Peft model loaded successfully
[2025-03-06 12:11:56,263][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 12:11:56,264][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:11:56,265][root][INFO] - Starting inference
[2025-03-06 12:11:56,436][root][INFO] - Processing question number 0
[2025-03-06 12:11:56,438][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 12:12:09,643][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 12:12:26,209][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 12:12:41,861][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 12:12:55,642][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 12:13:12,102][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 12:13:26,341][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 12:13:43,498][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 12:13:58,910][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 12:14:12,573][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 12:14:28,038][root][INFO] - Processing question number 10
[2025-03-06 12:14:28,040][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 12:14:43,898][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 12:14:59,984][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 12:15:15,643][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 12:15:28,927][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 12:15:43,665][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 12:15:57,779][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 12:16:10,799][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 12:16:24,736][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 12:16:36,489][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 12:16:49,198][root][INFO] - Processing question number 20
[2025-03-06 12:16:49,201][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 12:17:02,434][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 12:17:17,792][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 12:17:32,584][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 12:17:47,524][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 12:18:02,729][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 12:18:18,166][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 12:18:32,747][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 12:18:47,888][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 12:19:03,774][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 12:19:17,395][root][INFO] - Processing question number 30
[2025-03-06 12:19:17,398][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 12:19:31,917][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 12:19:46,518][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 12:20:01,970][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 12:20:15,568][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 12:20:27,247][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 12:20:42,573][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 12:20:56,849][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 12:21:10,756][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 12:21:24,268][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 12:21:38,347][root][INFO] - Processing question number 40
[2025-03-06 12:21:38,351][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 12:21:52,235][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 12:22:07,964][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 12:22:21,451][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 12:22:38,342][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 12:22:51,769][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 12:23:07,407][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 12:23:24,311][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 12:23:40,249][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 12:23:53,822][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 12:24:08,437][root][INFO] - Processing question number 50
[2025-03-06 12:24:08,442][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 12:24:25,605][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 12:24:43,493][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 12:24:56,512][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 12:25:14,135][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 12:25:28,815][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 12:25:40,906][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 12:25:56,664][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 12:26:13,094][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 12:26:26,787][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 12:26:41,639][root][INFO] - Processing question number 60
[2025-03-06 12:26:41,643][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 12:26:53,206][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:27:04,822][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 12:27:21,625][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 12:27:35,166][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 12:27:50,697][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 12:28:04,340][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 12:28:17,601][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 12:28:30,762][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:28:44,442][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 12:28:56,328][root][INFO] - Processing question number 70
[2025-03-06 12:28:56,333][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 12:29:11,156][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 12:29:22,933][root][INFO] - Domain : Property, Question : 6
[2025-03-06 12:29:35,816][root][INFO] - Domain : Property, Question : 13
[2025-03-06 12:29:50,330][root][INFO] - Domain : Property, Question : 20
[2025-03-06 12:30:05,915][root][INFO] - Domain : Property, Question : 33
[2025-03-06 12:30:19,927][root][INFO] - Domain : Property, Question : 39
[2025-03-06 12:30:37,866][root][INFO] - Domain : Property, Question : 48
[2025-03-06 12:30:52,562][root][INFO] - Domain : Property, Question : 54
[2025-03-06 12:31:10,610][root][INFO] - Domain : Property, Question : 61
[2025-03-06 12:31:26,249][root][INFO] - Processing question number 80
[2025-03-06 12:31:26,254][root][INFO] - Domain : Property, Question : 67
[2025-03-06 12:31:39,847][root][INFO] - Domain : Property, Question : 75
[2025-03-06 12:31:56,111][root][INFO] - Domain : Property, Question : 83
[2025-03-06 12:32:08,319][root][INFO] - Domain : Property, Question : 89
[2025-03-06 12:32:21,807][root][INFO] - Domain : Property, Question : 97
[2025-03-06 12:32:35,305][root][INFO] - Domain : Property, Question : 100
[2025-03-06 12:32:48,888][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 12:33:03,643][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 12:33:17,535][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 12:33:33,208][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 12:33:44,881][root][INFO] - Processing question number 90
[2025-03-06 12:33:44,886][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 12:34:04,029][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 12:34:18,691][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 12:34:33,899][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 12:34:46,852][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 12:35:01,007][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 12:35:17,117][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 12:35:30,594][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 12:35:44,868][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 12:35:59,880][root][INFO] - Inference complete
[2025-03-06 12:35:59,880][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:35:59,887][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:35:59,894][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:35:59,895][root][WARNING] - |Q. 12||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:35:59,895][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:35:59,897][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:35:59,897][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:35:59,898][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:35:59,901][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:35:59,907][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:35:59,907][root][INFO] - Saved parsed outputs
[2025-03-06 12:35:59,907][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:35:59,909][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:35:59,909][root][INFO] - Saved parsing metadata
[2025-03-06 12:35:59,909][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:35:59,911][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:35:59,912][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 12:35:59,926][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 12:35:59,926][root][INFO] - Summary of metrics : {'label_accuracy': 0.40404040404040403, 'misclassification_rate': 0.595959595959596, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 0, 'malformed_domain': 8, 'total_predictions': 99, 'correct_predictions': 40, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.13131313131313133, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 53, 'correct_label_wrong_domain': 2, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 12:36:06,372][root][INFO] - Setting global seed to 206
[2025-03-06 12:36:06,378][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 12:36:06,378][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 12:36:06,379][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 12:36:06,382][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 12:36:06,384][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 12:36:06,384][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 12:36:06,727][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 12:36:07,507][root][INFO] - Full model selected, loading model
[2025-03-06 12:36:31,712][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 12:38:18,592][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 12:38:18,592][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 12:38:53,474][root][INFO] - Peft model loaded successfully
[2025-03-06 12:39:01,424][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 12:39:01,425][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:39:01,425][root][INFO] - Starting inference
[2025-03-06 12:39:01,604][root][INFO] - Processing question number 0
[2025-03-06 12:39:01,606][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 12:39:13,805][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 12:39:30,319][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 12:39:46,301][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 12:40:00,775][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 12:40:15,993][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 12:40:30,511][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 12:40:45,717][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 12:40:58,801][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 12:41:11,667][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 12:41:27,269][root][INFO] - Processing question number 10
[2025-03-06 12:41:27,271][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 12:41:42,934][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 12:41:59,462][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 12:42:16,388][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 12:42:29,691][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 12:42:45,736][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 12:42:59,346][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 12:43:12,022][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 12:43:26,230][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 12:43:38,493][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 12:43:51,716][root][INFO] - Processing question number 20
[2025-03-06 12:43:51,718][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 12:44:03,788][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 12:44:18,866][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 12:44:33,072][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 12:44:47,725][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 12:45:02,799][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 12:45:16,261][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 12:45:30,852][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 12:45:46,131][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 12:46:02,043][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 12:46:15,975][root][INFO] - Processing question number 30
[2025-03-06 12:46:15,977][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 12:46:29,952][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 12:46:44,627][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 12:47:01,339][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 12:47:15,978][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 12:47:27,804][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 12:47:41,247][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 12:47:55,482][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 12:48:09,664][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 12:48:23,290][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 12:48:39,067][root][INFO] - Processing question number 40
[2025-03-06 12:48:39,070][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 12:48:53,680][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 12:49:09,594][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 12:49:26,728][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 12:49:41,673][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 12:49:55,214][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 12:50:09,599][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 12:50:26,696][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 12:50:41,463][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 12:50:55,459][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 12:51:10,045][root][INFO] - Processing question number 50
[2025-03-06 12:51:10,049][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 12:51:27,474][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 12:51:44,617][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 12:51:57,731][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 12:52:13,717][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 12:52:29,129][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 12:52:40,934][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 12:52:55,883][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 12:53:08,743][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 12:53:22,702][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 12:53:37,576][root][INFO] - Processing question number 60
[2025-03-06 12:53:37,580][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 12:53:50,192][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:54:02,321][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 12:54:22,295][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 12:54:35,955][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 12:54:50,852][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 12:55:05,846][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 12:55:20,549][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 12:55:34,601][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:55:47,730][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 12:56:00,578][root][INFO] - Processing question number 70
[2025-03-06 12:56:00,582][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 12:56:15,624][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 12:56:28,105][root][INFO] - Domain : Property, Question : 6
[2025-03-06 12:56:40,326][root][INFO] - Domain : Property, Question : 13
[2025-03-06 12:56:54,349][root][INFO] - Domain : Property, Question : 20
[2025-03-06 12:57:09,497][root][INFO] - Domain : Property, Question : 33
[2025-03-06 12:57:25,623][root][INFO] - Domain : Property, Question : 39
[2025-03-06 12:57:42,606][root][INFO] - Domain : Property, Question : 48
[2025-03-06 12:57:59,283][root][INFO] - Domain : Property, Question : 54
[2025-03-06 12:58:14,768][root][INFO] - Domain : Property, Question : 61
[2025-03-06 12:58:29,268][root][INFO] - Processing question number 80
[2025-03-06 12:58:29,290][root][INFO] - Domain : Property, Question : 67
[2025-03-06 12:58:43,141][root][INFO] - Domain : Property, Question : 75
[2025-03-06 12:59:02,777][root][INFO] - Domain : Property, Question : 83
[2025-03-06 12:59:15,188][root][INFO] - Domain : Property, Question : 89
[2025-03-06 12:59:28,784][root][INFO] - Domain : Property, Question : 97
[2025-03-06 12:59:44,141][root][INFO] - Domain : Property, Question : 100
[2025-03-06 12:59:59,694][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 13:00:15,556][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:00:29,623][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 13:00:45,475][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 13:01:00,931][root][INFO] - Processing question number 90
[2025-03-06 13:01:00,948][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 13:01:18,624][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 13:01:34,276][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 13:01:50,639][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 13:02:03,308][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:02:18,870][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 13:02:32,411][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 13:02:47,686][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 13:03:02,083][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 13:03:16,918][root][INFO] - Inference complete
[2025-03-06 13:03:16,918][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:03:16,933][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:03:16,945][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:03:16,964][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:03:16,964][root][INFO] - Saved parsed outputs
[2025-03-06 13:03:16,964][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:03:16,966][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:03:16,966][root][INFO] - Saved parsing metadata
[2025-03-06 13:03:16,966][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:03:16,968][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:03:16,977][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 13:03:17,063][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 13:03:17,063][root][INFO] - Summary of metrics : {'label_accuracy': 0.40404040404040403, 'misclassification_rate': 0.595959595959596, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 0, 'malformed_domain': 8, 'total_predictions': 99, 'correct_predictions': 40, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.13131313131313133, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 53, 'correct_label_wrong_domain': 2, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 13:03:23,809][root][INFO] - Setting global seed to 206
[2025-03-06 13:03:23,815][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 13:03:23,815][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 13:03:23,816][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 13:03:23,818][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:03:23,820][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:03:23,820][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 13:03:23,999][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 13:03:24,604][root][INFO] - Full model selected, loading model
[2025-03-06 13:03:48,584][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 13:05:36,842][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 13:05:36,859][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 13:06:13,633][root][INFO] - Peft model loaded successfully
[2025-03-06 13:06:21,222][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 13:06:21,223][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:06:21,223][root][INFO] - Starting inference
[2025-03-06 13:06:21,426][root][INFO] - Processing question number 0
[2025-03-06 13:06:21,465][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 13:06:34,308][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 13:06:50,706][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 13:07:06,135][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 13:07:20,763][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 13:07:37,260][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 13:07:55,221][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 13:08:10,945][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 13:08:26,231][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 13:08:38,146][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 13:08:54,784][root][INFO] - Processing question number 10
[2025-03-06 13:08:54,806][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 13:09:11,218][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 13:09:26,151][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 13:09:41,680][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 13:09:54,204][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 13:10:07,267][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 13:10:21,565][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 13:10:34,137][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 13:10:48,965][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 13:11:02,445][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 13:11:15,617][root][INFO] - Processing question number 20
[2025-03-06 13:11:15,620][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 13:11:27,749][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 13:11:40,370][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 13:11:54,222][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 13:12:08,268][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 13:12:22,744][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 13:12:36,365][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 13:12:51,548][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 13:13:06,360][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 13:13:23,979][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 13:13:38,067][root][INFO] - Processing question number 30
[2025-03-06 13:13:38,070][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 13:13:52,452][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 13:14:09,411][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 13:14:23,454][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 13:14:37,737][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 13:14:50,783][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 13:15:04,386][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 13:15:18,107][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 13:15:33,990][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 13:15:49,837][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 13:16:06,278][root][INFO] - Processing question number 40
[2025-03-06 13:16:06,281][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 13:16:20,624][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 13:16:36,734][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 13:16:50,813][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 13:17:06,019][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 13:17:19,775][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 13:17:35,028][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 13:17:51,077][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 13:18:05,745][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 13:18:18,927][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 13:18:32,649][root][INFO] - Processing question number 50
[2025-03-06 13:18:32,653][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 13:18:50,664][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 13:19:08,550][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 13:19:22,623][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 13:19:38,135][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 13:19:51,702][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 13:20:03,458][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 13:20:19,279][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 13:20:35,462][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 13:20:51,572][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 13:21:05,794][root][INFO] - Processing question number 60
[2025-03-06 13:21:05,798][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 13:21:18,298][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 13:21:30,054][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 13:21:47,907][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 13:21:59,426][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 13:22:12,307][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 13:22:27,153][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 13:22:43,684][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 13:22:58,331][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 13:23:11,639][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 13:23:31,322][root][INFO] - Processing question number 70
[2025-03-06 13:23:31,327][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 13:23:46,197][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 13:24:02,585][root][INFO] - Domain : Property, Question : 6
[2025-03-06 13:24:14,793][root][INFO] - Domain : Property, Question : 13
[2025-03-06 13:24:31,144][root][INFO] - Domain : Property, Question : 20
[2025-03-06 13:24:47,063][root][INFO] - Domain : Property, Question : 33
[2025-03-06 13:25:01,233][root][INFO] - Domain : Property, Question : 39
[2025-03-06 13:25:15,913][root][INFO] - Domain : Property, Question : 48
[2025-03-06 13:25:30,158][root][INFO] - Domain : Property, Question : 54
[2025-03-06 13:25:47,684][root][INFO] - Domain : Property, Question : 61
[2025-03-06 13:26:02,583][root][INFO] - Processing question number 80
[2025-03-06 13:26:02,589][root][INFO] - Domain : Property, Question : 67
[2025-03-06 13:26:17,715][root][INFO] - Domain : Property, Question : 75
[2025-03-06 13:26:35,462][root][INFO] - Domain : Property, Question : 83
[2025-03-06 13:26:47,550][root][INFO] - Domain : Property, Question : 89
[2025-03-06 13:27:00,773][root][INFO] - Domain : Property, Question : 97
[2025-03-06 13:27:14,626][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:27:29,384][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 13:27:44,505][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:27:58,344][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 13:28:12,640][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 13:28:26,312][root][INFO] - Processing question number 90
[2025-03-06 13:28:26,318][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 13:28:44,620][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 13:28:59,999][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 13:29:15,575][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 13:29:27,966][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:29:45,243][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 13:29:59,740][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 13:30:13,777][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 13:30:26,975][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 13:30:43,165][root][INFO] - Inference complete
[2025-03-06 13:30:43,165][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:30:43,172][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:30:43,181][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:43,182][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:30:43,182][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:43,185][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:30:43,193][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:30:43,193][root][INFO] - Saved parsed outputs
[2025-03-06 13:30:43,193][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:30:43,194][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:30:43,194][root][INFO] - Saved parsing metadata
[2025-03-06 13:30:43,195][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:30:43,196][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:30:43,198][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 13:30:43,268][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 13:30:43,268][root][INFO] - Summary of metrics : {'label_accuracy': 0.43434343434343436, 'misclassification_rate': 0.5656565656565656, 'combined_accuracy': 0.41414141414141414, 'malformed_label': 0, 'malformed_domain': 8, 'total_predictions': 99, 'correct_predictions': 43, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.6923076923076923, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.13131313131313133, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 50, 'correct_label_wrong_domain': 2, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 13:30:54,560][root][INFO] - Setting global seed to 989
[2025-03-06 13:30:54,569][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 13:30:54,569][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 13:30:54,571][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 13:30:54,572][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:30:54,578][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:30:54,578][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 13:30:54,763][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 13:30:55,379][root][INFO] - Full model selected, loading model
[2025-03-06 13:31:20,070][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 13:33:13,420][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 13:33:13,421][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 13:33:49,206][root][INFO] - Peft model loaded successfully
[2025-03-06 13:33:56,737][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 13:33:56,739][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:33:56,739][root][INFO] - Starting inference
[2025-03-06 13:33:56,911][root][INFO] - Processing question number 0
[2025-03-06 13:33:56,913][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 13:34:10,115][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 13:34:26,771][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 13:34:42,491][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 13:34:56,326][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 13:35:12,849][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 13:35:27,144][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 13:35:44,357][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 13:35:59,817][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 13:36:13,534][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 13:36:29,047][root][INFO] - Processing question number 10
[2025-03-06 13:36:29,050][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 13:36:44,955][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 13:37:01,101][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 13:37:16,805][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 13:37:30,128][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 13:37:44,920][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 13:37:59,075][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 13:38:12,134][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 13:38:26,117][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 13:38:37,908][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 13:38:50,654][root][INFO] - Processing question number 20
[2025-03-06 13:38:50,657][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 13:39:03,945][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 13:39:19,366][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 13:39:34,206][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 13:39:49,199][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 13:40:04,447][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 13:40:19,920][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 13:40:34,555][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 13:40:49,754][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 13:41:05,692][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 13:41:19,360][root][INFO] - Processing question number 30
[2025-03-06 13:41:19,363][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 13:41:33,924][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 13:41:48,571][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 13:42:04,080][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 13:42:17,729][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 13:42:29,443][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 13:42:44,819][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 13:42:59,142][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 13:43:13,091][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 13:43:26,658][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 13:43:40,799][root][INFO] - Processing question number 40
[2025-03-06 13:43:40,805][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 13:43:54,736][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 13:44:10,511][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 13:44:24,050][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 13:44:40,995][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 13:44:54,472][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 13:45:10,159][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 13:45:27,114][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 13:45:43,109][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 13:45:56,727][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 13:46:11,389][root][INFO] - Processing question number 50
[2025-03-06 13:46:11,393][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 13:46:28,569][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 13:46:46,472][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 13:46:59,532][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 13:47:17,210][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 13:47:31,928][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 13:47:44,069][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 13:47:59,886][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 13:48:16,376][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 13:48:30,110][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 13:48:45,015][root][INFO] - Processing question number 60
[2025-03-06 13:48:45,019][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 13:48:56,620][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 13:49:08,282][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 13:49:25,134][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 13:49:38,714][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 13:49:54,300][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 13:50:07,993][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 13:50:21,293][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 13:50:34,500][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 13:50:48,224][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 13:51:00,148][root][INFO] - Processing question number 70
[2025-03-06 13:51:00,153][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 13:51:15,022][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 13:51:26,835][root][INFO] - Domain : Property, Question : 6
[2025-03-06 13:51:39,774][root][INFO] - Domain : Property, Question : 13
[2025-03-06 13:51:54,341][root][INFO] - Domain : Property, Question : 20
[2025-03-06 13:52:09,974][root][INFO] - Domain : Property, Question : 33
[2025-03-06 13:52:24,025][root][INFO] - Domain : Property, Question : 39
[2025-03-06 13:52:42,005][root][INFO] - Domain : Property, Question : 48
[2025-03-06 13:52:56,737][root][INFO] - Domain : Property, Question : 54
[2025-03-06 13:53:14,840][root][INFO] - Domain : Property, Question : 61
[2025-03-06 13:53:30,533][root][INFO] - Processing question number 80
[2025-03-06 13:53:30,538][root][INFO] - Domain : Property, Question : 67
[2025-03-06 13:53:44,168][root][INFO] - Domain : Property, Question : 75
[2025-03-06 13:54:00,487][root][INFO] - Domain : Property, Question : 83
[2025-03-06 13:54:12,732][root][INFO] - Domain : Property, Question : 89
[2025-03-06 13:54:26,256][root][INFO] - Domain : Property, Question : 97
[2025-03-06 13:54:39,797][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:54:53,419][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 13:55:08,207][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:55:22,134][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 13:55:37,839][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 13:55:49,539][root][INFO] - Processing question number 90
[2025-03-06 13:55:49,544][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 13:56:08,743][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 13:56:23,442][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 13:56:38,694][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 13:56:51,694][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:57:05,888][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 13:57:22,030][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 13:57:35,542][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 13:57:49,859][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 13:58:04,906][root][INFO] - Inference complete
[2025-03-06 13:58:04,906][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:58:04,914][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:58:04,922][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 13:58:04,922][root][WARNING] - |Q. 12||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:58:04,922][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 13:58:04,925][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:58:04,925][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:58:04,925][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:58:04,928][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:58:04,934][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:58:04,934][root][INFO] - Saved parsed outputs
[2025-03-06 13:58:04,935][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:58:04,936][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:58:04,936][root][INFO] - Saved parsing metadata
[2025-03-06 13:58:04,937][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:58:04,938][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:58:04,940][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 13:58:04,981][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 13:58:04,981][root][INFO] - Summary of metrics : {'label_accuracy': 0.40404040404040403, 'misclassification_rate': 0.595959595959596, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 0, 'malformed_domain': 8, 'total_predictions': 99, 'correct_predictions': 40, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.13131313131313133, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 53, 'correct_label_wrong_domain': 2, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 13:58:13,903][root][INFO] - Setting global seed to 989
[2025-03-06 13:58:13,910][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 13:58:13,910][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 13:58:13,912][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 13:58:13,941][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:58:13,944][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:58:13,944][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 13:58:14,112][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 13:58:14,686][root][INFO] - Full model selected, loading model
[2025-03-06 13:58:40,267][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 14:00:33,012][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 14:00:33,012][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 14:01:09,979][root][INFO] - Peft model loaded successfully
[2025-03-06 14:01:18,045][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:01:18,047][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:01:18,047][root][INFO] - Starting inference
[2025-03-06 14:01:18,201][root][INFO] - Processing question number 0
[2025-03-06 14:01:18,204][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 14:01:31,446][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 14:01:44,811][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 14:02:01,584][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 14:02:16,524][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 14:02:35,037][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 14:02:49,399][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 14:03:04,719][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 14:03:19,040][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 14:03:33,305][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 14:03:48,981][root][INFO] - Processing question number 10
[2025-03-06 14:03:48,983][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 14:04:05,298][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 14:04:20,404][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 14:04:36,966][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 14:04:50,165][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 14:05:05,603][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 14:05:18,435][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 14:05:31,373][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 14:05:45,276][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 14:05:58,508][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 14:06:11,381][root][INFO] - Processing question number 20
[2025-03-06 14:06:11,384][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 14:06:24,026][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 14:06:38,236][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 14:06:53,630][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 14:07:08,291][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 14:07:23,537][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 14:07:38,452][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 14:07:54,572][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 14:08:08,979][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 14:08:24,911][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 14:08:37,892][root][INFO] - Processing question number 30
[2025-03-06 14:08:37,895][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 14:08:54,100][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 14:09:08,224][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 14:09:24,532][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 14:09:37,599][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 14:09:51,250][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 14:10:04,555][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 14:10:19,789][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 14:10:34,763][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 14:10:49,695][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 14:11:04,018][root][INFO] - Processing question number 40
[2025-03-06 14:11:04,022][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 14:11:18,022][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 14:11:33,547][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 14:11:48,258][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 14:12:02,656][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 14:12:15,700][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 14:12:30,365][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 14:12:46,798][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 14:13:01,085][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 14:13:14,079][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 14:13:28,901][root][INFO] - Processing question number 50
[2025-03-06 14:13:28,905][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 14:13:47,187][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 14:14:05,558][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 14:14:18,692][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 14:14:34,385][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 14:14:48,742][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 14:15:00,565][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 14:15:16,321][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 14:15:33,493][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 14:15:46,542][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 14:16:01,282][root][INFO] - Processing question number 60
[2025-03-06 14:16:01,287][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 14:16:13,313][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 14:16:25,056][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 14:16:42,760][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 14:16:56,438][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 14:17:11,875][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 14:17:25,659][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 14:17:39,050][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 14:17:52,609][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 14:18:06,429][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 14:18:22,762][root][INFO] - Processing question number 70
[2025-03-06 14:18:22,767][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 14:18:37,838][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 14:18:52,691][root][INFO] - Domain : Property, Question : 6
[2025-03-06 14:19:06,515][root][INFO] - Domain : Property, Question : 13
[2025-03-06 14:19:21,445][root][INFO] - Domain : Property, Question : 20
[2025-03-06 14:19:36,561][root][INFO] - Domain : Property, Question : 33
[2025-03-06 14:19:50,309][root][INFO] - Domain : Property, Question : 39
[2025-03-06 14:20:07,637][root][INFO] - Domain : Property, Question : 48
[2025-03-06 14:20:22,333][root][INFO] - Domain : Property, Question : 54
[2025-03-06 14:20:37,808][root][INFO] - Domain : Property, Question : 61
[2025-03-06 14:20:52,015][root][INFO] - Processing question number 80
[2025-03-06 14:20:52,020][root][INFO] - Domain : Property, Question : 67
[2025-03-06 14:21:06,046][root][INFO] - Domain : Property, Question : 75
[2025-03-06 14:21:24,093][root][INFO] - Domain : Property, Question : 83
[2025-03-06 14:21:36,319][root][INFO] - Domain : Property, Question : 89
[2025-03-06 14:21:49,933][root][INFO] - Domain : Property, Question : 97
[2025-03-06 14:22:04,183][root][INFO] - Domain : Property, Question : 100
[2025-03-06 14:22:20,234][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 14:22:36,640][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:22:51,597][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 14:23:07,419][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 14:23:20,675][root][INFO] - Processing question number 90
[2025-03-06 14:23:20,681][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 14:23:37,332][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 14:23:52,146][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 14:24:07,400][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 14:24:20,028][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:24:35,008][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 14:24:50,079][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 14:25:05,490][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 14:25:20,059][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 14:25:34,547][root][INFO] - Inference complete
[2025-03-06 14:25:34,548][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:25:34,554][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:25:34,567][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:25:34,573][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:25:34,573][root][INFO] - Saved parsed outputs
[2025-03-06 14:25:34,573][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:25:34,575][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:25:34,575][root][INFO] - Saved parsing metadata
[2025-03-06 14:25:34,575][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:25:34,577][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:25:34,578][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 14:25:34,586][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 14:25:34,586][root][INFO] - Summary of metrics : {'label_accuracy': 0.41414141414141414, 'misclassification_rate': 0.5858585858585859, 'combined_accuracy': 0.3939393939393939, 'malformed_label': 0, 'malformed_domain': 8, 'total_predictions': 99, 'correct_predictions': 41, 'correct_label_and_domain': 39, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.13131313131313133, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 52, 'correct_label_wrong_domain': 2, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 14:25:41,300][root][INFO] - Setting global seed to 989
[2025-03-06 14:25:41,305][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 14:25:41,305][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 14:25:41,306][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 14:25:41,308][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:25:41,310][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:25:41,310][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 14:25:41,466][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 14:25:42,098][root][INFO] - Full model selected, loading model
[2025-03-06 14:26:05,313][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 14:27:57,009][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 14:27:57,009][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 14:28:34,172][root][INFO] - Peft model loaded successfully
[2025-03-06 14:28:41,751][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:28:41,753][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:28:41,753][root][INFO] - Starting inference
[2025-03-06 14:28:41,909][root][INFO] - Processing question number 0
[2025-03-06 14:28:41,911][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 14:28:56,315][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 14:29:12,656][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 14:29:29,203][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 14:29:44,077][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 14:30:00,934][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 14:30:16,828][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 14:30:31,812][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 14:30:46,718][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 14:31:00,846][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 14:31:16,224][root][INFO] - Processing question number 10
[2025-03-06 14:31:16,226][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 14:31:35,990][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 14:31:51,888][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 14:32:07,968][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 14:32:21,973][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 14:32:38,074][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 14:32:51,695][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 14:33:04,245][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 14:33:19,058][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 14:33:31,965][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 14:33:45,268][root][INFO] - Processing question number 20
[2025-03-06 14:33:45,270][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 14:33:57,888][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 14:34:12,281][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 14:34:25,651][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 14:34:39,277][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 14:34:53,870][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 14:35:08,851][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 14:35:23,010][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 14:35:37,953][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 14:35:53,131][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 14:36:06,887][root][INFO] - Processing question number 30
[2025-03-06 14:36:06,890][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 14:36:24,192][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 14:36:37,562][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 14:36:53,178][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 14:37:07,073][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 14:37:21,065][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 14:37:34,024][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 14:37:48,396][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 14:38:03,073][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 14:38:17,452][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 14:38:33,679][root][INFO] - Processing question number 40
[2025-03-06 14:38:33,683][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 14:38:46,674][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 14:39:06,167][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 14:39:23,071][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 14:39:36,030][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 14:39:49,091][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 14:40:03,562][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 14:40:20,123][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 14:40:35,681][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 14:40:49,765][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 14:41:05,333][root][INFO] - Processing question number 50
[2025-03-06 14:41:05,337][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 14:41:20,758][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 14:41:38,516][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 14:41:51,759][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 14:42:08,253][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 14:42:24,008][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 14:42:36,547][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 14:42:51,852][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 14:43:05,352][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 14:43:20,693][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 14:43:36,703][root][INFO] - Processing question number 60
[2025-03-06 14:43:36,708][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 14:43:49,139][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 14:44:01,599][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 14:44:17,945][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 14:44:31,582][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 14:44:47,182][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 14:45:02,355][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 14:45:15,804][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 14:45:29,269][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 14:45:42,941][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 14:45:56,070][root][INFO] - Processing question number 70
[2025-03-06 14:45:56,075][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 14:46:10,327][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 14:46:26,166][root][INFO] - Domain : Property, Question : 6
[2025-03-06 14:46:39,589][root][INFO] - Domain : Property, Question : 13
[2025-03-06 14:46:55,148][root][INFO] - Domain : Property, Question : 20
[2025-03-06 14:47:11,624][root][INFO] - Domain : Property, Question : 33
[2025-03-06 14:47:25,997][root][INFO] - Domain : Property, Question : 39
[2025-03-06 14:47:44,393][root][INFO] - Domain : Property, Question : 48
[2025-03-06 14:47:58,484][root][INFO] - Domain : Property, Question : 54
[2025-03-06 14:48:15,020][root][INFO] - Domain : Property, Question : 61
[2025-03-06 14:48:28,618][root][INFO] - Processing question number 80
[2025-03-06 14:48:28,623][root][INFO] - Domain : Property, Question : 67
[2025-03-06 14:48:45,763][root][INFO] - Domain : Property, Question : 75
[2025-03-06 14:49:05,284][root][INFO] - Domain : Property, Question : 83
[2025-03-06 14:49:18,128][root][INFO] - Domain : Property, Question : 89
[2025-03-06 14:49:31,755][root][INFO] - Domain : Property, Question : 97
[2025-03-06 14:49:45,137][root][INFO] - Domain : Property, Question : 100
[2025-03-06 14:49:59,083][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 14:50:15,189][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:50:29,344][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 14:50:46,473][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 14:50:58,127][root][INFO] - Processing question number 90
[2025-03-06 14:50:58,133][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 14:51:16,853][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 14:51:31,170][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 14:51:45,819][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 14:51:59,619][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:52:14,333][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 14:52:28,687][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 14:52:41,744][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 14:52:56,022][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 14:53:13,385][root][INFO] - Inference complete
[2025-03-06 14:53:13,386][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:53:13,392][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:53:13,394][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:13,394][root][WARNING] - |Q. 49||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:13,395][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:13,403][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:13,404][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:53:13,404][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:13,405][root][WARNING] - |Q. 10||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:13,405][root][WARNING] - |Q. 10||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:53:13,405][root][INFO] - |Q. 10||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:13,408][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:53:13,414][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:53:13,414][root][INFO] - Saved parsed outputs
[2025-03-06 14:53:13,414][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:53:13,415][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:53:13,415][root][INFO] - Saved parsing metadata
[2025-03-06 14:53:13,416][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:53:13,417][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:53:13,419][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 14:53:13,450][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 14:53:13,450][root][INFO] - Summary of metrics : {'label_accuracy': 0.41414141414141414, 'misclassification_rate': 0.5858585858585859, 'combined_accuracy': 0.3939393939393939, 'malformed_label': 0, 'malformed_domain': 7, 'total_predictions': 99, 'correct_predictions': 41, 'correct_label_and_domain': 39, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.13131313131313133, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 53, 'correct_label_wrong_domain': 2, 'both_wrong': 5}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 14:53:22,348][root][INFO] - Setting global seed to 206
[2025-03-06 14:53:22,354][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 14:53:22,355][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 14:53:22,356][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 14:53:22,358][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:53:22,361][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:53:22,361][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 14:53:22,535][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 14:53:23,163][root][INFO] - Full model selected, loading model
[2025-03-06 14:53:47,697][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 14:55:42,112][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 14:55:42,112][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 14:56:19,987][root][INFO] - Peft model loaded successfully
[2025-03-06 14:56:27,637][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:56:27,639][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 14:56:27,639][root][INFO] - Starting inference
[2025-03-06 14:56:27,798][root][INFO] - Processing question number 0
[2025-03-06 14:56:27,800][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 14:56:40,762][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 14:56:54,347][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 14:57:08,151][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 14:57:22,669][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 14:57:34,678][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 14:57:47,428][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 14:58:02,248][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 14:58:16,845][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 14:58:27,761][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 14:58:40,486][root][INFO] - Processing question number 10
[2025-03-06 14:58:40,488][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 14:58:51,793][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 14:59:06,531][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 14:59:20,173][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 14:59:32,675][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 14:59:44,874][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 14:59:56,952][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 15:00:11,916][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 15:00:26,578][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 15:00:39,839][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 15:00:54,329][root][INFO] - Processing question number 20
[2025-03-06 15:00:54,331][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 15:01:06,737][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 15:01:22,612][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 15:01:35,158][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 15:01:47,473][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 15:02:01,540][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 15:02:15,658][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 15:02:30,851][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 15:02:44,954][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 15:02:58,869][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 15:03:14,658][root][INFO] - Processing question number 30
[2025-03-06 15:03:14,661][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 15:03:28,593][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 15:03:42,052][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 15:03:55,259][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 15:04:11,975][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 15:04:25,661][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 15:04:41,317][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 15:04:54,715][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 15:05:08,942][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 15:05:22,040][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 15:05:40,181][root][INFO] - Processing question number 40
[2025-03-06 15:05:40,185][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 15:05:54,226][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 15:06:08,842][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 15:06:22,497][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 15:06:33,717][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 15:06:52,646][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 15:07:06,058][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 15:07:18,961][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 15:07:31,278][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 15:07:46,009][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 15:08:01,234][root][INFO] - Processing question number 50
[2025-03-06 15:08:01,238][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 15:08:15,985][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 15:08:29,353][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 15:08:49,078][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 15:09:03,429][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 15:09:16,104][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 15:09:29,356][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 15:09:44,210][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 15:09:59,116][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 15:10:13,713][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 15:10:29,556][root][INFO] - Processing question number 60
[2025-03-06 15:10:29,561][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 15:10:44,100][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 15:11:00,109][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 15:11:16,484][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 15:11:30,748][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 15:11:46,825][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 15:12:03,169][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 15:12:15,787][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 15:12:28,273][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 15:12:43,370][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 15:12:56,899][root][INFO] - Processing question number 70
[2025-03-06 15:12:56,905][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 15:13:10,792][root][INFO] - Domain : Property, Question : 9
[2025-03-06 15:13:27,170][root][INFO] - Domain : Property, Question : 17
[2025-03-06 15:13:46,903][root][INFO] - Domain : Property, Question : 25
[2025-03-06 15:14:03,255][root][INFO] - Domain : Property, Question : 30
[2025-03-06 15:14:15,307][root][INFO] - Domain : Property, Question : 36
[2025-03-06 15:14:29,530][root][INFO] - Domain : Property, Question : 46
[2025-03-06 15:14:47,480][root][INFO] - Domain : Property, Question : 53
[2025-03-06 15:15:01,868][root][INFO] - Domain : Property, Question : 59
[2025-03-06 15:15:15,843][root][INFO] - Domain : Property, Question : 66
[2025-03-06 15:15:31,131][root][INFO] - Processing question number 80
[2025-03-06 15:15:31,136][root][INFO] - Domain : Property, Question : 69
[2025-03-06 15:15:44,793][root][INFO] - Domain : Property, Question : 81
[2025-03-06 15:15:58,837][root][INFO] - Domain : Property, Question : 88
[2025-03-06 15:16:15,399][root][INFO] - Domain : Property, Question : 91
[2025-03-06 15:16:30,949][root][INFO] - Domain : Property, Question : 94
[2025-03-06 15:16:44,872][root][INFO] - Domain : Property, Question : 100
[2025-03-06 15:17:00,714][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 15:17:15,868][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 15:17:32,264][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 15:17:46,377][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 15:17:59,736][root][INFO] - Processing question number 90
[2025-03-06 15:17:59,741][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 15:18:12,052][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 15:18:26,938][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 15:18:40,037][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 15:18:53,307][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 15:19:07,199][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 15:19:21,836][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 15:19:36,356][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 15:19:49,454][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 15:20:03,430][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 15:20:18,712][root][INFO] - Inference complete
[2025-03-06 15:20:18,712][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:20:18,725][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:20:18,737][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:20:18,753][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:20:18,753][root][INFO] - Saved parsed outputs
[2025-03-06 15:20:18,753][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:20:18,760][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:20:18,760][root][INFO] - Saved parsing metadata
[2025-03-06 15:20:18,762][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:20:18,763][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:20:18,764][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 15:20:18,798][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_2
[2025-03-06 15:20:18,798][root][INFO] - Summary of metrics : {'label_accuracy': 0.58, 'misclassification_rate': 0.42000000000000004, 'combined_accuracy': 0.49, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 58, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.8571428571428571, 'Civil_Procedure_accuracy': 0.5384615384615384, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 9, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 15:20:25,417][root][INFO] - Setting global seed to 206
[2025-03-06 15:20:25,422][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 15:20:25,422][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 15:20:25,423][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 15:20:25,425][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 15:20:25,427][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 15:20:25,427][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 15:20:25,587][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 15:20:26,165][root][INFO] - Full model selected, loading model
[2025-03-06 15:20:51,994][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 15:22:41,338][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 15:22:41,339][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 15:23:19,290][root][INFO] - Peft model loaded successfully
[2025-03-06 15:23:27,381][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 15:23:27,384][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:23:27,385][root][INFO] - Starting inference
[2025-03-06 15:23:27,543][root][INFO] - Processing question number 0
[2025-03-06 15:23:27,545][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 15:23:40,823][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 15:23:55,757][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 15:24:09,906][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 15:24:24,676][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 15:24:37,030][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 15:24:51,375][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 15:25:07,024][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 15:25:20,581][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 15:25:31,613][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 15:25:46,766][root][INFO] - Processing question number 10
[2025-03-06 15:25:46,769][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 15:25:58,236][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 15:26:12,189][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 15:26:26,690][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 15:26:40,277][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 15:26:53,640][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 15:27:06,043][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 15:27:22,149][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 15:27:39,026][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 15:27:52,410][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 15:28:06,785][root][INFO] - Processing question number 20
[2025-03-06 15:28:06,788][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 15:28:20,492][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 15:28:38,082][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 15:28:51,380][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 15:29:05,567][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 15:29:20,309][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 15:29:35,235][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 15:29:51,090][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 15:30:06,796][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 15:30:21,407][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 15:30:37,691][root][INFO] - Processing question number 30
[2025-03-06 15:30:37,695][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 15:30:51,608][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 15:31:07,043][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 15:31:19,360][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 15:31:36,024][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 15:31:48,705][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 15:32:03,105][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 15:32:18,391][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 15:32:32,808][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 15:32:46,684][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 15:33:03,676][root][INFO] - Processing question number 40
[2025-03-06 15:33:03,679][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 15:33:17,689][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 15:33:32,266][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 15:33:47,263][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 15:33:58,930][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 15:34:18,938][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 15:34:33,765][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 15:34:46,386][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 15:34:59,828][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 15:35:14,371][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 15:35:27,422][root][INFO] - Processing question number 50
[2025-03-06 15:35:27,426][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 15:35:41,855][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 15:35:55,448][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 15:36:17,346][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 15:36:32,411][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 15:36:45,082][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 15:36:59,530][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 15:37:13,030][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 15:37:27,014][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 15:37:44,091][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 15:38:00,234][root][INFO] - Processing question number 60
[2025-03-06 15:38:00,238][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 15:38:14,458][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 15:38:31,698][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 15:38:47,704][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 15:39:02,052][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 15:39:18,220][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 15:39:34,726][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 15:39:47,512][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 15:40:02,970][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 15:40:18,265][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 15:40:31,987][root][INFO] - Processing question number 70
[2025-03-06 15:40:31,991][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 15:40:47,259][root][INFO] - Domain : Property, Question : 9
[2025-03-06 15:41:02,866][root][INFO] - Domain : Property, Question : 17
[2025-03-06 15:41:22,725][root][INFO] - Domain : Property, Question : 25
[2025-03-06 15:41:40,696][root][INFO] - Domain : Property, Question : 30
[2025-03-06 15:41:52,817][root][INFO] - Domain : Property, Question : 36
[2025-03-06 15:42:07,868][root][INFO] - Domain : Property, Question : 46
[2025-03-06 15:42:24,059][root][INFO] - Domain : Property, Question : 53
[2025-03-06 15:42:38,672][root][INFO] - Domain : Property, Question : 59
[2025-03-06 15:42:51,309][root][INFO] - Domain : Property, Question : 66
[2025-03-06 15:43:05,401][root][INFO] - Processing question number 80
[2025-03-06 15:43:05,406][root][INFO] - Domain : Property, Question : 69
[2025-03-06 15:43:18,622][root][INFO] - Domain : Property, Question : 81
[2025-03-06 15:43:30,953][root][INFO] - Domain : Property, Question : 88
[2025-03-06 15:43:47,539][root][INFO] - Domain : Property, Question : 91
[2025-03-06 15:44:02,793][root][INFO] - Domain : Property, Question : 94
[2025-03-06 15:44:18,699][root][INFO] - Domain : Property, Question : 100
[2025-03-06 15:44:34,048][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 15:44:53,234][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 15:45:09,801][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 15:45:23,344][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 15:45:36,793][root][INFO] - Processing question number 90
[2025-03-06 15:45:36,798][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 15:45:49,448][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 15:46:04,495][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 15:46:18,643][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 15:46:31,544][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 15:46:47,514][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 15:47:02,709][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 15:47:16,596][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 15:47:30,083][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 15:47:44,148][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 15:47:59,542][root][INFO] - Inference complete
[2025-03-06 15:47:59,542][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:47:59,550][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:47:59,562][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:47:59,569][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:47:59,569][root][INFO] - Saved parsed outputs
[2025-03-06 15:47:59,569][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:47:59,573][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:47:59,573][root][INFO] - Saved parsing metadata
[2025-03-06 15:47:59,574][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:47:59,575][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:47:59,584][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 15:47:59,635][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_2
[2025-03-06 15:47:59,635][root][INFO] - Summary of metrics : {'label_accuracy': 0.58, 'misclassification_rate': 0.42000000000000004, 'combined_accuracy': 0.49, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 58, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.8571428571428571, 'Civil_Procedure_accuracy': 0.5384615384615384, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 9, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 15:48:11,352][root][INFO] - Setting global seed to 206
[2025-03-06 15:48:11,362][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 15:48:11,362][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 15:48:11,363][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 15:48:11,365][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 15:48:11,370][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 15:48:11,370][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 15:48:11,666][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 15:48:12,232][root][INFO] - Full model selected, loading model
[2025-03-06 15:48:36,727][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 15:50:19,205][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 15:50:19,206][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 15:50:54,880][root][INFO] - Peft model loaded successfully
[2025-03-06 15:51:02,750][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 15:51:02,752][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 15:51:02,752][root][INFO] - Starting inference
[2025-03-06 15:51:02,940][root][INFO] - Processing question number 0
[2025-03-06 15:51:02,942][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 15:51:16,516][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 15:51:30,820][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 15:51:45,286][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 15:52:00,309][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 15:52:12,721][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 15:52:27,934][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 15:52:42,461][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 15:52:55,885][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 15:53:08,129][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 15:53:20,218][root][INFO] - Processing question number 10
[2025-03-06 15:53:20,220][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 15:53:31,308][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 15:53:47,527][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 15:54:01,682][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 15:54:14,554][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 15:54:28,216][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 15:54:40,578][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 15:54:54,523][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 15:55:08,730][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 15:55:22,224][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 15:55:37,780][root][INFO] - Processing question number 20
[2025-03-06 15:55:37,794][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 15:55:50,904][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 15:56:06,802][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 15:56:20,019][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 15:56:32,343][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 15:56:47,160][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 15:57:03,195][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 15:57:17,870][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 15:57:32,299][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 15:57:45,962][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 15:58:03,295][root][INFO] - Processing question number 30
[2025-03-06 15:58:03,298][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 15:58:16,560][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 15:58:31,289][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 15:58:45,202][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 15:59:00,224][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 15:59:16,977][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 15:59:31,807][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 15:59:45,623][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 15:59:58,410][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 16:00:11,761][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 16:00:29,720][root][INFO] - Processing question number 40
[2025-03-06 16:00:29,724][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 16:00:44,894][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 16:00:57,617][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 16:01:11,274][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 16:01:23,827][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 16:01:40,429][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 16:01:55,670][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 16:02:08,667][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 16:02:21,377][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 16:02:36,418][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 16:02:49,525][root][INFO] - Processing question number 50
[2025-03-06 16:02:49,530][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 16:03:04,795][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 16:03:17,056][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 16:03:32,730][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 16:03:48,738][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 16:04:02,879][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 16:04:18,009][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 16:04:31,781][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 16:04:45,772][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 16:05:04,576][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 16:05:20,533][root][INFO] - Processing question number 60
[2025-03-06 16:05:20,537][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 16:05:33,532][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 16:05:49,703][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 16:06:05,966][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 16:06:21,700][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 16:06:38,488][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 16:06:55,319][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 16:07:07,719][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 16:07:20,348][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 16:07:33,967][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 16:07:47,143][root][INFO] - Processing question number 70
[2025-03-06 16:07:47,148][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 16:08:02,382][root][INFO] - Domain : Property, Question : 9
[2025-03-06 16:08:18,877][root][INFO] - Domain : Property, Question : 17
[2025-03-06 16:08:35,240][root][INFO] - Domain : Property, Question : 25
[2025-03-06 16:08:49,776][root][INFO] - Domain : Property, Question : 30
[2025-03-06 16:09:01,700][root][INFO] - Domain : Property, Question : 36
[2025-03-06 16:09:18,773][root][INFO] - Domain : Property, Question : 46
[2025-03-06 16:09:35,190][root][INFO] - Domain : Property, Question : 53
[2025-03-06 16:09:51,627][root][INFO] - Domain : Property, Question : 59
[2025-03-06 16:10:04,874][root][INFO] - Domain : Property, Question : 66
[2025-03-06 16:10:18,164][root][INFO] - Processing question number 80
[2025-03-06 16:10:18,169][root][INFO] - Domain : Property, Question : 69
[2025-03-06 16:10:30,211][root][INFO] - Domain : Property, Question : 81
[2025-03-06 16:10:44,252][root][INFO] - Domain : Property, Question : 88
[2025-03-06 16:10:58,457][root][INFO] - Domain : Property, Question : 91
[2025-03-06 16:11:12,904][root][INFO] - Domain : Property, Question : 94
[2025-03-06 16:11:27,514][root][INFO] - Domain : Property, Question : 100
[2025-03-06 16:11:42,770][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 16:12:01,331][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 16:12:17,541][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 16:12:30,421][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 16:12:44,233][root][INFO] - Processing question number 90
[2025-03-06 16:12:44,239][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 16:13:02,057][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 16:13:19,628][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 16:13:33,373][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 16:13:45,469][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 16:14:01,446][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 16:14:16,499][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 16:14:31,988][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 16:14:45,843][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 16:14:56,993][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 16:15:11,354][root][INFO] - Inference complete
[2025-03-06 16:15:11,354][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:15:11,362][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:15:11,370][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:15:11,371][root][WARNING] - |Q. 25||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:15:11,372][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:15:11,376][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:15:11,382][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:15:11,382][root][INFO] - Saved parsed outputs
[2025-03-06 16:15:11,382][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:15:11,383][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:15:11,383][root][INFO] - Saved parsing metadata
[2025-03-06 16:15:11,384][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:15:11,386][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:15:11,387][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 16:15:11,434][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_2
[2025-03-06 16:15:11,434][root][INFO] - Summary of metrics : {'label_accuracy': 0.58, 'misclassification_rate': 0.42000000000000004, 'combined_accuracy': 0.48, 'malformed_label': 0, 'malformed_domain': 13, 'total_predictions': 100, 'correct_predictions': 58, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.7857142857142857, 'Civil_Procedure_accuracy': 0.5384615384615384, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.12, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 10, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 16:15:18,539][root][INFO] - Setting global seed to 989
[2025-03-06 16:15:18,546][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 16:15:18,546][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 16:15:18,547][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 16:15:18,549][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 16:15:18,552][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 16:15:18,552][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 16:15:18,705][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 16:15:19,239][root][INFO] - Full model selected, loading model
[2025-03-06 16:15:45,024][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 16:17:26,263][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 16:17:26,264][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 16:18:03,982][root][INFO] - Peft model loaded successfully
[2025-03-06 16:18:11,876][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 16:18:11,879][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:18:11,879][root][INFO] - Starting inference
[2025-03-06 16:18:12,049][root][INFO] - Processing question number 0
[2025-03-06 16:18:12,053][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 16:18:24,984][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 16:18:38,540][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 16:18:52,315][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 16:19:06,803][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 16:19:18,803][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 16:19:31,526][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 16:19:46,332][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 16:20:00,900][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 16:20:11,795][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 16:20:24,488][root][INFO] - Processing question number 10
[2025-03-06 16:20:24,490][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 16:20:35,777][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 16:20:50,474][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 16:21:04,084][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 16:21:16,556][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 16:21:28,744][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 16:21:40,798][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 16:21:55,737][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 16:22:10,377][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 16:22:23,614][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 16:22:38,073][root][INFO] - Processing question number 20
[2025-03-06 16:22:38,075][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 16:22:50,462][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 16:23:06,271][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 16:23:18,771][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 16:23:31,011][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 16:23:45,008][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 16:23:59,035][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 16:24:14,152][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 16:24:28,169][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 16:24:41,979][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 16:24:57,673][root][INFO] - Processing question number 30
[2025-03-06 16:24:57,676][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 16:25:11,549][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 16:25:24,956][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 16:25:38,119][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 16:25:54,774][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 16:26:08,413][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 16:26:24,024][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 16:26:37,433][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 16:26:51,687][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 16:27:04,827][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 16:27:22,934][root][INFO] - Processing question number 40
[2025-03-06 16:27:22,937][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 16:27:36,945][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 16:27:51,507][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 16:28:05,136][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 16:28:16,335][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 16:28:35,221][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 16:28:48,592][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 16:29:01,480][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 16:29:13,794][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 16:29:28,480][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 16:29:43,652][root][INFO] - Processing question number 50
[2025-03-06 16:29:43,656][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 16:29:58,375][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 16:30:11,740][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 16:30:31,440][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 16:30:45,764][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 16:30:58,425][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 16:31:11,624][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 16:31:26,440][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 16:31:41,306][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 16:31:55,863][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 16:32:11,659][root][INFO] - Processing question number 60
[2025-03-06 16:32:11,663][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 16:32:26,164][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 16:32:42,120][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 16:32:58,444][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 16:33:12,664][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 16:33:28,696][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 16:33:44,998][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 16:33:57,571][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 16:34:10,019][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 16:34:25,068][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 16:34:38,560][root][INFO] - Processing question number 70
[2025-03-06 16:34:38,565][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 16:34:52,416][root][INFO] - Domain : Property, Question : 9
[2025-03-06 16:35:08,751][root][INFO] - Domain : Property, Question : 17
[2025-03-06 16:35:28,425][root][INFO] - Domain : Property, Question : 25
[2025-03-06 16:35:44,731][root][INFO] - Domain : Property, Question : 30
[2025-03-06 16:35:56,747][root][INFO] - Domain : Property, Question : 36
[2025-03-06 16:36:10,889][root][INFO] - Domain : Property, Question : 46
[2025-03-06 16:36:28,756][root][INFO] - Domain : Property, Question : 53
[2025-03-06 16:36:43,093][root][INFO] - Domain : Property, Question : 59
[2025-03-06 16:36:57,003][root][INFO] - Domain : Property, Question : 66
[2025-03-06 16:37:12,236][root][INFO] - Processing question number 80
[2025-03-06 16:37:12,241][root][INFO] - Domain : Property, Question : 69
[2025-03-06 16:37:25,850][root][INFO] - Domain : Property, Question : 81
[2025-03-06 16:37:39,852][root][INFO] - Domain : Property, Question : 88
[2025-03-06 16:37:56,330][root][INFO] - Domain : Property, Question : 91
[2025-03-06 16:38:11,805][root][INFO] - Domain : Property, Question : 94
[2025-03-06 16:38:25,697][root][INFO] - Domain : Property, Question : 100
[2025-03-06 16:38:41,503][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 16:38:56,625][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 16:39:12,980][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 16:39:27,051][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 16:39:40,372][root][INFO] - Processing question number 90
[2025-03-06 16:39:40,378][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 16:39:52,657][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 16:40:07,503][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 16:40:20,552][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 16:40:33,787][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 16:40:47,653][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 16:41:02,240][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 16:41:16,715][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 16:41:29,763][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 16:41:43,690][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 16:41:58,922][root][INFO] - Inference complete
[2025-03-06 16:41:58,922][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:41:58,930][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:41:58,943][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:41:58,949][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:41:58,949][root][INFO] - Saved parsed outputs
[2025-03-06 16:41:58,949][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:41:58,950][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:41:58,950][root][INFO] - Saved parsing metadata
[2025-03-06 16:41:58,951][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:41:58,953][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:41:58,954][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 16:41:59,003][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_2
[2025-03-06 16:41:59,003][root][INFO] - Summary of metrics : {'label_accuracy': 0.58, 'misclassification_rate': 0.42000000000000004, 'combined_accuracy': 0.49, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 58, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.8571428571428571, 'Civil_Procedure_accuracy': 0.5384615384615384, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 9, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 16:42:09,156][root][INFO] - Setting global seed to 989
[2025-03-06 16:42:09,164][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 16:42:09,165][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 16:42:09,166][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 16:42:09,170][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 16:42:09,175][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 16:42:09,175][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 16:42:09,357][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 16:42:09,899][root][INFO] - Full model selected, loading model
[2025-03-06 16:42:34,119][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 16:44:19,250][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 16:44:19,251][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 16:44:59,995][root][INFO] - Peft model loaded successfully
[2025-03-06 16:45:08,025][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 16:45:08,028][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 16:45:08,028][root][INFO] - Starting inference
[2025-03-06 16:45:08,206][root][INFO] - Processing question number 0
[2025-03-06 16:45:08,207][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 16:45:21,606][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 16:45:34,908][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 16:45:50,218][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 16:46:06,309][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 16:46:18,221][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 16:46:33,169][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 16:46:49,144][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 16:47:04,352][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 16:47:15,312][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 16:47:28,133][root][INFO] - Processing question number 10
[2025-03-06 16:47:28,135][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 16:47:39,690][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 16:47:55,992][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 16:48:11,809][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 16:48:24,939][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 16:48:37,476][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 16:48:50,185][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 16:49:04,933][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 16:49:21,798][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 16:49:35,180][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 16:49:48,775][root][INFO] - Processing question number 20
[2025-03-06 16:49:48,778][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 16:50:03,371][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 16:50:18,071][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 16:50:30,220][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 16:50:41,920][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 16:50:55,844][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 16:51:10,415][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 16:51:26,162][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 16:51:40,008][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 16:51:54,576][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 16:52:10,938][root][INFO] - Processing question number 30
[2025-03-06 16:52:10,941][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 16:52:24,234][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 16:52:40,322][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 16:52:52,597][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 16:53:09,411][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 16:53:22,669][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 16:53:37,691][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 16:53:52,519][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 16:54:06,624][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 16:54:20,007][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 16:54:36,239][root][INFO] - Processing question number 40
[2025-03-06 16:54:36,242][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 16:54:49,607][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 16:55:05,334][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 16:55:19,069][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 16:55:30,807][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 16:55:48,229][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 16:56:02,735][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 16:56:15,747][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 16:56:27,913][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 16:56:41,695][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 16:56:55,221][root][INFO] - Processing question number 50
[2025-03-06 16:56:55,225][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 16:57:10,091][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 16:57:23,419][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 16:57:42,352][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 16:57:56,876][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 16:58:09,497][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 16:58:24,294][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 16:58:39,235][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 16:58:53,214][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 16:59:07,896][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 16:59:23,426][root][INFO] - Processing question number 60
[2025-03-06 16:59:23,430][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 16:59:36,818][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 16:59:52,918][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 17:00:09,072][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 17:00:23,415][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 17:00:39,573][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 17:00:57,715][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 17:01:10,461][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 17:01:23,419][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 17:01:38,453][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 17:01:51,920][root][INFO] - Processing question number 70
[2025-03-06 17:01:51,925][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 17:02:05,912][root][INFO] - Domain : Property, Question : 9
[2025-03-06 17:02:22,037][root][INFO] - Domain : Property, Question : 17
[2025-03-06 17:02:37,142][root][INFO] - Domain : Property, Question : 25
[2025-03-06 17:02:52,600][root][INFO] - Domain : Property, Question : 30
[2025-03-06 17:03:05,883][root][INFO] - Domain : Property, Question : 36
[2025-03-06 17:03:22,328][root][INFO] - Domain : Property, Question : 46
[2025-03-06 17:03:37,413][root][INFO] - Domain : Property, Question : 53
[2025-03-06 17:03:53,111][root][INFO] - Domain : Property, Question : 59
[2025-03-06 17:04:05,790][root][INFO] - Domain : Property, Question : 66
[2025-03-06 17:04:20,188][root][INFO] - Processing question number 80
[2025-03-06 17:04:20,193][root][INFO] - Domain : Property, Question : 69
[2025-03-06 17:04:33,711][root][INFO] - Domain : Property, Question : 81
[2025-03-06 17:04:46,258][root][INFO] - Domain : Property, Question : 88
[2025-03-06 17:05:01,530][root][INFO] - Domain : Property, Question : 91
[2025-03-06 17:05:16,794][root][INFO] - Domain : Property, Question : 94
[2025-03-06 17:05:32,020][root][INFO] - Domain : Property, Question : 100
[2025-03-06 17:05:48,495][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 17:06:04,742][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 17:06:20,682][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 17:06:35,086][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 17:06:49,195][root][INFO] - Processing question number 90
[2025-03-06 17:06:49,200][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 17:07:01,894][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 17:07:16,614][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 17:07:29,828][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 17:07:43,292][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 17:07:58,052][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 17:08:12,980][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 17:08:26,965][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 17:08:39,834][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 17:08:53,495][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 17:09:09,027][root][INFO] - Inference complete
[2025-03-06 17:09:09,027][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:09:09,035][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:09:09,037][root][WARNING] - |Q. 86||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 17:09:09,038][root][WARNING] - |Q. 86||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:09:09,038][root][INFO] - |Q. 86||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 17:09:09,049][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:09:09,055][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:09:09,055][root][INFO] - Saved parsed outputs
[2025-03-06 17:09:09,055][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:09:09,056][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:09:09,056][root][INFO] - Saved parsing metadata
[2025-03-06 17:09:09,057][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:09:09,060][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:09:09,061][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 17:09:09,087][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_2
[2025-03-06 17:09:09,087][root][INFO] - Summary of metrics : {'label_accuracy': 0.58, 'misclassification_rate': 0.42000000000000004, 'combined_accuracy': 0.49, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 58, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.8571428571428571, 'Civil_Procedure_accuracy': 0.5384615384615384, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 9, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 18 to status running with exit code None
Eval status update completed for job 18
[2025-03-06 17:09:16,192][root][INFO] - Setting global seed to 989
[2025-03-06 17:09:16,199][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 17:09:16,200][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 17:09:16,201][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 17:09:16,204][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 17:09:16,206][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 17:09:16,206][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 17:09:16,400][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 17:09:16,967][root][INFO] - Full model selected, loading model
[2025-03-06 17:09:47,271][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 17:11:31,634][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 17:11:31,635][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 17:12:08,746][root][INFO] - Peft model loaded successfully
[2025-03-06 17:12:16,699][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 17:12:16,702][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:12:16,702][root][INFO] - Starting inference
[2025-03-06 17:12:16,893][root][INFO] - Processing question number 0
[2025-03-06 17:12:16,896][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 17:12:30,540][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 17:12:44,249][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 17:12:59,942][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 17:13:15,402][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 17:13:28,586][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 17:13:41,707][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 17:13:56,304][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 17:14:09,133][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 17:14:21,303][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 17:14:35,255][root][INFO] - Processing question number 10
[2025-03-06 17:14:35,257][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 17:14:47,520][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 17:15:02,268][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 17:15:14,651][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 17:15:28,265][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 17:15:40,888][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 17:15:53,733][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 17:16:10,269][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 17:16:26,897][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 17:16:41,491][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 17:16:55,945][root][INFO] - Processing question number 20
[2025-03-06 17:16:55,948][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 17:17:07,619][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 17:17:21,384][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 17:17:34,674][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 17:17:46,466][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 17:17:59,974][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 17:18:14,690][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 17:18:29,699][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 17:18:46,616][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 17:19:00,455][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 17:19:15,991][root][INFO] - Processing question number 30
[2025-03-06 17:19:15,994][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 17:19:29,485][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 17:19:43,216][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 17:19:55,646][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 17:20:12,036][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 17:20:24,408][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 17:20:40,190][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 17:20:55,772][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 17:21:10,134][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 17:21:24,375][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 17:21:39,523][root][INFO] - Processing question number 40
[2025-03-06 17:21:39,527][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 17:21:54,307][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 17:22:08,381][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 17:22:21,903][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 17:22:34,689][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 17:22:55,594][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 17:23:10,341][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 17:23:23,710][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 17:23:37,474][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 17:23:53,100][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 17:24:06,544][root][INFO] - Processing question number 50
[2025-03-06 17:24:06,548][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 17:24:22,307][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 17:24:36,350][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 17:24:50,753][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 17:25:06,203][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 17:25:19,257][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 17:25:32,672][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 17:25:46,986][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 17:26:02,130][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 17:26:17,576][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 17:26:31,654][root][INFO] - Processing question number 60
[2025-03-06 17:26:31,658][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 17:26:46,061][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 17:27:01,074][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 17:27:17,621][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 17:27:33,761][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 17:27:50,842][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 17:28:04,722][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 17:28:17,651][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 17:28:31,216][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 17:28:43,549][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 17:28:57,093][root][INFO] - Processing question number 70
[2025-03-06 17:28:57,098][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 17:29:10,962][root][INFO] - Domain : Property, Question : 9
[2025-03-06 17:29:26,762][root][INFO] - Domain : Property, Question : 17
[2025-03-06 17:29:43,820][root][INFO] - Domain : Property, Question : 25
[2025-03-06 17:30:01,308][root][INFO] - Domain : Property, Question : 30
[2025-03-06 17:30:13,667][root][INFO] - Domain : Property, Question : 36
[2025-03-06 17:30:28,283][root][INFO] - Domain : Property, Question : 46
[2025-03-06 17:30:44,091][root][INFO] - Domain : Property, Question : 53
[2025-03-06 17:31:00,442][root][INFO] - Domain : Property, Question : 59
[2025-03-06 17:31:14,911][root][INFO] - Domain : Property, Question : 66
[2025-03-06 17:31:29,545][root][INFO] - Processing question number 80
[2025-03-06 17:31:29,550][root][INFO] - Domain : Property, Question : 69
[2025-03-06 17:31:41,923][root][INFO] - Domain : Property, Question : 81
[2025-03-06 17:31:54,286][root][INFO] - Domain : Property, Question : 88
[2025-03-06 17:32:09,329][root][INFO] - Domain : Property, Question : 91
[2025-03-06 17:32:25,026][root][INFO] - Domain : Property, Question : 94
[2025-03-06 17:32:43,475][root][INFO] - Domain : Property, Question : 100
[2025-03-06 17:32:57,831][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 17:33:16,882][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 17:33:34,000][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 17:33:47,525][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 17:34:02,332][root][INFO] - Processing question number 90
[2025-03-06 17:34:02,338][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 17:34:14,719][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 17:34:33,550][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 17:34:46,193][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 17:34:58,307][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 17:35:15,407][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 17:35:31,418][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 17:35:46,108][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 17:36:00,250][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 17:36:12,478][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 17:36:28,037][root][INFO] - Inference complete
[2025-03-06 17:36:28,037][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:36:28,044][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:36:28,051][root][WARNING] - |Q. 43||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 17:36:28,051][root][WARNING] - |Q. 43||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 17:36:28,051][root][INFO] - |Q. 43||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 17:36:28,058][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:36:28,064][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:36:28,064][root][INFO] - Saved parsed outputs
[2025-03-06 17:36:28,064][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:36:28,065][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:36:28,065][root][INFO] - Saved parsing metadata
[2025-03-06 17:36:28,066][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:36:28,067][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 17:36:28,068][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 17:36:28,097][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_2
[2025-03-06 17:36:28,097][root][INFO] - Summary of metrics : {'label_accuracy': 0.59, 'misclassification_rate': 0.41000000000000003, 'combined_accuracy': 0.5, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 59, 'correct_label_and_domain': 50, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.8571428571428571, 'Civil_Procedure_accuracy': 0.5384615384615384, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 38, 'correct_label_wrong_domain': 9, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '18', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 18 to status completed with exit code 0
Eval status update completed for job 18
Job 18 completed at Thu Mar  6 17:36:29 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n511
Job ID: 25358393
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 06:33:11
CPU Efficiency: 9.88% of 2-18:18:00 core-walltime
Job Wall-clock time: 06:37:48
Memory Utilized: 34.54 GB
Memory Efficiency: 95.95% of 36.00 GB
