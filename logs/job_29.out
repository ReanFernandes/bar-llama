Starting job 29 at Thu Mar  6 20:24:53 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_10_samples prompt=json_fact_first_zero_shot_structured train=json_fact_first_zero_shot_structured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '29', 'training']
Updating job 29 to status training with exit code None
Status update completed for job 29
[2025-03-06 20:25:12,578][root][INFO] - Global seed set to 314
[2025-03-06 20:25:12,580][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 20:25:12,580][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 20:25:12,580][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 20:25:12,580][root][INFO] - Current training config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 20:25:12,581][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/distilled_dataset.json
[2025-03-06 20:25:12,669][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:25:12,675][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 20:25:12,779][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 20:25:12,783][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 20:25:13,253][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 20:25:22,913][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 20:25:57,576][root][INFO] - Model prepared for kbit training
[2025-03-06 20:25:57,577][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'q_proj', 'k_proj', 'o_proj', 'down_proj', 'up_proj', 'v_proj', 'gate_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 20:25:59,444][root][INFO] - Lora adapter added to model
[2025-03-06 20:25:59,448][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_zero_shot_structured
[2025-03-06 20:25:59,764][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.444, 'grad_norm': 0.12375859171152115, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.4366, 'grad_norm': 0.15023452043533325, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.4035, 'grad_norm': 0.1628960818052292, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.3361, 'grad_norm': 0.2099539190530777, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.2027, 'grad_norm': 0.1860591173171997, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.9744, 'grad_norm': 0.25910162925720215, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.9273, 'grad_norm': 0.20474621653556824, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.8089, 'grad_norm': 0.17786626517772675, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.8477, 'grad_norm': 0.1698705404996872, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.773, 'grad_norm': 0.1612882763147354, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.813, 'grad_norm': 0.1676439493894577, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.7373, 'grad_norm': 0.19497494399547577, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.748, 'grad_norm': 0.13208061456680298, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.7184, 'grad_norm': 0.1430060714483261, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.7324, 'grad_norm': 0.14633111655712128, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.6525, 'grad_norm': 0.15795598924160004, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.6935, 'grad_norm': 0.14818929135799408, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.6252, 'grad_norm': 0.17170450091362, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.6925, 'grad_norm': 0.19465535879135132, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.6288, 'grad_norm': 0.1814693808555603, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.6286, 'grad_norm': 0.1746053546667099, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.5788, 'grad_norm': 0.19727617502212524, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.6632, 'grad_norm': 0.19591470062732697, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.6089, 'grad_norm': 0.19843555986881256, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.6233, 'grad_norm': 0.21858252584934235, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.5771, 'grad_norm': 0.21130022406578064, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.598, 'grad_norm': 0.19929446280002594, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.63, 'grad_norm': 0.2106892466545105, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.5832, 'grad_norm': 0.2867124080657959, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.5142, 'grad_norm': 0.3455881178379059, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.48, 'grad_norm': 0.3643498122692108, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.462, 'grad_norm': 0.3516753613948822, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.4737, 'grad_norm': 0.3867667317390442, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.3361, 'grad_norm': 0.43670356273651123, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.3337, 'grad_norm': 0.47915059328079224, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.2774, 'grad_norm': 0.41742581129074097, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.3032, 'grad_norm': 0.42655041813850403, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.151, 'grad_norm': 0.5420097708702087, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.2385, 'grad_norm': 0.46334847807884216, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.1825, 'grad_norm': 0.40437889099121094, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.1693, 'grad_norm': 0.47383835911750793, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.0977, 'grad_norm': 0.47031787037849426, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.1151, 'grad_norm': 0.4524194002151489, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.1026, 'grad_norm': 0.2647501528263092, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.0784, 'grad_norm': 0.30186256766319275, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.0772, 'grad_norm': 0.2985609471797943, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0853, 'grad_norm': 0.36689698696136475, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.0535, 'grad_norm': 0.2280072420835495, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0672, 'grad_norm': 0.31374573707580566, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.06, 'grad_norm': 0.22620822489261627, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 3144.9801, 'train_samples_per_second': 0.334, 'train_steps_per_second': 0.048, 'train_loss': 0.5669097136457761, 'epoch': 15.0}
[2025-03-06 21:18:27,869][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_zero_shot_structured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '29', 'trained', '0']
Updating job 29 to status trained with exit code 0
Status update completed for job 29
Starting evaluations for job 29
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-06 21:18:37,821][root][INFO] - Setting global seed to 206
[2025-03-06 21:18:37,828][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:18:37,828][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:18:37,830][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:18:37,832][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:18:37,837][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:18:37,837][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:18:38,014][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:18:38,449][root][INFO] - Full model selected, loading model
[2025-03-06 21:18:57,480][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:20:00,258][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:20:00,273][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:20:27,803][root][INFO] - Peft model loaded successfully
[2025-03-06 21:20:34,008][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:20:34,010][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:20:34,010][root][INFO] - Starting inference
[2025-03-06 21:20:34,485][root][INFO] - Processing question number 0
[2025-03-06 21:20:34,487][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:20:47,277][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:21:00,230][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:21:15,276][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:21:28,329][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:21:41,398][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:21:55,583][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:22:09,494][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:22:25,995][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:22:38,689][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:22:55,540][root][INFO] - Processing question number 10
[2025-03-06 21:22:55,541][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:23:12,328][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:23:25,567][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:23:40,724][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:23:54,754][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:24:09,489][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:24:22,718][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:24:37,113][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:24:51,185][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:25:05,467][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:25:17,340][root][INFO] - Processing question number 20
[2025-03-06 21:25:17,342][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:25:30,121][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:25:44,705][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:25:56,002][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:26:10,050][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:26:23,005][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:26:35,335][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:26:48,903][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:27:04,675][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:27:16,821][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:27:29,818][root][INFO] - Processing question number 30
[2025-03-06 21:27:29,820][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:27:45,955][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:28:00,384][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:28:12,317][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:28:25,917][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:28:36,494][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:28:51,288][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:29:01,588][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:29:16,999][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:29:31,300][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:29:49,762][root][INFO] - Processing question number 40
[2025-03-06 21:29:49,765][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:30:02,990][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:30:20,189][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:30:35,695][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:30:52,841][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:31:06,746][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:31:20,826][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:31:35,783][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:31:48,355][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:32:01,369][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:32:18,982][root][INFO] - Processing question number 50
[2025-03-06 21:32:18,994][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:32:39,020][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:32:58,031][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:33:12,889][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:33:26,396][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:33:43,632][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:33:56,501][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:34:13,786][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:34:26,784][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:34:41,454][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:35:02,815][root][INFO] - Processing question number 60
[2025-03-06 21:35:02,818][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:35:16,522][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:35:29,214][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:35:43,265][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:35:56,061][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:36:07,424][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:36:22,933][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:36:38,231][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:36:51,097][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:37:06,524][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:37:23,952][root][INFO] - Processing question number 70
[2025-03-06 21:37:23,956][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:37:36,244][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:37:50,912][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:38:04,601][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:38:18,373][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:38:33,324][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:38:47,043][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:39:00,761][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:39:17,342][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:39:32,944][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:39:46,455][root][INFO] - Processing question number 80
[2025-03-06 21:39:46,459][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:40:02,154][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:40:17,222][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:40:29,381][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:40:42,520][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:40:54,522][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:41:08,979][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:41:22,830][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:41:36,840][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:41:51,862][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:42:05,264][root][INFO] - Processing question number 90
[2025-03-06 21:42:05,268][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:42:20,058][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:42:32,481][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:42:47,644][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:43:01,266][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:43:14,066][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:43:26,518][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:43:38,404][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:43:52,580][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:44:07,577][root][INFO] - Inference complete
[2025-03-06 21:44:07,577][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:07,582][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:07,584][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:44:07,585][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:44:07,585][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:44:07,585][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:44:07,585][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:44:07,585][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:44:07,586][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:44:07,586][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:44:07,586][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:44:07,596][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:07,601][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:07,601][root][INFO] - Saved parsed outputs
[2025-03-06 21:44:07,601][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:07,602][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:07,602][root][INFO] - Saved parsing metadata
[2025-03-06 21:44:07,603][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:07,605][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:07,607][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:44:07,634][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 21:44:07,634][root][INFO] - Summary of metrics : {'label_accuracy': 0.32323232323232326, 'misclassification_rate': 0.6767676767676767, 'combined_accuracy': 0.2828282828282828, 'malformed_label': 3, 'malformed_domain': 15, 'total_predictions': 99, 'correct_predictions': 32, 'correct_label_and_domain': 28, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.1919191919191919, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.10101010101010101, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 56, 'correct_label_wrong_domain': 4, 'both_wrong': 11}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-06 21:44:18,539][root][INFO] - Setting global seed to 206
[2025-03-06 21:44:18,546][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:44:18,547][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:44:18,548][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:44:18,550][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:44:18,552][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:44:18,552][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:44:18,711][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:44:18,968][root][INFO] - Full model selected, loading model
[2025-03-06 21:44:36,869][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:45:36,007][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:45:36,007][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:46:00,787][root][INFO] - Peft model loaded successfully
[2025-03-06 21:46:06,883][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:46:06,884][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:46:06,885][root][INFO] - Starting inference
[2025-03-06 21:46:07,107][root][INFO] - Processing question number 0
[2025-03-06 21:46:07,109][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:46:20,410][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:46:33,796][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:46:46,029][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:47:00,454][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:47:13,430][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:47:27,707][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:47:42,069][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:47:55,922][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:48:11,117][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:48:27,802][root][INFO] - Processing question number 10
[2025-03-06 21:48:27,804][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:48:45,826][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:48:59,749][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:49:16,291][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:49:29,067][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:49:43,083][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:49:56,744][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:50:10,802][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:50:24,260][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:50:38,017][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:50:50,317][root][INFO] - Processing question number 20
[2025-03-06 21:50:50,320][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:51:03,090][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:51:15,026][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:51:25,923][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:51:37,910][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:51:54,601][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:52:06,786][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:52:21,750][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:52:36,252][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:52:49,674][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:53:01,551][root][INFO] - Processing question number 30
[2025-03-06 21:53:01,554][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:53:17,569][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:53:31,951][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:53:44,837][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:53:57,778][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:54:09,239][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:54:24,398][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:54:37,279][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:54:50,787][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:55:05,616][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:55:22,404][root][INFO] - Processing question number 40
[2025-03-06 21:55:22,406][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:55:35,274][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:55:51,058][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:56:04,638][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:56:22,985][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:56:38,215][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:56:52,653][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:57:09,240][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:57:21,804][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:57:34,599][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:57:53,970][root][INFO] - Processing question number 50
[2025-03-06 21:57:53,973][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:58:12,768][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:58:30,308][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:58:44,262][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:59:00,783][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:59:17,091][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:59:28,589][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:59:46,665][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:59:59,571][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:00:15,430][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:00:41,707][root][INFO] - Processing question number 60
[2025-03-06 22:00:41,710][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:00:54,193][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:01:10,204][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:01:26,774][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:01:38,952][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:01:49,808][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:02:02,494][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:02:16,732][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:02:33,937][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:02:47,945][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:03:05,951][root][INFO] - Processing question number 70
[2025-03-06 22:03:05,954][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:03:20,385][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:03:31,765][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:03:46,952][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:04:05,286][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:04:20,830][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:04:33,547][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:04:48,530][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:05:00,611][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:05:16,198][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:05:30,424][root][INFO] - Processing question number 80
[2025-03-06 22:05:30,428][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:05:46,204][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:06:01,325][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:06:17,014][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:06:32,194][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:06:47,866][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:07:02,277][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:07:16,178][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:07:30,534][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:07:44,475][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:08:00,983][root][INFO] - Processing question number 90
[2025-03-06 22:08:00,988][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:08:14,544][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:08:26,317][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:08:39,673][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:08:51,186][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:09:07,057][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:09:19,922][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:09:32,582][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:09:46,701][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:10:01,268][root][INFO] - Inference complete
[2025-03-06 22:10:01,269][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:01,274][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:01,276][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:10:01,276][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:10:01,276][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:10:01,287][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:01,292][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:01,292][root][INFO] - Saved parsed outputs
[2025-03-06 22:10:01,292][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:01,293][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:01,293][root][INFO] - Saved parsing metadata
[2025-03-06 22:10:01,294][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:01,295][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:01,296][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:10:01,315][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 22:10:01,315][root][INFO] - Summary of metrics : {'label_accuracy': 0.4444444444444444, 'misclassification_rate': 0.5555555555555556, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 1, 'malformed_domain': 16, 'total_predictions': 99, 'correct_predictions': 44, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.625, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.1919191919191919, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.10101010101010101, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 6, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-06 22:10:09,231][root][INFO] - Setting global seed to 206
[2025-03-06 22:10:09,238][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:10:09,238][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:10:09,239][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:10:09,241][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:10:09,243][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:10:09,243][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:10:09,411][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:10:09,669][root][INFO] - Full model selected, loading model
[2025-03-06 22:10:25,052][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:11:24,544][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:11:24,544][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:11:49,521][root][INFO] - Peft model loaded successfully
[2025-03-06 22:11:55,662][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:11:55,664][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:11:55,664][root][INFO] - Starting inference
[2025-03-06 22:11:55,878][root][INFO] - Processing question number 0
[2025-03-06 22:11:55,881][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:12:09,536][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:12:23,748][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:12:39,623][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:12:52,972][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:13:04,331][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:13:17,059][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:13:31,987][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:13:47,865][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:14:04,763][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:14:23,195][root][INFO] - Processing question number 10
[2025-03-06 22:14:23,197][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:14:40,730][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:14:54,126][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:15:07,723][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:15:23,410][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:15:38,313][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:15:53,536][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:16:06,625][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:16:20,819][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:16:35,045][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:16:46,686][root][INFO] - Processing question number 20
[2025-03-06 22:16:46,688][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:16:58,880][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:17:11,648][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:17:23,134][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:17:34,163][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:17:47,449][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:18:00,904][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:18:15,261][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:18:31,348][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:18:47,099][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:18:57,341][root][INFO] - Processing question number 30
[2025-03-06 22:18:57,343][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:19:11,066][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:19:26,562][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:19:39,970][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:19:53,384][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:20:04,917][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:20:19,478][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:20:31,343][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:20:44,886][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:20:59,831][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:21:19,879][root][INFO] - Processing question number 40
[2025-03-06 22:21:19,882][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:21:34,281][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:21:50,143][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:22:03,844][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:22:21,173][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:22:34,451][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:22:50,924][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:23:06,384][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:23:17,784][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:23:31,800][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:23:45,838][root][INFO] - Processing question number 50
[2025-03-06 22:23:45,841][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:24:01,456][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:24:17,582][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:24:29,326][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:24:47,094][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:25:02,642][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:25:18,520][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:25:33,944][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:25:49,030][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:26:05,011][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:26:19,325][root][INFO] - Processing question number 60
[2025-03-06 22:26:19,330][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:26:31,688][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:26:43,931][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:26:58,282][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:27:08,699][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:27:21,832][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:27:38,053][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:27:53,887][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:28:08,879][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:28:23,305][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:28:40,331][root][INFO] - Processing question number 70
[2025-03-06 22:28:40,334][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:28:53,231][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:29:06,810][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:29:19,841][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:29:36,580][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:29:52,174][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:30:05,027][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:30:21,261][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:30:36,858][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:30:55,065][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:31:07,830][root][INFO] - Processing question number 80
[2025-03-06 22:31:07,834][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:31:21,657][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:31:34,186][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:31:49,805][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:32:01,364][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:32:13,516][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:32:26,804][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:32:42,883][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:32:59,431][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:33:11,807][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:33:23,465][root][INFO] - Processing question number 90
[2025-03-06 22:33:23,469][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:33:40,659][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:33:52,554][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:34:07,002][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:34:19,533][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:34:35,743][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:34:48,347][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:35:05,275][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:35:20,673][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:35:36,769][root][INFO] - Inference complete
[2025-03-06 22:35:36,769][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:35:36,775][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:35:36,777][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:35:36,777][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:35:36,777][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:35:36,788][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:35:36,793][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:35:36,793][root][INFO] - Saved parsed outputs
[2025-03-06 22:35:36,793][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:35:36,795][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:35:36,795][root][INFO] - Saved parsing metadata
[2025-03-06 22:35:36,795][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:35:36,797][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:35:36,798][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:35:36,817][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 22:35:36,817][root][INFO] - Summary of metrics : {'label_accuracy': 0.35353535353535354, 'misclassification_rate': 0.6464646464646464, 'combined_accuracy': 0.3333333333333333, 'malformed_label': 2, 'malformed_domain': 17, 'total_predictions': 99, 'correct_predictions': 35, 'correct_label_and_domain': 33, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.18181818181818182, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1717171717171717, 'Civil_Procedure_confidence': 0.15151515151515152, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 2, 'both_wrong': 15}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-06 22:35:45,087][root][INFO] - Setting global seed to 989
[2025-03-06 22:35:45,094][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:35:45,095][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:35:45,096][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:35:45,098][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:35:45,100][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:35:45,100][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:35:45,270][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:35:45,588][root][INFO] - Full model selected, loading model
[2025-03-06 22:36:01,672][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:37:01,056][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:37:01,058][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:37:25,447][root][INFO] - Peft model loaded successfully
[2025-03-06 22:37:31,594][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:37:31,597][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:37:31,597][root][INFO] - Starting inference
[2025-03-06 22:37:31,785][root][INFO] - Processing question number 0
[2025-03-06 22:37:31,787][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:37:44,219][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:37:57,168][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:38:12,205][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:38:25,260][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:38:38,326][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:38:52,512][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:39:06,421][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:39:22,927][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:39:35,622][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:39:52,476][root][INFO] - Processing question number 10
[2025-03-06 22:39:52,479][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:40:09,264][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:40:22,500][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:40:37,653][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:40:51,682][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:41:06,417][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:41:19,646][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:41:34,036][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:41:48,110][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:42:02,388][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:42:14,265][root][INFO] - Processing question number 20
[2025-03-06 22:42:14,267][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:42:27,047][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:42:41,632][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:42:52,926][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:43:06,979][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:43:19,930][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:43:32,260][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:43:45,825][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:44:01,596][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:44:13,744][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:44:26,739][root][INFO] - Processing question number 30
[2025-03-06 22:44:26,742][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:44:42,876][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:44:57,301][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:45:09,231][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:45:22,831][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:45:33,408][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:45:48,201][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:45:58,499][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:46:13,913][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:46:28,223][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:46:46,682][root][INFO] - Processing question number 40
[2025-03-06 22:46:46,686][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:46:59,911][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:47:17,113][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:47:32,618][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:47:49,768][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:48:03,672][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:48:17,754][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:48:32,710][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:48:45,285][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:48:58,298][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:49:15,910][root][INFO] - Processing question number 50
[2025-03-06 22:49:15,914][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:49:35,929][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:49:54,943][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:50:09,796][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:50:23,306][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:50:40,538][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:50:53,408][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:51:10,687][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:51:23,690][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:51:38,382][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:51:59,773][root][INFO] - Processing question number 60
[2025-03-06 22:51:59,777][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:52:13,496][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:52:26,204][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:52:40,262][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:52:53,066][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:53:04,436][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:53:19,963][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:53:35,270][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:53:48,145][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:54:03,590][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:54:21,043][root][INFO] - Processing question number 70
[2025-03-06 22:54:21,047][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:54:33,333][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:54:48,001][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:55:01,688][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:55:15,458][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:55:30,409][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:55:44,126][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:55:57,848][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:56:14,427][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:56:30,018][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:56:43,529][root][INFO] - Processing question number 80
[2025-03-06 22:56:43,533][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:56:59,231][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:57:14,293][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:57:26,453][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:57:39,592][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:57:51,592][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:58:06,039][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:58:19,883][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:58:33,876][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:58:48,867][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:59:02,261][root][INFO] - Processing question number 90
[2025-03-06 22:59:02,265][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:59:17,038][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:59:29,455][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:59:44,611][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:59:58,220][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:00:11,007][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 23:00:23,448][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 23:00:35,332][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 23:00:49,497][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 23:01:04,467][root][INFO] - Inference complete
[2025-03-06 23:01:04,468][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:01:04,473][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:01:04,475][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:01:04,475][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:01:04,476][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:01:04,476][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:01:04,476][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:01:04,476][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:01:04,476][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:01:04,477][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:01:04,477][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:01:04,487][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:01:04,491][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:01:04,491][root][INFO] - Saved parsed outputs
[2025-03-06 23:01:04,491][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:01:04,493][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:01:04,493][root][INFO] - Saved parsing metadata
[2025-03-06 23:01:04,493][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:01:04,495][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:01:04,496][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 23:01:04,513][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 23:01:04,513][root][INFO] - Summary of metrics : {'label_accuracy': 0.32323232323232326, 'misclassification_rate': 0.6767676767676767, 'combined_accuracy': 0.2828282828282828, 'malformed_label': 3, 'malformed_domain': 15, 'total_predictions': 99, 'correct_predictions': 32, 'correct_label_and_domain': 28, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.1919191919191919, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.10101010101010101, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 56, 'correct_label_wrong_domain': 4, 'both_wrong': 11}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-06 23:01:11,627][root][INFO] - Setting global seed to 989
[2025-03-06 23:01:11,634][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 23:01:11,634][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 23:01:11,636][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 23:01:11,637][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:01:11,640][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:01:11,640][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 23:01:11,825][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:01:12,096][root][INFO] - Full model selected, loading model
[2025-03-06 23:01:26,266][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:02:24,940][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:02:24,941][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:02:48,723][root][INFO] - Peft model loaded successfully
[2025-03-06 23:02:54,823][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:02:54,825][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:02:54,825][root][INFO] - Starting inference
[2025-03-06 23:02:55,047][root][INFO] - Processing question number 0
[2025-03-06 23:02:55,049][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 23:03:09,566][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 23:03:24,366][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 23:03:38,786][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 23:03:53,742][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 23:04:05,154][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 23:04:21,363][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 23:04:35,267][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 23:04:51,105][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 23:05:06,507][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 23:05:25,039][root][INFO] - Processing question number 10
[2025-03-06 23:05:25,040][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 23:05:43,096][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 23:05:56,214][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 23:06:11,629][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 23:06:26,147][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 23:06:40,966][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 23:06:54,014][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 23:07:07,460][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 23:07:21,217][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 23:07:34,745][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 23:07:47,213][root][INFO] - Processing question number 20
[2025-03-06 23:07:47,215][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 23:08:01,080][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 23:08:14,999][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 23:08:28,002][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 23:08:38,308][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 23:08:51,113][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 23:09:04,218][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 23:09:19,217][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 23:09:33,406][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 23:09:45,675][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 23:09:57,205][root][INFO] - Processing question number 30
[2025-03-06 23:09:57,207][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:10:15,797][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 23:10:30,126][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 23:10:41,996][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 23:10:54,627][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 23:11:05,735][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 23:11:21,657][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 23:11:34,269][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 23:11:50,000][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:12:07,009][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 23:12:28,182][root][INFO] - Processing question number 40
[2025-03-06 23:12:28,185][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:12:41,044][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 23:12:56,160][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 23:13:10,225][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 23:13:26,110][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 23:13:42,705][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:13:59,356][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 23:14:15,976][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:14:26,959][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 23:14:43,196][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 23:15:03,719][root][INFO] - Processing question number 50
[2025-03-06 23:15:03,722][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:15:24,011][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 23:15:41,876][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 23:15:56,149][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 23:16:13,757][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 23:16:32,825][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:16:47,296][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 23:17:01,108][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 23:17:14,373][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 23:17:31,179][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 23:17:50,175][root][INFO] - Processing question number 60
[2025-03-06 23:17:50,178][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:18:03,331][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:18:16,014][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 23:18:32,716][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 23:18:45,278][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 23:18:57,663][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 23:19:10,732][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 23:19:24,522][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 23:19:42,098][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:19:56,815][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 23:20:15,307][root][INFO] - Processing question number 70
[2025-03-06 23:20:15,310][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 23:20:28,806][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 23:20:44,271][root][INFO] - Domain : Property, Question : 6
[2025-03-06 23:20:58,699][root][INFO] - Domain : Property, Question : 13
[2025-03-06 23:21:12,732][root][INFO] - Domain : Property, Question : 20
[2025-03-06 23:21:26,876][root][INFO] - Domain : Property, Question : 33
[2025-03-06 23:21:38,766][root][INFO] - Domain : Property, Question : 39
[2025-03-06 23:21:51,987][root][INFO] - Domain : Property, Question : 48
[2025-03-06 23:22:08,259][root][INFO] - Domain : Property, Question : 54
[2025-03-06 23:22:22,863][root][INFO] - Domain : Property, Question : 61
[2025-03-06 23:22:34,999][root][INFO] - Processing question number 80
[2025-03-06 23:22:35,003][root][INFO] - Domain : Property, Question : 67
[2025-03-06 23:22:51,292][root][INFO] - Domain : Property, Question : 75
[2025-03-06 23:23:08,748][root][INFO] - Domain : Property, Question : 83
[2025-03-06 23:23:25,830][root][INFO] - Domain : Property, Question : 89
[2025-03-06 23:23:42,540][root][INFO] - Domain : Property, Question : 97
[2025-03-06 23:23:55,276][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:24:08,350][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 23:24:25,156][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:24:39,931][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 23:24:57,673][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 23:25:09,419][root][INFO] - Processing question number 90
[2025-03-06 23:25:09,423][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 23:25:24,148][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 23:25:37,324][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 23:25:49,750][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 23:26:01,339][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:26:15,750][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 23:26:28,571][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 23:26:43,160][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 23:26:57,136][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 23:27:12,189][root][INFO] - Inference complete
[2025-03-06 23:27:12,190][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:27:12,195][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:27:12,197][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:27:12,197][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:27:12,197][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:27:12,197][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:27:12,198][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:27:12,198][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:27:12,208][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:27:12,213][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:27:12,214][root][INFO] - Saved parsed outputs
[2025-03-06 23:27:12,214][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:27:12,215][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:27:12,215][root][INFO] - Saved parsing metadata
[2025-03-06 23:27:12,216][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:27:12,218][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:27:12,219][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 23:27:12,250][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 23:27:12,250][root][INFO] - Summary of metrics : {'label_accuracy': 0.40404040404040403, 'misclassification_rate': 0.595959595959596, 'combined_accuracy': 0.35353535353535354, 'malformed_label': 2, 'malformed_domain': 15, 'total_predictions': 99, 'correct_predictions': 40, 'correct_label_and_domain': 35, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.1919191919191919, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.10101010101010101, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 5, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-06 23:27:20,474][root][INFO] - Setting global seed to 989
[2025-03-06 23:27:20,481][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 23:27:20,482][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 23:27:20,483][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 23:27:20,485][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:27:20,488][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:27:20,488][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 23:27:20,638][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:27:20,916][root][INFO] - Full model selected, loading model
[2025-03-06 23:27:38,609][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:28:37,923][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:28:37,923][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:29:04,144][root][INFO] - Peft model loaded successfully
[2025-03-06 23:29:10,319][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:29:10,321][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:29:10,321][root][INFO] - Starting inference
[2025-03-06 23:29:10,534][root][INFO] - Processing question number 0
[2025-03-06 23:29:10,537][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 23:29:22,233][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 23:29:37,945][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 23:29:54,291][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 23:30:06,895][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 23:30:20,229][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 23:30:32,497][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 23:30:45,347][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 23:30:58,628][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 23:31:13,604][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 23:31:32,517][root][INFO] - Processing question number 10
[2025-03-06 23:31:32,520][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 23:31:47,589][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 23:32:01,604][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 23:32:16,641][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 23:32:33,252][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 23:32:47,405][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 23:33:01,200][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 23:33:13,793][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 23:33:28,096][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 23:33:42,078][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 23:33:54,119][root][INFO] - Processing question number 20
[2025-03-06 23:33:54,121][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 23:34:06,597][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 23:34:20,257][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 23:34:32,799][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 23:34:45,561][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 23:35:03,712][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 23:35:17,846][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 23:35:30,825][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 23:35:44,669][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 23:35:58,493][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 23:36:11,366][root][INFO] - Processing question number 30
[2025-03-06 23:36:11,368][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:36:27,250][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 23:36:39,177][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 23:36:52,825][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 23:37:07,986][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 23:37:19,197][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 23:37:34,587][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 23:37:48,833][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 23:38:05,069][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:38:23,985][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 23:38:39,682][root][INFO] - Processing question number 40
[2025-03-06 23:38:39,684][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:38:53,169][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 23:39:11,185][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 23:39:26,591][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 23:39:40,803][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 23:39:54,564][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:40:10,489][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 23:40:25,740][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:40:38,199][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 23:40:51,938][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 23:41:06,719][root][INFO] - Processing question number 50
[2025-03-06 23:41:06,722][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:41:28,109][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 23:41:45,411][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 23:41:58,814][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 23:42:14,828][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 23:42:30,644][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:42:41,887][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 23:42:56,504][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 23:43:09,202][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 23:43:23,208][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 23:43:37,299][root][INFO] - Processing question number 60
[2025-03-06 23:43:37,302][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:43:49,373][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:44:02,413][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 23:44:15,705][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 23:44:29,882][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 23:44:40,486][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 23:44:54,718][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 23:45:06,844][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 23:45:20,818][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:45:32,449][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 23:45:47,895][root][INFO] - Processing question number 70
[2025-03-06 23:45:47,899][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 23:46:02,950][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 23:46:14,678][root][INFO] - Domain : Property, Question : 6
[2025-03-06 23:46:29,643][root][INFO] - Domain : Property, Question : 13
[2025-03-06 23:46:43,954][root][INFO] - Domain : Property, Question : 20
[2025-03-06 23:47:00,177][root][INFO] - Domain : Property, Question : 33
[2025-03-06 23:47:11,731][root][INFO] - Domain : Property, Question : 39
[2025-03-06 23:47:28,108][root][INFO] - Domain : Property, Question : 48
[2025-03-06 23:47:44,248][root][INFO] - Domain : Property, Question : 54
[2025-03-06 23:48:00,081][root][INFO] - Domain : Property, Question : 61
[2025-03-06 23:48:15,219][root][INFO] - Processing question number 80
[2025-03-06 23:48:15,223][root][INFO] - Domain : Property, Question : 67
[2025-03-06 23:48:30,800][root][INFO] - Domain : Property, Question : 75
[2025-03-06 23:48:45,026][root][INFO] - Domain : Property, Question : 83
[2025-03-06 23:49:00,526][root][INFO] - Domain : Property, Question : 89
[2025-03-06 23:49:16,452][root][INFO] - Domain : Property, Question : 97
[2025-03-06 23:49:28,886][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:49:44,871][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 23:50:00,197][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:50:14,236][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 23:50:30,454][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 23:50:44,456][root][INFO] - Processing question number 90
[2025-03-06 23:50:44,460][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 23:50:57,967][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 23:51:11,407][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 23:51:23,581][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 23:51:34,366][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:51:51,184][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 23:52:03,842][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 23:52:17,610][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 23:52:31,727][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 23:52:46,160][root][INFO] - Inference complete
[2025-03-06 23:52:46,160][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:52:46,166][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:52:46,168][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:52:46,168][root][WARNING] - |Q. 56||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:52:46,169][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:52:46,169][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:52:46,169][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:52:46,170][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:52:46,178][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:52:46,178][root][WARNING] - |Q. 100||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:52:46,178][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:52:46,180][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:52:46,185][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:52:46,185][root][INFO] - Saved parsed outputs
[2025-03-06 23:52:46,185][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:52:46,187][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:52:46,187][root][INFO] - Saved parsing metadata
[2025-03-06 23:52:46,187][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:52:46,189][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:52:46,190][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 23:52:46,219][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 23:52:46,219][root][INFO] - Summary of metrics : {'label_accuracy': 0.41414141414141414, 'misclassification_rate': 0.5858585858585859, 'combined_accuracy': 0.35353535353535354, 'malformed_label': 3, 'malformed_domain': 16, 'total_predictions': 99, 'correct_predictions': 41, 'correct_label_and_domain': 35, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.1919191919191919, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.10101010101010101, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 48, 'correct_label_wrong_domain': 6, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-06 23:53:06,697][root][INFO] - Setting global seed to 206
[2025-03-06 23:53:06,756][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:53:06,756][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 23:53:06,758][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:53:06,760][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:53:06,763][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:53:06,764][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:53:06,925][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:53:07,229][root][INFO] - Full model selected, loading model
[2025-03-06 23:53:21,470][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:54:20,642][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:54:20,643][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:54:45,700][root][INFO] - Peft model loaded successfully
[2025-03-06 23:54:51,869][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:54:51,870][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:54:51,871][root][INFO] - Starting inference
[2025-03-06 23:54:52,074][root][INFO] - Processing question number 0
[2025-03-06 23:54:52,088][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:55:06,197][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:55:21,999][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:55:36,895][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:55:52,168][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:56:05,923][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:56:20,082][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:56:33,203][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:56:46,190][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:56:59,607][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:57:14,262][root][INFO] - Processing question number 10
[2025-03-06 23:57:14,263][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:57:26,324][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:57:39,487][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:57:53,541][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:58:04,799][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:58:18,339][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:58:31,629][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:58:44,193][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:58:59,015][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:59:13,736][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:59:27,521][root][INFO] - Processing question number 20
[2025-03-06 23:59:27,523][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:59:42,642][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:59:55,462][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:00:08,045][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:00:23,268][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:00:39,325][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:00:54,497][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:01:07,689][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:01:21,268][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:01:37,659][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:01:55,955][root][INFO] - Processing question number 30
[2025-03-07 00:01:55,957][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:02:08,302][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:02:22,183][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:02:34,690][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:02:49,918][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:03:05,365][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:03:22,312][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:03:37,669][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:03:53,970][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:04:07,160][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:04:24,057][root][INFO] - Processing question number 40
[2025-03-07 00:04:24,061][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:04:41,321][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:04:55,596][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:05:10,691][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:05:22,681][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:05:39,712][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:05:51,134][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:06:03,964][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:06:16,923][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:06:29,473][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:06:42,789][root][INFO] - Processing question number 50
[2025-03-07 00:06:42,792][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:06:57,515][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:07:10,513][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:07:23,577][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:07:40,187][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:07:55,309][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:08:08,902][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:08:24,584][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:08:42,127][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:08:58,596][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:09:15,758][root][INFO] - Processing question number 60
[2025-03-07 00:09:15,761][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:09:30,279][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:09:44,072][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:10:01,046][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:10:17,844][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:10:32,532][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:10:46,686][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:10:57,498][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:11:08,634][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:11:25,110][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:11:40,548][root][INFO] - Processing question number 70
[2025-03-07 00:11:40,552][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:11:55,323][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:12:08,553][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:12:21,303][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:12:39,542][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:12:54,533][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:13:09,654][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:13:26,066][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:13:42,178][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:13:56,603][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:14:11,094][root][INFO] - Processing question number 80
[2025-03-07 00:14:11,097][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:14:27,307][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:14:40,973][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:14:55,811][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:15:09,900][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:15:24,186][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:15:39,004][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:15:55,669][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:16:13,376][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:16:24,461][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:16:41,026][root][INFO] - Processing question number 90
[2025-03-07 00:16:41,030][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:16:55,372][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:17:08,841][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:17:22,583][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:17:37,548][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:17:58,124][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:18:16,384][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:18:34,797][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:18:48,583][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:19:01,218][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:19:17,966][root][INFO] - Inference complete
[2025-03-07 00:19:17,966][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:19:17,972][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:19:17,974][root][WARNING] - |Q. 35||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:19:17,974][root][WARNING] - |Q. 35||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:19:17,974][root][INFO] - |Q. 35||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:19:17,980][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:19:17,981][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:19:17,981][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:19:17,986][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:19:17,991][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:19:17,991][root][INFO] - Saved parsed outputs
[2025-03-07 00:19:17,991][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:19:17,992][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:19:17,992][root][INFO] - Saved parsing metadata
[2025-03-07 00:19:17,993][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:19:17,994][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:19:17,995][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:19:18,028][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 00:19:18,028][root][INFO] - Summary of metrics : {'label_accuracy': 0.4, 'misclassification_rate': 0.6, 'combined_accuracy': 0.36, 'malformed_label': 2, 'malformed_domain': 14, 'total_predictions': 100, 'correct_predictions': 40, 'correct_label_and_domain': 36, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.35714285714285715, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.13, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.16, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.12, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 50, 'correct_label_wrong_domain': 4, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-07 00:19:25,545][root][INFO] - Setting global seed to 206
[2025-03-07 00:19:25,551][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:19:25,551][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 00:19:25,552][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:19:25,553][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:19:25,556][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:19:25,556][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:19:25,721][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 00:19:26,069][root][INFO] - Full model selected, loading model
[2025-03-07 00:19:40,549][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:20:39,943][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:20:39,982][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:21:06,073][root][INFO] - Peft model loaded successfully
[2025-03-07 00:21:12,209][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:21:12,211][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:21:12,211][root][INFO] - Starting inference
[2025-03-07 00:21:12,426][root][INFO] - Processing question number 0
[2025-03-07 00:21:12,428][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:21:25,963][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:21:42,513][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:21:57,310][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:22:15,696][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:22:28,205][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:22:38,327][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:22:51,523][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:23:05,374][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:23:18,701][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:23:32,029][root][INFO] - Processing question number 10
[2025-03-07 00:23:32,031][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:23:45,793][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:24:01,620][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:24:15,351][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:24:28,385][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:24:41,376][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:24:53,292][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:25:05,176][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:25:19,371][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:25:33,278][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:25:48,213][root][INFO] - Processing question number 20
[2025-03-07 00:25:48,216][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:26:02,516][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:26:15,150][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:26:26,352][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:26:40,678][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:26:54,896][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:27:10,487][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:27:23,234][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:27:40,591][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:27:52,590][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:28:05,529][root][INFO] - Processing question number 30
[2025-03-07 00:28:05,531][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:28:18,164][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:28:31,550][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:28:43,790][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:29:01,089][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:29:15,617][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:29:30,442][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:29:45,861][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:30:02,787][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:30:16,477][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:30:30,934][root][INFO] - Processing question number 40
[2025-03-07 00:30:30,937][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:30:46,880][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:30:59,901][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:31:15,190][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:31:26,504][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:31:42,845][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:31:54,804][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:32:09,994][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:32:25,312][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:32:40,410][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:32:53,227][root][INFO] - Processing question number 50
[2025-03-07 00:32:53,230][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:33:07,574][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:33:19,355][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:33:33,841][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:33:46,742][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:34:03,586][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:34:22,305][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:34:38,476][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:34:54,799][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:35:13,665][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:35:31,832][root][INFO] - Processing question number 60
[2025-03-07 00:35:31,835][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:35:49,233][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:36:03,364][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:36:20,712][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:36:37,686][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:36:51,652][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:37:05,623][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:37:18,513][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:37:31,734][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:37:46,879][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:38:04,253][root][INFO] - Processing question number 70
[2025-03-07 00:38:04,257][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:38:20,411][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:38:33,752][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:38:49,831][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:39:07,379][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:39:22,094][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:39:35,424][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:39:51,185][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:40:04,648][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:40:18,417][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:40:31,885][root][INFO] - Processing question number 80
[2025-03-07 00:40:31,889][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:40:50,325][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:41:03,125][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:41:19,758][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:41:34,013][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:41:49,327][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:42:01,859][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:42:20,209][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:42:39,684][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:42:53,789][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:43:11,068][root][INFO] - Processing question number 90
[2025-03-07 00:43:11,073][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:43:24,744][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:43:40,846][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:43:58,264][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:44:15,097][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:44:32,603][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:44:50,363][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:45:07,649][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:45:21,375][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:45:33,645][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:45:49,501][root][INFO] - Inference complete
[2025-03-07 00:45:49,501][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:45:49,507][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:45:49,514][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:45:49,515][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:45:49,515][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:45:49,520][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:45:49,525][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:45:49,525][root][INFO] - Saved parsed outputs
[2025-03-07 00:45:49,525][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:45:49,526][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:45:49,527][root][INFO] - Saved parsing metadata
[2025-03-07 00:45:49,527][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:45:49,529][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:45:49,530][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:45:49,548][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 00:45:49,548][root][INFO] - Summary of metrics : {'label_accuracy': 0.33, 'misclassification_rate': 0.6699999999999999, 'combined_accuracy': 0.3, 'malformed_label': 1, 'malformed_domain': 15, 'total_predictions': 100, 'correct_predictions': 33, 'correct_label_and_domain': 30, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.23076923076923078, 'Constitutional_Law_confidence': 0.13, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.16, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.13, 'correct_domain_wrong_label': 55, 'correct_label_wrong_domain': 3, 'both_wrong': 12}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-07 00:46:00,474][root][INFO] - Setting global seed to 206
[2025-03-07 00:46:00,544][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:46:00,545][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 00:46:00,546][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:46:00,548][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:46:00,551][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:46:00,551][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:46:00,704][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 00:46:01,037][root][INFO] - Full model selected, loading model
[2025-03-07 00:46:16,967][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:47:16,313][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:47:16,314][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:47:42,158][root][INFO] - Peft model loaded successfully
[2025-03-07 00:47:48,355][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:47:48,357][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:47:48,357][root][INFO] - Starting inference
[2025-03-07 00:47:48,573][root][INFO] - Processing question number 0
[2025-03-07 00:47:48,579][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:48:02,791][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:48:17,886][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:48:31,458][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:48:45,954][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:49:01,457][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:49:13,111][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:49:25,257][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:49:41,366][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:49:55,108][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:50:09,072][root][INFO] - Processing question number 10
[2025-03-07 00:50:09,074][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:50:21,377][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:50:34,551][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:50:49,401][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:51:00,257][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:51:15,523][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:51:28,329][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:51:40,622][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:51:52,898][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:52:08,280][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:52:23,685][root][INFO] - Processing question number 20
[2025-03-07 00:52:23,687][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:52:36,669][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:52:49,962][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:53:03,790][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:53:16,237][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:53:29,548][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:53:42,657][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:53:56,178][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:54:14,066][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:54:27,852][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:54:41,752][root][INFO] - Processing question number 30
[2025-03-07 00:54:41,755][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:54:59,164][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:55:12,808][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:55:24,896][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:55:43,539][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:55:57,665][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:56:11,876][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:56:26,147][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:56:42,569][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:56:54,808][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:57:08,202][root][INFO] - Processing question number 40
[2025-03-07 00:57:08,205][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:57:22,509][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:57:38,310][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:57:52,794][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:58:05,817][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:58:18,868][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:58:34,228][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:58:46,033][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:58:58,745][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:59:11,065][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:59:24,325][root][INFO] - Processing question number 50
[2025-03-07 00:59:24,328][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:59:38,858][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:59:50,299][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 01:00:03,125][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 01:00:20,176][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 01:00:31,993][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 01:00:46,530][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 01:01:02,841][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 01:01:17,669][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 01:01:37,505][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 01:01:52,868][root][INFO] - Processing question number 60
[2025-03-07 01:01:52,873][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 01:02:08,085][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 01:02:22,661][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 01:02:37,957][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 01:02:54,800][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 01:03:07,833][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 01:03:20,841][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 01:03:34,380][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 01:03:44,426][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 01:04:00,662][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 01:04:18,566][root][INFO] - Processing question number 70
[2025-03-07 01:04:18,569][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 01:04:34,631][root][INFO] - Domain : Property, Question : 9
[2025-03-07 01:04:48,684][root][INFO] - Domain : Property, Question : 17
[2025-03-07 01:05:00,882][root][INFO] - Domain : Property, Question : 25
[2025-03-07 01:05:17,465][root][INFO] - Domain : Property, Question : 30
[2025-03-07 01:05:31,523][root][INFO] - Domain : Property, Question : 36
[2025-03-07 01:05:46,671][root][INFO] - Domain : Property, Question : 46
[2025-03-07 01:06:01,045][root][INFO] - Domain : Property, Question : 53
[2025-03-07 01:06:19,230][root][INFO] - Domain : Property, Question : 59
[2025-03-07 01:06:32,183][root][INFO] - Domain : Property, Question : 66
[2025-03-07 01:06:44,212][root][INFO] - Processing question number 80
[2025-03-07 01:06:44,216][root][INFO] - Domain : Property, Question : 69
[2025-03-07 01:07:00,832][root][INFO] - Domain : Property, Question : 81
[2025-03-07 01:07:20,072][root][INFO] - Domain : Property, Question : 88
[2025-03-07 01:07:35,522][root][INFO] - Domain : Property, Question : 91
[2025-03-07 01:07:51,969][root][INFO] - Domain : Property, Question : 94
[2025-03-07 01:08:08,113][root][INFO] - Domain : Property, Question : 100
[2025-03-07 01:08:20,116][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 01:08:38,058][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 01:08:54,973][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 01:09:10,091][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 01:09:26,244][root][INFO] - Processing question number 90
[2025-03-07 01:09:26,248][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 01:09:41,426][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 01:09:58,615][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 01:10:13,147][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 01:10:28,279][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 01:10:46,002][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 01:10:59,236][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 01:11:12,792][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 01:11:28,504][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 01:11:40,474][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 01:11:55,677][root][INFO] - Inference complete
[2025-03-07 01:11:55,677][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:11:55,684][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:11:55,691][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 01:11:55,692][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:11:55,692][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 01:11:55,697][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:11:55,702][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:11:55,702][root][INFO] - Saved parsed outputs
[2025-03-07 01:11:55,702][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:11:55,703][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:11:55,703][root][INFO] - Saved parsing metadata
[2025-03-07 01:11:55,704][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:11:55,705][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:11:55,706][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 01:11:55,737][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 01:11:55,737][root][INFO] - Summary of metrics : {'label_accuracy': 0.39, 'misclassification_rate': 0.61, 'combined_accuracy': 0.33, 'malformed_label': 1, 'malformed_domain': 13, 'total_predictions': 100, 'correct_predictions': 39, 'correct_label_and_domain': 33, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.26666666666666666, 'Torts_accuracy': 0.2857142857142857, 'Civil_Procedure_accuracy': 0.23076923076923078, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.15, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.12, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 6, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-07 01:12:04,358][root][INFO] - Setting global seed to 989
[2025-03-07 01:12:04,366][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 01:12:04,366][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 01:12:04,367][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 01:12:04,368][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 01:12:04,371][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 01:12:04,371][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 01:12:04,745][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 01:12:05,022][root][INFO] - Full model selected, loading model
[2025-03-07 01:12:22,983][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 01:13:22,364][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 01:13:22,364][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 01:13:47,722][root][INFO] - Peft model loaded successfully
[2025-03-07 01:13:53,958][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 01:13:53,960][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:13:53,960][root][INFO] - Starting inference
[2025-03-07 01:13:54,161][root][INFO] - Processing question number 0
[2025-03-07 01:13:54,163][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 01:14:08,441][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 01:14:24,258][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 01:14:39,168][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 01:14:54,446][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 01:15:08,210][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 01:15:22,380][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 01:15:35,506][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 01:15:48,499][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 01:16:01,923][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 01:16:16,595][root][INFO] - Processing question number 10
[2025-03-07 01:16:16,597][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 01:16:28,661][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 01:16:41,817][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 01:16:55,862][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 01:17:07,114][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 01:17:20,650][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 01:17:33,931][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 01:17:46,491][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 01:18:01,304][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 01:18:16,012][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 01:18:29,793][root][INFO] - Processing question number 20
[2025-03-07 01:18:29,796][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 01:18:44,906][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 01:18:57,723][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 01:19:10,299][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 01:19:25,515][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 01:19:41,562][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 01:19:56,723][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 01:20:09,910][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 01:20:23,478][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 01:20:39,861][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 01:20:58,148][root][INFO] - Processing question number 30
[2025-03-07 01:20:58,151][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 01:21:10,488][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 01:21:24,361][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 01:21:36,858][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 01:21:52,056][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 01:22:07,408][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 01:22:24,316][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 01:22:39,643][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 01:22:55,927][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 01:23:09,095][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 01:23:25,953][root][INFO] - Processing question number 40
[2025-03-07 01:23:25,955][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 01:23:43,197][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 01:23:57,454][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 01:24:12,517][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 01:24:24,484][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 01:24:41,508][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 01:24:52,920][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 01:25:05,743][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 01:25:18,698][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 01:25:31,241][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 01:25:44,554][root][INFO] - Processing question number 50
[2025-03-07 01:25:44,557][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 01:25:59,276][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 01:26:12,271][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 01:26:25,330][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 01:26:41,932][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 01:26:57,046][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 01:27:10,630][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 01:27:26,307][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 01:27:43,838][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 01:28:00,299][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 01:28:17,457][root][INFO] - Processing question number 60
[2025-03-07 01:28:17,460][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 01:28:31,966][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 01:28:45,751][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 01:29:02,724][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 01:29:19,518][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 01:29:34,200][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 01:29:48,349][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 01:29:59,155][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 01:30:10,292][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 01:30:26,757][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 01:30:42,185][root][INFO] - Processing question number 70
[2025-03-07 01:30:42,188][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 01:30:56,951][root][INFO] - Domain : Property, Question : 9
[2025-03-07 01:31:10,175][root][INFO] - Domain : Property, Question : 17
[2025-03-07 01:31:22,921][root][INFO] - Domain : Property, Question : 25
[2025-03-07 01:31:41,149][root][INFO] - Domain : Property, Question : 30
[2025-03-07 01:31:56,131][root][INFO] - Domain : Property, Question : 36
[2025-03-07 01:32:11,244][root][INFO] - Domain : Property, Question : 46
[2025-03-07 01:32:27,652][root][INFO] - Domain : Property, Question : 53
[2025-03-07 01:32:43,756][root][INFO] - Domain : Property, Question : 59
[2025-03-07 01:32:58,176][root][INFO] - Domain : Property, Question : 66
[2025-03-07 01:33:12,659][root][INFO] - Processing question number 80
[2025-03-07 01:33:12,663][root][INFO] - Domain : Property, Question : 69
[2025-03-07 01:33:28,865][root][INFO] - Domain : Property, Question : 81
[2025-03-07 01:33:42,525][root][INFO] - Domain : Property, Question : 88
[2025-03-07 01:33:57,361][root][INFO] - Domain : Property, Question : 91
[2025-03-07 01:34:11,447][root][INFO] - Domain : Property, Question : 94
[2025-03-07 01:34:25,727][root][INFO] - Domain : Property, Question : 100
[2025-03-07 01:34:40,538][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 01:34:57,197][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 01:35:14,896][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 01:35:25,977][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 01:35:42,534][root][INFO] - Processing question number 90
[2025-03-07 01:35:42,538][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 01:35:56,874][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 01:36:10,337][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 01:36:24,082][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 01:36:39,039][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 01:36:59,608][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 01:37:17,859][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 01:37:36,269][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 01:37:50,053][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 01:38:02,695][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 01:38:19,453][root][INFO] - Inference complete
[2025-03-07 01:38:19,453][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:38:19,459][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:38:19,460][root][WARNING] - |Q. 35||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 01:38:19,461][root][WARNING] - |Q. 35||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:38:19,461][root][INFO] - |Q. 35||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 01:38:19,467][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 01:38:19,467][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:38:19,467][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 01:38:19,472][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:38:19,477][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:38:19,477][root][INFO] - Saved parsed outputs
[2025-03-07 01:38:19,477][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:38:19,478][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:38:19,478][root][INFO] - Saved parsing metadata
[2025-03-07 01:38:19,479][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:38:19,481][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:38:19,482][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 01:38:19,489][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 01:38:19,489][root][INFO] - Summary of metrics : {'label_accuracy': 0.4, 'misclassification_rate': 0.6, 'combined_accuracy': 0.36, 'malformed_label': 2, 'malformed_domain': 14, 'total_predictions': 100, 'correct_predictions': 40, 'correct_label_and_domain': 36, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.35714285714285715, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.13, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.16, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.12, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 50, 'correct_label_wrong_domain': 4, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-07 01:38:25,922][root][INFO] - Setting global seed to 989
[2025-03-07 01:38:25,927][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 01:38:25,928][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 01:38:25,929][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 01:38:25,930][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 01:38:25,932][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 01:38:25,932][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 01:38:26,085][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 01:38:26,595][root][INFO] - Full model selected, loading model
[2025-03-07 01:39:03,561][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 01:40:02,961][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 01:40:02,961][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 01:40:28,353][root][INFO] - Peft model loaded successfully
[2025-03-07 01:40:34,535][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 01:40:34,537][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:40:34,537][root][INFO] - Starting inference
[2025-03-07 01:40:34,747][root][INFO] - Processing question number 0
[2025-03-07 01:40:34,749][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 01:40:49,600][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 01:41:05,338][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 01:41:20,680][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 01:41:36,984][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 01:41:50,151][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 01:42:02,322][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 01:42:13,391][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 01:42:25,438][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 01:42:38,934][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 01:42:53,363][root][INFO] - Processing question number 10
[2025-03-07 01:42:53,364][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 01:43:05,242][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 01:43:20,850][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 01:43:35,022][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 01:43:46,462][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 01:44:00,252][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 01:44:14,719][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 01:44:27,041][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 01:44:42,113][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 01:44:55,264][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 01:45:09,839][root][INFO] - Processing question number 20
[2025-03-07 01:45:09,841][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 01:45:25,445][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 01:45:38,159][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 01:45:49,859][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 01:46:06,757][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 01:46:21,172][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 01:46:35,792][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 01:46:48,215][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 01:47:01,816][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 01:47:15,739][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 01:47:33,125][root][INFO] - Processing question number 30
[2025-03-07 01:47:33,127][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 01:47:46,371][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 01:48:03,061][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 01:48:14,852][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 01:48:32,265][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 01:48:48,514][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 01:49:03,474][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 01:49:17,524][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 01:49:36,095][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 01:49:49,964][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 01:50:06,204][root][INFO] - Processing question number 40
[2025-03-07 01:50:06,207][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 01:50:20,733][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 01:50:33,489][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 01:50:48,019][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 01:51:02,294][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 01:51:18,371][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 01:51:30,684][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 01:51:44,156][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 01:51:59,883][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 01:52:12,159][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 01:52:24,979][root][INFO] - Processing question number 50
[2025-03-07 01:52:24,982][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 01:52:40,098][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 01:52:52,097][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 01:53:06,266][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 01:53:23,409][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 01:53:37,926][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 01:53:51,362][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 01:54:06,808][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 01:54:19,898][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 01:54:33,879][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 01:54:50,509][root][INFO] - Processing question number 60
[2025-03-07 01:54:50,513][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 01:55:08,006][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 01:55:20,240][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 01:55:35,175][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 01:55:51,022][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 01:56:04,944][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 01:56:19,093][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 01:56:32,464][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 01:56:44,907][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 01:56:58,037][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 01:57:13,511][root][INFO] - Processing question number 70
[2025-03-07 01:57:13,515][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 01:57:28,196][root][INFO] - Domain : Property, Question : 9
[2025-03-07 01:57:43,131][root][INFO] - Domain : Property, Question : 17
[2025-03-07 01:57:57,417][root][INFO] - Domain : Property, Question : 25
[2025-03-07 01:58:15,334][root][INFO] - Domain : Property, Question : 30
[2025-03-07 01:58:28,387][root][INFO] - Domain : Property, Question : 36
[2025-03-07 01:58:40,649][root][INFO] - Domain : Property, Question : 46
[2025-03-07 01:58:56,874][root][INFO] - Domain : Property, Question : 53
[2025-03-07 01:59:16,156][root][INFO] - Domain : Property, Question : 59
[2025-03-07 01:59:30,659][root][INFO] - Domain : Property, Question : 66
[2025-03-07 01:59:43,910][root][INFO] - Processing question number 80
[2025-03-07 01:59:43,914][root][INFO] - Domain : Property, Question : 69
[2025-03-07 02:00:00,807][root][INFO] - Domain : Property, Question : 81
[2025-03-07 02:00:14,323][root][INFO] - Domain : Property, Question : 88
[2025-03-07 02:00:31,234][root][INFO] - Domain : Property, Question : 91
[2025-03-07 02:00:47,237][root][INFO] - Domain : Property, Question : 94
[2025-03-07 02:01:02,098][root][INFO] - Domain : Property, Question : 100
[2025-03-07 02:01:15,945][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 02:01:34,894][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 02:01:54,262][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 02:02:08,042][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 02:02:22,712][root][INFO] - Processing question number 90
[2025-03-07 02:02:22,716][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 02:02:35,588][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 02:02:50,510][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 02:03:04,326][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 02:03:19,390][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 02:03:35,749][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 02:03:52,857][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 02:04:09,522][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 02:04:23,831][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 02:04:35,812][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 02:04:51,757][root][INFO] - Inference complete
[2025-03-07 02:04:51,757][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:04:51,762][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:04:51,770][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 02:04:51,770][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 02:04:51,771][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 02:04:51,776][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:04:51,780][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:04:51,780][root][INFO] - Saved parsed outputs
[2025-03-07 02:04:51,780][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:04:51,781][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:04:51,782][root][INFO] - Saved parsing metadata
[2025-03-07 02:04:51,782][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:04:51,783][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:04:51,784][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 02:04:51,797][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 02:04:51,798][root][INFO] - Summary of metrics : {'label_accuracy': 0.34, 'misclassification_rate': 0.6599999999999999, 'combined_accuracy': 0.32, 'malformed_label': 1, 'malformed_domain': 14, 'total_predictions': 100, 'correct_predictions': 34, 'correct_label_and_domain': 32, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.6428571428571429, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.35714285714285715, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.13, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.16, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.12, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 2, 'both_wrong': 12}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 29 to status running with exit code None
Eval status update completed for job 29
[2025-03-07 02:05:10,322][root][INFO] - Setting global seed to 989
[2025-03-07 02:05:10,329][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 02:05:10,329][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 02:05:10,330][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 02:05:10,332][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 02:05:10,335][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 02:05:10,335][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 02:05:10,491][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 02:05:10,736][root][INFO] - Full model selected, loading model
[2025-03-07 02:05:27,734][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 02:06:28,668][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 02:06:28,669][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 02:06:54,619][root][INFO] - Peft model loaded successfully
[2025-03-07 02:07:00,835][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 02:07:00,837][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:07:00,837][root][INFO] - Starting inference
[2025-03-07 02:07:01,065][root][INFO] - Processing question number 0
[2025-03-07 02:07:01,067][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 02:07:14,748][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 02:07:29,430][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 02:07:42,171][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 02:07:57,382][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 02:08:11,907][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 02:08:21,974][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 02:08:31,727][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 02:08:44,552][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 02:08:57,564][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 02:09:11,059][root][INFO] - Processing question number 10
[2025-03-07 02:09:11,061][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 02:09:23,955][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 02:09:38,104][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 02:09:50,156][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 02:10:02,059][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 02:10:15,436][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 02:10:30,031][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 02:10:43,488][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 02:10:56,972][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 02:11:10,776][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 02:11:27,295][root][INFO] - Processing question number 20
[2025-03-07 02:11:27,297][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 02:11:39,356][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 02:11:52,629][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 02:12:07,901][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 02:12:23,244][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 02:12:41,711][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 02:12:55,965][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 02:13:09,966][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 02:13:28,039][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 02:13:43,232][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 02:13:58,030][root][INFO] - Processing question number 30
[2025-03-07 02:13:58,032][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 02:14:11,704][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 02:14:27,424][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 02:14:41,605][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 02:14:58,289][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 02:15:12,361][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 02:15:25,726][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 02:15:39,681][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 02:15:57,245][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 02:16:13,961][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 02:16:26,061][root][INFO] - Processing question number 40
[2025-03-07 02:16:26,065][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 02:16:41,251][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 02:16:54,484][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 02:17:12,357][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 02:17:26,452][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 02:17:44,589][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 02:17:56,804][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 02:18:09,781][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 02:18:24,789][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 02:18:38,643][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 02:18:51,094][root][INFO] - Processing question number 50
[2025-03-07 02:18:51,097][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 02:19:03,732][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 02:19:19,425][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 02:19:32,775][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 02:19:47,311][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 02:20:02,126][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 02:20:14,633][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 02:20:29,573][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 02:20:44,576][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 02:21:01,543][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 02:21:19,532][root][INFO] - Processing question number 60
[2025-03-07 02:21:19,535][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 02:21:33,412][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 02:21:46,343][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 02:22:01,773][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 02:22:16,536][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 02:22:29,207][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 02:22:41,938][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 02:22:52,147][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 02:23:04,236][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 02:23:17,790][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 02:23:34,815][root][INFO] - Processing question number 70
[2025-03-07 02:23:34,819][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 02:23:50,887][root][INFO] - Domain : Property, Question : 9
[2025-03-07 02:24:06,667][root][INFO] - Domain : Property, Question : 17
[2025-03-07 02:24:22,787][root][INFO] - Domain : Property, Question : 25
[2025-03-07 02:24:39,005][root][INFO] - Domain : Property, Question : 30
[2025-03-07 02:24:51,928][root][INFO] - Domain : Property, Question : 36
[2025-03-07 02:25:05,781][root][INFO] - Domain : Property, Question : 46
[2025-03-07 02:25:20,194][root][INFO] - Domain : Property, Question : 53
[2025-03-07 02:25:39,197][root][INFO] - Domain : Property, Question : 59
[2025-03-07 02:25:51,710][root][INFO] - Domain : Property, Question : 66
[2025-03-07 02:26:03,648][root][INFO] - Processing question number 80
[2025-03-07 02:26:03,653][root][INFO] - Domain : Property, Question : 69
[2025-03-07 02:26:19,126][root][INFO] - Domain : Property, Question : 81
[2025-03-07 02:26:38,049][root][INFO] - Domain : Property, Question : 88
[2025-03-07 02:26:53,408][root][INFO] - Domain : Property, Question : 91
[2025-03-07 02:27:07,826][root][INFO] - Domain : Property, Question : 94
[2025-03-07 02:27:24,476][root][INFO] - Domain : Property, Question : 100
[2025-03-07 02:27:39,735][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 02:27:53,426][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 02:28:09,931][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 02:28:24,069][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 02:28:41,171][root][INFO] - Processing question number 90
[2025-03-07 02:28:41,175][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 02:28:55,234][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 02:29:10,290][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 02:29:26,419][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 02:29:41,864][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 02:29:58,813][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 02:30:17,341][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 02:30:32,870][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 02:30:48,136][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 02:31:00,346][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 02:31:17,593][root][INFO] - Inference complete
[2025-03-07 02:31:17,593][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:31:17,599][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:31:17,603][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 02:31:17,603][root][WARNING] - |Q. 89||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 02:31:17,603][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 02:31:17,607][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 02:31:17,607][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 02:31:17,607][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 02:31:17,608][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 02:31:17,609][root][WARNING] - |Q. 75||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 02:31:17,609][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 02:31:17,614][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:31:17,619][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:31:17,619][root][INFO] - Saved parsed outputs
[2025-03-07 02:31:17,619][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:31:17,620][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:31:17,620][root][INFO] - Saved parsing metadata
[2025-03-07 02:31:17,620][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:31:17,622][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:31:17,624][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 02:31:17,753][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 02:31:17,753][root][INFO] - Summary of metrics : {'label_accuracy': 0.31, 'misclassification_rate': 0.69, 'combined_accuracy': 0.29, 'malformed_label': 3, 'malformed_domain': 13, 'total_predictions': 100, 'correct_predictions': 31, 'correct_label_and_domain': 29, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.13333333333333333, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.15, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.12, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 2, 'both_wrong': 11}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '29', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 29 to status completed with exit code 0
Eval status update completed for job 29
Job 29 completed at Fri Mar  7 02:31:20 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n518
Job ID: 25358404
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 06:03:10
CPU Efficiency: 9.90% of 2-13:10:10 core-walltime
Job Wall-clock time: 06:07:01
Memory Utilized: 27.79 GB
Memory Efficiency: 77.19% of 36.00 GB
