Starting job 22 at Thu Mar  6 19:02:58 CET 2025
Configuration: model=llama3 tokenizer=llama3 dataset=all_domains_10_samples prompt=json_answer_first_zero_shot_structured train=json_answer_first_zero_shot_structured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '22', 'training']
Updating job 22 to status training with exit code None
Status update completed for job 22
[2025-03-06 19:03:13,296][root][INFO] - Global seed set to 314
[2025-03-06 19:03:13,297][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 19:03:13,298][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 19:03:13,298][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 19:03:13,298][root][INFO] - Current training config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 19:03:13,298][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/distilled_dataset.json
[2025-03-06 19:03:13,319][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 19:03:13,366][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 19:03:13,369][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 19:03:13,373][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 19:03:14,143][root][INFO] - Tokenizer meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 19:03:38,016][root][INFO] - Quantised model meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 19:04:08,548][root][INFO] - Model prepared for kbit training
[2025-03-06 19:04:08,549][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'gate_proj', 'o_proj', 'q_proj', 'up_proj', 'down_proj', 'k_proj', 'v_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 19:04:10,302][root][INFO] - Lora adapter added to model
[2025-03-06 19:04:10,304][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_answer_first_zero_shot_structured
[2025-03-06 19:04:10,579][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.7701, 'grad_norm': 0.5446538925170898, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.7124, 'grad_norm': 0.5560038089752197, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.5803, 'grad_norm': 0.387940913438797, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.398, 'grad_norm': 0.39688628911972046, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.2795, 'grad_norm': 0.3378441035747528, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 1.0045, 'grad_norm': 0.4128011465072632, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.972, 'grad_norm': 0.2614603340625763, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.8661, 'grad_norm': 0.3105553090572357, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.945, 'grad_norm': 0.2781272232532501, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.8215, 'grad_norm': 0.2796611487865448, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.8614, 'grad_norm': 0.28993046283721924, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.7687, 'grad_norm': 0.34224817156791687, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.7853, 'grad_norm': 0.3169553577899933, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.7154, 'grad_norm': 0.33813419938087463, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.7229, 'grad_norm': 0.33307820558547974, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.6345, 'grad_norm': 0.3723932206630707, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.6489, 'grad_norm': 0.3741375505924225, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.5346, 'grad_norm': 0.40669962763786316, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.6106, 'grad_norm': 0.5284814238548279, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.5573, 'grad_norm': 0.39433377981185913, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.5193, 'grad_norm': 0.41881632804870605, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.4414, 'grad_norm': 0.4653823971748352, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.5317, 'grad_norm': 0.5033305883407593, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.4546, 'grad_norm': 0.47780516743659973, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.4809, 'grad_norm': 0.4669654369354248, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.4293, 'grad_norm': 0.4838982820510864, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.4368, 'grad_norm': 0.5292354822158813, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.4693, 'grad_norm': 0.486380934715271, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.4572, 'grad_norm': 0.8040679693222046, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.3329, 'grad_norm': 0.6711046695709229, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.2615, 'grad_norm': 1.1539299488067627, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.2981, 'grad_norm': 0.8123475909233093, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.2914, 'grad_norm': 1.1297398805618286, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.1482, 'grad_norm': 0.5582509636878967, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.1821, 'grad_norm': 0.8302501440048218, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.1468, 'grad_norm': 0.885221004486084, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.1493, 'grad_norm': 0.6397769451141357, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.0678, 'grad_norm': 1.179279088973999, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.1128, 'grad_norm': 0.9535526037216187, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.0736, 'grad_norm': 0.5673603415489197, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.0609, 'grad_norm': 0.5595808029174805, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.0404, 'grad_norm': 0.5811582803726196, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.0444, 'grad_norm': 0.6864285469055176, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.0351, 'grad_norm': 0.18539296090602875, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.0244, 'grad_norm': 0.33469727635383606, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.0264, 'grad_norm': 0.2864602506160736, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0244, 'grad_norm': 0.22999878227710724, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.0196, 'grad_norm': 0.12220685929059982, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0216, 'grad_norm': 0.21808359026908875, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0228, 'grad_norm': 0.15225324034690857, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 2781.3342, 'train_samples_per_second': 0.378, 'train_steps_per_second': 0.054, 'train_loss': 0.5158847739050786, 'epoch': 15.0}
[2025-03-06 19:50:39,445][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_answer_first_zero_shot_structured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '22', 'trained', '0']
Updating job 22 to status trained with exit code 0
Status update completed for job 22
Starting evaluations for job 22
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 19:50:48,698][root][INFO] - Setting global seed to 206
[2025-03-06 19:50:48,704][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 19:50:48,704][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 19:50:48,705][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 19:50:48,707][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 19:50:48,709][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 19:50:48,709][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 19:50:48,871][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 19:50:49,647][root][INFO] - Full model selected, loading model
[2025-03-06 19:51:26,929][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 19:53:17,023][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 19:53:17,023][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 19:53:51,058][root][INFO] - Peft model loaded successfully
[2025-03-06 19:53:58,406][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 19:53:58,408][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 19:53:58,408][root][INFO] - Starting inference
[2025-03-06 19:53:58,619][root][INFO] - Processing question number 0
[2025-03-06 19:53:58,621][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 19:54:09,128][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 19:54:22,872][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 19:54:36,548][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 19:54:49,934][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 19:55:02,065][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 19:55:15,003][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 19:55:28,855][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 19:55:42,512][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 19:55:53,734][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 19:56:07,125][root][INFO] - Processing question number 10
[2025-03-06 19:56:07,127][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 19:56:21,194][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 19:56:34,494][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 19:56:46,341][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 19:56:57,764][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 19:57:08,502][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 19:57:18,221][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 19:57:28,257][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 19:57:40,421][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 19:57:51,336][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 19:58:00,908][root][INFO] - Processing question number 20
[2025-03-06 19:58:00,910][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 19:58:11,193][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 19:58:23,232][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 19:58:33,515][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 19:58:44,341][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 19:58:56,546][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 19:59:07,956][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 19:59:18,389][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 19:59:30,607][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 19:59:41,057][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 19:59:51,826][root][INFO] - Processing question number 30
[2025-03-06 19:59:51,828][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:00:03,217][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:00:13,406][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:00:24,474][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:00:37,617][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:00:49,342][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:01:02,077][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:01:13,496][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:01:27,132][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:01:38,883][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:01:53,619][root][INFO] - Processing question number 40
[2025-03-06 20:01:53,622][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:02:05,447][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:02:18,476][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:02:31,373][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:02:43,084][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:02:54,899][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:03:05,732][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:03:18,741][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:03:31,829][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:03:43,027][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:03:55,787][root][INFO] - Processing question number 50
[2025-03-06 20:03:55,790][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:04:07,542][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:04:20,403][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:04:34,209][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:04:49,614][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:05:00,860][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:05:11,590][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:05:24,152][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:05:34,150][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:05:46,325][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:05:57,591][root][INFO] - Processing question number 60
[2025-03-06 20:05:57,594][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:06:10,148][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:06:20,378][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:06:33,616][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:06:44,179][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:06:55,623][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:07:07,507][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:07:19,048][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:07:28,936][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:07:40,255][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:07:54,952][root][INFO] - Processing question number 70
[2025-03-06 20:07:54,956][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:08:06,426][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:08:19,499][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:08:31,271][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:08:46,844][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:09:00,071][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:09:09,479][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:09:23,449][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:09:34,234][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:09:47,721][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:09:58,776][root][INFO] - Processing question number 80
[2025-03-06 20:09:58,780][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:10:10,792][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:10:25,657][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:10:35,526][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:10:46,738][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:11:04,376][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:11:16,256][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:11:28,002][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:11:38,934][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:11:52,707][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:12:04,821][root][INFO] - Processing question number 90
[2025-03-06 20:12:04,825][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:12:18,587][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:12:29,067][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:12:42,540][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:12:52,793][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:13:06,153][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:13:18,927][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:13:29,159][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:13:42,212][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:13:54,092][root][INFO] - Inference complete
[2025-03-06 20:13:54,092][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:13:54,097][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:13:54,103][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:13:54,104][root][WARNING] - |Q. 47||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:13:54,104][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:13:54,111][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:13:54,116][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:13:54,116][root][INFO] - Saved parsed outputs
[2025-03-06 20:13:54,116][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:13:54,117][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:13:54,117][root][INFO] - Saved parsing metadata
[2025-03-06 20:13:54,117][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:13:54,119][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:13:54,120][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:13:54,149][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_1
[2025-03-06 20:13:54,149][root][INFO] - Summary of metrics : {'label_accuracy': 0.5151515151515151, 'misclassification_rate': 0.48484848484848486, 'combined_accuracy': 0.48484848484848486, 'malformed_label': 0, 'malformed_domain': 7, 'total_predictions': 99, 'correct_predictions': 51, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.15151515151515152, 'correct_domain_wrong_label': 44, 'correct_label_wrong_domain': 3, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 20:14:01,471][root][INFO] - Setting global seed to 206
[2025-03-06 20:14:01,477][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:14:01,477][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 20:14:01,478][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:14:01,480][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:14:01,481][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:14:01,482][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:14:01,638][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:14:02,201][root][INFO] - Full model selected, loading model
[2025-03-06 20:14:31,014][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:16:20,316][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:16:20,316][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:16:55,042][root][INFO] - Peft model loaded successfully
[2025-03-06 20:17:02,262][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:17:02,263][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:17:02,263][root][INFO] - Starting inference
[2025-03-06 20:17:02,478][root][INFO] - Processing question number 0
[2025-03-06 20:17:02,480][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:17:13,878][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:17:27,943][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:17:41,451][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:17:54,952][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:18:08,169][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:18:21,172][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:18:34,839][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:18:46,253][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:19:01,719][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:19:12,284][root][INFO] - Processing question number 10
[2025-03-06 20:19:12,286][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:19:26,563][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:19:40,265][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:19:51,598][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:20:03,168][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:20:13,331][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:20:23,131][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:20:34,922][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:20:46,713][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:20:58,426][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:21:08,036][root][INFO] - Processing question number 20
[2025-03-06 20:21:08,038][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:21:18,684][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:21:31,723][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:21:42,744][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:21:53,663][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:22:06,676][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:22:17,994][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:22:29,659][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:22:41,786][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:22:51,949][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:23:02,901][root][INFO] - Processing question number 30
[2025-03-06 20:23:02,904][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:23:14,388][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:23:25,895][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:23:37,433][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:23:47,812][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:24:00,008][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:24:13,860][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:24:27,030][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:24:38,269][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:24:51,251][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:25:06,120][root][INFO] - Processing question number 40
[2025-03-06 20:25:06,123][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:25:19,648][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:25:33,362][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:25:47,990][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:25:58,803][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:26:08,988][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:26:21,795][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:26:34,914][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:26:47,279][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:26:58,570][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:27:12,104][root][INFO] - Processing question number 50
[2025-03-06 20:27:12,107][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:27:23,957][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:27:38,011][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:27:50,614][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:28:06,337][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:28:16,980][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:28:27,950][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:28:40,740][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:28:51,225][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:29:03,964][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:29:15,510][root][INFO] - Processing question number 60
[2025-03-06 20:29:15,514][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:29:26,430][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:29:36,815][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:29:52,198][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:30:02,788][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:30:14,986][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:30:26,792][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:30:39,815][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:30:49,993][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:30:59,961][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:31:14,335][root][INFO] - Processing question number 70
[2025-03-06 20:31:14,338][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:31:25,738][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:31:38,695][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:31:50,188][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:32:04,901][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:32:17,693][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:32:30,259][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:32:45,088][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:32:58,483][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:33:11,982][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:33:24,011][root][INFO] - Processing question number 80
[2025-03-06 20:33:24,015][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:33:36,754][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:33:52,717][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:34:03,584][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:34:14,000][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:34:26,088][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:34:38,118][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:34:49,144][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:35:00,305][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:35:15,722][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:35:26,540][root][INFO] - Processing question number 90
[2025-03-06 20:35:26,544][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:35:42,351][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:35:53,429][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:36:06,585][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:36:16,965][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:36:32,593][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:36:46,129][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:36:55,936][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:37:09,098][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:37:21,079][root][INFO] - Inference complete
[2025-03-06 20:37:21,079][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:37:21,084][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:37:21,096][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:37:21,101][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:37:21,101][root][INFO] - Saved parsed outputs
[2025-03-06 20:37:21,101][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:37:21,102][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:37:21,103][root][INFO] - Saved parsing metadata
[2025-03-06 20:37:21,103][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:37:21,104][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:37:21,106][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:37:21,161][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_1
[2025-03-06 20:37:21,162][root][INFO] - Summary of metrics : {'label_accuracy': 0.5151515151515151, 'misclassification_rate': 0.48484848484848486, 'combined_accuracy': 0.47474747474747475, 'malformed_label': 0, 'malformed_domain': 8, 'total_predictions': 99, 'correct_predictions': 51, 'correct_label_and_domain': 47, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 44, 'correct_label_wrong_domain': 4, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 20:37:37,644][root][INFO] - Setting global seed to 206
[2025-03-06 20:37:37,721][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:37:37,721][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 20:37:37,722][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:37:37,724][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:37:37,727][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:37:37,728][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:37:37,895][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:37:38,517][root][INFO] - Full model selected, loading model
[2025-03-06 20:38:04,518][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:39:53,015][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:39:53,016][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:40:28,274][root][INFO] - Peft model loaded successfully
[2025-03-06 20:40:36,001][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:40:36,002][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 20:40:36,002][root][INFO] - Starting inference
[2025-03-06 20:40:36,189][root][INFO] - Processing question number 0
[2025-03-06 20:40:36,191][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:40:47,445][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:41:01,646][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:41:17,232][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:41:30,168][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:41:43,239][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:41:54,778][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:42:09,600][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:42:21,103][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:42:34,153][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:42:45,279][root][INFO] - Processing question number 10
[2025-03-06 20:42:45,281][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:42:59,655][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:43:11,296][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:43:22,157][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:43:32,917][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:43:44,588][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:43:55,869][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:44:06,680][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:44:18,800][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:44:29,052][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:44:42,402][root][INFO] - Processing question number 20
[2025-03-06 20:44:42,404][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:44:53,565][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:45:07,080][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:45:18,187][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:45:32,329][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:45:44,913][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:45:54,637][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:46:05,530][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:46:19,262][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:46:30,783][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:46:43,578][root][INFO] - Processing question number 30
[2025-03-06 20:46:43,580][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:46:55,675][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:47:09,434][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:47:24,424][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:47:34,866][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:47:47,383][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:48:00,493][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:48:12,677][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:48:23,118][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:48:37,324][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:48:50,971][root][INFO] - Processing question number 40
[2025-03-06 20:48:50,974][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:49:04,016][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:49:17,453][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:49:31,851][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:49:42,767][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:49:53,644][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:50:07,115][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:50:20,181][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:50:31,710][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:50:43,376][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:50:53,809][root][INFO] - Processing question number 50
[2025-03-06 20:50:53,812][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:51:05,903][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:51:20,012][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:51:32,346][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:51:48,762][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:51:59,540][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:52:11,099][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:52:23,619][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:52:33,892][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:52:44,503][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:52:57,693][root][INFO] - Processing question number 60
[2025-03-06 20:52:57,697][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:53:08,628][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:53:19,608][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:53:35,792][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:53:48,173][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:54:00,275][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:54:11,985][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:54:24,249][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:54:36,315][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:54:48,925][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:55:03,350][root][INFO] - Processing question number 70
[2025-03-06 20:55:03,355][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:55:15,130][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:55:25,593][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:55:37,606][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:55:51,742][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:56:04,972][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:56:16,695][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:56:29,028][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:56:42,000][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:56:55,454][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:57:07,343][root][INFO] - Processing question number 80
[2025-03-06 20:57:07,348][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:57:20,524][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:57:36,103][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:57:46,550][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:57:57,293][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:58:11,684][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:58:23,859][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:58:37,025][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:58:49,220][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:59:01,924][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:59:13,161][root][INFO] - Processing question number 90
[2025-03-06 20:59:13,165][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:59:26,793][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:59:38,007][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:59:50,456][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:00:00,886][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:00:12,543][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:00:25,377][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:00:36,303][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:00:50,330][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:01:02,894][root][INFO] - Inference complete
[2025-03-06 21:01:02,894][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:01:02,900][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:01:02,902][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:01:02,902][root][WARNING] - |Q. 42||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:01:02,903][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:01:02,914][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:01:02,919][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:01:02,919][root][INFO] - Saved parsed outputs
[2025-03-06 21:01:02,919][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:01:02,920][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:01:02,920][root][INFO] - Saved parsing metadata
[2025-03-06 21:01:02,921][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:01:02,922][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:01:02,924][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:01:02,955][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_1
[2025-03-06 21:01:02,955][root][INFO] - Summary of metrics : {'label_accuracy': 0.5151515151515151, 'misclassification_rate': 0.48484848484848486, 'combined_accuracy': 0.48484848484848486, 'malformed_label': 0, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 51, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 3, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 21:01:10,574][root][INFO] - Setting global seed to 989
[2025-03-06 21:01:10,579][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:01:10,579][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:01:10,580][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:01:10,582][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:01:10,585][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:01:10,585][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:01:10,770][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:01:11,334][root][INFO] - Full model selected, loading model
[2025-03-06 21:01:38,709][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:03:28,517][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:03:28,518][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:04:04,248][root][INFO] - Peft model loaded successfully
[2025-03-06 21:04:11,979][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:04:11,982][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:04:11,982][root][INFO] - Starting inference
[2025-03-06 21:04:12,201][root][INFO] - Processing question number 0
[2025-03-06 21:04:12,203][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:04:23,104][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:04:36,775][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:04:50,368][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:05:03,683][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:05:15,744][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:05:28,613][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:05:42,381][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:05:55,958][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:06:07,113][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:06:20,433][root][INFO] - Processing question number 10
[2025-03-06 21:06:20,435][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:06:34,437][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:06:47,662][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:06:59,449][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:07:10,862][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:07:21,657][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:07:31,427][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:07:41,583][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:07:53,828][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:08:04,789][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:08:14,413][root][INFO] - Processing question number 20
[2025-03-06 21:08:14,415][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:08:24,736][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:08:36,801][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:08:47,133][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:08:58,014][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:09:10,262][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:09:21,708][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:09:32,095][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:09:44,275][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:09:54,757][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:10:05,566][root][INFO] - Processing question number 30
[2025-03-06 21:10:05,570][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:10:16,971][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:10:27,107][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:10:38,108][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:10:51,171][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:11:02,821][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:11:15,486][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:11:26,836][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:11:40,399][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:11:52,079][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:12:06,739][root][INFO] - Processing question number 40
[2025-03-06 21:12:06,742][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:12:18,495][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:12:31,448][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:12:44,266][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:12:55,912][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:13:07,657][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:13:18,426][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:13:31,363][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:13:44,369][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:13:55,497][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:14:08,183][root][INFO] - Processing question number 50
[2025-03-06 21:14:08,186][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:14:19,874][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:14:32,666][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:14:46,388][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:15:01,712][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:15:12,890][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:15:23,551][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:15:36,043][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:15:45,983][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:15:58,087][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:16:09,294][root][INFO] - Processing question number 60
[2025-03-06 21:16:09,298][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:16:21,776][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:16:31,946][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:16:45,104][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:16:55,605][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:17:06,975][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:17:18,756][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:17:30,152][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:17:39,907][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:17:50,991][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:18:05,504][root][INFO] - Processing question number 70
[2025-03-06 21:18:05,507][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:18:16,791][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:18:29,649][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:18:41,303][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:18:56,671][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:19:09,658][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:19:18,882][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:19:32,604][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:19:43,243][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:19:56,547][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:20:07,385][root][INFO] - Processing question number 80
[2025-03-06 21:20:07,389][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:20:19,204][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:20:33,857][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:20:43,551][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:20:54,597][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:21:12,115][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:21:23,920][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:21:35,586][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:21:46,443][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:22:00,129][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:22:12,160][root][INFO] - Processing question number 90
[2025-03-06 21:22:12,164][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:22:25,840][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:22:36,244][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:22:49,629][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:22:59,808][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:23:13,082][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:23:25,767][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:23:35,927][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:23:48,896][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:24:00,709][root][INFO] - Inference complete
[2025-03-06 21:24:00,710][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:24:00,715][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:24:00,720][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:24:00,721][root][WARNING] - |Q. 47||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:24:00,722][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:24:00,728][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:24:00,733][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:24:00,733][root][INFO] - Saved parsed outputs
[2025-03-06 21:24:00,733][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:24:00,734][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:24:00,734][root][INFO] - Saved parsing metadata
[2025-03-06 21:24:00,735][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:24:00,736][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:24:00,738][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:24:00,765][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_1
[2025-03-06 21:24:00,765][root][INFO] - Summary of metrics : {'label_accuracy': 0.5151515151515151, 'misclassification_rate': 0.48484848484848486, 'combined_accuracy': 0.48484848484848486, 'malformed_label': 0, 'malformed_domain': 7, 'total_predictions': 99, 'correct_predictions': 51, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.15151515151515152, 'correct_domain_wrong_label': 44, 'correct_label_wrong_domain': 3, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 21:24:09,795][root][INFO] - Setting global seed to 989
[2025-03-06 21:24:09,802][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:24:09,802][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:24:09,803][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:24:09,805][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:24:09,808][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:24:09,808][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:24:09,976][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:24:10,539][root][INFO] - Full model selected, loading model
[2025-03-06 21:24:34,307][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:26:21,220][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:26:21,221][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:26:56,819][root][INFO] - Peft model loaded successfully
[2025-03-06 21:27:04,621][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:27:04,623][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:27:04,623][root][INFO] - Starting inference
[2025-03-06 21:27:04,846][root][INFO] - Processing question number 0
[2025-03-06 21:27:04,848][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:27:15,124][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:27:29,674][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:27:43,045][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:27:56,270][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:28:08,246][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:28:21,601][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:28:35,382][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:28:47,837][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:29:00,239][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:29:12,336][root][INFO] - Processing question number 10
[2025-03-06 21:29:12,338][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:29:28,540][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:29:40,822][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:29:53,371][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:30:05,834][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:30:17,180][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:30:28,089][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:30:38,805][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:30:51,246][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:31:02,057][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:31:14,740][root][INFO] - Processing question number 20
[2025-03-06 21:31:14,743][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:31:24,311][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:31:36,629][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:31:45,418][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:31:58,609][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:32:11,233][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:32:23,198][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:32:35,095][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:32:47,261][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:32:57,787][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:33:08,590][root][INFO] - Processing question number 30
[2025-03-06 21:33:08,592][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:33:21,387][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:33:31,748][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:33:44,509][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:33:59,737][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:34:11,690][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:34:26,877][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:34:38,332][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:34:49,230][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:35:03,196][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:35:15,876][root][INFO] - Processing question number 40
[2025-03-06 21:35:15,879][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:35:28,261][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:35:41,388][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:35:54,368][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:36:05,407][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:36:16,373][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:36:25,970][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:36:40,000][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:36:51,612][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:37:02,420][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:37:16,469][root][INFO] - Processing question number 50
[2025-03-06 21:37:16,472][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:37:28,273][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:37:42,134][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:37:54,367][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:38:12,100][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:38:24,277][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:38:36,480][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:38:49,231][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:39:00,003][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:39:12,407][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:39:23,750][root][INFO] - Processing question number 60
[2025-03-06 21:39:23,753][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:39:35,143][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:39:45,454][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:39:58,644][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:40:09,150][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:40:21,238][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:40:33,171][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:40:46,231][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:40:55,832][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:41:06,679][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:41:20,900][root][INFO] - Processing question number 70
[2025-03-06 21:41:20,904][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:41:32,485][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:41:45,431][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:41:58,514][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:42:13,071][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:42:26,997][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:42:39,129][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:42:53,413][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:43:04,341][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:43:17,256][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:43:28,381][root][INFO] - Processing question number 80
[2025-03-06 21:43:28,385][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:43:41,878][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:43:56,194][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:44:06,677][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:44:17,880][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:44:31,443][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:44:42,798][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:44:54,436][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:45:04,743][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:45:21,300][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:45:31,876][root][INFO] - Processing question number 90
[2025-03-06 21:45:31,880][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:45:44,579][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:45:54,355][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:46:06,841][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:46:17,283][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:46:33,097][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:46:46,078][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:46:57,416][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:47:09,330][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:47:21,405][root][INFO] - Inference complete
[2025-03-06 21:47:21,405][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:47:21,411][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:47:21,416][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:47:21,416][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:47:21,416][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:47:21,418][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:47:21,418][root][WARNING] - |Q. 47||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:47:21,419][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:47:21,425][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:47:21,430][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:47:21,430][root][INFO] - Saved parsed outputs
[2025-03-06 21:47:21,430][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:47:21,431][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:47:21,431][root][INFO] - Saved parsing metadata
[2025-03-06 21:47:21,432][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:47:21,433][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:47:21,435][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:47:21,451][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_1
[2025-03-06 21:47:21,451][root][INFO] - Summary of metrics : {'label_accuracy': 0.5151515151515151, 'misclassification_rate': 0.48484848484848486, 'combined_accuracy': 0.48484848484848486, 'malformed_label': 0, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 51, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 3, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 21:47:30,567][root][INFO] - Setting global seed to 989
[2025-03-06 21:47:30,583][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:47:30,583][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:47:30,585][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:47:30,586][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:47:30,589][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:47:30,589][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:47:30,740][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:47:31,346][root][INFO] - Full model selected, loading model
[2025-03-06 21:47:58,979][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:49:51,069][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:49:51,070][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:50:25,130][root][INFO] - Peft model loaded successfully
[2025-03-06 21:50:32,379][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:50:32,381][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:50:32,381][root][INFO] - Starting inference
[2025-03-06 21:50:32,586][root][INFO] - Processing question number 0
[2025-03-06 21:50:32,589][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:50:42,547][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:50:56,590][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:51:11,352][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:51:25,201][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:51:37,143][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:51:49,526][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:52:03,874][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:52:17,270][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:52:28,204][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:52:40,604][root][INFO] - Processing question number 10
[2025-03-06 21:52:40,606][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:52:54,444][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:53:05,755][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:53:16,654][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:53:28,168][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:53:38,129][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:53:49,264][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:54:00,810][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:54:13,445][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:54:24,725][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:54:34,696][root][INFO] - Processing question number 20
[2025-03-06 21:54:34,698][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:54:48,974][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:55:01,961][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:55:11,434][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:55:24,028][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:55:35,897][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:55:46,923][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:55:58,100][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:56:11,696][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:56:22,315][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:56:33,069][root][INFO] - Processing question number 30
[2025-03-06 21:56:33,072][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:56:46,204][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:56:59,229][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:57:11,276][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:57:23,907][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:57:36,146][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:57:48,186][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:58:00,871][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:58:13,099][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:58:26,030][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:58:38,288][root][INFO] - Processing question number 40
[2025-03-06 21:58:38,291][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:58:49,202][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:59:01,959][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:59:17,218][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:59:28,737][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:59:41,212][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:59:52,593][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:00:05,856][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:00:16,217][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:00:28,347][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:00:39,054][root][INFO] - Processing question number 50
[2025-03-06 22:00:39,058][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:00:52,305][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:01:04,748][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:01:19,719][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:01:34,725][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:01:47,297][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:01:56,721][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:02:10,057][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:02:19,667][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:02:33,182][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:02:45,598][root][INFO] - Processing question number 60
[2025-03-06 22:02:45,602][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:02:56,060][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:03:05,808][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:03:24,000][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:03:34,276][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:03:46,278][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:03:57,087][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:04:08,922][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:04:20,370][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:04:33,024][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:04:47,553][root][INFO] - Processing question number 70
[2025-03-06 22:04:47,556][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:04:59,189][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:05:12,949][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:05:25,401][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:05:37,789][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:05:53,246][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:06:06,952][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:06:19,631][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:06:30,582][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:06:44,154][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:06:55,896][root][INFO] - Processing question number 80
[2025-03-06 22:06:55,900][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:07:07,911][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:07:22,557][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:07:32,397][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:07:42,994][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:07:56,482][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:08:10,487][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:08:24,105][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:08:34,983][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:08:48,129][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:08:58,951][root][INFO] - Processing question number 90
[2025-03-06 22:08:58,955][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:09:14,541][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:09:25,712][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:09:38,303][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:09:48,911][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:10:00,946][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:10:15,580][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:10:27,156][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:10:38,851][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:10:50,552][root][INFO] - Inference complete
[2025-03-06 22:10:50,552][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:50,559][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:50,570][root][WARNING] - |Q. 10||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:10:50,570][root][WARNING] - |Q. 10||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:10:50,570][root][INFO] - |Q. 10||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:10:50,573][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:50,577][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:50,578][root][INFO] - Saved parsed outputs
[2025-03-06 22:10:50,578][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:50,579][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:50,579][root][INFO] - Saved parsing metadata
[2025-03-06 22:10:50,579][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:50,581][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:10:50,583][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:10:50,617][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_1
[2025-03-06 22:10:50,618][root][INFO] - Summary of metrics : {'label_accuracy': 0.5252525252525253, 'misclassification_rate': 0.4747474747474747, 'combined_accuracy': 0.494949494949495, 'malformed_label': 0, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 52, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.5625, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 44, 'correct_label_wrong_domain': 3, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 22:10:59,632][root][INFO] - Setting global seed to 206
[2025-03-06 22:10:59,674][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:10:59,674][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:10:59,676][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:10:59,678][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:10:59,681][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:10:59,681][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:10:59,828][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:11:00,434][root][INFO] - Full model selected, loading model
[2025-03-06 22:11:25,111][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:13:15,759][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:13:15,760][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:13:48,528][root][INFO] - Peft model loaded successfully
[2025-03-06 22:13:55,728][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:13:55,730][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:13:55,730][root][INFO] - Starting inference
[2025-03-06 22:13:55,967][root][INFO] - Processing question number 0
[2025-03-06 22:13:55,970][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:14:07,171][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:14:20,928][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:14:33,868][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:14:45,429][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:14:54,276][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:15:04,887][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:15:16,573][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:15:27,717][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:15:37,423][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:15:47,410][root][INFO] - Processing question number 10
[2025-03-06 22:15:47,412][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:15:58,937][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:16:11,428][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:16:23,050][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:16:33,752][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:16:45,535][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:16:56,403][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:17:07,561][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:17:19,854][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:17:30,860][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:17:42,244][root][INFO] - Processing question number 20
[2025-03-06 22:17:42,247][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:17:54,559][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:18:05,923][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:18:14,585][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:18:22,713][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:18:34,071][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:18:45,982][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:18:58,525][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:19:10,672][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:19:22,179][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:19:34,975][root][INFO] - Processing question number 30
[2025-03-06 22:19:34,977][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:19:46,107][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:19:58,926][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:20:10,299][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:20:23,682][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:20:37,927][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:20:50,680][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:21:00,881][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:21:13,027][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:21:22,876][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:21:37,251][root][INFO] - Processing question number 40
[2025-03-06 22:21:37,255][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:21:49,058][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:21:59,905][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:22:11,998][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:22:22,072][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:22:34,821][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:22:47,560][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:22:57,808][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:23:08,823][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:23:21,149][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:23:31,513][root][INFO] - Processing question number 50
[2025-03-06 22:23:31,517][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:23:43,247][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:23:55,265][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:24:08,072][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:24:22,880][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:24:33,110][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:24:46,671][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:25:00,912][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:25:14,364][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 22:25:27,239][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 22:25:41,708][root][INFO] - Processing question number 60
[2025-03-06 22:25:41,712][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 22:25:55,029][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 22:26:08,493][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 22:26:22,619][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 22:26:36,074][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 22:26:50,803][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 22:27:03,665][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 22:27:16,320][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 22:27:27,452][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:27:41,040][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:27:54,070][root][INFO] - Processing question number 70
[2025-03-06 22:27:54,074][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:28:06,645][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:28:20,163][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:28:31,598][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:28:47,317][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:28:57,567][root][INFO] - Domain : Property, Question : 36
[2025-03-06 22:29:11,362][root][INFO] - Domain : Property, Question : 46
[2025-03-06 22:29:24,516][root][INFO] - Domain : Property, Question : 53
[2025-03-06 22:29:37,057][root][INFO] - Domain : Property, Question : 59
[2025-03-06 22:29:49,322][root][INFO] - Domain : Property, Question : 66
[2025-03-06 22:30:00,260][root][INFO] - Processing question number 80
[2025-03-06 22:30:00,264][root][INFO] - Domain : Property, Question : 69
[2025-03-06 22:30:13,127][root][INFO] - Domain : Property, Question : 81
[2025-03-06 22:30:26,769][root][INFO] - Domain : Property, Question : 88
[2025-03-06 22:30:37,893][root][INFO] - Domain : Property, Question : 91
[2025-03-06 22:30:50,127][root][INFO] - Domain : Property, Question : 94
[2025-03-06 22:31:04,885][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:31:16,863][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:31:30,491][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 22:31:43,730][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 22:31:55,872][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:32:09,325][root][INFO] - Processing question number 90
[2025-03-06 22:32:09,329][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 22:32:22,046][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 22:32:41,119][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:32:51,733][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 22:33:02,361][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 22:33:15,914][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 22:33:27,907][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 22:33:40,629][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 22:33:51,332][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 22:34:00,034][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:34:13,247][root][INFO] - Inference complete
[2025-03-06 22:34:13,247][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:34:13,253][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:34:13,257][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:13,257][root][WARNING] - |Q. 89||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:34:13,257][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:13,262][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:34:13,262][root][WARNING] - |Q. 61||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:34:13,263][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:34:13,267][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:34:13,273][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:34:13,273][root][INFO] - Saved parsed outputs
[2025-03-06 22:34:13,273][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:34:13,274][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:34:13,274][root][INFO] - Saved parsing metadata
[2025-03-06 22:34:13,277][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:34:13,278][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:34:13,280][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 22:34:13,424][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_2
[2025-03-06 22:34:13,424][root][INFO] - Summary of metrics : {'label_accuracy': 0.54, 'misclassification_rate': 0.45999999999999996, 'combined_accuracy': 0.47, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 54, 'correct_label_and_domain': 47, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.5714285714285714, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.6153846153846154, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 42, 'correct_label_wrong_domain': 7, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 22:34:39,180][root][INFO] - Setting global seed to 206
[2025-03-06 22:34:39,245][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:34:39,245][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:34:39,246][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:34:39,248][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:34:39,261][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:34:39,261][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:34:39,626][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:34:40,210][root][INFO] - Full model selected, loading model
[2025-03-06 22:35:10,648][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:37:04,250][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:37:04,252][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:37:46,522][root][INFO] - Peft model loaded successfully
[2025-03-06 22:37:54,196][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:37:54,198][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:37:54,198][root][INFO] - Starting inference
[2025-03-06 22:37:54,365][root][INFO] - Processing question number 0
[2025-03-06 22:37:54,368][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:38:07,586][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:38:22,015][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:38:34,999][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:38:46,387][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:38:55,322][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:39:05,486][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:39:17,723][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:39:27,934][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:39:37,600][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:39:49,524][root][INFO] - Processing question number 10
[2025-03-06 22:39:49,526][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:39:59,363][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:40:11,503][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:40:22,772][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:40:33,260][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:40:45,545][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:40:56,802][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:41:10,064][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:41:21,491][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:41:32,183][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:41:45,636][root][INFO] - Processing question number 20
[2025-03-06 22:41:45,638][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:41:55,946][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:42:07,242][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:42:15,993][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:42:26,855][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:42:37,625][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:42:49,946][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:43:04,460][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:43:16,726][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:43:29,010][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:43:41,937][root][INFO] - Processing question number 30
[2025-03-06 22:43:41,939][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:43:51,334][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:44:02,489][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:44:14,835][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:44:26,545][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:44:40,177][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:44:54,627][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:45:07,581][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:45:19,871][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:45:29,926][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:45:48,965][root][INFO] - Processing question number 40
[2025-03-06 22:45:48,968][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:46:00,995][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:46:11,972][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:46:24,455][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:46:34,333][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:46:48,349][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:47:01,531][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:47:11,846][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:47:22,979][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:47:34,442][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:47:44,779][root][INFO] - Processing question number 50
[2025-03-06 22:47:44,782][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:47:56,925][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:48:08,982][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:48:21,919][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:48:36,842][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:48:48,450][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:49:03,486][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:49:18,136][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:49:30,281][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 22:49:45,244][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 22:49:59,173][root][INFO] - Processing question number 60
[2025-03-06 22:49:59,176][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 22:50:09,982][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 22:50:23,420][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 22:50:35,886][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 22:50:47,516][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 22:50:59,538][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 22:51:12,386][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 22:51:23,122][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 22:51:34,346][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:51:46,032][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:51:59,117][root][INFO] - Processing question number 70
[2025-03-06 22:51:59,122][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:52:11,893][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:52:23,840][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:52:36,598][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:52:50,270][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:52:59,178][root][INFO] - Domain : Property, Question : 36
[2025-03-06 22:53:11,684][root][INFO] - Domain : Property, Question : 46
[2025-03-06 22:53:24,978][root][INFO] - Domain : Property, Question : 53
[2025-03-06 22:53:36,705][root][INFO] - Domain : Property, Question : 59
[2025-03-06 22:53:52,915][root][INFO] - Domain : Property, Question : 66
[2025-03-06 22:54:05,856][root][INFO] - Processing question number 80
[2025-03-06 22:54:05,860][root][INFO] - Domain : Property, Question : 69
[2025-03-06 22:54:17,961][root][INFO] - Domain : Property, Question : 81
[2025-03-06 22:54:26,828][root][INFO] - Domain : Property, Question : 88
[2025-03-06 22:54:37,980][root][INFO] - Domain : Property, Question : 91
[2025-03-06 22:54:50,354][root][INFO] - Domain : Property, Question : 94
[2025-03-06 22:55:05,377][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:55:17,391][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:55:31,165][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 22:55:43,007][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 22:55:53,815][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:56:08,269][root][INFO] - Processing question number 90
[2025-03-06 22:56:08,273][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 22:56:21,133][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 22:56:34,852][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:56:45,582][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 22:56:56,275][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 22:57:09,353][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 22:57:25,688][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 22:57:40,131][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 22:57:49,690][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 22:57:58,488][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:58:12,129][root][INFO] - Inference complete
[2025-03-06 22:58:12,129][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:58:12,135][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:58:12,147][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:58:12,152][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:58:12,152][root][INFO] - Saved parsed outputs
[2025-03-06 22:58:12,152][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:58:12,153][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:58:12,153][root][INFO] - Saved parsing metadata
[2025-03-06 22:58:12,154][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:58:12,156][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 22:58:12,157][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 22:58:12,173][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_2
[2025-03-06 22:58:12,174][root][INFO] - Summary of metrics : {'label_accuracy': 0.53, 'misclassification_rate': 0.47, 'combined_accuracy': 0.46, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 53, 'correct_label_and_domain': 46, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.5714285714285714, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.6153846153846154, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 7, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 22:58:20,399][root][INFO] - Setting global seed to 206
[2025-03-06 22:58:20,405][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:58:20,406][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:58:20,407][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:58:20,408][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:58:20,410][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:58:20,410][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:58:20,574][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:58:21,152][root][INFO] - Full model selected, loading model
[2025-03-06 22:58:45,951][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:00:35,675][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:00:35,675][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:01:09,255][root][INFO] - Peft model loaded successfully
[2025-03-06 23:01:16,469][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:01:16,471][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:01:16,471][root][INFO] - Starting inference
[2025-03-06 23:01:16,702][root][INFO] - Processing question number 0
[2025-03-06 23:01:16,704][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:01:28,510][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:01:41,925][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:01:53,951][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:02:06,543][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:02:15,136][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:02:25,361][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:02:36,708][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:02:46,338][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:02:56,669][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:03:08,036][root][INFO] - Processing question number 10
[2025-03-06 23:03:08,038][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:03:16,797][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:03:28,761][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:03:39,292][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:03:50,344][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:04:01,671][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:04:13,516][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:04:25,461][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:04:38,261][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:04:50,030][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:05:03,509][root][INFO] - Processing question number 20
[2025-03-06 23:05:03,511][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:05:14,200][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:05:26,258][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:05:37,826][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:05:47,347][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:05:58,392][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:06:10,504][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:06:22,464][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:06:34,024][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:06:45,601][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:06:58,403][root][INFO] - Processing question number 30
[2025-03-06 23:06:58,405][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:07:11,082][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:07:23,121][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:07:35,303][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:07:48,981][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:08:01,202][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:08:14,514][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:08:24,904][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:08:37,743][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:08:46,960][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:08:59,343][root][INFO] - Processing question number 40
[2025-03-06 23:08:59,345][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:09:11,431][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:09:22,208][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:09:35,983][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:09:44,662][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:09:58,641][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:10:09,078][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:10:19,859][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:10:31,504][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:10:42,685][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:10:52,468][root][INFO] - Processing question number 50
[2025-03-06 23:10:52,471][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:11:06,467][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:11:19,436][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:11:33,085][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:11:45,324][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:11:57,565][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:12:11,951][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:12:25,664][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:12:36,396][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:12:49,802][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:13:02,019][root][INFO] - Processing question number 60
[2025-03-06 23:13:02,023][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:13:14,761][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:13:27,627][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:13:41,924][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:13:54,743][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:14:05,544][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:14:17,449][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:14:31,173][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:14:42,401][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:14:53,064][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:15:05,480][root][INFO] - Processing question number 70
[2025-03-06 23:15:05,484][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:15:17,395][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:15:29,953][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:15:43,366][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:15:56,071][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:16:06,104][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:16:19,035][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:16:32,568][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:16:42,840][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:16:52,739][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:17:02,685][root][INFO] - Processing question number 80
[2025-03-06 23:17:02,689][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:17:14,408][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:17:25,518][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:17:37,198][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:17:49,482][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:18:04,676][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:18:16,778][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:18:30,350][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:18:42,149][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:18:55,085][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:19:06,739][root][INFO] - Processing question number 90
[2025-03-06 23:19:06,743][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:19:19,739][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:19:32,970][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:19:43,523][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:19:55,305][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:20:08,039][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:20:21,456][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:20:33,936][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:20:44,856][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:20:53,628][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:21:05,077][root][INFO] - Inference complete
[2025-03-06 23:21:05,077][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:21:05,082][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:21:05,085][root][WARNING] - |Q. 21||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:21:05,085][root][WARNING] - |Q. 21||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:21:05,085][root][INFO] - |Q. 21||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:21:05,095][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:21:05,100][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:21:05,100][root][INFO] - Saved parsed outputs
[2025-03-06 23:21:05,100][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:21:05,101][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:21:05,101][root][INFO] - Saved parsing metadata
[2025-03-06 23:21:05,102][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:21:05,103][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:21:05,105][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:21:05,123][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_2
[2025-03-06 23:21:05,123][root][INFO] - Summary of metrics : {'label_accuracy': 0.52, 'misclassification_rate': 0.48, 'combined_accuracy': 0.45, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 52, 'correct_label_and_domain': 45, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.5, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.6153846153846154, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 44, 'correct_label_wrong_domain': 7, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 23:21:13,089][root][INFO] - Setting global seed to 989
[2025-03-06 23:21:13,096][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:21:13,096][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 23:21:13,098][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:21:13,099][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:21:13,101][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:21:13,102][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:21:13,256][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 23:21:13,919][root][INFO] - Full model selected, loading model
[2025-03-06 23:21:38,107][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:23:26,267][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:23:26,267][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:24:01,707][root][INFO] - Peft model loaded successfully
[2025-03-06 23:24:08,971][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:24:08,973][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:24:08,973][root][INFO] - Starting inference
[2025-03-06 23:24:09,214][root][INFO] - Processing question number 0
[2025-03-06 23:24:09,217][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:24:20,405][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:24:34,085][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:24:47,048][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:24:58,628][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:25:07,442][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:25:17,965][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:25:29,560][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:25:40,615][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:25:50,238][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:26:00,166][root][INFO] - Processing question number 10
[2025-03-06 23:26:00,167][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:26:11,676][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:26:24,179][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:26:35,798][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:26:46,501][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:26:58,289][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:27:09,168][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:27:20,254][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:27:32,529][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:27:43,540][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:27:54,926][root][INFO] - Processing question number 20
[2025-03-06 23:27:54,929][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:28:07,220][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:28:18,511][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:28:27,125][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:28:35,261][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:28:46,631][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:28:58,533][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:29:10,969][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:29:23,011][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:29:34,419][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:29:47,107][root][INFO] - Processing question number 30
[2025-03-06 23:29:47,110][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:29:58,142][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:30:10,846][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:30:22,119][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:30:35,386][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:30:49,505][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:31:02,146][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:31:12,254][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:31:24,300][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:31:34,063][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:31:48,313][root][INFO] - Processing question number 40
[2025-03-06 23:31:48,316][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:32:00,014][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:32:10,764][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:32:22,750][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:32:32,727][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:32:45,369][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:32:57,999][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:33:08,155][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:33:19,070][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:33:31,291][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:33:41,566][root][INFO] - Processing question number 50
[2025-03-06 23:33:41,569][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:33:53,196][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:34:05,099][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:34:17,797][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:34:32,476][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:34:42,612][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:34:56,054][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:35:10,154][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:35:23,348][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:35:35,995][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:35:50,225][root][INFO] - Processing question number 60
[2025-03-06 23:35:50,229][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:36:03,378][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:36:16,560][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:36:30,443][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:36:43,533][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:36:57,951][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:37:10,546][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:37:22,953][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:37:33,967][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:37:47,518][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:38:00,314][root][INFO] - Processing question number 70
[2025-03-06 23:38:00,318][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:38:12,724][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:38:26,118][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:38:37,434][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:38:52,874][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:39:02,935][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:39:16,574][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:39:29,636][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:39:42,082][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:39:54,246][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:40:05,099][root][INFO] - Processing question number 80
[2025-03-06 23:40:05,103][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:40:17,872][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:40:31,412][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:40:42,456][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:40:54,600][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:41:09,256][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:41:21,142][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:41:34,663][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:41:47,803][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:41:59,858][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:42:13,209][root][INFO] - Processing question number 90
[2025-03-06 23:42:13,213][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:42:25,833][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:42:44,770][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:42:55,313][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:43:05,861][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:43:19,322][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:43:31,232][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:43:43,861][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:43:54,486][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:44:03,120][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:44:16,234][root][INFO] - Inference complete
[2025-03-06 23:44:16,234][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:44:16,239][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:44:16,243][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:44:16,243][root][WARNING] - |Q. 89||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:44:16,243][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:44:16,248][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:44:16,248][root][WARNING] - |Q. 61||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:44:16,249][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:44:16,253][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:44:16,258][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:44:16,258][root][INFO] - Saved parsed outputs
[2025-03-06 23:44:16,258][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:44:16,276][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:44:16,276][root][INFO] - Saved parsing metadata
[2025-03-06 23:44:16,276][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:44:16,278][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:44:16,279][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:44:16,292][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_2
[2025-03-06 23:44:16,292][root][INFO] - Summary of metrics : {'label_accuracy': 0.54, 'misclassification_rate': 0.45999999999999996, 'combined_accuracy': 0.47, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 54, 'correct_label_and_domain': 47, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.5714285714285714, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.6153846153846154, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 42, 'correct_label_wrong_domain': 7, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-06 23:44:42,146][root][INFO] - Setting global seed to 989
[2025-03-06 23:44:42,189][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:44:42,189][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 23:44:42,190][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:44:42,192][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:44:42,196][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:44:42,196][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:44:42,357][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 23:44:42,937][root][INFO] - Full model selected, loading model
[2025-03-06 23:45:08,043][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:47:00,348][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:47:00,349][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:47:33,278][root][INFO] - Peft model loaded successfully
[2025-03-06 23:47:40,500][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:47:40,501][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:47:40,501][root][INFO] - Starting inference
[2025-03-06 23:47:40,722][root][INFO] - Processing question number 0
[2025-03-06 23:47:40,724][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:47:56,500][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:48:10,336][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:48:23,895][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:48:35,386][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:48:44,814][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:48:54,994][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:49:07,562][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:49:16,998][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:49:27,183][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:49:38,354][root][INFO] - Processing question number 10
[2025-03-06 23:49:38,356][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:49:50,226][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:50:02,171][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:50:13,118][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:50:23,333][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:50:34,577][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:50:45,931][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:50:59,414][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:51:10,985][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:51:22,017][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:51:33,430][root][INFO] - Processing question number 20
[2025-03-06 23:51:33,432][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:51:44,864][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:51:57,060][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:52:07,868][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:52:16,565][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:52:27,481][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:52:39,704][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:52:51,614][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:53:03,553][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:53:15,929][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:53:27,387][root][INFO] - Processing question number 30
[2025-03-06 23:53:27,390][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:53:39,900][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:53:51,901][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:54:02,654][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:54:14,366][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:54:26,803][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:54:39,582][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:54:51,535][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:55:06,384][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:55:15,561][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:55:34,630][root][INFO] - Processing question number 40
[2025-03-06 23:55:34,634][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:55:45,955][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:55:57,289][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:56:10,824][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:56:20,319][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:56:35,119][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:56:45,739][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:56:56,008][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:57:07,572][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:57:19,361][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:57:29,655][root][INFO] - Processing question number 50
[2025-03-06 23:57:29,658][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:57:42,554][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:57:54,179][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:58:07,350][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:58:22,206][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:58:32,370][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:58:44,643][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:58:55,602][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:59:06,288][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:59:19,225][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:59:34,136][root][INFO] - Processing question number 60
[2025-03-06 23:59:34,139][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:59:44,622][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:59:57,959][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:00:11,879][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:00:24,939][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:00:37,293][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:00:49,060][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:01:00,773][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:01:11,585][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:01:23,924][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:01:36,902][root][INFO] - Processing question number 70
[2025-03-07 00:01:36,906][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:01:50,659][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:02:03,035][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:02:15,458][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:02:28,073][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:02:38,204][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:02:50,853][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:03:03,726][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:03:16,561][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:03:30,117][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:03:40,770][root][INFO] - Processing question number 80
[2025-03-07 00:03:40,774][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:03:53,264][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:04:05,531][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:04:15,993][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:04:27,295][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:04:41,243][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:04:53,217][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:05:06,365][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:05:17,746][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:05:30,124][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:05:43,621][root][INFO] - Processing question number 90
[2025-03-07 00:05:43,626][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:05:56,581][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:06:12,902][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:06:23,556][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:06:34,028][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:06:47,199][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:06:59,235][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:07:12,307][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:07:23,281][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:07:32,014][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:07:44,132][root][INFO] - Inference complete
[2025-03-07 00:07:44,133][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:07:44,138][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:07:44,140][root][WARNING] - |Q. 99||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:07:44,141][root][WARNING] - |Q. 99||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:07:44,141][root][INFO] - |Q. 99||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:07:44,151][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:07:44,156][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:07:44,156][root][INFO] - Saved parsed outputs
[2025-03-07 00:07:44,156][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:07:44,171][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:07:44,171][root][INFO] - Saved parsing metadata
[2025-03-07 00:07:44,171][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:07:44,173][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:07:44,174][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:07:44,186][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_2
[2025-03-07 00:07:44,186][root][INFO] - Summary of metrics : {'label_accuracy': 0.54, 'misclassification_rate': 0.45999999999999996, 'combined_accuracy': 0.47, 'malformed_label': 0, 'malformed_domain': 10, 'total_predictions': 100, 'correct_predictions': 54, 'correct_label_and_domain': 47, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.5714285714285714, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.6153846153846154, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 7, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 22 to status running with exit code None
Eval status update completed for job 22
[2025-03-07 00:07:53,845][root][INFO] - Setting global seed to 989
[2025-03-07 00:07:53,854][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:07:53,854][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 00:07:53,855][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:07:53,856][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:07:53,859][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:07:53,859][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:07:54,018][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-07 00:07:54,580][root][INFO] - Full model selected, loading model
[2025-03-07 00:08:17,377][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:10:06,402][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:10:06,402][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:10:39,270][root][INFO] - Peft model loaded successfully
[2025-03-07 00:10:46,679][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:10:46,681][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:10:46,681][root][INFO] - Starting inference
[2025-03-07 00:10:46,915][root][INFO] - Processing question number 0
[2025-03-07 00:10:46,917][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:10:59,567][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:11:15,279][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:11:28,770][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:11:41,696][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:11:52,327][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:12:03,346][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:12:16,911][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:12:28,891][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:12:37,987][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:12:47,728][root][INFO] - Processing question number 10
[2025-03-07 00:12:47,730][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:12:59,431][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:13:11,162][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:13:25,084][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:13:35,453][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:13:47,612][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:13:58,380][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:14:11,269][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:14:22,057][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:14:32,679][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:14:48,446][root][INFO] - Processing question number 20
[2025-03-07 00:14:48,448][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:15:01,221][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:15:13,950][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:15:26,635][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:15:37,241][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:15:48,032][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:15:57,726][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:16:09,982][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:16:21,701][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:16:35,740][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:16:48,058][root][INFO] - Processing question number 30
[2025-03-07 00:16:48,061][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:16:59,648][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:17:11,618][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:17:22,656][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:17:33,296][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:17:44,247][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:17:56,670][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:18:08,777][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:18:21,154][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:18:31,182][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:18:44,378][root][INFO] - Processing question number 40
[2025-03-07 00:18:44,380][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:18:56,603][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:19:08,520][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:19:22,545][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:19:31,594][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:19:45,688][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:19:56,183][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:20:06,793][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:20:18,407][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:20:32,336][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:20:44,295][root][INFO] - Processing question number 50
[2025-03-07 00:20:44,298][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:20:56,781][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:21:08,284][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:21:20,008][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:21:34,548][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:21:44,726][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:21:59,135][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:22:12,868][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:22:25,738][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:22:40,070][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:22:53,158][root][INFO] - Processing question number 60
[2025-03-07 00:22:53,161][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:23:05,497][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:23:18,670][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:23:33,040][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:23:48,120][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:24:01,965][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:24:14,593][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:24:26,515][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:24:36,470][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:24:46,462][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:24:58,337][root][INFO] - Processing question number 70
[2025-03-07 00:24:58,341][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:25:09,375][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:25:22,237][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:25:34,581][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:25:49,039][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:25:58,950][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:26:11,901][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:26:25,023][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:26:38,626][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:26:50,654][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:27:01,539][root][INFO] - Processing question number 80
[2025-03-07 00:27:01,543][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:27:13,459][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:27:26,575][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:27:39,939][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:27:54,216][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:28:07,775][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:28:20,455][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:28:33,606][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:28:46,524][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:28:58,203][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:29:10,810][root][INFO] - Processing question number 90
[2025-03-07 00:29:10,814][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:29:22,638][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:29:35,977][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:29:47,673][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:29:58,479][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:30:12,087][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:30:24,460][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:30:37,753][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:30:47,246][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:30:56,483][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:31:10,081][root][INFO] - Inference complete
[2025-03-07 00:31:10,081][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:31:10,087][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:31:10,092][root][WARNING] - |Q. 97||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:10,092][root][WARNING] - |Q. 97||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:10,092][root][INFO] - |Q. 97||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:10,100][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:31:10,105][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:31:10,105][root][INFO] - Saved parsed outputs
[2025-03-07 00:31:10,105][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:31:10,106][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:31:10,106][root][INFO] - Saved parsing metadata
[2025-03-07 00:31:10,107][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:31:10,109][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:31:10,110][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:31:10,138][root][INFO] - Evaluation completed for json_answer_first_zero_shot_structured, on test_set_2
[2025-03-07 00:31:10,138][root][INFO] - Summary of metrics : {'label_accuracy': 0.54, 'misclassification_rate': 0.45999999999999996, 'combined_accuracy': 0.46, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 54, 'correct_label_and_domain': 46, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.5714285714285714, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.6153846153846154, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.13, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.17, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 42, 'correct_label_wrong_domain': 8, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '22', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 22 to status completed with exit code 0
Eval status update completed for job 22
Job 22 completed at Fri Mar  7 00:31:11 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n516
Job ID: 25358397
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 05:23:01
CPU Efficiency: 9.83% of 2-06:47:40 core-walltime
Job Wall-clock time: 05:28:46
Memory Utilized: 34.75 GB
Memory Efficiency: 96.52% of 36.00 GB
