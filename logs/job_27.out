Starting job 27 at Thu Mar  6 19:02:59 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_10_samples prompt=json_fact_first_few_shot_unstructured train=json_fact_first_few_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '27', 'training']
Updating job 27 to status training with exit code None
Status update completed for job 27
[2025-03-06 19:03:09,320][root][INFO] - Global seed set to 314
[2025-03-06 19:03:09,322][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 19:03:09,322][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 19:03:09,322][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 19:03:09,322][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 19:03:09,322][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 19:03:09,338][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 19:03:09,343][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 19:03:09,343][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 19:03:09,348][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 19:03:09,772][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 19:03:23,871][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 19:03:53,181][root][INFO] - Model prepared for kbit training
[2025-03-06 19:03:53,182][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'q_proj', 'o_proj', 'gate_proj', 'up_proj', 'k_proj', 'v_proj', 'down_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 19:03:54,910][root][INFO] - Lora adapter added to model
[2025-03-06 19:03:54,913][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_few_shot_unstructured
[2025-03-06 19:03:55,145][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.5487, 'grad_norm': 0.1353198140859604, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.5671, 'grad_norm': 0.14344191551208496, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.4712, 'grad_norm': 0.14320988953113556, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.405, 'grad_norm': 0.17568674683570862, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.1983, 'grad_norm': 0.19984693825244904, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.9611, 'grad_norm': 0.28654012084007263, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.784, 'grad_norm': 0.24128052592277527, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.6049, 'grad_norm': 0.19419598579406738, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.5673, 'grad_norm': 0.14870160818099976, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.5492, 'grad_norm': 0.11215481162071228, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.5202, 'grad_norm': 0.10652227699756622, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.5154, 'grad_norm': 0.08867114782333374, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.4831, 'grad_norm': 0.42730674147605896, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.5246, 'grad_norm': 0.08375649154186249, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.4443, 'grad_norm': 0.07965204864740372, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.4767, 'grad_norm': 0.07794076204299927, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.4901, 'grad_norm': 0.0803818553686142, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.4387, 'grad_norm': 0.07839502394199371, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.4704, 'grad_norm': 0.09424098581075668, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.4624, 'grad_norm': 0.0875830352306366, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.459, 'grad_norm': 0.08792450278997421, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.4188, 'grad_norm': 0.08905845880508423, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.4661, 'grad_norm': 0.09200473129749298, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.411, 'grad_norm': 0.09489677846431732, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.4338, 'grad_norm': 0.09510081261396408, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.4681, 'grad_norm': 0.09422515332698822, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.4509, 'grad_norm': 0.10095299780368805, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.4244, 'grad_norm': 0.09444955736398697, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.447, 'grad_norm': 0.11680952459573746, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.4058, 'grad_norm': 0.13077840209007263, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.4022, 'grad_norm': 0.15072228014469147, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.3625, 'grad_norm': 0.2457045316696167, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.3524, 'grad_norm': 0.18531735241413116, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.2773, 'grad_norm': 0.1872507482767105, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.3133, 'grad_norm': 0.3699219822883606, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.2493, 'grad_norm': 0.1910175383090973, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.2909, 'grad_norm': 0.23862224817276, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.1944, 'grad_norm': 0.44030433893203735, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.2285, 'grad_norm': 0.26365411281585693, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.171, 'grad_norm': 0.24637719988822937, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.1418, 'grad_norm': 0.2734069526195526, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.135, 'grad_norm': 0.30898919701576233, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.1381, 'grad_norm': 0.30814236402511597, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.1076, 'grad_norm': 0.19524520635604858, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.1027, 'grad_norm': 0.24776539206504822, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.1092, 'grad_norm': 0.24641643464565277, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0911, 'grad_norm': 0.2524035573005676, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.0853, 'grad_norm': 0.24263818562030792, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0874, 'grad_norm': 0.24261997640132904, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0765, 'grad_norm': 0.201274573802948, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 3739.7049, 'train_samples_per_second': 0.281, 'train_steps_per_second': 0.04, 'train_loss': 0.47568494657675425, 'epoch': 15.0}
[2025-03-06 20:06:17,975][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_few_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '27', 'trained', '0']
Updating job 27 to status trained with exit code 0
Status update completed for job 27
Starting evaluations for job 27
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 20:06:26,501][root][INFO] - Setting global seed to 206
[2025-03-06 20:06:26,507][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:06:26,507][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:06:26,508][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:06:26,510][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:06:26,512][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:06:26,512][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:06:26,659][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:06:26,925][root][INFO] - Full model selected, loading model
[2025-03-06 20:06:38,832][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:07:39,230][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:07:39,230][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:08:05,244][root][INFO] - Peft model loaded successfully
[2025-03-06 20:08:11,566][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:08:11,567][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:08:11,568][root][INFO] - Starting inference
[2025-03-06 20:08:11,804][root][INFO] - Processing question number 0
[2025-03-06 20:08:11,806][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:08:23,581][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:08:36,071][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:08:46,036][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:08:56,383][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:09:06,177][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:09:15,822][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:09:30,003][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:09:44,549][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:09:53,023][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:10:11,990][root][INFO] - Processing question number 10
[2025-03-06 20:10:11,992][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:10:20,385][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:10:39,492][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:10:53,315][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:11:04,733][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:11:18,466][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:11:28,064][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:11:38,790][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:11:49,333][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:12:01,138][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:12:14,048][root][INFO] - Processing question number 20
[2025-03-06 20:12:14,050][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:12:21,699][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:12:27,982][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:12:40,755][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:12:49,961][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:13:01,002][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:13:15,571][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:13:27,932][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:13:34,365][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:13:44,947][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:13:53,106][root][INFO] - Processing question number 30
[2025-03-06 20:13:53,109][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:14:08,394][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:14:22,361][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:14:33,967][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:14:50,457][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:14:58,011][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:15:06,837][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:15:18,882][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:15:29,639][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:15:49,069][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:16:03,853][root][INFO] - Processing question number 40
[2025-03-06 20:16:03,856][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:16:17,569][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:16:37,088][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:16:58,942][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:17:15,521][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:17:26,680][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:17:41,196][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:17:49,166][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:17:59,486][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:18:09,957][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:18:22,710][root][INFO] - Processing question number 50
[2025-03-06 20:18:22,714][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:18:38,202][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:19:00,147][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:19:08,591][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:19:16,754][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:19:39,627][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:19:48,669][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:20:04,174][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:20:19,715][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:20:36,245][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:21:07,617][root][INFO] - Processing question number 60
[2025-03-06 20:21:07,621][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:21:18,524][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:21:27,889][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:21:41,194][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:21:50,085][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:21:57,093][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:22:09,745][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:22:20,162][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:22:30,209][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:22:37,724][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:22:56,543][root][INFO] - Processing question number 70
[2025-03-06 20:22:56,547][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:23:10,119][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:23:22,566][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:23:32,510][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:23:40,427][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:23:57,166][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:24:08,686][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:24:28,385][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:24:45,774][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:24:55,808][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:25:13,325][root][INFO] - Processing question number 80
[2025-03-06 20:25:13,329][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:25:26,672][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:25:42,948][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:25:56,376][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:26:08,773][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:26:17,588][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:26:32,192][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:26:45,694][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:26:57,167][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:27:04,654][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:27:16,604][root][INFO] - Processing question number 90
[2025-03-06 20:27:16,610][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:27:35,107][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:27:42,467][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:27:53,268][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:28:03,724][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:28:21,834][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:28:28,934][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:28:56,978][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:29:09,864][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:29:23,309][root][INFO] - Inference complete
[2025-03-06 20:29:23,309][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,315][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,317][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,317][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,317][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,318][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,318][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,318][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,318][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,318][root][WARNING] - |Q. 91||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,319][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,319][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,319][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,319][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,320][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,320][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,320][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,323][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,323][root][WARNING] - |Q. 62||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,323][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,324][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,325][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:29:23,325][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,325][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:29:23,326][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,326][root][WARNING] - |Q. 59||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,326][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,328][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,328][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,328][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,328][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,329][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,329][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,329][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,329][root][WARNING] - |Q. 15||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,330][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,332][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,337][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,337][root][INFO] - Saved parsed outputs
[2025-03-06 20:29:23,337][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,338][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,338][root][INFO] - Saved parsing metadata
[2025-03-06 20:29:23,339][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,340][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,342][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:29:23,368][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:29:23,368][root][INFO] - Summary of metrics : {'label_accuracy': 0.41414141414141414, 'misclassification_rate': 0.5858585858585859, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 2, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 41, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.5714285714285714, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.18181818181818182, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 3, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 20:29:30,482][root][INFO] - Setting global seed to 206
[2025-03-06 20:29:30,487][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:29:30,487][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:29:30,488][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:29:30,490][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:29:30,493][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:29:30,493][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:29:30,995][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:29:31,297][root][INFO] - Full model selected, loading model
[2025-03-06 20:29:43,210][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:30:44,503][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:30:44,504][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:31:09,981][root][INFO] - Peft model loaded successfully
[2025-03-06 20:31:16,195][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:31:16,197][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:31:16,197][root][INFO] - Starting inference
[2025-03-06 20:31:16,409][root][INFO] - Processing question number 0
[2025-03-06 20:31:16,411][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:31:26,222][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:31:43,421][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:31:54,867][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:32:05,823][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:32:27,760][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:32:36,768][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:32:52,483][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:33:22,543][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:33:31,023][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:33:43,580][root][INFO] - Processing question number 10
[2025-03-06 20:33:43,582][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:33:55,568][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:34:04,276][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:34:22,476][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:34:37,294][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:34:47,303][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:34:56,556][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:35:06,760][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:35:16,347][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:35:38,503][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:35:52,764][root][INFO] - Processing question number 20
[2025-03-06 20:35:52,767][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:35:59,429][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:36:05,137][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:36:18,675][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:36:28,370][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:36:39,184][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:36:53,855][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:37:17,388][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:37:24,096][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:37:32,575][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:37:39,961][root][INFO] - Processing question number 30
[2025-03-06 20:37:39,963][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:38:10,208][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:38:25,338][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:38:54,441][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:39:08,349][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:39:18,592][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:39:26,750][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:39:38,066][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:39:51,304][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:40:09,324][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:40:24,247][root][INFO] - Processing question number 40
[2025-03-06 20:40:24,250][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:40:36,849][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:40:50,027][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:41:05,767][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:41:17,693][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:41:26,383][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:41:32,702][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:41:41,069][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:41:49,891][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:41:59,609][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:42:16,355][root][INFO] - Processing question number 50
[2025-03-06 20:42:16,359][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:42:28,302][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:42:45,669][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:42:56,413][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:43:04,638][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:43:25,357][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:43:33,717][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:43:48,939][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:44:00,400][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:44:08,398][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:44:29,407][root][INFO] - Processing question number 60
[2025-03-06 20:44:29,410][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:44:43,285][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:44:57,689][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:45:11,329][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:45:29,088][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:45:44,556][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:45:55,945][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:46:18,423][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:46:33,442][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:46:42,287][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:46:57,486][root][INFO] - Processing question number 70
[2025-03-06 20:46:57,490][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:47:14,098][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:47:24,150][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:47:38,073][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:47:46,746][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:47:57,898][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:48:13,891][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:48:32,439][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:48:44,232][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:49:02,293][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:49:19,199][root][INFO] - Processing question number 80
[2025-03-06 20:49:19,204][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:49:29,238][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:49:38,312][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:49:47,477][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:50:01,382][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:50:07,423][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:50:18,605][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:50:27,921][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:50:42,471][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:50:55,899][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:51:09,096][root][INFO] - Processing question number 90
[2025-03-06 20:51:09,102][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:51:23,736][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:51:35,570][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:51:47,148][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:51:55,845][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:52:17,435][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:52:26,429][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:52:37,925][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:52:57,754][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:53:11,862][root][INFO] - Inference complete
[2025-03-06 20:53:11,862][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,868][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,870][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,871][root][WARNING] - |Q. 49||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:53:11,871][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,871][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:53:11,873][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,873][root][WARNING] - |Q. 17||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,873][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,874][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,875][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:53:11,875][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,875][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:53:11,875][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,875][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,875][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,876][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,876][root][WARNING] - |Q. 22||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,876][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,876][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,877][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,877][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,877][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,877][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,877][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,879][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,879][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,879][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,880][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,881][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,881][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,882][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,882][root][WARNING] - |Q. 6||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,882][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,883][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,883][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,883][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,883][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,883][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,883][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,885][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,885][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,885][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,887][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,892][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,892][root][INFO] - Saved parsed outputs
[2025-03-06 20:53:11,892][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,893][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,893][root][INFO] - Saved parsing metadata
[2025-03-06 20:53:11,894][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,895][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,897][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:53:11,933][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:53:11,933][root][INFO] - Summary of metrics : {'label_accuracy': 0.3838383838383838, 'misclassification_rate': 0.6161616161616161, 'combined_accuracy': 0.35353535353535354, 'malformed_label': 3, 'malformed_domain': 13, 'total_predictions': 99, 'correct_predictions': 38, 'correct_label_and_domain': 35, 'Constitutional_Law_accuracy': 0.0, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1717171717171717, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 51, 'correct_label_wrong_domain': 3, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 20:53:18,829][root][INFO] - Setting global seed to 206
[2025-03-06 20:53:18,834][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:53:18,834][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:53:18,835][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:53:18,837][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:53:18,840][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:53:18,840][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:53:19,062][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:53:19,354][root][INFO] - Full model selected, loading model
[2025-03-06 20:53:31,039][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:54:31,592][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:54:31,592][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:54:56,917][root][INFO] - Peft model loaded successfully
[2025-03-06 20:55:03,236][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:55:03,238][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:55:03,238][root][INFO] - Starting inference
[2025-03-06 20:55:03,433][root][INFO] - Processing question number 0
[2025-03-06 20:55:03,435][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:55:08,644][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:55:21,468][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:55:34,184][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:55:43,929][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:55:55,171][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:56:01,700][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:56:16,543][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:56:41,279][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:56:52,463][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:57:19,046][root][INFO] - Processing question number 10
[2025-03-06 20:57:19,048][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:57:27,781][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:57:36,534][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:57:49,110][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:58:09,505][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:58:21,617][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:58:33,143][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:58:43,925][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:58:54,244][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:59:01,777][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:59:12,860][root][INFO] - Processing question number 20
[2025-03-06 20:59:12,863][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:59:25,516][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:59:37,165][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:59:45,050][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:59:53,571][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:00:08,345][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:00:28,845][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:00:37,982][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:00:55,338][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:01:06,719][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:01:12,816][root][INFO] - Processing question number 30
[2025-03-06 21:01:12,818][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:01:43,057][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:01:56,074][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:02:26,117][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:02:41,957][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:02:51,768][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:03:09,685][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:03:20,464][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:03:31,340][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:03:45,696][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:03:58,201][root][INFO] - Processing question number 40
[2025-03-06 21:03:58,204][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:04:11,090][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:04:21,908][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:04:34,537][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:04:52,980][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:05:04,854][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:05:13,734][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:05:24,045][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:05:33,174][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:05:46,775][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:05:57,561][root][INFO] - Processing question number 50
[2025-03-06 21:05:57,564][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:06:15,060][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:06:28,804][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:06:34,009][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:06:59,198][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:07:23,625][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:07:33,368][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:07:49,016][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:08:04,221][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:08:16,106][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:08:32,828][root][INFO] - Processing question number 60
[2025-03-06 21:08:32,832][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:08:55,680][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:09:10,473][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:09:24,407][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:09:33,417][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:09:45,431][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:10:03,810][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:10:16,594][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:10:35,431][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:10:47,661][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:10:59,338][root][INFO] - Processing question number 70
[2025-03-06 21:10:59,342][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:11:07,815][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:11:13,100][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:11:24,995][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:11:38,421][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:11:51,050][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:12:02,325][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:12:16,715][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:12:30,780][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:12:45,024][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:12:54,950][root][INFO] - Processing question number 80
[2025-03-06 21:12:54,955][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:13:02,563][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:13:12,329][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:13:21,379][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:13:33,213][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:13:44,304][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:13:55,301][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:14:06,748][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:14:18,168][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:14:24,346][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:14:38,878][root][INFO] - Processing question number 90
[2025-03-06 21:14:38,883][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:14:50,274][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:15:00,413][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:15:12,700][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:15:17,852][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:15:27,241][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:15:33,797][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:15:51,926][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:16:11,564][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:16:22,100][root][INFO] - Inference complete
[2025-03-06 21:16:22,100][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,106][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,108][root][WARNING] - |Q. 28||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,108][root][WARNING] - |Q. 28||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,109][root][INFO] - |Q. 28||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,109][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,109][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,109][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,110][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,110][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,110][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,111][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,111][root][WARNING] - |Q. 2||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,111][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,111][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,112][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,112][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,113][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,113][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:16:22,114][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,114][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:16:22,114][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,114][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,114][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,115][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,115][root][WARNING] - |Q. 16||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:16:22,115][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,115][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:16:22,116][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,116][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,116][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,117][root][WARNING] - |Q. 94||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,117][root][WARNING] - |Q. 94||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,117][root][INFO] - |Q. 94||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,118][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,118][root][WARNING] - |Q. 47||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,118][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,119][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,119][root][WARNING] - |Q. 82||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,119][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,119][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,119][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,119][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,122][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,122][root][WARNING] - |Q. 39||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,122][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,123][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,123][root][WARNING] - |Q. 97||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,123][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,124][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,124][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,124][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,125][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,125][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,125][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,125][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,126][root][WARNING] - |Q. 85||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,126][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,127][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,132][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,132][root][INFO] - Saved parsed outputs
[2025-03-06 21:16:22,132][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,134][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,134][root][INFO] - Saved parsing metadata
[2025-03-06 21:16:22,134][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,137][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,138][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:16:22,178][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:16:22,178][root][INFO] - Summary of metrics : {'label_accuracy': 0.3333333333333333, 'misclassification_rate': 0.6666666666666667, 'combined_accuracy': 0.2828282828282828, 'malformed_label': 5, 'malformed_domain': 13, 'total_predictions': 99, 'correct_predictions': 33, 'correct_label_and_domain': 28, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1717171717171717, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 5, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 21:16:35,109][root][INFO] - Setting global seed to 989
[2025-03-06 21:16:35,118][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:16:35,118][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:16:35,119][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:16:35,121][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:16:35,136][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:16:35,136][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:16:35,298][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:16:35,582][root][INFO] - Full model selected, loading model
[2025-03-06 21:16:54,370][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:18:04,323][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:18:04,323][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:18:30,752][root][INFO] - Peft model loaded successfully
[2025-03-06 21:18:36,940][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:18:36,942][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:18:36,942][root][INFO] - Starting inference
[2025-03-06 21:18:37,145][root][INFO] - Processing question number 0
[2025-03-06 21:18:37,147][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:18:49,118][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:19:01,690][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:19:11,716][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:19:22,139][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:19:31,960][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:19:41,623][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:19:55,877][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:20:10,524][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:20:19,043][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:20:37,984][root][INFO] - Processing question number 10
[2025-03-06 21:20:37,986][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:20:46,376][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:21:05,456][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:21:19,205][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:21:30,530][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:21:44,072][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:21:53,611][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:22:04,244][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:22:14,701][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:22:26,434][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:22:39,297][root][INFO] - Processing question number 20
[2025-03-06 21:22:39,300][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:22:46,886][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:22:53,118][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:23:05,787][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:23:14,937][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:23:25,947][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:23:40,405][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:23:52,666][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:23:59,050][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:24:09,581][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:24:17,734][root][INFO] - Processing question number 30
[2025-03-06 21:24:17,737][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:24:33,013][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:24:46,959][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:24:58,541][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:25:14,999][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:25:22,574][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:25:31,460][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:25:43,569][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:25:54,320][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:26:13,732][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:26:28,494][root][INFO] - Processing question number 40
[2025-03-06 21:26:28,498][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:26:42,195][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:27:01,691][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:27:23,520][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:27:40,087][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:27:51,248][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:28:05,752][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:28:13,717][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:28:24,035][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:28:34,493][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:28:47,235][root][INFO] - Processing question number 50
[2025-03-06 21:28:47,239][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:29:02,716][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:29:24,650][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:29:33,093][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:29:41,254][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:30:04,112][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:30:13,148][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:30:28,655][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:30:44,191][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:31:00,707][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:31:31,913][root][INFO] - Processing question number 60
[2025-03-06 21:31:31,917][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:31:42,811][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:31:52,171][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:32:05,465][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:32:14,354][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:32:21,363][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:32:34,007][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:32:44,420][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:32:54,460][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:33:01,972][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:33:20,780][root][INFO] - Processing question number 70
[2025-03-06 21:33:20,784][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:33:34,341][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:33:46,777][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:33:56,709][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:34:04,596][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:34:21,278][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:34:32,760][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:34:52,400][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:35:09,729][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:35:19,743][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:35:37,251][root][INFO] - Processing question number 80
[2025-03-06 21:35:37,256][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:35:50,571][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:36:06,787][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:36:20,178][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:36:32,548][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:36:41,346][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:36:55,910][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:37:09,375][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:37:20,815][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:37:28,294][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:37:40,211][root][INFO] - Processing question number 90
[2025-03-06 21:37:40,217][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:37:58,672][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:38:06,009][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:38:16,787][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:38:27,218][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:38:45,286][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:38:52,370][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:39:20,351][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:39:33,225][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:39:46,694][root][INFO] - Inference complete
[2025-03-06 21:39:46,694][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,708][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,710][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,710][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,710][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,711][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,711][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,711][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,711][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,712][root][WARNING] - |Q. 91||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,712][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,712][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,713][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,713][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,713][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,713][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,713][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,716][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,717][root][WARNING] - |Q. 62||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,717][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,718][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,718][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:39:46,719][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,719][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:39:46,719][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,720][root][WARNING] - |Q. 59||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,720][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,721][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,721][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,721][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,722][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,722][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,722][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,723][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,723][root][WARNING] - |Q. 15||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,723][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,725][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,730][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,730][root][INFO] - Saved parsed outputs
[2025-03-06 21:39:46,730][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,732][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,732][root][INFO] - Saved parsing metadata
[2025-03-06 21:39:46,733][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,734][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,736][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:39:46,742][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:39:46,742][root][INFO] - Summary of metrics : {'label_accuracy': 0.41414141414141414, 'misclassification_rate': 0.5858585858585859, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 2, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 41, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.5714285714285714, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.18181818181818182, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 3, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 21:39:53,500][root][INFO] - Setting global seed to 989
[2025-03-06 21:39:53,506][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:39:53,506][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:39:53,508][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:39:53,509][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:39:53,511][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:39:53,511][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:39:53,664][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:39:54,044][root][INFO] - Full model selected, loading model
[2025-03-06 21:40:13,071][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:41:14,561][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:41:14,561][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:41:41,316][root][INFO] - Peft model loaded successfully
[2025-03-06 21:41:47,535][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:41:47,537][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:41:47,537][root][INFO] - Starting inference
[2025-03-06 21:41:47,790][root][INFO] - Processing question number 0
[2025-03-06 21:41:47,792][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:41:53,510][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:42:10,463][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:42:18,984][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:42:30,077][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:42:38,586][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:42:48,188][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:43:00,438][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:43:11,461][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:43:20,632][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:43:35,842][root][INFO] - Processing question number 10
[2025-03-06 21:43:35,844][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:43:49,527][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:43:59,858][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:44:08,821][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:44:32,719][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:44:48,516][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:44:59,047][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:45:09,751][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:45:19,793][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:45:25,701][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:45:37,353][root][INFO] - Processing question number 20
[2025-03-06 21:45:37,355][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:45:49,964][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:45:55,621][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:46:05,591][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:46:15,453][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:46:26,247][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:46:36,957][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:46:47,291][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:46:58,323][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:47:17,672][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:47:25,046][root][INFO] - Processing question number 30
[2025-03-06 21:47:25,049][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:47:37,257][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:47:54,259][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:48:24,300][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:48:54,107][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:49:01,755][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:49:11,636][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:49:22,790][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:49:44,868][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:49:57,529][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:50:11,448][root][INFO] - Processing question number 40
[2025-03-06 21:50:11,451][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:50:26,592][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:50:41,636][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:50:56,458][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:51:06,774][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:51:13,261][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:51:20,733][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:51:32,530][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:51:41,844][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:51:58,522][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:52:12,629][root][INFO] - Processing question number 50
[2025-03-06 21:52:12,633][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:52:34,749][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:52:49,297][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:52:56,719][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:53:09,200][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:53:21,274][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:53:35,979][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:53:52,476][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:54:03,959][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:54:14,014][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:54:30,504][root][INFO] - Processing question number 60
[2025-03-06 21:54:30,508][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:54:39,923][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:54:50,286][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:55:07,504][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:55:21,199][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:55:29,185][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:55:42,675][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:56:12,740][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:56:25,779][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:56:33,381][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:56:49,506][root][INFO] - Processing question number 70
[2025-03-06 21:56:49,510][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:56:59,574][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:57:13,001][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:57:22,290][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:57:32,713][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:57:47,621][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:58:00,886][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:58:21,762][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:58:33,827][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:58:44,368][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:58:55,046][root][INFO] - Processing question number 80
[2025-03-06 21:58:55,050][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:59:06,354][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:59:18,139][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:59:28,420][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:59:41,043][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:59:50,134][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:00:01,187][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:00:08,712][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:00:16,274][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:00:22,005][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:00:30,107][root][INFO] - Processing question number 90
[2025-03-06 22:00:30,112][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:00:51,877][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:01:06,078][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:01:15,687][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:01:20,946][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:01:27,755][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:01:34,420][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:01:42,317][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:02:12,478][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:02:25,176][root][INFO] - Inference complete
[2025-03-06 22:02:25,177][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:02:25,182][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:02:25,185][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,186][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:02:25,186][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,186][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,186][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:02:25,186][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,188][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,188][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:02:25,188][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,188][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,188][root][WARNING] - |Q. 22||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:02:25,189][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,189][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:02:25,189][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,190][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:02:25,190][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,190][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,190][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:02:25,190][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,191][root][WARNING] - |Q. 88||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,191][root][WARNING] - |Q. 88||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:02:25,191][root][INFO] - |Q. 88||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,192][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,192][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:02:25,193][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,194][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,194][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:02:25,194][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,194][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,195][root][WARNING] - |Q. 59||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:02:25,195][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,195][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:02:25,196][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,196][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:02:25,196][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,198][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:02:25,198][root][WARNING] - |Q. 85||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:02:25,198][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:02:25,199][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:02:25,200][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:02:25,205][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:02:25,205][root][INFO] - Saved parsed outputs
[2025-03-06 22:02:25,205][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:02:25,206][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:02:25,206][root][INFO] - Saved parsing metadata
[2025-03-06 22:02:25,207][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:02:25,208][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:02:25,209][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:02:25,217][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 22:02:25,217][root][INFO] - Summary of metrics : {'label_accuracy': 0.3333333333333333, 'misclassification_rate': 0.6666666666666667, 'combined_accuracy': 0.31313131313131315, 'malformed_label': 3, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 33, 'correct_label_and_domain': 31, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1717171717171717, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 57, 'correct_label_wrong_domain': 2, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 22:02:33,668][root][INFO] - Setting global seed to 989
[2025-03-06 22:02:33,676][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:02:33,677][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:02:33,678][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:02:33,680][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:02:33,687][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:02:33,688][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:02:33,843][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:02:34,132][root][INFO] - Full model selected, loading model
[2025-03-06 22:02:51,232][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:03:52,817][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:03:52,818][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:04:19,158][root][INFO] - Peft model loaded successfully
[2025-03-06 22:04:25,433][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:04:25,435][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:04:25,435][root][INFO] - Starting inference
[2025-03-06 22:04:25,634][root][INFO] - Processing question number 0
[2025-03-06 22:04:25,636][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:04:34,917][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:05:00,908][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:05:20,105][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:05:33,601][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:05:48,655][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:05:54,617][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:06:07,848][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:06:16,399][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:06:29,254][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:06:40,384][root][INFO] - Processing question number 10
[2025-03-06 22:06:40,386][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:06:54,828][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:07:03,665][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:07:15,392][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:07:37,714][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:07:47,137][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:07:55,523][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:08:05,383][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:08:12,557][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:08:19,821][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:08:33,576][root][INFO] - Processing question number 20
[2025-03-06 22:08:33,578][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:08:41,585][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:08:49,964][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:09:05,392][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:09:11,456][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:09:23,503][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:09:40,287][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:09:52,368][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:09:59,675][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:10:10,775][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:10:17,273][root][INFO] - Processing question number 30
[2025-03-06 22:10:17,275][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:10:31,125][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:10:43,795][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:10:55,075][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:11:10,219][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:11:20,230][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:11:32,015][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:11:44,965][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:12:01,367][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:12:18,981][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:12:30,152][root][INFO] - Processing question number 40
[2025-03-06 22:12:30,155][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:12:41,494][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:13:02,598][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:13:18,610][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:13:42,113][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:13:55,782][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:14:02,226][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:14:17,329][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:14:25,954][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:14:39,541][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:14:54,041][root][INFO] - Processing question number 50
[2025-03-06 22:14:54,044][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:15:05,280][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:15:20,956][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:15:35,321][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:15:53,060][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:16:21,616][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:16:40,005][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:16:57,856][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:17:09,345][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:17:17,914][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:17:38,132][root][INFO] - Processing question number 60
[2025-03-06 22:17:38,135][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:17:50,420][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:18:04,272][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:18:21,791][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:18:31,294][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:18:45,005][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:18:51,595][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:19:02,600][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:19:17,502][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:19:32,063][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:19:47,442][root][INFO] - Processing question number 70
[2025-03-06 22:19:47,446][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:19:57,372][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:20:18,717][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:20:31,180][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:20:47,148][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:21:00,158][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:21:12,089][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:21:23,262][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:21:31,115][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:21:50,992][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:22:04,496][root][INFO] - Processing question number 80
[2025-03-06 22:22:04,500][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:22:18,083][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:22:31,996][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:22:40,121][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:22:54,863][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:23:09,159][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:23:22,437][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:23:48,668][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:23:58,666][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:24:05,147][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:24:13,811][root][INFO] - Processing question number 90
[2025-03-06 22:24:13,816][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:24:24,084][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:24:41,947][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:24:50,852][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:24:58,205][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:25:06,454][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:25:15,708][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:25:45,146][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:26:09,456][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:26:22,531][root][INFO] - Inference complete
[2025-03-06 22:26:22,531][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:26:22,538][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:26:22,539][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,540][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,540][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,540][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,540][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,540][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,541][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,541][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,541][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,542][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,542][root][WARNING] - |Q. 2||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,542][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,542][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,542][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,543][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,543][root][WARNING] - |Q. 37||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,543][root][WARNING] - |Q. 37||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,543][root][INFO] - |Q. 37||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,545][root][WARNING] - |Q. 88||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,546][root][WARNING] - |Q. 88||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,546][root][INFO] - |Q. 88||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,546][root][WARNING] - |Q. 94||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,546][root][WARNING] - |Q. 94||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,546][root][INFO] - |Q. 94||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,548][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,548][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,548][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,548][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,548][root][WARNING] - |Q. 95||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,548][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,550][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,550][root][WARNING] - |Q. 78||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,550][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,550][root][WARNING] - |Q. 86||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,551][root][WARNING] - |Q. 86||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,551][root][INFO] - |Q. 86||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,551][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,551][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,552][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,552][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,552][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,552][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,553][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,553][root][WARNING] - |Q. 97||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,553][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,553][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,554][root][WARNING] - |Q. 100||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,554][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,555][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:26:22,555][root][WARNING] - |Q. 85||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:26:22,555][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:26:22,556][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:26:22,562][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:26:22,562][root][INFO] - Saved parsed outputs
[2025-03-06 22:26:22,562][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:26:22,563][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:26:22,563][root][INFO] - Saved parsing metadata
[2025-03-06 22:26:22,564][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:26:22,566][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:26:22,567][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:26:22,608][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 22:26:22,608][root][INFO] - Summary of metrics : {'label_accuracy': 0.37373737373737376, 'misclassification_rate': 0.6262626262626263, 'combined_accuracy': 0.35353535353535354, 'malformed_label': 1, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 37, 'correct_label_and_domain': 35, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.5, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.1717171717171717, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 53, 'correct_label_wrong_domain': 2, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 22:26:30,953][root][INFO] - Setting global seed to 206
[2025-03-06 22:26:30,961][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:26:30,961][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:26:30,962][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:26:30,964][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:26:30,967][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:26:30,967][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:26:31,118][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:26:31,495][root][INFO] - Full model selected, loading model
[2025-03-06 22:26:48,046][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:27:49,779][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:27:49,779][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:28:16,452][root][INFO] - Peft model loaded successfully
[2025-03-06 22:28:22,726][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:28:22,729][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:28:22,729][root][INFO] - Starting inference
[2025-03-06 22:28:22,920][root][INFO] - Processing question number 0
[2025-03-06 22:28:22,923][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:28:34,609][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:29:05,145][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:29:14,474][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:29:28,040][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:29:45,784][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:29:52,841][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:30:13,152][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:30:25,795][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:30:32,123][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:30:40,706][root][INFO] - Processing question number 10
[2025-03-06 22:30:40,709][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:30:52,243][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:31:00,083][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:31:13,246][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:31:23,817][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:31:37,994][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:31:48,594][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:31:56,679][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:32:08,024][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:32:28,365][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:32:43,719][root][INFO] - Processing question number 20
[2025-03-06 22:32:43,723][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:32:52,949][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:33:06,359][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:33:14,887][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:33:22,011][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:33:33,430][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:33:43,977][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:34:05,574][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:34:28,790][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:34:44,067][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:35:00,873][root][INFO] - Processing question number 30
[2025-03-06 22:35:00,877][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:35:12,766][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:35:22,466][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:35:36,190][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:35:47,156][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:36:16,914][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:36:27,367][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:36:44,893][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:36:56,032][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:37:10,226][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:37:35,593][root][INFO] - Processing question number 40
[2025-03-06 22:37:35,596][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:37:46,609][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:37:55,769][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:38:04,406][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:38:10,571][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:38:24,850][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:38:34,203][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:38:53,096][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:39:02,734][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:39:17,643][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:39:33,812][root][INFO] - Processing question number 50
[2025-03-06 22:39:33,815][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:39:45,546][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:39:57,323][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:40:14,164][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:40:25,995][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:40:39,505][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:40:59,128][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:41:13,994][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:41:30,172][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 22:41:55,810][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 22:42:05,461][root][INFO] - Processing question number 60
[2025-03-06 22:42:05,465][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 22:42:18,766][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 22:42:27,082][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 22:42:39,471][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 22:42:50,577][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 22:43:01,841][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 22:43:17,902][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 22:43:25,810][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 22:43:34,572][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:43:59,842][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:44:07,446][root][INFO] - Processing question number 70
[2025-03-06 22:44:07,450][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:44:16,703][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:44:30,469][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:44:45,690][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:44:56,072][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:45:11,938][root][INFO] - Domain : Property, Question : 36
[2025-03-06 22:45:27,198][root][INFO] - Domain : Property, Question : 46
[2025-03-06 22:45:51,494][root][INFO] - Domain : Property, Question : 53
[2025-03-06 22:46:06,604][root][INFO] - Domain : Property, Question : 59
[2025-03-06 22:46:16,265][root][INFO] - Domain : Property, Question : 66
[2025-03-06 22:46:45,856][root][INFO] - Processing question number 80
[2025-03-06 22:46:45,861][root][INFO] - Domain : Property, Question : 69
[2025-03-06 22:46:57,726][root][INFO] - Domain : Property, Question : 81
[2025-03-06 22:47:04,706][root][INFO] - Domain : Property, Question : 88
[2025-03-06 22:47:24,365][root][INFO] - Domain : Property, Question : 91
[2025-03-06 22:47:37,954][root][INFO] - Domain : Property, Question : 94
[2025-03-06 22:47:51,562][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:48:02,277][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:48:22,000][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 22:48:39,120][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 22:48:52,605][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:49:06,912][root][INFO] - Processing question number 90
[2025-03-06 22:49:06,917][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 22:49:14,635][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 22:49:27,299][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:49:35,580][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 22:49:53,864][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 22:50:09,130][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 22:50:21,795][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 22:50:31,073][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 22:50:46,241][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 22:50:56,732][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:51:05,892][root][INFO] - Inference complete
[2025-03-06 22:51:05,893][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:51:05,900][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:51:05,901][root][WARNING] - |Q. 6||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,902][root][WARNING] - |Q. 6||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:51:05,902][root][INFO] - |Q. 6||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,902][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:51:05,903][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,903][root][WARNING] - |Q. 20||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,903][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,903][root][WARNING] - |Q. 41||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,904][root][WARNING] - |Q. 41||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,904][root][INFO] - |Q. 41||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,904][root][WARNING] - |Q. 70||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,904][root][WARNING] - |Q. 70||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,904][root][INFO] - |Q. 70||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,906][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,907][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,907][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,907][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,907][root][WARNING] - |Q. 7||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,907][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,908][root][WARNING] - |Q. 28||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,908][root][WARNING] - |Q. 28||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,908][root][INFO] - |Q. 28||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,908][root][WARNING] - |Q. 42||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,908][root][WARNING] - |Q. 42||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:51:05,909][root][INFO] - |Q. 42||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,909][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:51:05,909][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,909][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,909][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,910][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,910][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,910][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,911][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,911][root][WARNING] - |Q. 31||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,911][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,911][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,912][root][WARNING] - |Q. 38||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,912][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,912][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,913][root][WARNING] - |Q. 85||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,913][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,913][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,914][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,914][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,914][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,914][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,914][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,915][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,915][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,915][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,916][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,916][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,916][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,916][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,916][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,917][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,917][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,917][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,917][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,918][root][WARNING] - |Q. 66||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,918][root][WARNING] - |Q. 66||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:51:05,918][root][INFO] - |Q. 66||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,918][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:51:05,918][root][WARNING] - |Q. 88||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,919][root][WARNING] - |Q. 88||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,919][root][INFO] - |Q. 88||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,919][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:51:05,919][root][WARNING] - |Q. 100||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:51:05,919][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:51:05,922][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:51:05,927][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:51:05,927][root][INFO] - Saved parsed outputs
[2025-03-06 22:51:05,928][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:51:05,929][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:51:05,929][root][INFO] - Saved parsing metadata
[2025-03-06 22:51:05,930][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:51:05,931][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:51:05,933][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 22:51:05,981][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 22:51:05,981][root][INFO] - Summary of metrics : {'label_accuracy': 0.32, 'misclassification_rate': 0.6799999999999999, 'combined_accuracy': 0.27, 'malformed_label': 4, 'malformed_domain': 15, 'total_predictions': 100, 'correct_predictions': 32, 'correct_label_and_domain': 27, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.2, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 5, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 22:51:15,667][root][INFO] - Setting global seed to 206
[2025-03-06 22:51:15,677][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:51:15,677][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:51:15,678][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:51:15,679][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:51:15,682][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:51:15,682][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:51:15,933][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:51:16,339][root][INFO] - Full model selected, loading model
[2025-03-06 22:51:34,745][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:52:35,444][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:52:35,445][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:53:00,715][root][INFO] - Peft model loaded successfully
[2025-03-06 22:53:06,944][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:53:06,946][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:53:06,946][root][INFO] - Starting inference
[2025-03-06 22:53:07,124][root][INFO] - Processing question number 0
[2025-03-06 22:53:07,126][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:53:16,784][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:53:41,777][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:54:12,650][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:54:25,732][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:54:38,301][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:54:52,281][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:55:09,658][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:55:28,647][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:55:39,641][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:55:48,165][root][INFO] - Processing question number 10
[2025-03-06 22:55:48,167][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:55:56,790][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:56:06,969][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:56:27,270][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:56:35,289][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:56:49,913][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:56:58,680][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:57:06,773][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:57:18,082][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:57:48,288][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:57:59,972][root][INFO] - Processing question number 20
[2025-03-06 22:57:59,975][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:58:20,263][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:58:30,298][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:58:47,726][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:59:07,551][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:59:21,329][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:59:31,411][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:00:01,244][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:00:14,633][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:00:23,855][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:00:42,858][root][INFO] - Processing question number 30
[2025-03-06 23:00:42,860][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:00:59,536][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:01:08,730][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:01:17,349][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:01:32,277][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:01:55,582][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:02:04,770][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:02:25,706][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:02:46,904][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:02:54,808][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:03:06,716][root][INFO] - Processing question number 40
[2025-03-06 23:03:06,719][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:03:18,996][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:03:30,719][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:03:42,584][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:03:48,711][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:04:06,004][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:04:21,174][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:04:31,863][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:04:40,987][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:04:52,223][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:05:04,833][root][INFO] - Processing question number 50
[2025-03-06 23:05:04,837][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:05:15,943][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:05:25,764][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:05:38,575][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:05:51,822][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:06:11,072][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:06:19,853][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:06:29,405][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:06:37,644][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:06:54,440][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:07:06,602][root][INFO] - Processing question number 60
[2025-03-06 23:07:06,607][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:07:18,335][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:07:28,274][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:07:46,427][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:07:58,657][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:08:07,779][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:08:20,846][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:08:29,882][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:08:37,582][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:09:07,295][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:09:14,811][root][INFO] - Processing question number 70
[2025-03-06 23:09:14,815][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:09:22,177][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:09:36,027][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:09:46,551][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:10:05,245][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:10:20,786][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:10:30,847][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:10:40,317][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:11:10,665][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:11:25,742][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:11:33,377][root][INFO] - Processing question number 80
[2025-03-06 23:11:33,382][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:11:44,615][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:11:53,247][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:12:04,096][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:12:15,908][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:12:26,731][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:12:39,551][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:12:56,316][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:13:07,181][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:13:25,737][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:13:45,931][root][INFO] - Processing question number 90
[2025-03-06 23:13:45,936][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:14:08,411][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:14:25,704][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:14:35,564][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:14:54,903][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:15:09,634][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:15:34,351][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:15:44,219][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:15:51,097][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:15:58,945][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:16:06,243][root][INFO] - Inference complete
[2025-03-06 23:16:06,243][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:06,251][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:06,252][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,253][root][WARNING] - |Q. 13||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:16:06,253][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,253][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:16:06,253][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,253][root][WARNING] - |Q. 20||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,254][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,254][root][WARNING] - |Q. 41||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,254][root][WARNING] - |Q. 41||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,254][root][INFO] - |Q. 41||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,255][root][WARNING] - |Q. 70||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,255][root][WARNING] - |Q. 70||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,255][root][INFO] - |Q. 70||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,256][root][WARNING] - |Q. 29||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,256][root][WARNING] - |Q. 29||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:16:06,256][root][INFO] - |Q. 29||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,257][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:16:06,257][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,257][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,258][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,258][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,258][root][WARNING] - |Q. 89||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:16:06,258][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,258][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:16:06,258][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,259][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,259][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,259][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,259][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,259][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,259][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,260][root][WARNING] - |Q. 7||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,260][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,260][root][WARNING] - |Q. 48||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,260][root][WARNING] - |Q. 48||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,261][root][INFO] - |Q. 48||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,261][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,261][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,261][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,261][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,262][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,262][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,263][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,263][root][WARNING] - |Q. 38||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,263][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,264][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,264][root][WARNING] - |Q. 85||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,264][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,265][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,265][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,265][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,266][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,266][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,266][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,266][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,267][root][WARNING] - |Q. 75||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:16:06,267][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,267][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:16:06,267][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,268][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,268][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,268][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,268][root][WARNING] - |Q. 53||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:16:06,269][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,269][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:16:06,270][root][WARNING] - |Q. 63||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:06,271][root][WARNING] - |Q. 63||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:06,271][root][INFO] - |Q. 63||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:06,272][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:06,277][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:06,277][root][INFO] - Saved parsed outputs
[2025-03-06 23:16:06,277][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:06,279][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:06,279][root][INFO] - Saved parsing metadata
[2025-03-06 23:16:06,279][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:06,281][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:06,288][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:16:06,307][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 23:16:06,307][root][INFO] - Summary of metrics : {'label_accuracy': 0.26, 'misclassification_rate': 0.74, 'combined_accuracy': 0.22, 'malformed_label': 5, 'malformed_domain': 15, 'total_predictions': 100, 'correct_predictions': 26, 'correct_label_and_domain': 22, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.19, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.1, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.15, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 63, 'correct_label_wrong_domain': 4, 'both_wrong': 11}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 23:16:16,637][root][INFO] - Setting global seed to 206
[2025-03-06 23:16:16,645][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:16:16,645][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:16:16,646][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:16:16,647][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:16:16,649][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:16:16,649][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:16:16,816][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:16:17,098][root][INFO] - Full model selected, loading model
[2025-03-06 23:16:34,555][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:17:35,127][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:17:35,128][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:18:01,288][root][INFO] - Peft model loaded successfully
[2025-03-06 23:18:07,491][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:18:07,493][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:18:07,493][root][INFO] - Starting inference
[2025-03-06 23:18:07,697][root][INFO] - Processing question number 0
[2025-03-06 23:18:07,699][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:18:19,470][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:18:28,746][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:18:38,020][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:19:01,556][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:19:15,955][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:19:24,707][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:19:42,033][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:20:04,472][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:20:11,889][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:20:26,920][root][INFO] - Processing question number 10
[2025-03-06 23:20:26,922][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:20:33,218][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:20:38,776][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:20:51,141][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:21:04,882][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:21:23,788][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:21:33,402][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:21:39,723][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:21:56,073][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:22:07,522][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:22:25,128][root][INFO] - Processing question number 20
[2025-03-06 23:22:25,131][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:22:35,352][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:22:48,220][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:23:01,630][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:23:12,675][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:23:32,990][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:23:56,666][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:24:12,656][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:24:27,309][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:24:36,260][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:24:49,543][root][INFO] - Processing question number 30
[2025-03-06 23:24:49,546][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:24:58,498][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:25:09,002][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:25:21,732][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:25:33,719][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:25:52,155][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:26:05,817][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:26:16,211][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:26:33,130][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:26:44,007][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:26:57,870][root][INFO] - Processing question number 40
[2025-03-06 23:26:57,873][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:27:10,692][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:27:19,868][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:27:27,666][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:27:32,433][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:27:50,748][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:28:03,323][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:28:13,263][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:28:29,385][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:28:43,701][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:28:55,364][root][INFO] - Processing question number 50
[2025-03-06 23:28:55,368][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:29:14,475][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:29:23,050][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:29:36,710][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:29:48,961][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:30:03,785][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:30:16,034][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:30:35,837][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:30:44,041][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:31:06,564][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:31:18,924][root][INFO] - Processing question number 60
[2025-03-06 23:31:18,928][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:31:42,259][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:31:51,926][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:32:01,276][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:32:09,539][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:32:20,448][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:32:34,238][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:32:44,192][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:32:56,418][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:33:09,845][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:33:21,860][root][INFO] - Processing question number 70
[2025-03-06 23:33:21,866][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:33:31,246][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:33:41,839][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:33:52,817][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:34:04,435][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:34:24,988][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:34:31,944][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:34:57,743][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:35:15,894][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:35:27,683][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:35:34,661][root][INFO] - Processing question number 80
[2025-03-06 23:35:34,665][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:35:46,313][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:35:53,073][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:36:05,338][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:36:17,359][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:36:26,509][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:36:35,392][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:36:56,566][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:37:10,864][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:37:24,320][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:37:42,176][root][INFO] - Processing question number 90
[2025-03-06 23:37:42,181][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:37:54,208][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:38:06,113][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:38:11,761][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:38:19,614][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:38:35,192][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:38:53,005][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:39:04,797][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:39:16,773][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:39:24,909][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:39:38,518][root][INFO] - Inference complete
[2025-03-06 23:39:38,519][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:39:38,526][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:39:38,527][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,527][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,527][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,527][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,528][root][WARNING] - |Q. 20||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,528][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,530][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,530][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,530][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,531][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,531][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,531][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,532][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,532][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,532][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,533][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,533][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,533][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,534][root][WARNING] - |Q. 23||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,534][root][WARNING] - |Q. 23||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,534][root][INFO] - |Q. 23||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,534][root][WARNING] - |Q. 50||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,535][root][WARNING] - |Q. 50||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,535][root][INFO] - |Q. 50||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,535][root][WARNING] - |Q. 80||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,535][root][WARNING] - |Q. 80||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,536][root][INFO] - |Q. 80||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,536][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,536][root][WARNING] - |Q. 85||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,536][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,536][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,537][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,537][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,537][root][WARNING] - |Q. 12||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,537][root][WARNING] - |Q. 12||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,537][root][INFO] - |Q. 12||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,537][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,538][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,538][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,538][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,538][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,538][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,539][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,539][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,539][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,540][root][WARNING] - |Q. 46||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,540][root][WARNING] - |Q. 46||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,540][root][INFO] - |Q. 46||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,541][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,541][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,541][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,541][root][WARNING] - |Q. 69||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:39:38,541][root][WARNING] - |Q. 69||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:39:38,541][root][INFO] - |Q. 69||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:39:38,544][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:39:38,549][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:39:38,549][root][INFO] - Saved parsed outputs
[2025-03-06 23:39:38,549][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:39:38,551][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:39:38,551][root][INFO] - Saved parsing metadata
[2025-03-06 23:39:38,551][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:39:38,553][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:39:38,555][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:39:38,586][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 23:39:38,586][root][INFO] - Summary of metrics : {'label_accuracy': 0.23, 'misclassification_rate': 0.77, 'combined_accuracy': 0.2, 'malformed_label': 1, 'malformed_domain': 14, 'total_predictions': 100, 'correct_predictions': 23, 'correct_label_and_domain': 20, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.19, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.09, 'Evidence_confidence': 0.15, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.15, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 66, 'correct_label_wrong_domain': 3, 'both_wrong': 11}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 23:39:49,343][root][INFO] - Setting global seed to 989
[2025-03-06 23:39:49,362][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:39:49,362][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:39:49,363][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:39:49,365][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:39:49,368][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:39:49,368][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:39:49,544][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:39:49,835][root][INFO] - Full model selected, loading model
[2025-03-06 23:40:07,900][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:41:08,727][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:41:08,728][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:41:35,070][root][INFO] - Peft model loaded successfully
[2025-03-06 23:41:41,231][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:41:41,232][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:41:41,232][root][INFO] - Starting inference
[2025-03-06 23:41:41,415][root][INFO] - Processing question number 0
[2025-03-06 23:41:41,417][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:41:53,149][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:42:23,662][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:42:32,980][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:42:46,524][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:43:04,257][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:43:11,309][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:43:31,611][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:43:44,247][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:43:50,572][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:43:59,151][root][INFO] - Processing question number 10
[2025-03-06 23:43:59,153][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:44:10,682][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:44:18,519][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:44:31,672][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:44:42,239][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:44:56,378][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:45:06,925][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:45:14,978][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:45:26,275][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:45:46,528][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:46:01,823][root][INFO] - Processing question number 20
[2025-03-06 23:46:01,826][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:46:11,018][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:46:24,373][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:46:32,868][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:46:39,970][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:46:51,342][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:47:01,849][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:47:23,378][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:47:46,506][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:48:01,725][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:48:18,449][root][INFO] - Processing question number 30
[2025-03-06 23:48:18,451][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:48:30,291][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:48:39,954][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:48:53,620][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:49:04,540][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:49:34,173][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:49:44,584][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:50:02,048][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:50:13,156][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:50:27,309][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:50:52,577][root][INFO] - Processing question number 40
[2025-03-06 23:50:52,580][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:51:03,552][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:51:12,678][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:51:21,280][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:51:27,423][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:51:41,640][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:51:50,955][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:52:09,766][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:52:19,373][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:52:34,223][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:52:50,321][root][INFO] - Processing question number 50
[2025-03-06 23:52:50,325][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:53:02,023][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:53:13,824][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:53:30,662][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:53:42,447][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:53:55,916][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:54:15,583][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:54:30,506][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:54:46,715][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:55:12,348][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:55:21,998][root][INFO] - Processing question number 60
[2025-03-06 23:55:22,002][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:55:35,332][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:55:43,667][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:55:56,073][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:56:07,156][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:56:18,422][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:56:34,525][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:56:42,457][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:56:51,219][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:57:16,367][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:57:23,940][root][INFO] - Processing question number 70
[2025-03-06 23:57:23,945][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:57:33,163][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:57:46,872][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:58:02,031][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:58:12,376][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:58:28,176][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:58:43,368][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:59:07,565][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:59:22,613][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:59:32,237][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:00:01,713][root][INFO] - Processing question number 80
[2025-03-07 00:00:01,718][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:00:13,540][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:00:20,495][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:00:40,068][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:00:53,603][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:01:07,072][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:01:17,744][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:01:37,387][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:01:54,438][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:02:07,861][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:02:22,118][root][INFO] - Processing question number 90
[2025-03-07 00:02:22,123][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:02:29,812][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:02:42,422][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:02:50,668][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:03:08,876][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:03:24,078][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:03:36,681][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:03:45,924][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:04:01,030][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:04:11,480][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:04:20,605][root][INFO] - Inference complete
[2025-03-07 00:04:20,605][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:04:20,611][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:04:20,612][root][WARNING] - |Q. 6||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,612][root][WARNING] - |Q. 6||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:04:20,613][root][INFO] - |Q. 6||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,613][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:04:20,613][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,613][root][WARNING] - |Q. 20||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,614][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,614][root][WARNING] - |Q. 41||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,614][root][WARNING] - |Q. 41||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,614][root][INFO] - |Q. 41||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,615][root][WARNING] - |Q. 70||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,615][root][WARNING] - |Q. 70||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,615][root][INFO] - |Q. 70||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,617][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,617][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,617][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,617][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,618][root][WARNING] - |Q. 7||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,618][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,618][root][WARNING] - |Q. 28||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,618][root][WARNING] - |Q. 28||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,618][root][INFO] - |Q. 28||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,619][root][WARNING] - |Q. 42||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,619][root][WARNING] - |Q. 42||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:04:20,619][root][INFO] - |Q. 42||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,619][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:04:20,620][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,620][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,620][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,620][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,620][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,621][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,621][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,622][root][WARNING] - |Q. 31||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,622][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,622][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,622][root][WARNING] - |Q. 38||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,622][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,623][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,623][root][WARNING] - |Q. 85||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,623][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,624][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,624][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,624][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,625][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,625][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,625][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,625][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,625][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,625][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,626][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,626][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,626][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,627][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,627][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,627][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,628][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,628][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,628][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,628][root][WARNING] - |Q. 66||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,628][root][WARNING] - |Q. 66||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:04:20,628][root][INFO] - |Q. 66||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,629][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:04:20,629][root][WARNING] - |Q. 88||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,629][root][WARNING] - |Q. 88||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,629][root][INFO] - |Q. 88||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,630][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:04:20,630][root][WARNING] - |Q. 100||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:04:20,630][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:04:20,632][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:04:20,637][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:04:20,637][root][INFO] - Saved parsed outputs
[2025-03-07 00:04:20,637][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:04:20,639][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:04:20,639][root][INFO] - Saved parsing metadata
[2025-03-07 00:04:20,639][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:04:20,640][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:04:20,642][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:04:20,671][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-07 00:04:20,671][root][INFO] - Summary of metrics : {'label_accuracy': 0.32, 'misclassification_rate': 0.6799999999999999, 'combined_accuracy': 0.27, 'malformed_label': 4, 'malformed_domain': 15, 'total_predictions': 100, 'correct_predictions': 32, 'correct_label_and_domain': 27, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.2, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 5, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-07 00:04:29,556][root][INFO] - Setting global seed to 989
[2025-03-07 00:04:29,565][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:04:29,565][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-07 00:04:29,566][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:04:29,568][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:04:29,571][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:04:29,571][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:04:29,784][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 00:04:30,037][root][INFO] - Full model selected, loading model
[2025-03-07 00:04:48,058][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:05:49,266][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:05:49,267][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:06:14,479][root][INFO] - Peft model loaded successfully
[2025-03-07 00:06:20,668][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:06:20,669][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:06:20,669][root][INFO] - Starting inference
[2025-03-07 00:06:20,863][root][INFO] - Processing question number 0
[2025-03-07 00:06:20,864][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:06:33,114][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:06:48,672][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:07:00,300][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:07:24,612][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:07:38,052][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:07:52,860][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:08:05,096][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:08:13,706][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:08:19,933][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:08:36,433][root][INFO] - Processing question number 10
[2025-03-07 00:08:36,435][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:08:43,464][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:08:50,839][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:09:08,531][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:09:19,166][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:09:34,135][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:09:38,467][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:09:52,999][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:10:10,425][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:10:31,811][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:10:49,972][root][INFO] - Processing question number 20
[2025-03-07 00:10:49,974][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:11:04,521][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:11:15,371][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:11:29,161][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:11:45,334][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:11:58,550][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:12:11,152][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:12:22,427][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:12:41,214][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:12:53,452][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:13:05,467][root][INFO] - Processing question number 30
[2025-03-07 00:13:05,470][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:13:26,852][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:13:40,627][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:13:56,256][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:14:06,813][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:14:23,968][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:14:29,979][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:14:44,571][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:15:01,583][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:15:15,719][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:15:26,160][root][INFO] - Processing question number 40
[2025-03-07 00:15:26,163][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:15:36,637][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:15:47,000][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:15:55,185][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:16:01,244][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:16:15,191][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:16:27,695][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:16:43,525][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:16:58,412][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:17:28,505][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:17:42,414][root][INFO] - Processing question number 50
[2025-03-07 00:17:42,418][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:17:57,297][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:18:12,464][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:18:29,314][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:18:42,810][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:19:03,206][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:19:16,180][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:19:27,347][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:19:38,917][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:20:01,652][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:20:13,622][root][INFO] - Processing question number 60
[2025-03-07 00:20:13,626][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:20:25,323][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:20:33,657][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:20:47,393][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:20:55,788][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:21:07,215][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:21:19,571][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:21:27,544][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:21:39,601][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:21:51,563][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:22:04,740][root][INFO] - Processing question number 70
[2025-03-07 00:22:04,745][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:22:12,307][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:22:24,706][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:22:51,237][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:23:13,564][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:23:29,657][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:23:43,379][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:24:14,583][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:24:25,896][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:24:35,584][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:24:48,688][root][INFO] - Processing question number 80
[2025-03-07 00:24:48,692][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:24:58,603][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:25:07,181][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:25:23,187][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:25:35,545][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:25:46,320][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:25:57,337][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:26:16,390][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:26:27,633][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:26:42,494][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:27:08,164][root][INFO] - Processing question number 90
[2025-03-07 00:27:08,169][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:27:17,845][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:27:31,166][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:27:45,818][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:28:00,600][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:28:13,525][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:28:26,495][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:28:37,517][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:28:47,635][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:29:01,684][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:29:11,300][root][INFO] - Inference complete
[2025-03-07 00:29:11,301][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:29:11,306][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:29:11,308][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,308][root][WARNING] - |Q. 20||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,308][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,310][root][WARNING] - |Q. 21||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,310][root][WARNING] - |Q. 21||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,310][root][INFO] - |Q. 21||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,311][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,312][root][WARNING] - |Q. 7||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,312][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,312][root][WARNING] - |Q. 24||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,312][root][WARNING] - |Q. 24||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,312][root][INFO] - |Q. 24||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,313][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,313][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,313][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,315][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,315][root][WARNING] - |Q. 38||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:29:11,315][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,315][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:29:11,317][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,317][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,317][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,318][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,318][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,318][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,318][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,319][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,319][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,319][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,319][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,319][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,321][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,322][root][WARNING] - |Q. 32||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,322][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,322][root][WARNING] - |Q. 45||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:29:11,322][root][WARNING] - |Q. 45||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:29:11,322][root][INFO] - |Q. 45||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:29:11,324][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:29:11,329][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:29:11,329][root][INFO] - Saved parsed outputs
[2025-03-07 00:29:11,329][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:29:11,330][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:29:11,330][root][INFO] - Saved parsing metadata
[2025-03-07 00:29:11,331][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:29:11,332][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:29:11,333][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:29:11,345][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-07 00:29:11,345][root][INFO] - Summary of metrics : {'label_accuracy': 0.32, 'misclassification_rate': 0.6799999999999999, 'combined_accuracy': 0.27, 'malformed_label': 1, 'malformed_domain': 15, 'total_predictions': 100, 'correct_predictions': 32, 'correct_label_and_domain': 27, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.13333333333333333, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.2, 'Contracts_confidence': 0.21, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 5, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-07 00:29:17,619][root][INFO] - Setting global seed to 989
[2025-03-07 00:29:17,624][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:29:17,625][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-07 00:29:17,626][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:29:17,627][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:29:17,629][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:29:17,629][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:29:17,787][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 00:29:18,033][root][INFO] - Full model selected, loading model
[2025-03-07 00:29:31,980][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:30:33,214][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:30:33,214][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:30:59,422][root][INFO] - Peft model loaded successfully
[2025-03-07 00:31:05,689][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:31:05,690][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:31:05,690][root][INFO] - Starting inference
[2025-03-07 00:31:05,871][root][INFO] - Processing question number 0
[2025-03-07 00:31:05,873][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:31:18,567][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:31:39,913][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:31:55,248][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:32:15,517][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:32:27,622][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:32:36,381][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:32:52,659][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:33:01,600][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:33:12,425][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:33:23,668][root][INFO] - Processing question number 10
[2025-03-07 00:33:23,670][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:33:30,611][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:33:42,027][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:33:48,821][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:33:55,971][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:34:08,504][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:34:17,935][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:34:27,540][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:34:38,245][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:34:59,640][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:35:08,584][root][INFO] - Processing question number 20
[2025-03-07 00:35:08,586][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:35:17,099][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:35:28,144][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:35:45,199][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:35:53,140][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:36:07,465][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:36:28,322][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:36:46,521][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:36:56,095][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:37:09,389][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:37:18,660][root][INFO] - Processing question number 30
[2025-03-07 00:37:18,663][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:37:29,959][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:37:41,814][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:37:56,924][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:38:06,409][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:38:25,077][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:38:33,473][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:38:48,831][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:39:04,853][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:39:14,278][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:39:30,564][root][INFO] - Processing question number 40
[2025-03-07 00:39:30,566][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:39:45,606][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:39:49,701][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:39:58,687][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:40:02,870][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:40:22,490][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:40:34,681][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:40:44,477][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:41:03,547][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:41:14,361][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:41:24,729][root][INFO] - Processing question number 50
[2025-03-07 00:41:24,733][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:41:42,989][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:41:54,931][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:42:25,478][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:42:41,180][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:42:51,504][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:43:03,903][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:43:33,685][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:43:56,223][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:44:11,176][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:44:21,908][root][INFO] - Processing question number 60
[2025-03-07 00:44:21,912][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:44:35,451][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:44:47,032][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:44:59,305][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:45:17,482][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:45:30,943][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:45:41,455][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:45:53,317][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:46:03,510][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:46:16,489][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:46:25,094][root][INFO] - Processing question number 70
[2025-03-07 00:46:25,098][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:46:33,332][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:46:44,247][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:46:59,365][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:47:22,367][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:47:30,221][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:47:42,005][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:47:55,829][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:48:04,262][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:48:12,468][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:48:21,787][root][INFO] - Processing question number 80
[2025-03-07 00:48:21,792][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:48:35,602][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:48:49,971][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:49:06,327][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:49:18,884][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:49:45,636][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:49:57,083][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:50:17,612][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:50:32,171][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:50:47,142][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:51:15,801][root][INFO] - Processing question number 90
[2025-03-07 00:51:15,806][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:51:32,698][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:51:49,421][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:51:57,053][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:52:08,814][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:52:24,555][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:52:40,240][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:52:49,689][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:52:59,390][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:53:12,688][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:53:22,459][root][INFO] - Inference complete
[2025-03-07 00:53:22,459][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:53:22,465][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:53:22,467][root][WARNING] - |Q. 70||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,468][root][WARNING] - |Q. 70||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,468][root][INFO] - |Q. 70||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,468][root][WARNING] - |Q. 8||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,469][root][WARNING] - |Q. 8||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,469][root][INFO] - |Q. 8||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,469][root][WARNING] - |Q. 21||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,469][root][WARNING] - |Q. 21||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,469][root][INFO] - |Q. 21||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,471][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,471][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,471][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,472][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,472][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,472][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,473][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,474][root][WARNING] - |Q. 38||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,474][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,475][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,476][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,476][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,476][root][WARNING] - |Q. 47||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,476][root][WARNING] - |Q. 47||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,476][root][INFO] - |Q. 47||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,477][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,477][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,477][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,478][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,478][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,478][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,479][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,479][root][WARNING] - |Q. 11||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,480][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,480][root][WARNING] - |Q. 45||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,480][root][WARNING] - |Q. 45||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,480][root][INFO] - |Q. 45||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,481][root][WARNING] - |Q. 92||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:53:22,481][root][WARNING] - |Q. 92||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:53:22,481][root][INFO] - |Q. 92||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:53:22,482][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:53:22,488][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:53:22,488][root][INFO] - Saved parsed outputs
[2025-03-07 00:53:22,488][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:53:22,489][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:53:22,489][root][INFO] - Saved parsing metadata
[2025-03-07 00:53:22,490][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:53:22,491][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:53:22,492][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:53:22,511][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-07 00:53:22,511][root][INFO] - Summary of metrics : {'label_accuracy': 0.3, 'misclassification_rate': 0.7, 'combined_accuracy': 0.25, 'malformed_label': 0, 'malformed_domain': 15, 'total_predictions': 100, 'correct_predictions': 30, 'correct_label_and_domain': 25, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.13333333333333333, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.2, 'Contracts_confidence': 0.2, 'Criminal_Law_confidence': 0.1, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.15, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 60, 'correct_label_wrong_domain': 5, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Job 27 completed at Fri Mar  7 00:53:23 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n517
Job ID: 25358402
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 05:48:13
CPU Efficiency: 9.92% of 2-10:29:40 core-walltime
Job Wall-clock time: 05:50:58
Memory Utilized: 28.26 GB
Memory Efficiency: 78.50% of 36.00 GB
