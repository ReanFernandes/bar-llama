Starting job 27 at Thu Mar  6 19:02:59 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_10_samples prompt=json_fact_first_few_shot_unstructured train=json_fact_first_few_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '27', 'training']
Updating job 27 to status training with exit code None
Status update completed for job 27
[2025-03-06 19:03:09,320][root][INFO] - Global seed set to 314
[2025-03-06 19:03:09,322][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 19:03:09,322][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 19:03:09,322][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 19:03:09,322][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 19:03:09,322][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 19:03:09,338][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 19:03:09,343][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 19:03:09,343][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 19:03:09,348][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 19:03:09,772][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 19:03:23,871][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 19:03:53,181][root][INFO] - Model prepared for kbit training
[2025-03-06 19:03:53,182][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'q_proj', 'o_proj', 'gate_proj', 'up_proj', 'k_proj', 'v_proj', 'down_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 19:03:54,910][root][INFO] - Lora adapter added to model
[2025-03-06 19:03:54,913][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_few_shot_unstructured
[2025-03-06 19:03:55,145][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.5487, 'grad_norm': 0.1353198140859604, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.5671, 'grad_norm': 0.14344191551208496, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.4712, 'grad_norm': 0.14320988953113556, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.405, 'grad_norm': 0.17568674683570862, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.1983, 'grad_norm': 0.19984693825244904, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.9611, 'grad_norm': 0.28654012084007263, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.784, 'grad_norm': 0.24128052592277527, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.6049, 'grad_norm': 0.19419598579406738, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.5673, 'grad_norm': 0.14870160818099976, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.5492, 'grad_norm': 0.11215481162071228, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.5202, 'grad_norm': 0.10652227699756622, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.5154, 'grad_norm': 0.08867114782333374, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.4831, 'grad_norm': 0.42730674147605896, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.5246, 'grad_norm': 0.08375649154186249, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.4443, 'grad_norm': 0.07965204864740372, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.4767, 'grad_norm': 0.07794076204299927, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.4901, 'grad_norm': 0.0803818553686142, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.4387, 'grad_norm': 0.07839502394199371, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.4704, 'grad_norm': 0.09424098581075668, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.4624, 'grad_norm': 0.0875830352306366, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.459, 'grad_norm': 0.08792450278997421, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.4188, 'grad_norm': 0.08905845880508423, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.4661, 'grad_norm': 0.09200473129749298, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.411, 'grad_norm': 0.09489677846431732, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.4338, 'grad_norm': 0.09510081261396408, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.4681, 'grad_norm': 0.09422515332698822, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.4509, 'grad_norm': 0.10095299780368805, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.4244, 'grad_norm': 0.09444955736398697, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.447, 'grad_norm': 0.11680952459573746, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.4058, 'grad_norm': 0.13077840209007263, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.4022, 'grad_norm': 0.15072228014469147, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.3625, 'grad_norm': 0.2457045316696167, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.3524, 'grad_norm': 0.18531735241413116, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.2773, 'grad_norm': 0.1872507482767105, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.3133, 'grad_norm': 0.3699219822883606, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.2493, 'grad_norm': 0.1910175383090973, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.2909, 'grad_norm': 0.23862224817276, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.1944, 'grad_norm': 0.44030433893203735, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.2285, 'grad_norm': 0.26365411281585693, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.171, 'grad_norm': 0.24637719988822937, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.1418, 'grad_norm': 0.2734069526195526, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.135, 'grad_norm': 0.30898919701576233, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.1381, 'grad_norm': 0.30814236402511597, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.1076, 'grad_norm': 0.19524520635604858, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.1027, 'grad_norm': 0.24776539206504822, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.1092, 'grad_norm': 0.24641643464565277, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0911, 'grad_norm': 0.2524035573005676, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.0853, 'grad_norm': 0.24263818562030792, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0874, 'grad_norm': 0.24261997640132904, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0765, 'grad_norm': 0.201274573802948, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 3739.7049, 'train_samples_per_second': 0.281, 'train_steps_per_second': 0.04, 'train_loss': 0.47568494657675425, 'epoch': 15.0}
[2025-03-06 20:06:17,975][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_fact_first_few_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '27', 'trained', '0']
Updating job 27 to status trained with exit code 0
Status update completed for job 27
Starting evaluations for job 27
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 20:06:26,501][root][INFO] - Setting global seed to 206
[2025-03-06 20:06:26,507][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:06:26,507][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:06:26,508][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:06:26,510][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:06:26,512][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:06:26,512][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:06:26,659][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:06:26,925][root][INFO] - Full model selected, loading model
[2025-03-06 20:06:38,832][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:07:39,230][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:07:39,230][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:08:05,244][root][INFO] - Peft model loaded successfully
[2025-03-06 20:08:11,566][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:08:11,567][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:08:11,568][root][INFO] - Starting inference
[2025-03-06 20:08:11,804][root][INFO] - Processing question number 0
[2025-03-06 20:08:11,806][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:08:23,581][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:08:36,071][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:08:46,036][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:08:56,383][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:09:06,177][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:09:15,822][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:09:30,003][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:09:44,549][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:09:53,023][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:10:11,990][root][INFO] - Processing question number 10
[2025-03-06 20:10:11,992][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:10:20,385][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:10:39,492][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:10:53,315][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:11:04,733][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:11:18,466][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:11:28,064][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:11:38,790][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:11:49,333][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:12:01,138][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:12:14,048][root][INFO] - Processing question number 20
[2025-03-06 20:12:14,050][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:12:21,699][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:12:27,982][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:12:40,755][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:12:49,961][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:13:01,002][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:13:15,571][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:13:27,932][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:13:34,365][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:13:44,947][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:13:53,106][root][INFO] - Processing question number 30
[2025-03-06 20:13:53,109][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:14:08,394][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:14:22,361][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:14:33,967][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:14:50,457][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:14:58,011][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:15:06,837][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:15:18,882][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:15:29,639][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:15:49,069][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:16:03,853][root][INFO] - Processing question number 40
[2025-03-06 20:16:03,856][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:16:17,569][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:16:37,088][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:16:58,942][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:17:15,521][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:17:26,680][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:17:41,196][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:17:49,166][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:17:59,486][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:18:09,957][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:18:22,710][root][INFO] - Processing question number 50
[2025-03-06 20:18:22,714][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:18:38,202][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:19:00,147][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:19:08,591][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:19:16,754][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:19:39,627][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:19:48,669][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:20:04,174][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:20:19,715][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:20:36,245][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:21:07,617][root][INFO] - Processing question number 60
[2025-03-06 20:21:07,621][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:21:18,524][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:21:27,889][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:21:41,194][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:21:50,085][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:21:57,093][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:22:09,745][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:22:20,162][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:22:30,209][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:22:37,724][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:22:56,543][root][INFO] - Processing question number 70
[2025-03-06 20:22:56,547][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:23:10,119][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:23:22,566][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:23:32,510][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:23:40,427][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:23:57,166][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:24:08,686][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:24:28,385][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:24:45,774][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:24:55,808][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:25:13,325][root][INFO] - Processing question number 80
[2025-03-06 20:25:13,329][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:25:26,672][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:25:42,948][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:25:56,376][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:26:08,773][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:26:17,588][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:26:32,192][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:26:45,694][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:26:57,167][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:27:04,654][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:27:16,604][root][INFO] - Processing question number 90
[2025-03-06 20:27:16,610][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:27:35,107][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:27:42,467][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:27:53,268][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:28:03,724][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:28:21,834][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:28:28,934][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:28:56,978][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:29:09,864][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:29:23,309][root][INFO] - Inference complete
[2025-03-06 20:29:23,309][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,315][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,317][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,317][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,317][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,318][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,318][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,318][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,318][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,318][root][WARNING] - |Q. 91||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,319][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,319][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,319][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,319][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,320][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,320][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,320][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,323][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,323][root][WARNING] - |Q. 62||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,323][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,324][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,325][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:29:23,325][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,325][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:29:23,326][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,326][root][WARNING] - |Q. 59||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,326][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,328][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,328][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,328][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,328][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,329][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,329][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,329][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:29:23,329][root][WARNING] - |Q. 15||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:29:23,330][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:29:23,332][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,337][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,337][root][INFO] - Saved parsed outputs
[2025-03-06 20:29:23,337][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,338][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,338][root][INFO] - Saved parsing metadata
[2025-03-06 20:29:23,339][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,340][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:23,342][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:29:23,368][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:29:23,368][root][INFO] - Summary of metrics : {'label_accuracy': 0.41414141414141414, 'misclassification_rate': 0.5858585858585859, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 2, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 41, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.5714285714285714, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.18181818181818182, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 3, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 20:29:30,482][root][INFO] - Setting global seed to 206
[2025-03-06 20:29:30,487][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:29:30,487][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:29:30,488][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:29:30,490][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:29:30,493][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:29:30,493][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:29:30,995][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:29:31,297][root][INFO] - Full model selected, loading model
[2025-03-06 20:29:43,210][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:30:44,503][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:30:44,504][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:31:09,981][root][INFO] - Peft model loaded successfully
[2025-03-06 20:31:16,195][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:31:16,197][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:31:16,197][root][INFO] - Starting inference
[2025-03-06 20:31:16,409][root][INFO] - Processing question number 0
[2025-03-06 20:31:16,411][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:31:26,222][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:31:43,421][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:31:54,867][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:32:05,823][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:32:27,760][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:32:36,768][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:32:52,483][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:33:22,543][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:33:31,023][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:33:43,580][root][INFO] - Processing question number 10
[2025-03-06 20:33:43,582][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:33:55,568][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:34:04,276][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:34:22,476][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:34:37,294][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:34:47,303][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:34:56,556][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:35:06,760][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:35:16,347][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:35:38,503][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:35:52,764][root][INFO] - Processing question number 20
[2025-03-06 20:35:52,767][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:35:59,429][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:36:05,137][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:36:18,675][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:36:28,370][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:36:39,184][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:36:53,855][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:37:17,388][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:37:24,096][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:37:32,575][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:37:39,961][root][INFO] - Processing question number 30
[2025-03-06 20:37:39,963][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:38:10,208][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:38:25,338][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:38:54,441][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:39:08,349][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:39:18,592][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:39:26,750][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:39:38,066][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:39:51,304][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:40:09,324][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:40:24,247][root][INFO] - Processing question number 40
[2025-03-06 20:40:24,250][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:40:36,849][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:40:50,027][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:41:05,767][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:41:17,693][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:41:26,383][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:41:32,702][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:41:41,069][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:41:49,891][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:41:59,609][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:42:16,355][root][INFO] - Processing question number 50
[2025-03-06 20:42:16,359][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:42:28,302][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:42:45,669][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:42:56,413][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:43:04,638][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:43:25,357][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:43:33,717][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:43:48,939][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:44:00,400][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:44:08,398][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:44:29,407][root][INFO] - Processing question number 60
[2025-03-06 20:44:29,410][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:44:43,285][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:44:57,689][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:45:11,329][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:45:29,088][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:45:44,556][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:45:55,945][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:46:18,423][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:46:33,442][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:46:42,287][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:46:57,486][root][INFO] - Processing question number 70
[2025-03-06 20:46:57,490][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:47:14,098][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:47:24,150][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:47:38,073][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:47:46,746][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:47:57,898][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:48:13,891][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:48:32,439][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:48:44,232][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:49:02,293][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:49:19,199][root][INFO] - Processing question number 80
[2025-03-06 20:49:19,204][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:49:29,238][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:49:38,312][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:49:47,477][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:50:01,382][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:50:07,423][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:50:18,605][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:50:27,921][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:50:42,471][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:50:55,899][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:51:09,096][root][INFO] - Processing question number 90
[2025-03-06 20:51:09,102][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:51:23,736][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:51:35,570][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:51:47,148][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:51:55,845][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:52:17,435][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:52:26,429][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:52:37,925][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:52:57,754][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:53:11,862][root][INFO] - Inference complete
[2025-03-06 20:53:11,862][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,868][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,870][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,871][root][WARNING] - |Q. 49||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:53:11,871][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,871][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:53:11,873][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,873][root][WARNING] - |Q. 17||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,873][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,874][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,875][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:53:11,875][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,875][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:53:11,875][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,875][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,875][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,876][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,876][root][WARNING] - |Q. 22||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,876][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,876][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,877][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,877][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,877][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,877][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,877][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,879][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,879][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,879][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,880][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,881][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,881][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,882][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,882][root][WARNING] - |Q. 6||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,882][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,883][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,883][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,883][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,883][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,883][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,883][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,885][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:53:11,885][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:53:11,885][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:53:11,887][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,892][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,892][root][INFO] - Saved parsed outputs
[2025-03-06 20:53:11,892][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,893][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,893][root][INFO] - Saved parsing metadata
[2025-03-06 20:53:11,894][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,895][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:11,897][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:53:11,933][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:53:11,933][root][INFO] - Summary of metrics : {'label_accuracy': 0.3838383838383838, 'misclassification_rate': 0.6161616161616161, 'combined_accuracy': 0.35353535353535354, 'malformed_label': 3, 'malformed_domain': 13, 'total_predictions': 99, 'correct_predictions': 38, 'correct_label_and_domain': 35, 'Constitutional_Law_accuracy': 0.0, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1717171717171717, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 51, 'correct_label_wrong_domain': 3, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 20:53:18,829][root][INFO] - Setting global seed to 206
[2025-03-06 20:53:18,834][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:53:18,834][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:53:18,835][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:53:18,837][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:53:18,840][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:53:18,840][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:53:19,062][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:53:19,354][root][INFO] - Full model selected, loading model
[2025-03-06 20:53:31,039][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:54:31,592][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:54:31,592][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:54:56,917][root][INFO] - Peft model loaded successfully
[2025-03-06 20:55:03,236][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:55:03,238][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:55:03,238][root][INFO] - Starting inference
[2025-03-06 20:55:03,433][root][INFO] - Processing question number 0
[2025-03-06 20:55:03,435][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:55:08,644][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:55:21,468][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:55:34,184][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:55:43,929][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:55:55,171][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:56:01,700][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:56:16,543][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:56:41,279][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:56:52,463][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:57:19,046][root][INFO] - Processing question number 10
[2025-03-06 20:57:19,048][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:57:27,781][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:57:36,534][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:57:49,110][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:58:09,505][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:58:21,617][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:58:33,143][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:58:43,925][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:58:54,244][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:59:01,777][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:59:12,860][root][INFO] - Processing question number 20
[2025-03-06 20:59:12,863][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:59:25,516][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:59:37,165][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:59:45,050][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:59:53,571][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:00:08,345][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:00:28,845][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:00:37,982][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:00:55,338][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:01:06,719][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:01:12,816][root][INFO] - Processing question number 30
[2025-03-06 21:01:12,818][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:01:43,057][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:01:56,074][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:02:26,117][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:02:41,957][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:02:51,768][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:03:09,685][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:03:20,464][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:03:31,340][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:03:45,696][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:03:58,201][root][INFO] - Processing question number 40
[2025-03-06 21:03:58,204][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:04:11,090][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:04:21,908][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:04:34,537][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:04:52,980][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:05:04,854][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:05:13,734][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:05:24,045][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:05:33,174][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:05:46,775][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:05:57,561][root][INFO] - Processing question number 50
[2025-03-06 21:05:57,564][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:06:15,060][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:06:28,804][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:06:34,009][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:06:59,198][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:07:23,625][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:07:33,368][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:07:49,016][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:08:04,221][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:08:16,106][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:08:32,828][root][INFO] - Processing question number 60
[2025-03-06 21:08:32,832][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:08:55,680][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:09:10,473][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:09:24,407][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:09:33,417][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:09:45,431][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:10:03,810][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:10:16,594][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:10:35,431][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:10:47,661][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:10:59,338][root][INFO] - Processing question number 70
[2025-03-06 21:10:59,342][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:11:07,815][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:11:13,100][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:11:24,995][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:11:38,421][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:11:51,050][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:12:02,325][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:12:16,715][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:12:30,780][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:12:45,024][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:12:54,950][root][INFO] - Processing question number 80
[2025-03-06 21:12:54,955][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:13:02,563][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:13:12,329][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:13:21,379][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:13:33,213][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:13:44,304][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:13:55,301][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:14:06,748][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:14:18,168][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:14:24,346][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:14:38,878][root][INFO] - Processing question number 90
[2025-03-06 21:14:38,883][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:14:50,274][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:15:00,413][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:15:12,700][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:15:17,852][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:15:27,241][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:15:33,797][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:15:51,926][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:16:11,564][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:16:22,100][root][INFO] - Inference complete
[2025-03-06 21:16:22,100][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,106][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,108][root][WARNING] - |Q. 28||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,108][root][WARNING] - |Q. 28||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,109][root][INFO] - |Q. 28||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,109][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,109][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,109][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,110][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,110][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,110][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,111][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,111][root][WARNING] - |Q. 2||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,111][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,111][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,112][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,112][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,113][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,113][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:16:22,114][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,114][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:16:22,114][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,114][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,114][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,115][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,115][root][WARNING] - |Q. 16||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:16:22,115][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,115][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:16:22,116][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,116][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,116][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,117][root][WARNING] - |Q. 94||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,117][root][WARNING] - |Q. 94||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,117][root][INFO] - |Q. 94||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,118][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,118][root][WARNING] - |Q. 47||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,118][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,119][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,119][root][WARNING] - |Q. 82||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,119][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,119][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,119][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,119][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,122][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,122][root][WARNING] - |Q. 39||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,122][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,123][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,123][root][WARNING] - |Q. 97||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,123][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,124][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,124][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,124][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,125][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,125][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,125][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,125][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:16:22,126][root][WARNING] - |Q. 85||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:16:22,126][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:16:22,127][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,132][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,132][root][INFO] - Saved parsed outputs
[2025-03-06 21:16:22,132][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,134][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,134][root][INFO] - Saved parsing metadata
[2025-03-06 21:16:22,134][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,137][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:16:22,138][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:16:22,178][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:16:22,178][root][INFO] - Summary of metrics : {'label_accuracy': 0.3333333333333333, 'misclassification_rate': 0.6666666666666667, 'combined_accuracy': 0.2828282828282828, 'malformed_label': 5, 'malformed_domain': 13, 'total_predictions': 99, 'correct_predictions': 33, 'correct_label_and_domain': 28, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1717171717171717, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 5, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 21:16:35,109][root][INFO] - Setting global seed to 989
[2025-03-06 21:16:35,118][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:16:35,118][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:16:35,119][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:16:35,121][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:16:35,136][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:16:35,136][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:16:35,298][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:16:35,582][root][INFO] - Full model selected, loading model
[2025-03-06 21:16:54,370][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:18:04,323][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:18:04,323][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:18:30,752][root][INFO] - Peft model loaded successfully
[2025-03-06 21:18:36,940][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:18:36,942][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:18:36,942][root][INFO] - Starting inference
[2025-03-06 21:18:37,145][root][INFO] - Processing question number 0
[2025-03-06 21:18:37,147][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:18:49,118][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:19:01,690][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:19:11,716][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:19:22,139][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:19:31,960][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:19:41,623][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:19:55,877][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:20:10,524][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:20:19,043][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:20:37,984][root][INFO] - Processing question number 10
[2025-03-06 21:20:37,986][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:20:46,376][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:21:05,456][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:21:19,205][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:21:30,530][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:21:44,072][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:21:53,611][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:22:04,244][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:22:14,701][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:22:26,434][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:22:39,297][root][INFO] - Processing question number 20
[2025-03-06 21:22:39,300][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:22:46,886][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:22:53,118][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:23:05,787][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:23:14,937][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:23:25,947][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:23:40,405][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:23:52,666][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:23:59,050][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:24:09,581][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:24:17,734][root][INFO] - Processing question number 30
[2025-03-06 21:24:17,737][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:24:33,013][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:24:46,959][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:24:58,541][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:25:14,999][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:25:22,574][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:25:31,460][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:25:43,569][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:25:54,320][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:26:13,732][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:26:28,494][root][INFO] - Processing question number 40
[2025-03-06 21:26:28,498][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:26:42,195][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:27:01,691][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:27:23,520][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:27:40,087][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:27:51,248][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:28:05,752][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:28:13,717][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:28:24,035][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:28:34,493][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:28:47,235][root][INFO] - Processing question number 50
[2025-03-06 21:28:47,239][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:29:02,716][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:29:24,650][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:29:33,093][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:29:41,254][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:30:04,112][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:30:13,148][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:30:28,655][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:30:44,191][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:31:00,707][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:31:31,913][root][INFO] - Processing question number 60
[2025-03-06 21:31:31,917][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:31:42,811][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:31:52,171][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:32:05,465][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:32:14,354][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:32:21,363][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:32:34,007][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:32:44,420][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:32:54,460][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:33:01,972][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:33:20,780][root][INFO] - Processing question number 70
[2025-03-06 21:33:20,784][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:33:34,341][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:33:46,777][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:33:56,709][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:34:04,596][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:34:21,278][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:34:32,760][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:34:52,400][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:35:09,729][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:35:19,743][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:35:37,251][root][INFO] - Processing question number 80
[2025-03-06 21:35:37,256][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:35:50,571][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:36:06,787][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:36:20,178][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:36:32,548][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:36:41,346][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:36:55,910][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:37:09,375][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:37:20,815][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:37:28,294][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:37:40,211][root][INFO] - Processing question number 90
[2025-03-06 21:37:40,217][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:37:58,672][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:38:06,009][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:38:16,787][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:38:27,218][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:38:45,286][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:38:52,370][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:39:20,351][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:39:33,225][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:39:46,694][root][INFO] - Inference complete
[2025-03-06 21:39:46,694][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,708][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,710][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,710][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,710][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,711][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,711][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,711][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,711][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,712][root][WARNING] - |Q. 91||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,712][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,712][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,713][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,713][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,713][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,713][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,713][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,716][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,717][root][WARNING] - |Q. 62||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,717][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,718][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,718][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:39:46,719][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,719][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:39:46,719][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,720][root][WARNING] - |Q. 59||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,720][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,721][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,721][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,721][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,722][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,722][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,722][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,723][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:46,723][root][WARNING] - |Q. 15||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:46,723][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:46,725][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,730][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,730][root][INFO] - Saved parsed outputs
[2025-03-06 21:39:46,730][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,732][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,732][root][INFO] - Saved parsing metadata
[2025-03-06 21:39:46,733][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,734][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:46,736][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:39:46,742][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:39:46,742][root][INFO] - Summary of metrics : {'label_accuracy': 0.41414141414141414, 'misclassification_rate': 0.5858585858585859, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 2, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 41, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.5714285714285714, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.18181818181818182, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 3, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 27 to status completed with exit code 0
Eval status update completed for job 27
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '27', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 27 to status running with exit code None
Eval status update completed for job 27
[2025-03-06 21:39:53,500][root][INFO] - Setting global seed to 989
[2025-03-06 21:39:53,506][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:39:53,506][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:39:53,508][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:39:53,509][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:39:53,511][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:39:53,511][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:39:53,664][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:39:54,044][root][INFO] - Full model selected, loading model
[2025-03-06 21:40:13,071][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:41:14,561][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:41:14,561][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:41:41,316][root][INFO] - Peft model loaded successfully
[2025-03-06 21:41:47,535][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:41:47,537][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:41:47,537][root][INFO] - Starting inference
[2025-03-06 21:41:47,790][root][INFO] - Processing question number 0
[2025-03-06 21:41:47,792][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:41:53,510][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:42:10,463][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:42:18,984][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:42:30,077][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:42:38,586][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:42:48,188][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:43:00,438][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:43:11,461][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:43:20,632][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:43:35,842][root][INFO] - Processing question number 10
[2025-03-06 21:43:35,844][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:43:49,527][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:43:59,858][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:44:08,821][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:44:32,719][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:44:48,516][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:44:59,047][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:45:09,751][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:45:19,793][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:45:25,701][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:45:37,353][root][INFO] - Processing question number 20
[2025-03-06 21:45:37,355][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:45:49,964][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:45:55,621][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:46:05,591][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:46:15,453][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:46:26,247][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:46:36,957][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:46:47,291][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:46:58,323][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:47:17,672][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:47:25,046][root][INFO] - Processing question number 30
[2025-03-06 21:47:25,049][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:47:37,257][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:47:54,259][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:48:24,300][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:48:54,107][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:49:01,755][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:49:11,636][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:49:22,790][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:49:44,868][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:49:57,529][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:50:11,448][root][INFO] - Processing question number 40
[2025-03-06 21:50:11,451][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:50:26,592][root][INFO] - Domain : Contracts, Question : 81
