Starting job 23 at Thu Mar  6 19:02:58 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_10_samples prompt=json_answer_first_zero_shot_unstructured train=json_answer_first_zero_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '23', 'training']
Updating job 23 to status training with exit code None
Status update completed for job 23
[2025-03-06 19:03:13,307][root][INFO] - Global seed set to 314
[2025-03-06 19:03:13,308][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 19:03:13,308][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 19:03:13,308][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 19:03:13,308][root][INFO] - Current training config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 19:03:13,309][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 19:03:13,325][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 19:03:13,366][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 19:03:13,369][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 19:03:13,373][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 19:03:13,821][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 19:03:28,054][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 19:03:59,815][root][INFO] - Model prepared for kbit training
[2025-03-06 19:03:59,816][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'q_proj', 'gate_proj', 'k_proj', 'o_proj', 'down_proj', 'up_proj', 'v_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 19:04:01,542][root][INFO] - Lora adapter added to model
[2025-03-06 19:04:01,545][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_answer_first_zero_shot_unstructured
[2025-03-06 19:04:01,721][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.6544, 'grad_norm': 0.12412529438734055, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.7745, 'grad_norm': 0.18844011425971985, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.5588, 'grad_norm': 0.1492535024881363, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.5837, 'grad_norm': 0.21266518533229828, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.3761, 'grad_norm': 0.24330346286296844, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 1.2031, 'grad_norm': 0.36921992897987366, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 1.1753, 'grad_norm': 0.1751425862312317, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 1.0351, 'grad_norm': 0.22621892392635345, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 1.0244, 'grad_norm': 0.14145693182945251, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 1.0556, 'grad_norm': 0.23613570630550385, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 1.0225, 'grad_norm': 0.18166783452033997, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.9765, 'grad_norm': 0.1698284149169922, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.9379, 'grad_norm': 0.15562117099761963, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.9815, 'grad_norm': 0.17995306849479675, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.8525, 'grad_norm': 0.16267098486423492, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.877, 'grad_norm': 0.2021315097808838, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.9408, 'grad_norm': 0.18787287175655365, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.8162, 'grad_norm': 0.21696770191192627, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.8499, 'grad_norm': 0.20974089205265045, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.8457, 'grad_norm': 0.261216402053833, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.8422, 'grad_norm': 0.20721091330051422, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.7361, 'grad_norm': 0.2689412832260132, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.8302, 'grad_norm': 0.23383855819702148, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.7576, 'grad_norm': 0.28212013840675354, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.7582, 'grad_norm': 0.23698677122592926, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.8006, 'grad_norm': 0.2919101417064667, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.8465, 'grad_norm': 0.24624943733215332, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.7338, 'grad_norm': 0.2760869264602661, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.7562, 'grad_norm': 0.45113348960876465, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.6806, 'grad_norm': 0.423221230506897, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.6868, 'grad_norm': 0.5065656304359436, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.5481, 'grad_norm': 0.5837286710739136, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.5789, 'grad_norm': 0.46592962741851807, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.3997, 'grad_norm': 0.5157677531242371, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.5049, 'grad_norm': 1.0375306606292725, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.36, 'grad_norm': 0.6113277077674866, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.462, 'grad_norm': 0.5614391565322876, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.2295, 'grad_norm': 0.6231346726417542, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.3371, 'grad_norm': 0.5452233552932739, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.2301, 'grad_norm': 0.4682728946208954, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.2487, 'grad_norm': 0.6830006241798401, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.1446, 'grad_norm': 0.7082443237304688, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.1963, 'grad_norm': 0.576056182384491, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.1107, 'grad_norm': 0.30914902687072754, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.1498, 'grad_norm': 0.536873459815979, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.127, 'grad_norm': 0.39447733759880066, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.1486, 'grad_norm': 0.473660945892334, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.1021, 'grad_norm': 0.28620341420173645, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.1073, 'grad_norm': 0.4021146297454834, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.085, 'grad_norm': 0.3011339008808136, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 2691.9857, 'train_samples_per_second': 0.39, 'train_steps_per_second': 0.056, 'train_loss': 0.720808685819308, 'epoch': 15.0}
[2025-03-06 19:48:56,816][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_answer_first_zero_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '23', 'trained', '0']
Updating job 23 to status trained with exit code 0
Status update completed for job 23
Starting evaluations for job 23
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 19:49:12,125][root][INFO] - Setting global seed to 206
[2025-03-06 19:49:12,133][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 19:49:12,133][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 19:49:12,135][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 19:49:12,137][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 19:49:12,139][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 19:49:12,139][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 19:49:12,310][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 19:49:13,039][root][INFO] - Full model selected, loading model
[2025-03-06 19:49:31,472][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 19:50:35,844][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 19:50:35,844][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 19:51:01,520][root][INFO] - Peft model loaded successfully
[2025-03-06 19:51:07,635][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 19:51:07,637][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 19:51:07,637][root][INFO] - Starting inference
[2025-03-06 19:51:07,869][root][INFO] - Processing question number 0
[2025-03-06 19:51:07,872][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 19:51:12,396][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 19:51:23,169][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 19:51:31,005][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 19:51:39,200][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 19:51:47,536][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 19:51:52,735][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 19:51:57,674][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 19:52:13,908][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 19:52:27,111][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 19:52:40,547][root][INFO] - Processing question number 10
[2025-03-06 19:52:40,548][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 19:52:47,372][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 19:52:55,731][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 19:53:07,941][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 19:53:13,925][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 19:53:23,362][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 19:53:40,191][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 19:53:50,658][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 19:53:58,447][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 19:54:13,521][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 19:54:26,052][root][INFO] - Processing question number 20
[2025-03-06 19:54:26,054][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 19:54:38,118][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 19:54:51,816][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 19:55:04,113][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 19:55:19,822][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 19:55:27,534][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 19:55:36,337][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 19:55:43,459][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 19:55:49,648][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 19:56:00,697][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 19:56:09,854][root][INFO] - Processing question number 30
[2025-03-06 19:56:09,856][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 19:56:19,858][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 19:56:28,866][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 19:56:41,980][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 19:56:52,707][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 19:56:58,685][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 19:57:06,129][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 19:57:15,471][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 19:57:31,578][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 19:57:41,673][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 19:57:56,779][root][INFO] - Processing question number 40
[2025-03-06 19:57:56,781][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 19:58:08,180][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 19:58:15,273][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 19:58:42,155][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 19:59:08,932][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 19:59:17,997][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 19:59:30,417][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 19:59:56,255][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:00:03,490][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:00:15,060][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:00:26,921][root][INFO] - Processing question number 50
[2025-03-06 20:00:26,923][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:00:37,088][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:00:52,805][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:01:01,263][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:01:19,264][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:01:29,223][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:01:34,627][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:01:46,140][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:01:54,783][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:02:04,714][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:02:16,933][root][INFO] - Processing question number 60
[2025-03-06 20:02:16,936][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:02:23,041][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:02:31,737][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:02:41,507][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:02:47,607][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:03:00,057][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:03:11,105][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:03:37,555][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:03:48,681][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:04:06,270][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:04:23,023][root][INFO] - Processing question number 70
[2025-03-06 20:04:23,027][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:04:27,878][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:04:34,105][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:04:38,225][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:04:50,552][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:05:04,610][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:05:09,543][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:05:15,996][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:05:30,039][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:05:40,171][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:05:45,191][root][INFO] - Processing question number 80
[2025-03-06 20:05:45,194][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:06:00,573][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:06:12,866][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:06:26,156][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:06:36,681][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:06:40,538][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:06:49,288][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:06:58,008][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:07:05,796][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:07:15,908][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:07:23,341][root][INFO] - Processing question number 90
[2025-03-06 20:07:23,345][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:07:39,194][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:07:44,517][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:07:49,626][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:07:54,801][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:08:00,455][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:08:12,027][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:08:22,092][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:08:34,004][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:08:41,418][root][INFO] - Inference complete
[2025-03-06 20:08:41,418][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:08:41,424][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:08:41,425][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,426][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,426][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,426][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,426][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,426][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,428][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,428][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,428][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,429][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,429][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,429][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,430][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,430][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,430][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,430][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,431][root][WARNING] - |Q. 22||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,431][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,432][root][WARNING] - |Q. 88||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,432][root][WARNING] - |Q. 88||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:08:41,432][root][INFO] - |Q. 88||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,433][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:08:41,435][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,436][root][WARNING] - |Q. 59||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:08:41,436][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,436][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:08:41,437][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,437][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,437][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,437][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,438][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,438][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,438][root][WARNING] - |Q. 83||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,439][root][WARNING] - |Q. 83||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,439][root][INFO] - |Q. 83||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,440][root][WARNING] - |Q. 74||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:08:41,440][root][WARNING] - |Q. 74||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:08:41,440][root][INFO] - |Q. 74||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:08:41,441][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:08:41,446][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:08:41,446][root][INFO] - Saved parsed outputs
[2025-03-06 20:08:41,446][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:08:41,447][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:08:41,447][root][INFO] - Saved parsing metadata
[2025-03-06 20:08:41,448][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:08:41,450][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:08:41,451][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:08:41,468][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_1
[2025-03-06 20:08:41,469][root][INFO] - Summary of metrics : {'label_accuracy': 0.3939393939393939, 'misclassification_rate': 0.6060606060606061, 'combined_accuracy': 0.3434343434343434, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 39, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.18181818181818182, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.15151515151515152, 'Real_Property_confidence': 0.1414141414141414, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 5, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 20:08:52,092][root][INFO] - Setting global seed to 206
[2025-03-06 20:08:52,100][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:08:52,100][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:08:52,102][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:08:52,103][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:08:52,106][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:08:52,106][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:08:52,275][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:08:52,592][root][INFO] - Full model selected, loading model
[2025-03-06 20:09:09,981][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:10:14,902][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:10:14,902][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:10:40,103][root][INFO] - Peft model loaded successfully
[2025-03-06 20:10:46,188][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:10:46,190][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:10:46,190][root][INFO] - Starting inference
[2025-03-06 20:10:46,385][root][INFO] - Processing question number 0
[2025-03-06 20:10:46,387][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:10:50,902][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:11:02,150][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:11:14,591][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:11:23,213][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:11:32,555][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:11:38,199][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:11:49,264][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:11:58,310][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:12:14,676][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:12:23,775][root][INFO] - Processing question number 10
[2025-03-06 20:12:23,776][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:12:37,138][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:12:44,608][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:12:52,327][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:13:05,977][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:13:16,525][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:13:26,734][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:13:41,113][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:13:45,970][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:13:56,758][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:14:03,207][root][INFO] - Processing question number 20
[2025-03-06 20:14:03,209][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:14:14,352][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:14:23,312][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:14:32,313][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:14:40,279][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:14:53,833][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:15:18,929][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:15:29,132][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:15:33,727][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:15:45,152][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:15:53,696][root][INFO] - Processing question number 30
[2025-03-06 20:15:53,698][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:16:05,775][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:16:19,263][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:16:25,615][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:16:32,701][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:16:38,855][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:16:45,162][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:16:52,182][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:17:03,315][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:17:20,532][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:17:37,452][root][INFO] - Processing question number 40
[2025-03-06 20:17:37,454][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:17:45,021][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:18:00,710][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:18:12,451][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:18:30,875][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:18:37,940][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:18:49,708][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:19:07,696][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:19:12,326][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:19:18,434][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:19:28,347][root][INFO] - Processing question number 50
[2025-03-06 20:19:28,350][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:19:39,154][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:19:55,026][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:20:05,135][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:20:20,912][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:20:31,497][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:20:41,485][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:20:55,607][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:21:08,261][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:21:18,348][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:21:26,744][root][INFO] - Processing question number 60
[2025-03-06 20:21:26,747][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:21:34,601][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:21:39,994][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:21:50,660][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:21:55,562][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:22:01,092][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:22:14,480][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:22:26,483][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:22:34,693][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:22:50,614][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:23:09,252][root][INFO] - Processing question number 70
[2025-03-06 20:23:09,255][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:23:14,555][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:23:36,013][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:23:40,162][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:23:47,633][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:23:58,150][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:24:03,985][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:24:13,755][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:24:29,761][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:24:40,706][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:24:49,540][root][INFO] - Processing question number 80
[2025-03-06 20:24:49,544][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:24:55,757][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:25:04,796][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:25:10,441][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:25:23,626][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:25:28,275][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:25:35,447][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:25:47,809][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:25:53,371][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:26:03,642][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:26:11,409][root][INFO] - Processing question number 90
[2025-03-06 20:26:11,413][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:26:24,043][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:26:28,532][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:26:40,987][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:26:45,338][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:26:55,114][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:27:00,354][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:27:06,193][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:27:19,357][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:27:28,162][root][INFO] - Inference complete
[2025-03-06 20:27:28,163][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:27:28,167][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:27:28,169][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,169][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,170][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,170][root][WARNING] - |Q. 84||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,170][root][WARNING] - |Q. 84||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,170][root][INFO] - |Q. 84||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,171][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,172][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,172][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,172][root][WARNING] - |Q. 65||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,172][root][WARNING] - |Q. 65||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,173][root][INFO] - |Q. 65||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,173][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,173][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,174][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,174][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,175][root][WARNING] - |Q. 66||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,175][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,177][root][WARNING] - |Q. 5||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,177][root][WARNING] - |Q. 5||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,177][root][INFO] - |Q. 5||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,179][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,179][root][WARNING] - |Q. 33||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:28,180][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,180][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:28,180][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,180][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,180][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,181][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,181][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,181][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,181][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,181][root][WARNING] - |Q. 89||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:28,181][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,182][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:28,182][root][WARNING] - |Q. 10||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,182][root][WARNING] - |Q. 10||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,182][root][INFO] - |Q. 10||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,183][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:28,183][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:28,183][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:28,184][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:27:28,189][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:27:28,189][root][INFO] - Saved parsed outputs
[2025-03-06 20:27:28,189][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:27:28,190][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:27:28,190][root][INFO] - Saved parsing metadata
[2025-03-06 20:27:28,191][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:27:28,192][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:27:28,193][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:27:28,202][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_1
[2025-03-06 20:27:28,203][root][INFO] - Summary of metrics : {'label_accuracy': 0.36363636363636365, 'misclassification_rate': 0.6363636363636364, 'combined_accuracy': 0.32323232323232326, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 36, 'correct_label_and_domain': 32, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.18181818181818182, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.15151515151515152, 'Real_Property_confidence': 0.1414141414141414, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 55, 'correct_label_wrong_domain': 4, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 20:27:35,186][root][INFO] - Setting global seed to 206
[2025-03-06 20:27:35,191][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:27:35,191][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:27:35,193][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:27:35,194][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:27:35,196][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:27:35,196][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:27:35,344][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:27:35,673][root][INFO] - Full model selected, loading model
[2025-03-06 20:27:55,146][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:29:00,664][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:29:00,664][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:29:25,409][root][INFO] - Peft model loaded successfully
[2025-03-06 20:29:31,538][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:29:31,540][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:29:31,540][root][INFO] - Starting inference
[2025-03-06 20:29:31,779][root][INFO] - Processing question number 0
[2025-03-06 20:29:31,781][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:29:36,043][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:29:44,771][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:29:53,803][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:30:06,889][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:30:15,278][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:30:23,625][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:30:28,981][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:30:47,395][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:30:55,473][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:31:04,805][root][INFO] - Processing question number 10
[2025-03-06 20:31:04,807][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:31:12,564][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:31:22,065][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:31:32,509][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:31:36,929][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:31:44,231][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:31:57,486][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:32:10,975][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:32:20,929][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:32:36,294][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:32:44,194][root][INFO] - Processing question number 20
[2025-03-06 20:32:44,196][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:32:57,996][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:33:04,374][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:33:11,228][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:33:23,894][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:33:31,670][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:33:45,419][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:33:55,757][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:34:08,474][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:34:20,017][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:34:30,909][root][INFO] - Processing question number 30
[2025-03-06 20:34:30,912][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:34:42,182][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:34:57,347][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:35:19,878][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:35:31,537][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:35:47,066][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:35:56,832][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:36:06,044][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:36:27,339][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:36:35,719][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:36:55,238][root][INFO] - Processing question number 40
[2025-03-06 20:36:55,241][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:37:06,015][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:37:14,795][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:37:29,445][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:37:40,505][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:37:48,514][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:37:59,083][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:38:15,171][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:38:23,521][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:38:34,125][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:38:46,165][root][INFO] - Processing question number 50
[2025-03-06 20:38:46,168][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:38:57,763][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:39:13,485][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:39:18,894][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:39:28,188][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:39:43,852][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:39:52,032][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:40:04,957][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:40:27,317][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:40:36,686][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:40:45,855][root][INFO] - Processing question number 60
[2025-03-06 20:40:45,858][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:40:59,376][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:41:05,015][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:41:14,884][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:41:19,904][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:41:30,357][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:41:38,923][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:41:48,012][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:41:58,895][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:42:06,629][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:42:19,988][root][INFO] - Processing question number 70
[2025-03-06 20:42:19,992][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:42:26,466][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:42:29,762][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:42:35,151][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:42:41,166][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:42:59,383][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:43:06,014][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:43:21,630][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:43:33,205][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:43:47,296][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:43:57,610][root][INFO] - Processing question number 80
[2025-03-06 20:43:57,613][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:44:24,585][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:44:45,718][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:44:59,286][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:45:09,188][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:45:14,041][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:45:19,845][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:45:37,184][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:45:41,906][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:45:51,639][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:45:57,829][root][INFO] - Processing question number 90
[2025-03-06 20:45:57,833][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:46:11,051][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:46:17,416][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:46:25,595][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:46:31,210][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:46:36,166][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:46:45,097][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:46:53,167][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:47:02,961][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:47:10,628][root][INFO] - Inference complete
[2025-03-06 20:47:10,628][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:47:10,633][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:47:10,635][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,635][root][WARNING] - |Q. 56||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:47:10,636][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,636][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:47:10,636][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,637][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:10,637][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,637][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,637][root][WARNING] - |Q. 2||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:10,638][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,640][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,640][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:10,640][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,643][root][WARNING] - |Q. 5||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,643][root][WARNING] - |Q. 5||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:10,643][root][INFO] - |Q. 5||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,644][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,645][root][WARNING] - |Q. 68||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:10,645][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,646][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,646][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:10,646][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,646][root][WARNING] - |Q. 67||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,647][root][WARNING] - |Q. 67||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:47:10,647][root][INFO] - |Q. 67||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,647][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:47:10,647][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,648][root][WARNING] - |Q. 89||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:10,648][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,648][root][WARNING] - |Q. 10||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,648][root][WARNING] - |Q. 10||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:10,648][root][INFO] - |Q. 10||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,649][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:10,649][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:10,649][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:10,651][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:47:10,655][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:47:10,655][root][INFO] - Saved parsed outputs
[2025-03-06 20:47:10,655][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:47:10,656][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:47:10,656][root][INFO] - Saved parsing metadata
[2025-03-06 20:47:10,657][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:47:10,659][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:47:10,660][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:47:10,679][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_1
[2025-03-06 20:47:10,679][root][INFO] - Summary of metrics : {'label_accuracy': 0.3838383838383838, 'misclassification_rate': 0.6161616161616161, 'combined_accuracy': 0.3434343434343434, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 38, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.5625, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.18181818181818182, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.15151515151515152, 'Real_Property_confidence': 0.1414141414141414, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 4, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 20:47:19,463][root][INFO] - Setting global seed to 989
[2025-03-06 20:47:19,471][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:47:19,471][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:47:19,472][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:47:19,474][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:47:19,476][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:47:19,476][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:47:19,629][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:47:19,957][root][INFO] - Full model selected, loading model
[2025-03-06 20:47:38,677][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:48:43,277][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:48:43,277][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:49:08,995][root][INFO] - Peft model loaded successfully
[2025-03-06 20:49:15,253][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:49:15,255][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 20:49:15,255][root][INFO] - Starting inference
[2025-03-06 20:49:15,450][root][INFO] - Processing question number 0
[2025-03-06 20:49:15,453][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:49:19,947][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:49:30,653][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:49:38,509][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:49:46,685][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:49:54,986][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:50:00,163][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:50:05,085][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:50:21,282][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:50:34,501][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:50:47,885][root][INFO] - Processing question number 10
[2025-03-06 20:50:47,886][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:50:54,686][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:51:03,010][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:51:15,202][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:51:21,200][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:51:30,639][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:51:47,398][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:51:57,815][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:52:05,582][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:52:20,714][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:52:33,303][root][INFO] - Processing question number 20
[2025-03-06 20:52:33,305][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:52:45,421][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:52:59,178][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:53:11,533][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:53:27,306][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:53:35,050][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:53:43,889][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:53:51,042][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:53:57,257][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:54:08,354][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:54:17,553][root][INFO] - Processing question number 30
[2025-03-06 20:54:17,555][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:54:27,596][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:54:36,640][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:54:49,814][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:55:00,585][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:55:06,590][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:55:14,065][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:55:23,452][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:55:39,631][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:55:49,772][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:56:04,948][root][INFO] - Processing question number 40
[2025-03-06 20:56:04,951][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:56:16,401][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:56:23,524][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:56:50,509][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:57:17,404][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:57:26,511][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:57:38,988][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:58:04,944][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:58:12,210][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:58:23,824][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:58:35,733][root][INFO] - Processing question number 50
[2025-03-06 20:58:35,735][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:58:45,945][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:59:01,731][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:59:10,224][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:59:28,302][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:59:38,303][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:59:43,726][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:59:55,289][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:00:03,966][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:00:13,937][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:00:26,202][root][INFO] - Processing question number 60
[2025-03-06 21:00:26,205][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:00:32,333][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:00:41,052][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:00:50,852][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:00:56,969][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:01:09,468][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:01:20,574][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:01:47,358][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:01:58,543][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:02:16,217][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:02:33,042][root][INFO] - Processing question number 70
[2025-03-06 21:02:33,045][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:02:37,920][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:02:44,177][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:02:48,318][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:03:00,702][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:03:14,822][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:03:19,775][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:03:26,253][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:03:40,352][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:03:50,533][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:03:55,575][root][INFO] - Processing question number 80
[2025-03-06 21:03:55,579][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:04:11,021][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:04:23,350][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:04:36,692][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:04:47,259][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:04:51,130][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:04:59,912][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:05:08,655][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:05:16,443][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:05:26,547][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:05:33,954][root][INFO] - Processing question number 90
[2025-03-06 21:05:33,958][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:05:49,709][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:05:55,035][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:06:00,133][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:06:05,285][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:06:10,909][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:06:22,420][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:06:32,428][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:06:44,358][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:06:51,748][root][INFO] - Inference complete
[2025-03-06 21:06:51,748][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:06:51,754][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:06:51,755][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,756][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,756][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,756][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,756][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,756][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,758][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,758][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,758][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,759][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,759][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,759][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,760][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,760][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,760][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,760][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,761][root][WARNING] - |Q. 22||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,761][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,762][root][WARNING] - |Q. 88||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,762][root][WARNING] - |Q. 88||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:06:51,763][root][INFO] - |Q. 88||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,763][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:06:51,765][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,766][root][WARNING] - |Q. 59||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:06:51,766][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,766][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:06:51,767][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,767][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,767][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,767][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,768][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,768][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,768][root][WARNING] - |Q. 83||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,769][root][WARNING] - |Q. 83||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,769][root][INFO] - |Q. 83||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,770][root][WARNING] - |Q. 74||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:06:51,770][root][WARNING] - |Q. 74||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:06:51,770][root][INFO] - |Q. 74||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:06:51,771][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:06:51,775][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:06:51,776][root][INFO] - Saved parsed outputs
[2025-03-06 21:06:51,776][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:06:51,777][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:06:51,777][root][INFO] - Saved parsing metadata
[2025-03-06 21:06:51,778][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:06:51,779][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:06:51,781][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:06:51,802][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_1
[2025-03-06 21:06:51,802][root][INFO] - Summary of metrics : {'label_accuracy': 0.3939393939393939, 'misclassification_rate': 0.6060606060606061, 'combined_accuracy': 0.3434343434343434, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 39, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.18181818181818182, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.15151515151515152, 'Real_Property_confidence': 0.1414141414141414, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 5, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 21:07:06,874][root][INFO] - Setting global seed to 989
[2025-03-06 21:07:06,900][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:07:06,900][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:07:06,901][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:07:06,903][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:07:06,906][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:07:06,906][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:07:07,074][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:07:07,593][root][INFO] - Full model selected, loading model
[2025-03-06 21:07:24,105][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:08:29,825][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:08:29,826][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:08:55,444][root][INFO] - Peft model loaded successfully
[2025-03-06 21:09:01,563][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:09:01,565][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:09:01,565][root][INFO] - Starting inference
[2025-03-06 21:09:01,780][root][INFO] - Processing question number 0
[2025-03-06 21:09:01,782][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:09:08,281][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:09:18,737][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:09:26,749][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:09:37,244][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:09:41,609][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:09:47,411][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:09:52,167][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:10:09,705][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:10:35,937][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:10:46,718][root][INFO] - Processing question number 10
[2025-03-06 21:10:46,720][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:10:54,558][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:11:07,394][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:11:13,637][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:11:19,478][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:11:29,542][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:11:55,595][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:12:07,011][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:12:14,757][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:12:24,589][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:12:39,975][root][INFO] - Processing question number 20
[2025-03-06 21:12:39,977][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:12:46,662][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:13:06,838][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:13:16,071][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:13:26,766][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:13:36,633][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:13:44,554][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:13:55,259][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:14:02,200][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:14:10,142][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:14:15,379][root][INFO] - Processing question number 30
[2025-03-06 21:14:15,381][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:14:35,760][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:14:44,442][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:14:48,976][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:14:57,212][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:15:04,483][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:15:12,064][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:15:25,601][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:15:47,756][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:16:02,840][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:16:30,152][root][INFO] - Processing question number 40
[2025-03-06 21:16:30,155][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:16:40,724][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:16:46,807][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:17:13,106][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:17:18,338][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:17:27,552][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:17:34,304][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:17:53,123][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:18:04,615][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:18:17,725][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:18:26,851][root][INFO] - Processing question number 50
[2025-03-06 21:18:26,854][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:18:38,107][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:18:54,598][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:19:01,734][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:19:20,964][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:19:41,812][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:19:49,055][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:20:01,312][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:20:09,171][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:20:20,667][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:20:34,786][root][INFO] - Processing question number 60
[2025-03-06 21:20:34,790][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:20:42,145][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:20:52,266][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:21:02,355][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:21:07,718][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:21:14,897][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:21:21,574][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:21:34,373][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:21:45,792][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:21:53,913][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:22:09,988][root][INFO] - Processing question number 70
[2025-03-06 21:22:09,992][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:22:24,092][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:22:26,972][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:22:40,059][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:22:45,775][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:23:02,909][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:23:11,144][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:23:17,344][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:23:35,944][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:23:48,385][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:23:57,707][root][INFO] - Processing question number 80
[2025-03-06 21:23:57,711][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:24:07,268][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:24:15,261][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:24:21,250][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:24:34,840][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:24:41,612][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:24:50,836][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:25:03,783][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:25:11,292][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:25:21,250][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:25:39,118][root][INFO] - Processing question number 90
[2025-03-06 21:25:39,122][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:25:52,986][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:25:57,558][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:26:03,295][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:26:10,821][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:26:16,038][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:26:25,220][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:26:33,243][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:26:40,842][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:26:49,826][root][INFO] - Inference complete
[2025-03-06 21:26:49,826][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:26:49,831][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:26:49,833][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,834][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,834][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,835][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,835][root][WARNING] - |Q. 56||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:26:49,835][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,836][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:26:49,837][root][WARNING] - |Q. 98||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,837][root][WARNING] - |Q. 98||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:26:49,837][root][INFO] - |Q. 98||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,837][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:26:49,837][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,838][root][WARNING] - |Q. 2||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,838][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,838][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,839][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,839][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,839][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,839][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,839][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,840][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,840][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,840][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,841][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,841][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,841][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,842][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,843][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,843][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,843][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,844][root][WARNING] - |Q. 66||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:26:49,844][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,844][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:26:49,848][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,848][root][WARNING] - |Q. 78||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,848][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,849][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,849][root][WARNING] - |Q. 6||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,849][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,850][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,850][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,850][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,851][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,851][root][WARNING] - |Q. 89||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,851][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,853][root][WARNING] - |Q. 74||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:26:49,853][root][WARNING] - |Q. 74||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:26:49,853][root][INFO] - |Q. 74||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:26:49,854][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:26:49,859][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:26:49,859][root][INFO] - Saved parsed outputs
[2025-03-06 21:26:49,859][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:26:49,860][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:26:49,860][root][INFO] - Saved parsing metadata
[2025-03-06 21:26:49,861][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:26:49,863][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:26:49,864][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:26:49,878][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_1
[2025-03-06 21:26:49,878][root][INFO] - Summary of metrics : {'label_accuracy': 0.41414141414141414, 'misclassification_rate': 0.5858585858585859, 'combined_accuracy': 0.36363636363636365, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 41, 'correct_label_and_domain': 36, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.18181818181818182, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.15151515151515152, 'Real_Property_confidence': 0.1414141414141414, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 52, 'correct_label_wrong_domain': 5, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 21:26:57,213][root][INFO] - Setting global seed to 989
[2025-03-06 21:26:57,219][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:26:57,219][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:26:57,221][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:26:57,224][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:26:57,226][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:26:57,226][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:26:57,391][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:26:57,661][root][INFO] - Full model selected, loading model
[2025-03-06 21:27:14,690][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:28:19,574][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:28:19,574][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:28:45,166][root][INFO] - Peft model loaded successfully
[2025-03-06 21:28:51,358][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:28:51,360][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:28:51,360][root][INFO] - Starting inference
[2025-03-06 21:28:51,585][root][INFO] - Processing question number 0
[2025-03-06 21:28:51,587][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:28:55,985][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:29:07,993][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:29:16,634][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:29:25,693][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:29:30,879][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:29:37,791][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:29:48,235][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:30:04,326][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:30:15,438][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:30:33,457][root][INFO] - Processing question number 10
[2025-03-06 21:30:33,459][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:30:43,045][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:30:53,189][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:31:02,484][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:31:16,266][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:31:27,602][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:31:47,770][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:31:59,872][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:32:06,399][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:32:13,215][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:32:24,796][root][INFO] - Processing question number 20
[2025-03-06 21:32:24,798][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:32:46,838][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:32:53,764][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:33:02,954][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:33:06,632][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:33:11,349][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:33:18,171][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:33:25,774][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:33:36,888][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:33:46,196][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:33:51,924][root][INFO] - Processing question number 30
[2025-03-06 21:33:51,926][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:34:05,668][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:34:12,838][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:34:17,995][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:34:27,893][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:34:33,036][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:34:43,165][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:34:48,571][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:35:00,680][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:35:14,134][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:35:28,976][root][INFO] - Processing question number 40
[2025-03-06 21:35:28,979][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:35:39,200][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:35:44,988][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:35:55,763][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:36:21,744][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:36:29,271][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:36:39,956][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:36:56,365][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:37:06,931][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:37:13,334][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:37:19,230][root][INFO] - Processing question number 50
[2025-03-06 21:37:19,233][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:37:30,658][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:37:50,614][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:37:57,507][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:38:08,863][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:38:21,491][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:38:28,237][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:38:42,316][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:38:51,815][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:39:05,573][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:39:18,092][root][INFO] - Processing question number 60
[2025-03-06 21:39:18,095][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:39:26,077][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:39:32,890][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:39:44,790][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:39:53,266][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:40:06,999][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:40:32,110][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:40:44,943][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:41:01,848][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:41:12,394][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:41:27,827][root][INFO] - Processing question number 70
[2025-03-06 21:41:27,830][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:41:34,175][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:41:39,690][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:41:46,887][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:41:58,373][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:42:11,032][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:42:17,241][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:42:27,601][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:42:38,213][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:42:43,167][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:42:50,864][root][INFO] - Processing question number 80
[2025-03-06 21:42:50,868][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:43:00,187][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:43:09,068][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:43:16,182][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:43:31,133][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:43:39,750][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:43:47,277][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:43:57,516][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:44:04,381][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:44:31,308][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:44:38,920][root][INFO] - Processing question number 90
[2025-03-06 21:44:38,924][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:45:03,426][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:45:09,667][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:45:25,833][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:45:31,283][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:45:37,959][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:45:49,995][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:46:00,847][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:46:10,853][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:46:21,413][root][INFO] - Inference complete
[2025-03-06 21:46:21,414][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:46:21,419][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:46:21,421][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,422][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,422][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,422][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,422][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,422][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,423][root][WARNING] - |Q. 84||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,423][root][WARNING] - |Q. 84||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,423][root][INFO] - |Q. 84||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,423][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,423][root][WARNING] - |Q. 91||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,423][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,424][root][WARNING] - |Q. 9||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,424][root][WARNING] - |Q. 9||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,424][root][INFO] - |Q. 9||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,425][root][WARNING] - |Q. 29||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,425][root][WARNING] - |Q. 29||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,425][root][INFO] - |Q. 29||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,425][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,426][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,426][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,426][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,427][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:46:21,427][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,427][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:46:21,428][root][WARNING] - |Q. 38||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,428][root][WARNING] - |Q. 38||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,428][root][INFO] - |Q. 38||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,433][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,434][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,434][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,434][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,434][root][WARNING] - |Q. 89||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,435][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,435][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,435][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:46:21,436][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,436][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:46:21,437][root][WARNING] - |Q. 80||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:21,437][root][WARNING] - |Q. 80||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:21,437][root][INFO] - |Q. 80||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:21,438][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:46:21,443][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:46:21,443][root][INFO] - Saved parsed outputs
[2025-03-06 21:46:21,443][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:46:21,444][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:46:21,444][root][INFO] - Saved parsing metadata
[2025-03-06 21:46:21,445][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:46:21,446][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
[2025-03-06 21:46:21,448][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:46:21,466][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_1
[2025-03-06 21:46:21,466][root][INFO] - Summary of metrics : {'label_accuracy': 0.40404040404040403, 'misclassification_rate': 0.595959595959596, 'combined_accuracy': 0.37373737373737376, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 40, 'correct_label_and_domain': 37, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.18181818181818182, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.15151515151515152, 'Real_Property_confidence': 0.1414141414141414, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 51, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 21:46:28,621][root][INFO] - Setting global seed to 206
[2025-03-06 21:46:28,626][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 21:46:28,627][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:46:28,628][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 21:46:28,629][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:46:28,631][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:46:28,631][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 21:46:28,785][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:46:29,036][root][INFO] - Full model selected, loading model
[2025-03-06 21:46:45,169][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:47:51,086][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:47:51,086][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:48:16,646][root][INFO] - Peft model loaded successfully
[2025-03-06 21:48:22,900][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:48:22,902][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 21:48:22,902][root][INFO] - Starting inference
[2025-03-06 21:48:23,094][root][INFO] - Processing question number 0
[2025-03-06 21:48:23,097][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 21:48:27,802][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 21:48:36,814][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 21:48:44,950][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 21:48:51,404][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 21:49:03,297][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 21:49:08,782][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 21:49:16,650][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 21:49:27,062][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 21:49:34,053][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 21:49:37,588][root][INFO] - Processing question number 10
[2025-03-06 21:49:37,590][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 21:49:48,909][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 21:49:59,925][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 21:50:06,155][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 21:50:14,401][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 21:50:32,974][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 21:50:40,220][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:50:47,155][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 21:50:58,602][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 21:51:05,878][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 21:51:18,442][root][INFO] - Processing question number 20
[2025-03-06 21:51:18,444][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 21:51:23,456][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 21:51:29,709][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:51:40,383][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 21:51:48,987][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 21:51:58,267][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 21:52:06,207][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 21:52:30,354][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 21:52:41,326][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:52:47,598][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 21:52:55,141][root][INFO] - Processing question number 30
[2025-03-06 21:52:55,143][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 21:53:13,953][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 21:53:18,660][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 21:53:27,140][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 21:53:42,165][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 21:53:51,966][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 21:53:57,672][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:54:04,527][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 21:54:23,124][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:54:31,105][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 21:54:37,917][root][INFO] - Processing question number 40
[2025-03-06 21:54:37,920][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 21:54:44,551][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 21:54:53,163][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 21:55:06,776][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 21:55:14,329][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 21:55:27,381][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 21:55:33,668][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:55:51,544][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:55:58,593][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 21:56:07,239][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 21:56:23,036][root][INFO] - Processing question number 50
[2025-03-06 21:56:23,039][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 21:56:28,298][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 21:56:32,722][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 21:56:59,645][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:57:10,960][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 21:57:25,589][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 21:57:35,249][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 21:57:47,102][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 21:58:06,083][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 21:58:26,736][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 21:58:32,648][root][INFO] - Processing question number 60
[2025-03-06 21:58:32,651][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 21:58:52,294][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 21:59:00,366][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 21:59:12,339][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 21:59:21,628][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 21:59:29,057][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 21:59:41,387][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 21:59:47,704][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 21:59:59,209][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:00:12,750][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:00:22,337][root][INFO] - Processing question number 70
[2025-03-06 22:00:22,341][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:00:35,934][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:00:47,863][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:00:53,156][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:01:07,039][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:01:15,699][root][INFO] - Domain : Property, Question : 36
[2025-03-06 22:01:20,862][root][INFO] - Domain : Property, Question : 46
[2025-03-06 22:01:26,118][root][INFO] - Domain : Property, Question : 53
[2025-03-06 22:01:31,574][root][INFO] - Domain : Property, Question : 59
[2025-03-06 22:01:44,831][root][INFO] - Domain : Property, Question : 66
[2025-03-06 22:01:55,335][root][INFO] - Processing question number 80
[2025-03-06 22:01:55,339][root][INFO] - Domain : Property, Question : 69
[2025-03-06 22:02:00,978][root][INFO] - Domain : Property, Question : 81
[2025-03-06 22:02:07,434][root][INFO] - Domain : Property, Question : 88
[2025-03-06 22:02:16,965][root][INFO] - Domain : Property, Question : 91
[2025-03-06 22:02:33,305][root][INFO] - Domain : Property, Question : 94
[2025-03-06 22:02:39,547][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:02:44,361][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:03:00,205][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 22:03:13,060][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 22:03:20,120][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:03:32,618][root][INFO] - Processing question number 90
[2025-03-06 22:03:32,622][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 22:03:39,307][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 22:03:54,385][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:04:00,008][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 22:04:11,749][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 22:04:21,371][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 22:04:37,005][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 22:04:44,411][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 22:04:56,781][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 22:05:04,693][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:05:12,245][root][INFO] - Inference complete
[2025-03-06 22:05:12,245][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:05:12,253][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:05:12,254][root][WARNING] - |Q. 56||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,255][root][WARNING] - |Q. 56||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,255][root][INFO] - |Q. 56||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,256][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,257][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,257][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,257][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,257][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,257][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,258][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,258][root][WARNING] - |Q. 7||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,258][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,259][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,259][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,259][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,261][root][WARNING] - |Q. 60||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,261][root][WARNING] - |Q. 60||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:05:12,261][root][INFO] - |Q. 60||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,262][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:05:12,262][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,262][root][WARNING] - |Q. 98||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,262][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,263][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,264][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,264][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,264][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,264][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,264][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,265][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,265][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,265][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,265][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,265][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,265][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,266][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,266][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,266][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,268][root][WARNING] - |Q. 67||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:05:12,268][root][WARNING] - |Q. 67||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:05:12,268][root][INFO] - |Q. 67||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:05:12,270][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:05:12,274][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:05:12,274][root][INFO] - Saved parsed outputs
[2025-03-06 22:05:12,274][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:05:12,276][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:05:12,276][root][INFO] - Saved parsing metadata
[2025-03-06 22:05:12,277][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:05:12,279][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:05:12,280][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 22:05:12,316][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_2
[2025-03-06 22:05:12,316][root][INFO] - Summary of metrics : {'label_accuracy': 0.34, 'misclassification_rate': 0.6599999999999999, 'combined_accuracy': 0.31, 'malformed_label': 0, 'malformed_domain': 14, 'total_predictions': 100, 'correct_predictions': 34, 'correct_label_and_domain': 31, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.15, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 55, 'correct_label_wrong_domain': 3, 'both_wrong': 11}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 22:05:22,618][root][INFO] - Setting global seed to 206
[2025-03-06 22:05:22,626][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:05:22,626][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:05:22,627][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:05:22,628][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:05:22,631][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:05:22,631][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:05:22,794][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:05:23,049][root][INFO] - Full model selected, loading model
[2025-03-06 22:05:39,723][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:06:43,194][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:06:43,195][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:07:09,781][root][INFO] - Peft model loaded successfully
[2025-03-06 22:07:15,882][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:07:15,884][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:07:15,884][root][INFO] - Starting inference
[2025-03-06 22:07:16,090][root][INFO] - Processing question number 0
[2025-03-06 22:07:16,093][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:07:20,874][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:07:29,941][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:07:43,783][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:07:54,711][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:08:00,373][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:08:14,311][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:08:20,053][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:08:25,007][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:08:32,669][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:08:39,129][root][INFO] - Processing question number 10
[2025-03-06 22:08:39,130][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:08:53,125][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:09:06,982][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:09:12,085][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:09:17,708][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:09:31,413][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:09:39,468][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:09:48,824][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:09:58,552][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:10:05,110][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:10:17,677][root][INFO] - Processing question number 20
[2025-03-06 22:10:17,679][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:10:25,781][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:10:29,441][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:10:45,117][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:10:52,059][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:11:04,911][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:11:14,999][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:11:34,853][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:11:45,818][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:11:54,530][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:12:00,368][root][INFO] - Processing question number 30
[2025-03-06 22:12:00,371][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:12:13,230][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:12:21,704][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:12:28,694][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:12:42,333][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:12:49,586][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:12:54,571][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:13:07,451][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:13:22,281][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:13:27,395][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:13:46,267][root][INFO] - Processing question number 40
[2025-03-06 22:13:46,270][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:13:59,337][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:14:05,603][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:14:17,326][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:14:24,687][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:14:40,418][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:14:57,120][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:15:09,967][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:15:20,793][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:15:36,039][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:15:43,118][root][INFO] - Processing question number 50
[2025-03-06 22:15:43,121][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:15:55,144][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:15:59,596][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:16:13,888][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:16:32,969][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:16:52,505][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:17:04,240][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:17:12,783][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:17:37,843][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 22:17:46,762][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 22:17:52,715][root][INFO] - Processing question number 60
[2025-03-06 22:17:52,718][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 22:18:06,224][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 22:18:13,878][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 22:18:23,406][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 22:18:32,931][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 22:18:40,452][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 22:18:51,839][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 22:18:58,155][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 22:19:03,957][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:19:30,040][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:19:39,012][root][INFO] - Processing question number 70
[2025-03-06 22:19:39,015][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:19:49,072][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:20:02,743][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:20:14,359][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:20:23,280][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:20:37,695][root][INFO] - Domain : Property, Question : 36
[2025-03-06 22:20:45,530][root][INFO] - Domain : Property, Question : 46
[2025-03-06 22:20:50,774][root][INFO] - Domain : Property, Question : 53
[2025-03-06 22:20:56,606][root][INFO] - Domain : Property, Question : 59
[2025-03-06 22:21:05,469][root][INFO] - Domain : Property, Question : 66
[2025-03-06 22:21:11,152][root][INFO] - Processing question number 80
[2025-03-06 22:21:11,157][root][INFO] - Domain : Property, Question : 69
[2025-03-06 22:21:16,837][root][INFO] - Domain : Property, Question : 81
[2025-03-06 22:21:24,244][root][INFO] - Domain : Property, Question : 88
[2025-03-06 22:21:34,627][root][INFO] - Domain : Property, Question : 91
[2025-03-06 22:21:56,794][root][INFO] - Domain : Property, Question : 94
[2025-03-06 22:22:07,718][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:22:14,232][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:22:32,986][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 22:22:54,219][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 22:23:02,006][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:23:18,573][root][INFO] - Processing question number 90
[2025-03-06 22:23:18,577][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 22:23:25,354][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 22:23:36,635][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:23:46,451][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 22:24:00,757][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 22:24:08,951][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 22:24:16,394][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 22:24:24,964][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 22:24:36,803][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 22:24:44,689][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:24:52,430][root][INFO] - Inference complete
[2025-03-06 22:24:52,430][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:24:52,436][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:24:52,438][root][WARNING] - |Q. 56||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,439][root][WARNING] - |Q. 56||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,439][root][INFO] - |Q. 56||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,439][root][WARNING] - |Q. 70||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,439][root][WARNING] - |Q. 70||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,439][root][INFO] - |Q. 70||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,441][root][WARNING] - |Q. 24||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,442][root][WARNING] - |Q. 24||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,442][root][INFO] - |Q. 24||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,442][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,443][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,443][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,443][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,443][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,443][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,444][root][WARNING] - |Q. 10||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,444][root][WARNING] - |Q. 10||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,444][root][INFO] - |Q. 10||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,446][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,446][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,447][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,447][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,447][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,447][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,448][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,448][root][WARNING] - |Q. 75||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:24:52,448][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,449][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:24:52,449][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,449][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,449][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,450][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,450][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,450][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,451][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:24:52,452][root][WARNING] - |Q. 32||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:24:52,452][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:24:52,454][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:24:52,459][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:24:52,459][root][INFO] - Saved parsed outputs
[2025-03-06 22:24:52,459][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:24:52,460][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:24:52,460][root][INFO] - Saved parsing metadata
[2025-03-06 22:24:52,461][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:24:52,462][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:24:52,465][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 22:24:52,483][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_2
[2025-03-06 22:24:52,483][root][INFO] - Summary of metrics : {'label_accuracy': 0.33, 'misclassification_rate': 0.6699999999999999, 'combined_accuracy': 0.3, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 33, 'correct_label_and_domain': 30, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.18, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.15, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.12, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 3, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 22:25:00,933][root][INFO] - Setting global seed to 206
[2025-03-06 22:25:00,940][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:25:00,941][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:25:00,942][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:25:00,944][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:25:00,946][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:25:00,946][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:25:01,145][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:25:01,661][root][INFO] - Full model selected, loading model
[2025-03-06 22:25:19,007][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:26:23,170][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:26:23,170][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:26:48,169][root][INFO] - Peft model loaded successfully
[2025-03-06 22:26:54,303][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:26:54,306][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:26:54,306][root][INFO] - Starting inference
[2025-03-06 22:26:54,512][root][INFO] - Processing question number 0
[2025-03-06 22:26:54,515][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:26:59,310][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:27:10,576][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:27:15,044][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:27:30,377][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:27:37,664][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:27:50,705][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:27:56,394][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:28:02,090][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:28:12,715][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:28:21,072][root][INFO] - Processing question number 10
[2025-03-06 22:28:21,074][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:28:33,540][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:28:45,811][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:28:53,180][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:29:05,154][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:29:14,930][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:29:20,328][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:29:25,796][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:29:38,806][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:29:48,015][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:29:57,339][root][INFO] - Processing question number 20
[2025-03-06 22:29:57,341][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:30:03,075][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:30:08,401][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:30:24,316][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:30:31,089][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:30:42,226][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:30:50,679][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:31:01,489][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:31:06,443][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:31:14,390][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:31:22,885][root][INFO] - Processing question number 30
[2025-03-06 22:31:22,887][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:31:31,319][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:31:40,029][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:31:47,085][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:31:56,819][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:32:10,644][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:32:18,013][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:32:35,555][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:33:00,922][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:33:09,807][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:33:17,292][root][INFO] - Processing question number 40
[2025-03-06 22:33:17,295][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:33:25,154][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:33:30,957][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:33:42,229][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:33:52,285][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:34:05,903][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:34:17,242][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:34:30,263][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:34:45,307][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:34:54,291][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:35:05,751][root][INFO] - Processing question number 50
[2025-03-06 22:35:05,754][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:35:12,198][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:35:17,730][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:35:44,801][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:35:53,770][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:36:09,584][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:36:35,965][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:37:00,673][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:37:27,635][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 22:37:48,676][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 22:38:00,159][root][INFO] - Processing question number 60
[2025-03-06 22:38:00,163][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 22:38:14,307][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 22:38:20,513][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 22:38:34,320][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 22:38:44,912][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 22:38:52,080][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 22:39:03,236][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 22:39:12,972][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 22:39:22,881][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:39:43,202][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:39:53,141][root][INFO] - Processing question number 70
[2025-03-06 22:39:53,144][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:40:05,012][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:40:24,638][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:40:29,712][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:40:37,924][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:40:44,712][root][INFO] - Domain : Property, Question : 36
[2025-03-06 22:40:49,820][root][INFO] - Domain : Property, Question : 46
[2025-03-06 22:40:53,977][root][INFO] - Domain : Property, Question : 53
[2025-03-06 22:40:59,593][root][INFO] - Domain : Property, Question : 59
[2025-03-06 22:41:05,504][root][INFO] - Domain : Property, Question : 66
[2025-03-06 22:41:14,785][root][INFO] - Processing question number 80
[2025-03-06 22:41:14,789][root][INFO] - Domain : Property, Question : 69
[2025-03-06 22:41:22,826][root][INFO] - Domain : Property, Question : 81
[2025-03-06 22:41:29,283][root][INFO] - Domain : Property, Question : 88
[2025-03-06 22:41:44,658][root][INFO] - Domain : Property, Question : 91
[2025-03-06 22:41:53,000][root][INFO] - Domain : Property, Question : 94
[2025-03-06 22:42:00,949][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:42:06,751][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:42:31,146][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 22:42:47,437][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 22:42:55,435][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:43:11,456][root][INFO] - Processing question number 90
[2025-03-06 22:43:11,460][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 22:43:19,337][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 22:43:35,129][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:43:43,179][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 22:43:52,999][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 22:44:04,661][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 22:44:17,081][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 22:44:33,808][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 22:44:41,248][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 22:44:53,217][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:45:02,876][root][INFO] - Inference complete
[2025-03-06 22:45:02,876][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:45:02,881][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:45:02,882][root][WARNING] - |Q. 6||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,882][root][WARNING] - |Q. 6||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,882][root][INFO] - |Q. 6||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,882][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,883][root][WARNING] - |Q. 20||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:45:02,883][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,883][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:45:02,884][root][WARNING] - |Q. 56||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,884][root][WARNING] - |Q. 56||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,884][root][INFO] - |Q. 56||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,884][root][WARNING] - |Q. 70||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,885][root][WARNING] - |Q. 70||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,885][root][INFO] - |Q. 70||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,886][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,886][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,886][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,887][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,887][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,887][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,889][root][WARNING] - |Q. 10||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,889][root][WARNING] - |Q. 10||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,889][root][INFO] - |Q. 10||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,890][root][WARNING] - |Q. 60||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,890][root][WARNING] - |Q. 60||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:45:02,890][root][INFO] - |Q. 60||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,890][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:45:02,891][root][WARNING] - |Q. 80||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,891][root][WARNING] - |Q. 80||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,891][root][INFO] - |Q. 80||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,891][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,892][root][WARNING] - |Q. 85||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:45:02,892][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,892][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:45:02,892][root][WARNING] - |Q. 90||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,892][root][WARNING] - |Q. 90||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,892][root][INFO] - |Q. 90||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,893][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,893][root][WARNING] - |Q. 98||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:45:02,893][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,893][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:45:02,893][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,893][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,893][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,894][root][WARNING] - |Q. 33||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,894][root][WARNING] - |Q. 33||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,894][root][INFO] - |Q. 33||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,895][root][WARNING] - |Q. 68||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,895][root][WARNING] - |Q. 68||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,895][root][INFO] - |Q. 68||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,895][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,895][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,896][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,896][root][WARNING] - |Q. 9||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,896][root][WARNING] - |Q. 9||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,896][root][INFO] - |Q. 9||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,897][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,897][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,897][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,899][root][WARNING] - |Q. 67||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:45:02,899][root][WARNING] - |Q. 67||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:45:02,899][root][INFO] - |Q. 67||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:45:02,901][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:45:02,905][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:45:02,905][root][INFO] - Saved parsed outputs
[2025-03-06 22:45:02,905][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:45:02,907][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:45:02,907][root][INFO] - Saved parsing metadata
[2025-03-06 22:45:02,908][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:45:02,910][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:45:02,912][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 22:45:02,930][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_2
[2025-03-06 22:45:02,930][root][INFO] - Summary of metrics : {'label_accuracy': 0.35, 'misclassification_rate': 0.65, 'combined_accuracy': 0.33, 'malformed_label': 0, 'malformed_domain': 13, 'total_predictions': 100, 'correct_predictions': 35, 'correct_label_and_domain': 33, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.0, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.15, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.12, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 2, 'both_wrong': 11}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 22:45:10,843][root][INFO] - Setting global seed to 989
[2025-03-06 22:45:10,850][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:45:10,851][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:45:10,852][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:45:10,853][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:45:10,855][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:45:10,856][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:45:11,016][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:45:11,268][root][INFO] - Full model selected, loading model
[2025-03-06 22:45:26,732][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:46:31,287][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:46:31,288][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:46:57,108][root][INFO] - Peft model loaded successfully
[2025-03-06 22:47:03,279][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:47:03,281][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 22:47:03,281][root][INFO] - Starting inference
[2025-03-06 22:47:03,499][root][INFO] - Processing question number 0
[2025-03-06 22:47:03,502][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:47:07,871][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:47:16,884][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:47:24,977][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:47:31,399][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:47:43,268][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:47:48,740][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:47:56,577][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:48:06,981][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:48:13,942][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:48:17,457][root][INFO] - Processing question number 10
[2025-03-06 22:48:17,458][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:48:28,793][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:48:39,866][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:48:46,105][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:48:54,352][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:49:12,845][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:49:20,088][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:49:27,023][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:49:38,475][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:49:45,749][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:49:58,313][root][INFO] - Processing question number 20
[2025-03-06 22:49:58,316][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:50:03,329][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:50:09,578][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:50:20,246][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:50:28,849][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:50:38,125][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:50:46,060][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:51:10,201][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:51:21,173][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:51:27,445][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:51:34,986][root][INFO] - Processing question number 30
[2025-03-06 22:51:34,988][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:51:53,794][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:51:58,497][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:52:06,970][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:52:21,991][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:52:31,790][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:52:37,491][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:52:44,344][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:53:02,949][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:53:10,932][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:53:17,741][root][INFO] - Processing question number 40
[2025-03-06 22:53:17,744][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:53:24,371][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:53:32,979][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:53:46,586][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:53:54,137][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:54:07,183][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:54:13,471][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:54:31,346][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:54:38,396][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:54:47,033][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:55:02,827][root][INFO] - Processing question number 50
[2025-03-06 22:55:02,830][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:55:08,089][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:55:12,508][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:55:39,425][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:55:50,747][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:56:05,372][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:56:15,027][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:56:26,877][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:56:45,850][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 22:57:06,493][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 22:57:12,405][root][INFO] - Processing question number 60
[2025-03-06 22:57:12,408][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 22:57:32,042][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 22:57:40,109][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 22:57:52,075][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 22:58:01,363][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 22:58:08,788][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 22:58:21,147][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 22:58:27,525][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 22:58:39,112][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:58:52,763][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:59:02,428][root][INFO] - Processing question number 70
[2025-03-06 22:59:02,431][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:59:16,133][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:59:28,155][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:59:33,457][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:59:47,383][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:59:56,115][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:00:01,318][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:00:06,612][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:00:12,106][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:00:25,451][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:00:35,962][root][INFO] - Processing question number 80
[2025-03-06 23:00:35,965][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:00:41,622][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:00:48,110][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:00:57,717][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:01:14,182][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:01:20,439][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:01:25,250][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:01:41,089][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:01:53,952][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:02:01,006][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:02:13,502][root][INFO] - Processing question number 90
[2025-03-06 23:02:13,506][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:02:20,189][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:02:35,262][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:02:40,884][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:02:52,617][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:03:02,233][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:03:17,855][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:03:25,262][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:03:37,615][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:03:45,523][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:03:53,094][root][INFO] - Inference complete
[2025-03-06 23:03:53,094][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:03:53,100][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:03:53,102][root][WARNING] - |Q. 56||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,102][root][WARNING] - |Q. 56||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,102][root][INFO] - |Q. 56||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,104][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,104][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,104][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,104][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,105][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,105][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,105][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,105][root][WARNING] - |Q. 7||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,105][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,106][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,106][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,106][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,108][root][WARNING] - |Q. 60||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,108][root][WARNING] - |Q. 60||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:03:53,109][root][INFO] - |Q. 60||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,109][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:03:53,109][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,110][root][WARNING] - |Q. 98||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,110][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,111][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,111][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,111][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,111][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,111][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,111][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,112][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,112][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,112][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,112][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,113][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,113][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,113][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,113][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,113][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,115][root][WARNING] - |Q. 67||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:03:53,116][root][WARNING] - |Q. 67||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:03:53,116][root][INFO] - |Q. 67||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:03:53,117][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:03:53,121][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:03:53,121][root][INFO] - Saved parsed outputs
[2025-03-06 23:03:53,121][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:03:53,123][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:03:53,123][root][INFO] - Saved parsing metadata
[2025-03-06 23:03:53,123][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:03:53,125][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:03:53,126][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:03:53,151][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_2
[2025-03-06 23:03:53,151][root][INFO] - Summary of metrics : {'label_accuracy': 0.34, 'misclassification_rate': 0.6599999999999999, 'combined_accuracy': 0.31, 'malformed_label': 0, 'malformed_domain': 14, 'total_predictions': 100, 'correct_predictions': 34, 'correct_label_and_domain': 31, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.15, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 55, 'correct_label_wrong_domain': 3, 'both_wrong': 11}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 23:04:01,209][root][INFO] - Setting global seed to 989
[2025-03-06 23:04:01,215][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:04:01,215][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:04:01,217][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:04:01,218][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:04:01,221][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:04:01,221][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:04:01,414][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:04:02,109][root][INFO] - Full model selected, loading model
[2025-03-06 23:04:16,509][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:05:20,582][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:05:20,583][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:05:45,077][root][INFO] - Peft model loaded successfully
[2025-03-06 23:05:51,197][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:05:51,199][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:05:51,199][root][INFO] - Starting inference
[2025-03-06 23:05:51,373][root][INFO] - Processing question number 0
[2025-03-06 23:05:51,375][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:05:55,609][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:06:04,188][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:06:10,531][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:06:26,114][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:06:34,363][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:06:39,985][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:06:45,051][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:06:57,927][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:07:08,534][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:07:14,437][root][INFO] - Processing question number 10
[2025-03-06 23:07:14,439][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:07:18,590][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:07:27,484][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:07:32,075][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:07:39,991][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:07:54,090][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:07:59,704][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:08:26,258][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:08:36,700][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:08:44,862][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:08:56,113][root][INFO] - Processing question number 20
[2025-03-06 23:08:56,115][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:09:05,510][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:09:11,468][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:09:28,463][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:09:40,001][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:09:51,878][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:10:02,902][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:10:14,324][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:10:27,859][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:10:35,900][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:10:45,399][root][INFO] - Processing question number 30
[2025-03-06 23:10:45,402][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:10:59,638][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:11:03,960][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:11:12,535][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:11:22,875][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:11:30,848][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:11:36,388][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:11:44,793][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:12:01,956][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:12:08,386][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:12:12,624][root][INFO] - Processing question number 40
[2025-03-06 23:12:12,626][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:12:18,755][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:12:25,197][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:12:36,827][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:12:44,493][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:12:57,149][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:13:06,927][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:13:11,395][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:13:17,820][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:13:32,605][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:13:48,403][root][INFO] - Processing question number 50
[2025-03-06 23:13:48,406][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:13:55,507][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:13:59,993][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:14:12,424][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:14:19,185][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:14:30,132][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:14:55,845][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:15:08,445][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:15:25,673][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:15:51,253][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:15:58,538][root][INFO] - Processing question number 60
[2025-03-06 23:15:58,542][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:16:13,473][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:16:24,516][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:16:39,028][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:16:48,883][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:16:56,583][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:17:05,859][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:17:12,895][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:17:21,509][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:17:35,241][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:17:45,700][root][INFO] - Processing question number 70
[2025-03-06 23:17:45,704][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:17:55,532][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:18:03,246][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:18:19,309][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:18:29,356][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:18:37,294][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:18:41,091][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:18:50,631][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:18:58,263][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:19:05,977][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:19:13,302][root][INFO] - Processing question number 80
[2025-03-06 23:19:13,305][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:19:20,539][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:19:33,077][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:19:48,124][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:19:57,748][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:20:04,337][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:20:13,324][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:20:22,948][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:20:33,614][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:20:41,459][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:20:51,387][root][INFO] - Processing question number 90
[2025-03-06 23:20:51,391][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:20:56,770][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:21:08,761][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:21:18,668][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:21:29,054][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:21:47,088][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:22:04,685][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:22:31,752][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:22:44,911][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:22:54,168][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:23:00,791][root][INFO] - Inference complete
[2025-03-06 23:23:00,791][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:23:00,796][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:23:00,798][root][WARNING] - |Q. 56||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,799][root][WARNING] - |Q. 56||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,799][root][INFO] - |Q. 56||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,800][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,800][root][WARNING] - |Q. 15||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:23:00,801][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,801][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:23:00,802][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,802][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,802][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,803][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,804][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,804][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,804][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,804][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,804][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,806][root][WARNING] - |Q. 60||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,806][root][WARNING] - |Q. 60||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,806][root][INFO] - |Q. 60||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,807][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,807][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,807][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,809][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,809][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,809][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,809][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,809][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,809][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,810][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,810][root][WARNING] - |Q. 53||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,810][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,811][root][WARNING] - |Q. 45||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,812][root][WARNING] - |Q. 45||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,812][root][INFO] - |Q. 45||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,812][root][WARNING] - |Q. 67||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,812][root][WARNING] - |Q. 67||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:23:00,813][root][INFO] - |Q. 67||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,813][root][WARNING] - |Q. 74||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:23:00,813][root][WARNING] - |Q. 74||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:23:00,813][root][INFO] - |Q. 74||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:23:00,813][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:23:00,815][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:23:00,818][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:23:00,819][root][INFO] - Saved parsed outputs
[2025-03-06 23:23:00,819][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:23:00,820][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:23:00,820][root][INFO] - Saved parsing metadata
[2025-03-06 23:23:00,820][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:23:00,822][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:23:00,823][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:23:00,849][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_2
[2025-03-06 23:23:00,849][root][INFO] - Summary of metrics : {'label_accuracy': 0.33, 'misclassification_rate': 0.6699999999999999, 'combined_accuracy': 0.3, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 33, 'correct_label_and_domain': 30, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.18, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.15, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.12, 'correct_domain_wrong_label': 58, 'correct_label_wrong_domain': 3, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 23 to status running with exit code None
Eval status update completed for job 23
[2025-03-06 23:23:10,434][root][INFO] - Setting global seed to 989
[2025-03-06 23:23:10,442][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:23:10,442][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:23:10,444][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:23:10,445][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:23:10,448][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:23:10,448][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:23:10,610][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:23:10,920][root][INFO] - Full model selected, loading model
[2025-03-06 23:23:27,177][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:24:32,051][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:24:32,052][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:24:57,550][root][INFO] - Peft model loaded successfully
[2025-03-06 23:25:03,654][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:25:03,655][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:25:03,655][root][INFO] - Starting inference
[2025-03-06 23:25:03,881][root][INFO] - Processing question number 0
[2025-03-06 23:25:03,883][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:25:09,799][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:25:33,014][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:25:41,050][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:25:51,642][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:26:01,500][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:26:10,334][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:26:20,512][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:26:34,487][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:26:43,292][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:26:47,185][root][INFO] - Processing question number 10
[2025-03-06 23:26:47,187][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:26:50,758][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:27:00,440][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:27:04,703][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:27:11,889][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:27:24,365][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:27:31,203][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:27:38,537][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:27:46,042][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:27:58,445][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:28:13,009][root][INFO] - Processing question number 20
[2025-03-06 23:28:13,011][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:28:17,214][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:28:21,471][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:28:34,361][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:28:43,192][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:28:53,919][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:29:01,606][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:29:22,087][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:29:33,789][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:29:39,522][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:29:49,979][root][INFO] - Processing question number 30
[2025-03-06 23:29:49,982][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:29:58,593][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:30:06,048][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:30:10,986][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:30:22,354][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:30:31,457][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:30:40,283][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:30:54,270][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:31:05,637][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:31:13,510][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:31:23,839][root][INFO] - Processing question number 40
[2025-03-06 23:31:23,841][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:31:29,930][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:31:39,883][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:31:51,258][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:31:59,656][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:32:09,093][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:32:15,641][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:32:29,533][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:32:40,622][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:33:05,899][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:33:18,306][root][INFO] - Processing question number 50
[2025-03-06 23:33:18,309][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:33:30,074][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:33:36,355][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:33:52,667][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:34:01,539][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:34:12,442][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:34:21,376][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:34:30,685][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:34:53,310][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:35:13,092][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:35:21,975][root][INFO] - Processing question number 60
[2025-03-06 23:35:21,978][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:35:30,573][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:35:45,919][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:35:59,618][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:36:07,728][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:36:16,891][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:36:27,529][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:36:37,258][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:36:42,642][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:36:51,274][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:37:01,045][root][INFO] - Processing question number 70
[2025-03-06 23:37:01,049][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:37:13,246][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:37:24,165][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:37:28,640][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:37:45,860][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:38:08,471][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:38:14,713][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:38:22,767][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:38:28,302][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:38:32,783][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:38:37,718][root][INFO] - Processing question number 80
[2025-03-06 23:38:37,722][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:38:44,615][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:38:56,300][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:39:11,945][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:39:24,653][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:39:32,099][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:39:39,942][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:40:07,131][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:40:19,297][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:40:35,556][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:40:53,807][root][INFO] - Processing question number 90
[2025-03-06 23:40:53,811][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:40:58,778][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:41:21,916][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:41:30,177][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:41:40,187][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:41:55,655][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:42:08,108][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:42:19,206][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:42:27,565][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:42:35,901][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:42:42,500][root][INFO] - Inference complete
[2025-03-06 23:42:42,501][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:42:42,506][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:42:42,508][root][WARNING] - |Q. 6||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,508][root][WARNING] - |Q. 6||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,508][root][INFO] - |Q. 6||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,509][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,509][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,509][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,511][root][WARNING] - |Q. 76||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,511][root][WARNING] - |Q. 76||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,512][root][INFO] - |Q. 76||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,512][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,512][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,512][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,513][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,513][root][WARNING] - |Q. 7||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,513][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,514][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,514][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,514][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,516][root][WARNING] - |Q. 50||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,516][root][WARNING] - |Q. 50||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,516][root][INFO] - |Q. 50||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,517][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,517][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,517][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,518][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,518][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,519][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,519][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,519][root][WARNING] - |Q. 75||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:42:42,519][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,520][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:42:42,520][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,521][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:42:42,521][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,522][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:42:42,522][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:42:42,522][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:42:42,522][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:42:42,525][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:42:42,529][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:42:42,529][root][INFO] - Saved parsed outputs
[2025-03-06 23:42:42,529][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:42:42,530][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:42:42,531][root][INFO] - Saved parsing metadata
[2025-03-06 23:42:42,531][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:42:42,533][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
[2025-03-06 23:42:42,534][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_zero_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:42:42,645][root][INFO] - Evaluation completed for json_answer_first_zero_shot_unstructured, on test_set_2
[2025-03-06 23:42:42,646][root][INFO] - Summary of metrics : {'label_accuracy': 0.3, 'misclassification_rate': 0.7, 'combined_accuracy': 0.28, 'malformed_label': 0, 'malformed_domain': 13, 'total_predictions': 100, 'correct_predictions': 30, 'correct_label_and_domain': 28, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.18, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.15, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 59, 'correct_label_wrong_domain': 2, 'both_wrong': 11}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '23', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_zero_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 23 to status completed with exit code 0
Eval status update completed for job 23
Job 23 completed at Thu Mar  6 23:42:48 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n516
Job ID: 25358398
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 04:37:17
CPU Efficiency: 9.89% of 1-22:43:50 core-walltime
Job Wall-clock time: 04:40:23
Memory Utilized: 28.14 GB
Memory Efficiency: 78.17% of 36.00 GB
