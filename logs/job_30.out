Starting job 30 at Thu Mar  6 20:29:15 CET 2025
Configuration: model=llama3 tokenizer=llama3 dataset=all_domains_10_samples prompt=json_fact_first_zero_shot_structured train=json_fact_first_zero_shot_structured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '30', 'training']
Updating job 30 to status training with exit code None
Status update completed for job 30
[2025-03-06 20:29:21,988][root][INFO] - Global seed set to 314
[2025-03-06 20:29:21,989][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 20:29:21,990][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 20:29:21,990][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 20:29:21,990][root][INFO] - Current training config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 20:29:21,990][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/distilled_dataset.json
[2025-03-06 20:29:22,005][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:29:22,010][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 20:29:22,010][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 20:29:22,014][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 20:29:22,782][root][INFO] - Tokenizer meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 20:29:47,241][root][INFO] - Quantised model meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 20:30:14,285][root][INFO] - Model prepared for kbit training
[2025-03-06 20:30:14,286][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'k_proj', 'up_proj', 'gate_proj', 'v_proj', 'o_proj', 'q_proj', 'down_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 20:30:15,928][root][INFO] - Lora adapter added to model
[2025-03-06 20:30:15,931][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_fact_first_zero_shot_structured
[2025-03-06 20:30:16,176][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.7773, 'grad_norm': 0.5458003282546997, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.7229, 'grad_norm': 0.5898870825767517, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.5865, 'grad_norm': 0.3838472068309784, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.4032, 'grad_norm': 0.42596375942230225, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.272, 'grad_norm': 0.3472818434238434, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.9986, 'grad_norm': 0.40913522243499756, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.9687, 'grad_norm': 0.25754231214523315, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.8674, 'grad_norm': 0.3496938645839691, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.9448, 'grad_norm': 0.2719156742095947, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.8232, 'grad_norm': 0.2976677119731903, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.8611, 'grad_norm': 0.284891277551651, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.7724, 'grad_norm': 0.342115193605423, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.7866, 'grad_norm': 0.32043781876564026, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.7168, 'grad_norm': 0.33934226632118225, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.7256, 'grad_norm': 0.3486872911453247, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.6348, 'grad_norm': 0.37804678082466125, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.6526, 'grad_norm': 0.3704898953437805, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.5367, 'grad_norm': 0.3957219123840332, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.611, 'grad_norm': 0.5113623142242432, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.5603, 'grad_norm': 0.39787983894348145, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.5197, 'grad_norm': 0.4193989634513855, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.4432, 'grad_norm': 0.4547284245491028, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.5342, 'grad_norm': 0.5016228556632996, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.455, 'grad_norm': 0.46302664279937744, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.482, 'grad_norm': 0.4639520049095154, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.4328, 'grad_norm': 0.4751679301261902, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.437, 'grad_norm': 0.5189483761787415, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.471, 'grad_norm': 0.4814423620700836, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.449, 'grad_norm': 0.7489433288574219, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.3304, 'grad_norm': 0.7239226698875427, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.2554, 'grad_norm': 1.0964207649230957, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.2971, 'grad_norm': 0.7857205271720886, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.2858, 'grad_norm': 1.340146541595459, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.1487, 'grad_norm': 0.5845927000045776, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.1796, 'grad_norm': 0.913669764995575, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.1505, 'grad_norm': 0.9055840373039246, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.1535, 'grad_norm': 0.7185181975364685, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.0626, 'grad_norm': 0.8039226531982422, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.1162, 'grad_norm': 0.965133786201477, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.0807, 'grad_norm': 0.47167855501174927, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.0666, 'grad_norm': 0.551543116569519, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.0437, 'grad_norm': 0.9120916128158569, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.0478, 'grad_norm': 0.9691340923309326, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.0356, 'grad_norm': 0.4298268258571625, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.0241, 'grad_norm': 0.22779706120491028, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.0287, 'grad_norm': 0.25392985343933105, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0254, 'grad_norm': 0.24340598285198212, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.019, 'grad_norm': 0.15206791460514069, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0233, 'grad_norm': 0.26910102367401123, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0232, 'grad_norm': 0.1444890946149826, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 2840.7417, 'train_samples_per_second': 0.37, 'train_steps_per_second': 0.053, 'train_loss': 0.516895573263367, 'epoch': 15.0}
[2025-03-06 21:17:44,345][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_fact_first_zero_shot_structured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '30', 'trained', '0']
Updating job 30 to status trained with exit code 0
Status update completed for job 30
Starting evaluations for job 30
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-06 21:17:55,327][root][INFO] - Setting global seed to 206
[2025-03-06 21:17:55,333][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:17:55,333][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:17:55,335][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:17:55,337][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:17:55,340][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:17:55,340][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:17:55,487][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:17:56,017][root][INFO] - Full model selected, loading model
[2025-03-06 21:18:20,008][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:20:02,821][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:20:02,823][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:20:34,237][root][INFO] - Peft model loaded successfully
[2025-03-06 21:20:41,422][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:20:41,424][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:20:41,424][root][INFO] - Starting inference
[2025-03-06 21:20:41,593][root][INFO] - Processing question number 0
[2025-03-06 21:20:41,595][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:20:51,599][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:21:05,955][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:21:20,508][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:21:34,851][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:21:47,302][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:22:01,080][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:22:16,111][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:22:28,466][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:22:42,801][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:22:54,422][root][INFO] - Processing question number 10
[2025-03-06 21:22:54,423][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:23:08,316][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:23:18,997][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:23:32,483][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:23:43,040][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:23:53,938][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:24:08,171][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:24:19,634][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:24:30,229][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:24:41,491][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:24:52,881][root][INFO] - Processing question number 20
[2025-03-06 21:24:52,883][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:25:03,415][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:25:16,215][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:25:28,015][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:25:40,965][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:25:53,506][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:26:04,283][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:26:14,888][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:26:26,460][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:26:38,322][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:26:51,948][root][INFO] - Processing question number 30
[2025-03-06 21:26:51,950][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:27:03,770][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:27:15,859][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:27:26,951][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:27:39,025][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:27:50,990][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:28:03,504][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:28:15,575][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:28:27,351][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:28:40,889][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:28:55,155][root][INFO] - Processing question number 40
[2025-03-06 21:28:55,158][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:29:08,436][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:29:23,119][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:29:34,842][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:29:46,666][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:29:58,444][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:30:10,414][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:30:24,117][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:30:35,872][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:30:48,291][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:30:58,064][root][INFO] - Processing question number 50
[2025-03-06 21:30:58,067][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:31:09,993][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:31:22,445][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:31:34,083][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:31:48,679][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:32:02,138][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:32:11,922][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:32:25,358][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:32:35,330][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:32:46,906][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:32:56,257][root][INFO] - Processing question number 60
[2025-03-06 21:32:56,260][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:33:06,658][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:33:17,514][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:33:27,576][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:33:39,213][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:33:51,179][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:34:01,650][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:34:13,413][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:34:25,212][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:34:36,289][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:34:49,046][root][INFO] - Processing question number 70
[2025-03-06 21:34:49,050][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:35:01,061][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:35:15,401][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:35:26,577][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:35:39,758][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:35:51,250][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:36:03,117][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:36:18,775][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:36:30,063][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:36:44,219][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:36:54,447][root][INFO] - Processing question number 80
[2025-03-06 21:36:54,467][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:37:07,821][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:37:24,116][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:37:34,725][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:37:46,738][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:38:01,726][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:38:16,838][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:38:30,138][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:38:40,212][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:38:52,543][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:39:02,146][root][INFO] - Processing question number 90
[2025-03-06 21:39:02,150][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:39:15,966][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:39:25,823][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:39:38,596][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:39:49,043][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:40:01,416][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:40:13,494][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:40:24,894][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:40:37,719][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:40:54,258][root][INFO] - Inference complete
[2025-03-06 21:40:54,258][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,264][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,276][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,281][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,281][root][INFO] - Saved parsed outputs
[2025-03-06 21:40:54,281][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,282][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,282][root][INFO] - Saved parsing metadata
[2025-03-06 21:40:54,283][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,308][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,309][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:40:54,427][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 21:40:54,427][root][INFO] - Summary of metrics : {'label_accuracy': 0.5656565656565656, 'misclassification_rate': 0.43434343434343436, 'combined_accuracy': 0.5353535353535354, 'malformed_label': 0, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 56, 'correct_label_and_domain': 53, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.6923076923076923, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 40, 'correct_label_wrong_domain': 3, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-06 21:41:24,562][root][INFO] - Setting global seed to 206
[2025-03-06 21:41:24,574][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:41:24,574][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:41:24,575][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:41:24,578][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:41:24,583][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:41:24,583][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:41:24,752][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:41:25,342][root][INFO] - Full model selected, loading model
[2025-03-06 21:41:49,617][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:43:31,145][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:43:31,146][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:44:04,711][root][INFO] - Peft model loaded successfully
[2025-03-06 21:44:12,500][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:44:12,502][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:12,502][root][INFO] - Starting inference
[2025-03-06 21:44:12,671][root][INFO] - Processing question number 0
[2025-03-06 21:44:12,674][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:44:23,986][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:44:37,088][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:44:50,832][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:45:06,180][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:45:18,787][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:45:32,336][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:45:48,067][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:46:01,166][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:46:12,988][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:46:24,105][root][INFO] - Processing question number 10
[2025-03-06 21:46:24,107][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:46:37,193][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:46:48,392][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:47:02,004][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:47:12,658][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:47:25,356][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:47:37,536][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:47:49,112][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:48:00,788][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:48:13,182][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:48:24,675][root][INFO] - Processing question number 20
[2025-03-06 21:48:24,678][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:48:36,524][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:48:48,218][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:48:59,906][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:49:11,401][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:49:23,308][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:49:34,236][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:49:44,936][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:49:56,668][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:50:08,829][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:50:22,588][root][INFO] - Processing question number 30
[2025-03-06 21:50:22,591][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:50:34,198][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:50:46,300][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:51:00,040][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:51:12,791][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:51:25,432][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:51:37,777][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:51:48,752][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:52:00,638][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:52:13,222][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:52:26,380][root][INFO] - Processing question number 40
[2025-03-06 21:52:26,382][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:52:39,785][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:52:54,367][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:53:06,149][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:53:17,893][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:53:29,690][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:53:41,583][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:53:55,409][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:54:06,911][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:54:19,539][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:54:29,308][root][INFO] - Processing question number 50
[2025-03-06 21:54:29,311][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:54:41,345][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:54:53,773][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:55:05,152][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:55:18,721][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:55:32,307][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:55:41,776][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:55:54,093][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:56:03,892][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:56:15,905][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:56:25,819][root][INFO] - Processing question number 60
[2025-03-06 21:56:25,822][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:56:37,294][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:56:48,534][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:57:01,656][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:57:13,498][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:57:24,544][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:57:37,080][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:57:49,419][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:58:01,188][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:58:12,368][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:58:23,447][root][INFO] - Processing question number 70
[2025-03-06 21:58:23,450][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:58:34,598][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:58:48,744][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:59:00,079][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:59:16,053][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:59:29,820][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:59:41,425][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:59:59,157][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:00:12,765][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:00:27,719][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:00:40,173][root][INFO] - Processing question number 80
[2025-03-06 22:00:40,177][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:00:53,211][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:01:07,901][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:01:18,231][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:01:29,930][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:01:44,665][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:01:59,906][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:02:13,360][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:02:24,854][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:02:36,747][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:02:47,405][root][INFO] - Processing question number 90
[2025-03-06 22:02:47,410][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:03:01,215][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:03:11,223][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:03:23,659][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:03:33,944][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:03:47,729][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:04:00,738][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:04:12,494][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:04:24,323][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:04:38,092][root][INFO] - Inference complete
[2025-03-06 22:04:38,092][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:04:38,097][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:04:38,109][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:04:38,114][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:04:38,114][root][INFO] - Saved parsed outputs
[2025-03-06 22:04:38,114][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:04:38,116][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:04:38,116][root][INFO] - Saved parsing metadata
[2025-03-06 22:04:38,116][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:04:38,118][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:04:38,119][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:04:38,132][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 22:04:38,132][root][INFO] - Summary of metrics : {'label_accuracy': 0.5454545454545454, 'misclassification_rate': 0.4545454545454546, 'combined_accuracy': 0.5252525252525253, 'malformed_label': 1, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 54, 'correct_label_and_domain': 52, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.5333333333333333, 'Real_Property_accuracy': 0.6428571428571429, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 41, 'correct_label_wrong_domain': 2, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-06 22:04:44,791][root][INFO] - Setting global seed to 206
[2025-03-06 22:04:44,796][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:04:44,796][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:04:44,797][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:04:44,799][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:04:44,801][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:04:44,801][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:04:44,964][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:04:45,525][root][INFO] - Full model selected, loading model
[2025-03-06 22:05:10,813][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:06:52,205][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:06:52,206][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:07:25,032][root][INFO] - Peft model loaded successfully
[2025-03-06 22:07:32,194][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:07:32,195][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:07:32,195][root][INFO] - Starting inference
[2025-03-06 22:07:32,362][root][INFO] - Processing question number 0
[2025-03-06 22:07:32,364][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:07:44,627][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:07:59,315][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:08:13,037][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:08:28,759][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:08:42,051][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:08:56,483][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:09:10,663][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:09:23,374][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:09:35,003][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:09:48,865][root][INFO] - Processing question number 10
[2025-03-06 22:09:48,866][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:10:01,809][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:10:16,546][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:10:28,790][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:10:39,854][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:10:52,669][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:11:04,882][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:11:15,614][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:11:27,116][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:11:40,180][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:11:51,811][root][INFO] - Processing question number 20
[2025-03-06 22:11:51,813][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:12:03,582][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:12:16,189][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:12:26,731][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:12:37,312][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:12:48,426][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:13:01,091][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:13:11,856][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:13:23,174][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:13:33,749][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:13:47,891][root][INFO] - Processing question number 30
[2025-03-06 22:13:47,893][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:13:59,187][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:14:11,580][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:14:27,185][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:14:38,629][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:14:50,573][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:15:03,541][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:15:15,561][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:15:28,445][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:15:41,223][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:15:55,158][root][INFO] - Processing question number 40
[2025-03-06 22:15:55,160][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:16:07,675][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:16:20,334][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:16:32,691][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:16:45,719][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:16:58,560][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:17:09,850][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:17:22,814][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:17:36,359][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:17:49,137][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:17:58,955][root][INFO] - Processing question number 50
[2025-03-06 22:17:58,958][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:18:11,475][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:18:25,897][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:18:38,303][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:18:50,491][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:19:01,262][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:19:13,902][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:19:26,893][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:19:37,718][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:19:50,068][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:20:02,525][root][INFO] - Processing question number 60
[2025-03-06 22:20:02,528][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:20:13,311][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:20:24,330][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:20:36,472][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:20:48,041][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:21:00,221][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:21:12,401][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:21:23,811][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:21:35,352][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:21:45,748][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:21:59,106][root][INFO] - Processing question number 70
[2025-03-06 22:21:59,109][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:22:10,779][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:22:22,961][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:22:35,564][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:22:49,254][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:23:05,612][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:23:17,599][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:23:34,084][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:23:45,105][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:23:56,408][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:24:07,206][root][INFO] - Processing question number 80
[2025-03-06 22:24:07,210][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:24:19,562][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:24:37,909][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:24:48,068][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:24:59,655][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:25:13,162][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:25:25,747][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:25:36,487][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:25:48,023][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:26:01,189][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:26:10,573][root][INFO] - Processing question number 90
[2025-03-06 22:26:10,580][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:26:26,135][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:26:35,776][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:26:48,588][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:26:58,916][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:27:11,981][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:27:24,614][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:27:38,755][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:27:52,196][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:28:05,532][root][INFO] - Inference complete
[2025-03-06 22:28:05,532][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:28:05,538][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:28:05,550][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:28:05,555][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:28:05,555][root][INFO] - Saved parsed outputs
[2025-03-06 22:28:05,556][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:28:05,557][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:28:05,557][root][INFO] - Saved parsing metadata
[2025-03-06 22:28:05,558][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:28:05,560][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:28:05,561][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:28:05,632][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 22:28:05,632][root][INFO] - Summary of metrics : {'label_accuracy': 0.5050505050505051, 'misclassification_rate': 0.4949494949494949, 'combined_accuracy': 0.45454545454545453, 'malformed_label': 0, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 50, 'correct_label_and_domain': 45, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.5333333333333333, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 48, 'correct_label_wrong_domain': 5, 'both_wrong': 1}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-06 22:28:15,874][root][INFO] - Setting global seed to 989
[2025-03-06 22:28:15,881][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:28:15,881][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:28:15,882][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:28:15,884][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:28:15,887][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:28:15,887][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:28:16,044][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:28:16,812][root][INFO] - Full model selected, loading model
[2025-03-06 22:28:42,916][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:30:25,511][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:30:25,512][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:30:59,078][root][INFO] - Peft model loaded successfully
[2025-03-06 22:31:06,652][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:31:06,655][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:31:06,655][root][INFO] - Starting inference
[2025-03-06 22:31:06,849][root][INFO] - Processing question number 0
[2025-03-06 22:31:06,851][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:31:17,747][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:31:32,120][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:31:46,701][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:32:01,056][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:32:13,521][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:32:27,328][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:32:42,372][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:32:54,754][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:33:09,101][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:33:20,737][root][INFO] - Processing question number 10
[2025-03-06 22:33:20,739][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:33:34,648][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:33:45,344][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:33:58,844][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:34:09,419][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:34:20,337][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:34:34,584][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:34:46,065][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:34:56,676][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:35:07,968][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:35:19,372][root][INFO] - Processing question number 20
[2025-03-06 22:35:19,374][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:35:29,922][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:35:42,750][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:35:54,598][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:36:07,605][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:36:20,183][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:36:30,977][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:36:41,619][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:36:53,223][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:37:05,118][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:37:18,794][root][INFO] - Processing question number 30
[2025-03-06 22:37:18,796][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:37:30,653][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:37:42,755][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:37:53,870][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:38:05,958][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:38:17,938][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:38:30,467][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:38:42,585][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:38:54,374][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:39:07,927][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:39:22,223][root][INFO] - Processing question number 40
[2025-03-06 22:39:22,226][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:39:35,514][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:39:50,225][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:40:01,960][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:40:13,797][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:40:25,589][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:40:37,576][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:40:51,291][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:41:03,062][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:41:15,496][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:41:25,281][root][INFO] - Processing question number 50
[2025-03-06 22:41:25,284][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:41:37,233][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:41:49,699][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:42:01,351][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:42:15,975][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:42:29,449][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:42:39,247][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:42:52,698][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:43:02,685][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:43:14,288][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:43:23,649][root][INFO] - Processing question number 60
[2025-03-06 22:43:23,653][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:43:34,065][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:43:44,936][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:43:55,015][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:44:06,666][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:44:18,649][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:44:29,133][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:44:40,918][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:44:52,740][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:45:03,831][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:45:16,601][root][INFO] - Processing question number 70
[2025-03-06 22:45:16,604][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:45:28,633][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:45:43,001][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:45:54,190][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:46:07,383][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:46:18,898][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:46:30,787][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:46:46,453][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:46:57,763][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:47:11,933][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:47:22,177][root][INFO] - Processing question number 80
[2025-03-06 22:47:22,181][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:47:35,546][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:47:51,876][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:48:02,500][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:48:14,529][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:48:29,548][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:48:44,673][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:48:58,001][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:49:08,091][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:49:20,437][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:49:30,052][root][INFO] - Processing question number 90
[2025-03-06 22:49:30,056][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:49:43,892][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:49:53,765][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:50:06,565][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:50:17,028][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:50:29,414][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:50:41,508][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:50:52,936][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:51:05,782][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:51:22,327][root][INFO] - Inference complete
[2025-03-06 22:51:22,327][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:51:22,333][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:51:22,345][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:51:22,351][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:51:22,351][root][INFO] - Saved parsed outputs
[2025-03-06 22:51:22,351][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:51:22,352][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:51:22,352][root][INFO] - Saved parsing metadata
[2025-03-06 22:51:22,353][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:51:22,355][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:51:22,357][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:51:22,383][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 22:51:22,383][root][INFO] - Summary of metrics : {'label_accuracy': 0.5656565656565656, 'misclassification_rate': 0.43434343434343436, 'combined_accuracy': 0.5353535353535354, 'malformed_label': 0, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 56, 'correct_label_and_domain': 53, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.6923076923076923, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 40, 'correct_label_wrong_domain': 3, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-06 22:51:29,050][root][INFO] - Setting global seed to 989
[2025-03-06 22:51:29,055][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:51:29,055][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:51:29,056][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:51:29,058][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:51:29,060][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:51:29,060][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:51:29,212][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:51:29,805][root][INFO] - Full model selected, loading model
[2025-03-06 22:51:55,596][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:53:38,098][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:53:38,098][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:54:11,973][root][INFO] - Peft model loaded successfully
[2025-03-06 22:54:19,161][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:54:19,163][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 22:54:19,163][root][INFO] - Starting inference
[2025-03-06 22:54:19,345][root][INFO] - Processing question number 0
[2025-03-06 22:54:19,348][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:54:30,560][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:54:45,488][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:54:58,826][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:55:13,438][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:55:26,015][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:55:38,891][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:55:53,008][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:56:05,391][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:56:18,416][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:56:30,713][root][INFO] - Processing question number 10
[2025-03-06 22:56:30,714][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:56:44,732][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:56:57,326][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:57:12,598][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:57:23,682][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:57:35,390][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:57:49,439][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:58:01,019][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:58:12,789][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:58:25,563][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:58:38,837][root][INFO] - Processing question number 20
[2025-03-06 22:58:38,839][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:58:49,848][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:59:01,312][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:59:11,626][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:59:22,157][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:59:35,626][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:59:46,560][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:59:58,502][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 23:00:10,420][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 23:00:23,009][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 23:00:37,191][root][INFO] - Processing question number 30
[2025-03-06 23:00:37,193][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:00:51,199][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 23:01:04,345][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 23:01:18,923][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 23:01:30,254][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 23:01:42,784][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 23:01:54,240][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 23:02:05,620][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 23:02:17,529][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:02:29,604][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 23:02:41,550][root][INFO] - Processing question number 40
[2025-03-06 23:02:41,552][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:02:54,183][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 23:03:09,480][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 23:03:24,372][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 23:03:36,550][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 23:03:48,348][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:04:00,382][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 23:04:14,166][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:04:27,190][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 23:04:38,415][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 23:04:48,552][root][INFO] - Processing question number 50
[2025-03-06 23:04:48,555][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:05:00,204][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 23:05:14,584][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 23:05:26,341][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 23:05:40,879][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 23:05:52,465][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:06:02,993][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 23:06:16,555][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 23:06:27,141][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 23:06:40,345][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 23:06:54,821][root][INFO] - Processing question number 60
[2025-03-06 23:06:54,824][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:07:07,416][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:07:18,618][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 23:07:30,377][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 23:07:41,852][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 23:07:53,891][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 23:08:04,237][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 23:08:17,333][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 23:08:30,566][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:08:41,752][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 23:08:56,288][root][INFO] - Processing question number 70
[2025-03-06 23:08:56,292][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 23:09:07,400][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 23:09:20,562][root][INFO] - Domain : Property, Question : 6
[2025-03-06 23:09:33,352][root][INFO] - Domain : Property, Question : 13
[2025-03-06 23:09:48,176][root][INFO] - Domain : Property, Question : 20
[2025-03-06 23:09:59,403][root][INFO] - Domain : Property, Question : 33
[2025-03-06 23:10:10,694][root][INFO] - Domain : Property, Question : 39
[2025-03-06 23:10:24,965][root][INFO] - Domain : Property, Question : 48
[2025-03-06 23:10:36,226][root][INFO] - Domain : Property, Question : 54
[2025-03-06 23:10:50,517][root][INFO] - Domain : Property, Question : 61
[2025-03-06 23:11:02,250][root][INFO] - Processing question number 80
[2025-03-06 23:11:02,254][root][INFO] - Domain : Property, Question : 67
[2025-03-06 23:11:15,267][root][INFO] - Domain : Property, Question : 75
[2025-03-06 23:11:31,213][root][INFO] - Domain : Property, Question : 83
[2025-03-06 23:11:41,698][root][INFO] - Domain : Property, Question : 89
[2025-03-06 23:11:52,231][root][INFO] - Domain : Property, Question : 97
[2025-03-06 23:12:06,705][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:12:21,911][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 23:12:34,635][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:12:47,327][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 23:12:59,785][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 23:13:08,573][root][INFO] - Processing question number 90
[2025-03-06 23:13:08,577][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 23:13:23,631][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 23:13:36,617][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 23:13:49,190][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 23:13:59,469][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:14:12,914][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 23:14:25,115][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 23:14:36,864][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 23:14:49,204][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 23:15:05,840][root][INFO] - Inference complete
[2025-03-06 23:15:05,840][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:15:05,845][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:15:05,857][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:15:05,862][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:15:05,862][root][INFO] - Saved parsed outputs
[2025-03-06 23:15:05,862][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:15:05,864][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:15:05,864][root][INFO] - Saved parsing metadata
[2025-03-06 23:15:05,864][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:15:05,866][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:15:05,879][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 23:15:05,913][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 23:15:05,913][root][INFO] - Summary of metrics : {'label_accuracy': 0.5050505050505051, 'misclassification_rate': 0.4949494949494949, 'combined_accuracy': 0.48484848484848486, 'malformed_label': 0, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 50, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.5384615384615384, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 2, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-06 23:15:13,908][root][INFO] - Setting global seed to 989
[2025-03-06 23:15:13,913][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 23:15:13,913][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 23:15:13,915][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 23:15:13,917][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:15:13,944][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:15:13,944][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 23:15:14,100][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 23:15:14,793][root][INFO] - Full model selected, loading model
[2025-03-06 23:15:41,685][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:17:23,816][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:17:23,816][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:17:57,106][root][INFO] - Peft model loaded successfully
[2025-03-06 23:18:04,419][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:18:04,421][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:18:04,421][root][INFO] - Starting inference
[2025-03-06 23:18:04,603][root][INFO] - Processing question number 0
[2025-03-06 23:18:04,605][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 23:18:14,357][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 23:18:29,830][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 23:18:43,315][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 23:18:57,943][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 23:19:13,392][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 23:19:26,374][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 23:19:42,146][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 23:19:54,350][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 23:20:05,410][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 23:20:16,674][root][INFO] - Processing question number 10
[2025-03-06 23:20:16,676][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 23:20:29,051][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 23:20:42,543][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 23:20:55,705][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 23:21:06,884][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 23:21:19,644][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 23:21:33,566][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 23:21:44,367][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 23:21:54,546][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 23:22:09,656][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 23:22:21,443][root][INFO] - Processing question number 20
[2025-03-06 23:22:21,445][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 23:22:32,173][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 23:22:43,031][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 23:22:54,459][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 23:23:05,508][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 23:23:16,960][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 23:23:27,901][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 23:23:40,716][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 23:23:52,928][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 23:24:04,392][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 23:24:14,440][root][INFO] - Processing question number 30
[2025-03-06 23:24:14,442][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:24:26,297][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 23:24:38,740][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 23:24:53,920][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 23:25:06,453][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 23:25:20,424][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 23:25:35,323][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 23:25:46,030][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 23:25:58,780][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:26:10,572][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 23:26:24,369][root][INFO] - Processing question number 40
[2025-03-06 23:26:24,372][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:26:36,380][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 23:26:49,698][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 23:27:02,300][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 23:27:14,293][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 23:27:26,137][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:27:37,797][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 23:27:51,234][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:28:02,537][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 23:28:14,588][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 23:28:25,476][root][INFO] - Processing question number 50
[2025-03-06 23:28:25,479][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:28:38,205][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 23:28:51,432][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 23:29:05,326][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 23:29:17,428][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 23:29:30,463][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:29:41,091][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 23:29:54,953][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 23:30:05,130][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 23:30:16,499][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 23:30:26,808][root][INFO] - Processing question number 60
[2025-03-06 23:30:26,811][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:30:40,348][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:30:50,621][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 23:31:02,673][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 23:31:14,807][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 23:31:28,172][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 23:31:42,469][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 23:31:53,652][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 23:32:04,822][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:32:16,393][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 23:32:31,042][root][INFO] - Processing question number 70
[2025-03-06 23:32:31,046][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 23:32:42,396][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 23:32:59,692][root][INFO] - Domain : Property, Question : 6
[2025-03-06 23:33:09,977][root][INFO] - Domain : Property, Question : 13
[2025-03-06 23:33:24,448][root][INFO] - Domain : Property, Question : 20
[2025-03-06 23:33:37,389][root][INFO] - Domain : Property, Question : 33
[2025-03-06 23:33:49,349][root][INFO] - Domain : Property, Question : 39
[2025-03-06 23:34:02,109][root][INFO] - Domain : Property, Question : 48
[2025-03-06 23:34:14,562][root][INFO] - Domain : Property, Question : 54
[2025-03-06 23:34:29,546][root][INFO] - Domain : Property, Question : 61
[2025-03-06 23:34:45,830][root][INFO] - Processing question number 80
[2025-03-06 23:34:45,834][root][INFO] - Domain : Property, Question : 67
[2025-03-06 23:34:56,505][root][INFO] - Domain : Property, Question : 75
[2025-03-06 23:35:11,889][root][INFO] - Domain : Property, Question : 83
[2025-03-06 23:35:22,709][root][INFO] - Domain : Property, Question : 89
[2025-03-06 23:35:34,674][root][INFO] - Domain : Property, Question : 97
[2025-03-06 23:35:49,495][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:36:04,109][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 23:36:15,762][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:36:27,402][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 23:36:40,864][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 23:36:56,399][root][INFO] - Processing question number 90
[2025-03-06 23:36:56,404][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 23:37:10,627][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 23:37:20,875][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 23:37:35,345][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 23:37:47,315][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:38:00,608][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 23:38:15,841][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 23:38:26,789][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 23:38:40,112][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 23:38:53,340][root][INFO] - Inference complete
[2025-03-06 23:38:53,341][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:38:53,345][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:38:53,357][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:38:53,371][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:38:53,371][root][INFO] - Saved parsed outputs
[2025-03-06 23:38:53,371][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:38:53,373][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:38:53,373][root][INFO] - Saved parsing metadata
[2025-03-06 23:38:53,373][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:38:53,375][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 23:38:53,388][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 23:38:53,401][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 23:38:53,401][root][INFO] - Summary of metrics : {'label_accuracy': 0.5858585858585859, 'misclassification_rate': 0.41414141414141414, 'combined_accuracy': 0.5555555555555556, 'malformed_label': 0, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 58, 'correct_label_and_domain': 55, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.5714285714285714, 'Criminal_Law_accuracy': 0.8461538461538461, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 38, 'correct_label_wrong_domain': 3, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-06 23:39:00,462][root][INFO] - Setting global seed to 206
[2025-03-06 23:39:00,467][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:39:00,468][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 23:39:00,469][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:39:00,471][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:39:00,473][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:39:00,473][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:39:00,649][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 23:39:01,237][root][INFO] - Full model selected, loading model
[2025-03-06 23:39:26,113][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:41:07,128][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:41:07,129][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:41:39,221][root][INFO] - Peft model loaded successfully
[2025-03-06 23:41:46,442][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:41:46,444][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-06 23:41:46,444][root][INFO] - Starting inference
[2025-03-06 23:41:46,626][root][INFO] - Processing question number 0
[2025-03-06 23:41:46,627][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:41:59,152][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:42:12,342][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:42:25,195][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:42:37,933][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:42:50,291][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:43:00,956][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:43:14,798][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:43:26,375][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:43:36,917][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:43:49,007][root][INFO] - Processing question number 10
[2025-03-06 23:43:49,009][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:43:58,178][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:44:07,890][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:44:19,902][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:44:30,927][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:44:45,722][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:44:57,202][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:45:10,755][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:45:22,213][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:45:33,847][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:45:46,745][root][INFO] - Processing question number 20
[2025-03-06 23:45:46,747][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:46:00,709][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:46:16,698][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:46:29,301][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:46:40,067][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:46:52,596][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:47:05,551][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:47:17,956][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:47:27,883][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:47:41,404][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:47:53,866][root][INFO] - Processing question number 30
[2025-03-06 23:47:53,869][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:48:03,113][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:48:13,705][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:48:23,710][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:48:34,471][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:48:48,708][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:49:01,882][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:49:13,908][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:49:24,429][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:49:34,866][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:49:46,247][root][INFO] - Processing question number 40
[2025-03-06 23:49:46,250][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:49:57,794][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:50:10,179][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:50:24,866][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:50:34,139][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:50:48,667][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:51:00,121][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:51:10,118][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:51:24,139][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:51:37,319][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:51:48,916][root][INFO] - Processing question number 50
[2025-03-06 23:51:48,919][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:52:03,503][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:52:15,288][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:52:28,622][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:52:41,312][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:52:51,888][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:53:03,733][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:53:17,848][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:53:29,814][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:53:44,209][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:53:58,114][root][INFO] - Processing question number 60
[2025-03-06 23:53:58,118][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:54:09,189][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:54:24,097][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:54:38,502][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:54:52,544][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:55:06,905][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:55:17,775][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:55:29,939][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:55:40,371][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:55:51,169][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:56:03,002][root][INFO] - Processing question number 70
[2025-03-06 23:56:03,006][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:56:16,686][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:56:28,339][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:56:42,957][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:56:54,404][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:57:04,618][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:57:20,026][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:57:34,118][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:57:49,329][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:58:02,651][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:58:12,597][root][INFO] - Processing question number 80
[2025-03-06 23:58:12,601][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:58:24,965][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:58:40,231][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:58:54,510][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:59:05,147][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:59:21,943][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:59:35,380][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:59:49,682][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:00:04,709][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:00:16,224][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:00:28,377][root][INFO] - Processing question number 90
[2025-03-07 00:00:28,381][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:00:42,333][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:00:58,117][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:01:11,296][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:01:22,135][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:01:33,813][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:01:46,447][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:01:59,245][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:02:10,614][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:02:20,170][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:02:32,901][root][INFO] - Inference complete
[2025-03-07 00:02:32,901][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:02:32,907][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:02:32,915][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:02:32,916][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:02:32,916][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:02:32,920][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:02:32,925][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:02:32,925][root][INFO] - Saved parsed outputs
[2025-03-07 00:02:32,925][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:02:32,926][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:02:32,926][root][INFO] - Saved parsing metadata
[2025-03-07 00:02:32,927][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:02:32,928][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:02:32,929][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:02:32,942][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 00:02:32,942][root][INFO] - Summary of metrics : {'label_accuracy': 0.48, 'misclassification_rate': 0.52, 'combined_accuracy': 0.41, 'malformed_label': 1, 'malformed_domain': 9, 'total_predictions': 100, 'correct_predictions': 48, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.4666666666666667, 'Torts_accuracy': 0.6428571428571429, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.13, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 50, 'correct_label_wrong_domain': 7, 'both_wrong': 2}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-07 00:02:39,518][root][INFO] - Setting global seed to 206
[2025-03-07 00:02:39,523][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:02:39,523][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 00:02:39,524][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:02:39,526][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:02:39,528][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:02:39,528][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:02:39,703][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-07 00:02:40,270][root][INFO] - Full model selected, loading model
[2025-03-07 00:03:02,090][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:04:42,645][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:04:42,661][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:05:15,786][root][INFO] - Peft model loaded successfully
[2025-03-07 00:05:23,031][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:05:23,033][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:05:23,033][root][INFO] - Starting inference
[2025-03-07 00:05:23,222][root][INFO] - Processing question number 0
[2025-03-07 00:05:23,224][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:05:35,428][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:05:47,341][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:06:00,740][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:06:13,784][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:06:27,241][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:06:38,420][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:06:52,990][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:07:03,969][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:07:14,609][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:07:24,610][root][INFO] - Processing question number 10
[2025-03-07 00:07:24,612][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:07:35,968][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:07:49,224][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:08:02,979][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:08:12,683][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:08:23,129][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:08:35,278][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:08:48,664][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:09:00,369][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:09:12,245][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:09:25,780][root][INFO] - Processing question number 20
[2025-03-07 00:09:25,783][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:09:40,147][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:09:53,098][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:10:03,018][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:10:13,278][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:10:25,446][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:10:38,376][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:10:50,093][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:11:00,436][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:11:16,478][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:11:29,677][root][INFO] - Processing question number 30
[2025-03-07 00:11:29,679][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:11:39,559][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:11:49,828][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:12:00,568][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:12:11,423][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:12:25,644][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:12:38,551][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:12:50,078][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:13:03,335][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:13:13,626][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:13:25,482][root][INFO] - Processing question number 40
[2025-03-07 00:13:25,485][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:13:37,124][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:13:47,246][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:14:02,493][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:14:13,452][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:14:27,959][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:14:39,744][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:14:51,644][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:15:04,227][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:15:17,187][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:15:30,211][root][INFO] - Processing question number 50
[2025-03-07 00:15:30,214][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:15:42,535][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:15:54,568][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:16:06,741][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:16:19,354][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:16:30,019][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:16:44,209][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:16:56,483][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:17:08,581][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:17:23,506][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:17:37,992][root][INFO] - Processing question number 60
[2025-03-07 00:17:37,996][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:17:48,575][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:18:04,463][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:18:19,044][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:18:34,756][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:18:48,154][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:19:02,067][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:19:12,483][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:19:23,397][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:19:33,803][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:19:45,692][root][INFO] - Processing question number 70
[2025-03-07 00:19:45,696][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:19:59,617][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:20:11,333][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:20:26,124][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:20:39,655][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:20:50,907][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:21:06,398][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:21:21,251][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:21:35,540][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:21:48,015][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:21:58,332][root][INFO] - Processing question number 80
[2025-03-07 00:21:58,335][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:22:09,387][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:22:21,390][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:22:34,982][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:22:47,260][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:22:59,367][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:23:12,175][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:23:23,928][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:23:38,658][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:23:48,868][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:24:01,647][root][INFO] - Processing question number 90
[2025-03-07 00:24:01,651][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:24:14,981][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:24:31,386][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:24:43,161][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:24:54,048][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:25:05,923][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:25:18,956][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:25:35,389][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:25:46,538][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:25:56,181][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:26:08,552][root][INFO] - Inference complete
[2025-03-07 00:26:08,553][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:26:08,558][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:26:08,566][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:26:08,567][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:26:08,567][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:26:08,571][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:26:08,575][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:26:08,575][root][INFO] - Saved parsed outputs
[2025-03-07 00:26:08,575][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:26:08,577][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:26:08,577][root][INFO] - Saved parsing metadata
[2025-03-07 00:26:08,577][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:26:08,579][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:26:08,580][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:26:08,601][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 00:26:08,601][root][INFO] - Summary of metrics : {'label_accuracy': 0.55, 'misclassification_rate': 0.44999999999999996, 'combined_accuracy': 0.48, 'malformed_label': 1, 'malformed_domain': 9, 'total_predictions': 100, 'correct_predictions': 55, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 7, 'both_wrong': 2}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-07 00:26:15,914][root][INFO] - Setting global seed to 206
[2025-03-07 00:26:15,921][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:26:15,921][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 00:26:15,922][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:26:15,924][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:26:15,927][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:26:15,927][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:26:16,079][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-07 00:26:16,655][root][INFO] - Full model selected, loading model
[2025-03-07 00:26:43,572][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:28:24,851][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:28:24,851][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:28:58,811][root][INFO] - Peft model loaded successfully
[2025-03-07 00:29:06,042][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:29:06,043][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:29:06,043][root][INFO] - Starting inference
[2025-03-07 00:29:06,232][root][INFO] - Processing question number 0
[2025-03-07 00:29:06,234][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:29:19,875][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:29:33,232][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:29:44,926][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:29:56,601][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:30:06,109][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:30:18,768][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:30:30,583][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:30:43,395][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:30:53,763][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:31:06,110][root][INFO] - Processing question number 10
[2025-03-07 00:31:06,112][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:31:16,144][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:31:30,295][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:31:44,816][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:31:56,455][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:32:08,828][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:32:21,880][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:32:33,720][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:32:45,472][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:32:56,891][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:33:10,336][root][INFO] - Processing question number 20
[2025-03-07 00:33:10,338][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:33:24,295][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:33:34,330][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:33:47,467][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:33:59,836][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:34:12,105][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:34:24,658][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:34:35,771][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:34:45,934][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:34:59,815][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:35:13,645][root][INFO] - Processing question number 30
[2025-03-07 00:35:13,647][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:35:23,257][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:35:33,578][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:35:46,993][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:35:58,420][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:36:11,280][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:36:24,104][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:36:38,266][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:36:50,294][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:37:01,383][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:37:13,440][root][INFO] - Processing question number 40
[2025-03-07 00:37:13,443][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:37:24,151][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:37:36,324][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:37:50,720][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:38:00,305][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:38:14,333][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:38:27,021][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:38:37,108][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:38:47,073][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:39:02,351][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:39:13,773][root][INFO] - Processing question number 50
[2025-03-07 00:39:13,776][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:39:26,811][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:39:39,452][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:39:51,296][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:40:04,524][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:40:15,701][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:40:28,257][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:40:39,169][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:40:49,487][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:41:00,538][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:41:13,563][root][INFO] - Processing question number 60
[2025-03-07 00:41:13,566][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:41:24,992][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:41:38,234][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:41:55,000][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:42:09,484][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:42:22,311][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:42:36,286][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:42:49,914][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:42:59,987][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:43:10,838][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:43:22,698][root][INFO] - Processing question number 70
[2025-03-07 00:43:22,701][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:43:33,440][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:43:45,011][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:43:56,862][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:44:10,823][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:44:21,503][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:44:39,073][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:44:54,404][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:45:07,553][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:45:19,338][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:45:29,380][root][INFO] - Processing question number 80
[2025-03-07 00:45:29,384][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:45:40,684][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:45:55,328][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:46:09,342][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:46:20,997][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:46:37,200][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:46:48,755][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:47:02,543][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:47:16,903][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:47:28,219][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:47:40,658][root][INFO] - Processing question number 90
[2025-03-07 00:47:40,663][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:47:53,120][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:48:07,694][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:48:21,522][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:48:32,320][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:48:45,200][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:48:57,136][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:49:09,670][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:49:20,825][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:49:32,311][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:49:46,563][root][INFO] - Inference complete
[2025-03-07 00:49:46,564][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:49:46,569][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:49:46,572][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:49:46,572][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:49:46,573][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:49:46,577][root][WARNING] - |Q. 33||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:49:46,577][root][WARNING] - |Q. 33||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:49:46,578][root][INFO] - |Q. 33||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:49:46,579][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:49:46,579][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:49:46,579][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:49:46,580][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:49:46,580][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:49:46,580][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:49:46,584][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:49:46,588][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:49:46,589][root][INFO] - Saved parsed outputs
[2025-03-07 00:49:46,589][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:49:46,590][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:49:46,590][root][INFO] - Saved parsing metadata
[2025-03-07 00:49:46,590][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:49:46,592][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:49:46,593][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:49:46,600][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 00:49:46,600][root][INFO] - Summary of metrics : {'label_accuracy': 0.47, 'misclassification_rate': 0.53, 'combined_accuracy': 0.42, 'malformed_label': 4, 'malformed_domain': 9, 'total_predictions': 100, 'correct_predictions': 47, 'correct_label_and_domain': 42, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.5, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.13, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 5, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-07 00:49:53,099][root][INFO] - Setting global seed to 989
[2025-03-07 00:49:53,104][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:49:53,104][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 00:49:53,106][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:49:53,107][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:49:53,109][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:49:53,109][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:49:53,269][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-07 00:49:53,830][root][INFO] - Full model selected, loading model
[2025-03-07 00:50:18,930][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:52:00,456][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:52:00,457][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:52:33,962][root][INFO] - Peft model loaded successfully
[2025-03-07 00:52:41,268][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:52:41,270][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 00:52:41,270][root][INFO] - Starting inference
[2025-03-07 00:52:41,444][root][INFO] - Processing question number 0
[2025-03-07 00:52:41,446][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:52:54,194][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:53:07,398][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:53:20,256][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:53:33,005][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:53:45,376][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:53:56,049][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:54:09,896][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:54:21,485][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:54:32,039][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:54:44,140][root][INFO] - Processing question number 10
[2025-03-07 00:54:44,142][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:54:53,317][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:55:03,037][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:55:15,049][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:55:26,083][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:55:40,894][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:55:52,382][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:56:05,947][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:56:17,413][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:56:29,054][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:56:41,964][root][INFO] - Processing question number 20
[2025-03-07 00:56:41,967][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:56:55,941][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:57:11,949][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:57:24,552][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:57:35,327][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:57:47,862][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:58:00,831][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:58:13,238][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:58:23,173][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:58:36,707][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:58:49,180][root][INFO] - Processing question number 30
[2025-03-07 00:58:49,183][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:58:58,431][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:59:09,031][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:59:19,039][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:59:29,809][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:59:44,055][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:59:57,235][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 01:00:09,266][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 01:00:19,795][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 01:00:30,242][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 01:00:41,628][root][INFO] - Processing question number 40
[2025-03-07 01:00:41,631][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 01:00:53,175][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 01:01:05,568][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 01:01:20,269][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 01:01:29,548][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 01:01:44,077][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 01:01:55,548][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 01:02:05,547][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 01:02:19,573][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 01:02:32,759][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 01:02:44,362][root][INFO] - Processing question number 50
[2025-03-07 01:02:44,365][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 01:02:58,949][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 01:03:10,745][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 01:03:24,086][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 01:03:36,783][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 01:03:47,359][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 01:03:59,234][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 01:04:13,307][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 01:04:25,257][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 01:04:39,641][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 01:04:53,532][root][INFO] - Processing question number 60
[2025-03-07 01:04:53,535][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 01:05:04,588][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 01:05:19,503][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 01:05:33,882][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 01:05:47,897][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 01:06:02,270][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 01:06:13,144][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 01:06:25,312][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 01:06:35,753][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 01:06:46,552][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 01:06:58,395][root][INFO] - Processing question number 70
[2025-03-07 01:06:58,398][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 01:07:12,086][root][INFO] - Domain : Property, Question : 9
[2025-03-07 01:07:23,747][root][INFO] - Domain : Property, Question : 17
[2025-03-07 01:07:38,376][root][INFO] - Domain : Property, Question : 25
[2025-03-07 01:07:49,829][root][INFO] - Domain : Property, Question : 30
[2025-03-07 01:08:00,050][root][INFO] - Domain : Property, Question : 36
[2025-03-07 01:08:15,473][root][INFO] - Domain : Property, Question : 46
[2025-03-07 01:08:29,568][root][INFO] - Domain : Property, Question : 53
[2025-03-07 01:08:44,797][root][INFO] - Domain : Property, Question : 59
[2025-03-07 01:08:58,125][root][INFO] - Domain : Property, Question : 66
[2025-03-07 01:09:08,079][root][INFO] - Processing question number 80
[2025-03-07 01:09:08,083][root][INFO] - Domain : Property, Question : 69
[2025-03-07 01:09:20,451][root][INFO] - Domain : Property, Question : 81
[2025-03-07 01:09:35,734][root][INFO] - Domain : Property, Question : 88
[2025-03-07 01:09:50,018][root][INFO] - Domain : Property, Question : 91
[2025-03-07 01:10:00,669][root][INFO] - Domain : Property, Question : 94
[2025-03-07 01:10:17,464][root][INFO] - Domain : Property, Question : 100
[2025-03-07 01:10:30,920][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 01:10:45,225][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 01:11:00,270][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 01:11:11,791][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 01:11:23,953][root][INFO] - Processing question number 90
[2025-03-07 01:11:23,957][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 01:11:37,925][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 01:11:53,713][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 01:12:06,928][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 01:12:17,814][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 01:12:29,523][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 01:12:42,195][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 01:12:55,019][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 01:13:06,420][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 01:13:15,990][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 01:13:28,743][root][INFO] - Inference complete
[2025-03-07 01:13:28,743][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:13:28,749][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:13:28,758][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 01:13:28,758][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:13:28,758][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 01:13:28,762][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:13:28,767][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:13:28,767][root][INFO] - Saved parsed outputs
[2025-03-07 01:13:28,767][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:13:28,768][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:13:28,768][root][INFO] - Saved parsing metadata
[2025-03-07 01:13:28,769][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:13:28,771][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:13:28,772][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 01:13:28,785][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 01:13:28,785][root][INFO] - Summary of metrics : {'label_accuracy': 0.48, 'misclassification_rate': 0.52, 'combined_accuracy': 0.41, 'malformed_label': 1, 'malformed_domain': 9, 'total_predictions': 100, 'correct_predictions': 48, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.4666666666666667, 'Torts_accuracy': 0.6428571428571429, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.13, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 50, 'correct_label_wrong_domain': 7, 'both_wrong': 2}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-07 01:13:35,479][root][INFO] - Setting global seed to 989
[2025-03-07 01:13:35,484][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 01:13:35,484][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 01:13:35,485][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 01:13:35,487][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 01:13:35,488][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 01:13:35,489][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 01:13:35,655][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-07 01:13:36,197][root][INFO] - Full model selected, loading model
[2025-03-07 01:14:01,751][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-07 01:15:43,278][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 01:15:43,279][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 01:16:16,899][root][INFO] - Peft model loaded successfully
[2025-03-07 01:16:24,116][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 01:16:24,118][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:16:24,118][root][INFO] - Starting inference
[2025-03-07 01:16:24,273][root][INFO] - Processing question number 0
[2025-03-07 01:16:24,275][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 01:16:38,220][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 01:16:49,342][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 01:17:01,965][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 01:17:14,937][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 01:17:27,106][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 01:17:38,678][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 01:17:53,659][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 01:18:06,962][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 01:18:16,153][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 01:18:28,010][root][INFO] - Processing question number 10
[2025-03-07 01:18:28,012][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 01:18:37,462][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 01:18:50,738][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 01:19:03,673][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 01:19:15,010][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 01:19:25,996][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 01:19:37,605][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 01:19:48,011][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 01:19:59,600][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 01:20:13,247][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 01:20:28,485][root][INFO] - Processing question number 20
[2025-03-07 01:20:28,487][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 01:20:43,311][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 01:20:59,180][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 01:21:09,171][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 01:21:19,640][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 01:21:30,995][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 01:21:44,092][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 01:21:55,783][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 01:22:06,146][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 01:22:19,816][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 01:22:32,611][root][INFO] - Processing question number 30
[2025-03-07 01:22:32,613][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 01:22:42,470][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 01:22:52,807][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 01:23:03,475][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 01:23:14,210][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 01:23:26,102][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 01:23:39,524][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 01:23:50,747][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 01:24:03,936][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 01:24:14,437][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 01:24:25,942][root][INFO] - Processing question number 40
[2025-03-07 01:24:25,946][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 01:24:38,179][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 01:24:51,074][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 01:25:07,797][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 01:25:17,997][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 01:25:34,944][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 01:25:46,051][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 01:25:57,040][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 01:26:11,677][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 01:26:24,531][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 01:26:36,582][root][INFO] - Processing question number 50
[2025-03-07 01:26:36,585][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 01:26:49,786][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 01:27:03,066][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 01:27:19,179][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 01:27:31,920][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 01:27:42,655][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 01:27:56,915][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 01:28:11,905][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 01:28:24,022][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 01:28:35,652][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 01:28:51,645][root][INFO] - Processing question number 60
[2025-03-07 01:28:51,648][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 01:29:03,985][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 01:29:20,386][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 01:29:35,137][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 01:29:50,694][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 01:30:03,922][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 01:30:15,281][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 01:30:27,812][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 01:30:37,579][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 01:30:48,268][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 01:30:58,891][root][INFO] - Processing question number 70
[2025-03-07 01:30:58,894][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 01:31:12,055][root][INFO] - Domain : Property, Question : 9
[2025-03-07 01:31:24,160][root][INFO] - Domain : Property, Question : 17
[2025-03-07 01:31:39,124][root][INFO] - Domain : Property, Question : 25
[2025-03-07 01:31:53,003][root][INFO] - Domain : Property, Question : 30
[2025-03-07 01:32:03,793][root][INFO] - Domain : Property, Question : 36
[2025-03-07 01:32:20,919][root][INFO] - Domain : Property, Question : 46
[2025-03-07 01:32:35,155][root][INFO] - Domain : Property, Question : 53
[2025-03-07 01:32:49,963][root][INFO] - Domain : Property, Question : 59
[2025-03-07 01:33:01,446][root][INFO] - Domain : Property, Question : 66
[2025-03-07 01:33:11,739][root][INFO] - Processing question number 80
[2025-03-07 01:33:11,743][root][INFO] - Domain : Property, Question : 69
[2025-03-07 01:33:26,103][root][INFO] - Domain : Property, Question : 81
[2025-03-07 01:33:37,465][root][INFO] - Domain : Property, Question : 88
[2025-03-07 01:33:49,640][root][INFO] - Domain : Property, Question : 91
[2025-03-07 01:34:01,469][root][INFO] - Domain : Property, Question : 94
[2025-03-07 01:34:12,447][root][INFO] - Domain : Property, Question : 100
[2025-03-07 01:34:25,805][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 01:34:39,679][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 01:34:51,310][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 01:35:02,575][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 01:35:14,726][root][INFO] - Processing question number 90
[2025-03-07 01:35:14,730][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 01:35:27,789][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 01:35:43,843][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 01:35:56,445][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 01:36:07,683][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 01:36:18,720][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 01:36:32,364][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 01:36:44,020][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 01:36:54,818][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 01:37:05,079][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 01:37:18,519][root][INFO] - Inference complete
[2025-03-07 01:37:18,520][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:37:18,525][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:37:18,533][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 01:37:18,534][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:37:18,534][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 01:37:18,538][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:37:18,542][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:37:18,542][root][INFO] - Saved parsed outputs
[2025-03-07 01:37:18,542][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:37:18,544][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:37:18,544][root][INFO] - Saved parsing metadata
[2025-03-07 01:37:18,544][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:37:18,546][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:37:18,547][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 01:37:18,639][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 01:37:18,639][root][INFO] - Summary of metrics : {'label_accuracy': 0.48, 'misclassification_rate': 0.52, 'combined_accuracy': 0.42, 'malformed_label': 1, 'malformed_domain': 9, 'total_predictions': 100, 'correct_predictions': 48, 'correct_label_and_domain': 42, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.5714285714285714, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.13, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.16, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 6, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-07 01:37:50,169][root][INFO] - Setting global seed to 989
[2025-03-07 01:37:50,358][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 01:37:50,358][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 01:37:50,359][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 01:37:50,361][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 01:37:50,374][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 01:37:50,374][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 01:37:50,577][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-07 01:37:51,612][root][INFO] - Full model selected, loading model
[2025-03-07 01:38:31,343][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-07 01:40:12,057][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 01:40:12,058][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 01:40:45,054][root][INFO] - Peft model loaded successfully
[2025-03-07 01:40:52,286][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 01:40:52,288][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 01:40:52,288][root][INFO] - Starting inference
[2025-03-07 01:40:52,432][root][INFO] - Processing question number 0
[2025-03-07 01:40:52,434][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 01:41:05,657][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 01:41:21,621][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 01:41:33,075][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 01:41:45,435][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 01:41:58,159][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 01:42:08,251][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 01:42:21,154][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 01:42:34,265][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 01:42:43,581][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 01:42:55,664][root][INFO] - Processing question number 10
[2025-03-07 01:42:55,666][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 01:43:08,607][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 01:43:22,114][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 01:43:35,669][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 01:43:45,433][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 01:43:58,243][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 01:44:09,940][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 01:44:21,606][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 01:44:34,509][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 01:44:47,061][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 01:45:02,376][root][INFO] - Processing question number 20
[2025-03-07 01:45:02,378][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 01:45:19,495][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 01:45:32,880][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 01:45:45,619][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 01:45:55,621][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 01:46:08,788][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 01:46:19,332][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 01:46:32,374][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 01:46:42,872][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 01:46:55,177][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 01:47:09,439][root][INFO] - Processing question number 30
[2025-03-07 01:47:09,441][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 01:47:18,595][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 01:47:28,328][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 01:47:39,415][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 01:47:50,756][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 01:48:03,584][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 01:48:16,331][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 01:48:28,482][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 01:48:42,523][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 01:48:55,054][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 01:49:06,171][root][INFO] - Processing question number 40
[2025-03-07 01:49:06,174][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 01:49:17,367][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 01:49:29,180][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 01:49:42,680][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 01:49:52,280][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 01:50:05,136][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 01:50:17,457][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 01:50:29,654][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 01:50:42,300][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 01:50:56,849][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 01:51:09,749][root][INFO] - Processing question number 50
[2025-03-07 01:51:09,752][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 01:51:23,135][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 01:51:37,154][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 01:51:49,907][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 01:52:03,201][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 01:52:13,746][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 01:52:25,433][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 01:52:38,583][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 01:52:52,488][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 01:53:05,114][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 01:53:17,768][root][INFO] - Processing question number 60
[2025-03-07 01:53:17,771][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 01:53:29,303][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 01:53:41,807][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 01:53:54,875][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 01:54:09,747][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 01:54:26,181][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 01:54:38,987][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 01:54:50,806][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 01:55:00,616][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 01:55:11,663][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 01:55:22,421][root][INFO] - Processing question number 70
[2025-03-07 01:55:22,425][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 01:55:38,399][root][INFO] - Domain : Property, Question : 9
[2025-03-07 01:55:50,168][root][INFO] - Domain : Property, Question : 17
[2025-03-07 01:56:01,278][root][INFO] - Domain : Property, Question : 25
[2025-03-07 01:56:14,909][root][INFO] - Domain : Property, Question : 30
[2025-03-07 01:56:25,554][root][INFO] - Domain : Property, Question : 36
[2025-03-07 01:56:40,696][root][INFO] - Domain : Property, Question : 46
[2025-03-07 01:56:55,263][root][INFO] - Domain : Property, Question : 53
[2025-03-07 01:57:09,828][root][INFO] - Domain : Property, Question : 59
[2025-03-07 01:57:25,258][root][INFO] - Domain : Property, Question : 66
[2025-03-07 01:57:36,942][root][INFO] - Processing question number 80
[2025-03-07 01:57:36,946][root][INFO] - Domain : Property, Question : 69
[2025-03-07 01:57:47,973][root][INFO] - Domain : Property, Question : 81
[2025-03-07 01:58:04,207][root][INFO] - Domain : Property, Question : 88
[2025-03-07 01:58:17,391][root][INFO] - Domain : Property, Question : 91
[2025-03-07 01:58:29,129][root][INFO] - Domain : Property, Question : 94
[2025-03-07 01:58:42,838][root][INFO] - Domain : Property, Question : 100
[2025-03-07 01:58:54,536][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 01:59:07,592][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 01:59:21,385][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 01:59:32,129][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 01:59:43,423][root][INFO] - Processing question number 90
[2025-03-07 01:59:43,427][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 01:59:54,365][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 02:00:09,014][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 02:00:20,857][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 02:00:31,157][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 02:00:43,715][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 02:00:57,156][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 02:01:10,041][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 02:01:20,886][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 02:01:30,215][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 02:01:43,849][root][INFO] - Inference complete
[2025-03-07 02:01:43,849][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:01:43,854][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:01:43,857][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 02:01:43,858][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 02:01:43,858][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 02:01:43,863][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 02:01:43,864][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 02:01:43,864][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 02:01:43,868][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:01:43,872][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:01:43,872][root][INFO] - Saved parsed outputs
[2025-03-07 02:01:43,873][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:01:43,874][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:01:43,874][root][INFO] - Saved parsing metadata
[2025-03-07 02:01:43,874][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:01:43,876][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
[2025-03-07 02:01:43,877][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_zero_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 02:01:43,957][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_2
[2025-03-07 02:01:43,957][root][INFO] - Summary of metrics : {'label_accuracy': 0.48, 'misclassification_rate': 0.52, 'combined_accuracy': 0.4, 'malformed_label': 2, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 48, 'correct_label_and_domain': 40, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.26666666666666666, 'Torts_accuracy': 0.6428571428571429, 'Civil_Procedure_accuracy': 0.46153846153846156, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.15, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 8, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Job 30 completed at Fri Mar  7 02:01:45 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n518
Job ID: 25358405
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 05:28:04
CPU Efficiency: 9.85% of 2-07:30:00 core-walltime
Job Wall-clock time: 05:33:00
Memory Utilized: 34.53 GB
Memory Efficiency: 95.92% of 36.00 GB
