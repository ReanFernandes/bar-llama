Starting job 30 at Thu Mar  6 20:29:15 CET 2025
Configuration: model=llama3 tokenizer=llama3 dataset=all_domains_10_samples prompt=json_fact_first_zero_shot_structured train=json_fact_first_zero_shot_structured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '30', 'training']
Updating job 30 to status training with exit code None
Status update completed for job 30
[2025-03-06 20:29:21,988][root][INFO] - Global seed set to 314
[2025-03-06 20:29:21,989][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 20:29:21,990][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 20:29:21,990][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 20:29:21,990][root][INFO] - Current training config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 20:29:21,990][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/distilled_dataset.json
[2025-03-06 20:29:22,005][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:29:22,010][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 20:29:22,010][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 20:29:22,014][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 20:29:22,782][root][INFO] - Tokenizer meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 20:29:47,241][root][INFO] - Quantised model meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 20:30:14,285][root][INFO] - Model prepared for kbit training
[2025-03-06 20:30:14,286][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'k_proj', 'up_proj', 'gate_proj', 'v_proj', 'o_proj', 'q_proj', 'down_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 20:30:15,928][root][INFO] - Lora adapter added to model
[2025-03-06 20:30:15,931][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_fact_first_zero_shot_structured
[2025-03-06 20:30:16,176][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.7773, 'grad_norm': 0.5458003282546997, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.7229, 'grad_norm': 0.5898870825767517, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.5865, 'grad_norm': 0.3838472068309784, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.4032, 'grad_norm': 0.42596375942230225, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.272, 'grad_norm': 0.3472818434238434, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.9986, 'grad_norm': 0.40913522243499756, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.9687, 'grad_norm': 0.25754231214523315, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.8674, 'grad_norm': 0.3496938645839691, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.9448, 'grad_norm': 0.2719156742095947, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.8232, 'grad_norm': 0.2976677119731903, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.8611, 'grad_norm': 0.284891277551651, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.7724, 'grad_norm': 0.342115193605423, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.7866, 'grad_norm': 0.32043781876564026, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.7168, 'grad_norm': 0.33934226632118225, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.7256, 'grad_norm': 0.3486872911453247, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.6348, 'grad_norm': 0.37804678082466125, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.6526, 'grad_norm': 0.3704898953437805, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.5367, 'grad_norm': 0.3957219123840332, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.611, 'grad_norm': 0.5113623142242432, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.5603, 'grad_norm': 0.39787983894348145, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.5197, 'grad_norm': 0.4193989634513855, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.4432, 'grad_norm': 0.4547284245491028, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.5342, 'grad_norm': 0.5016228556632996, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.455, 'grad_norm': 0.46302664279937744, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.482, 'grad_norm': 0.4639520049095154, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.4328, 'grad_norm': 0.4751679301261902, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.437, 'grad_norm': 0.5189483761787415, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.471, 'grad_norm': 0.4814423620700836, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.449, 'grad_norm': 0.7489433288574219, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.3304, 'grad_norm': 0.7239226698875427, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.2554, 'grad_norm': 1.0964207649230957, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.2971, 'grad_norm': 0.7857205271720886, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.2858, 'grad_norm': 1.340146541595459, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.1487, 'grad_norm': 0.5845927000045776, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.1796, 'grad_norm': 0.913669764995575, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.1505, 'grad_norm': 0.9055840373039246, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.1535, 'grad_norm': 0.7185181975364685, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.0626, 'grad_norm': 0.8039226531982422, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.1162, 'grad_norm': 0.965133786201477, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.0807, 'grad_norm': 0.47167855501174927, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.0666, 'grad_norm': 0.551543116569519, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.0437, 'grad_norm': 0.9120916128158569, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.0478, 'grad_norm': 0.9691340923309326, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.0356, 'grad_norm': 0.4298268258571625, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.0241, 'grad_norm': 0.22779706120491028, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.0287, 'grad_norm': 0.25392985343933105, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0254, 'grad_norm': 0.24340598285198212, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.019, 'grad_norm': 0.15206791460514069, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0233, 'grad_norm': 0.26910102367401123, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0232, 'grad_norm': 0.1444890946149826, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 2840.7417, 'train_samples_per_second': 0.37, 'train_steps_per_second': 0.053, 'train_loss': 0.516895573263367, 'epoch': 15.0}
[2025-03-06 21:17:44,345][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_fact_first_zero_shot_structured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '30', 'trained', '0']
Updating job 30 to status trained with exit code 0
Status update completed for job 30
Starting evaluations for job 30
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-06 21:17:55,327][root][INFO] - Setting global seed to 206
[2025-03-06 21:17:55,333][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:17:55,333][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:17:55,335][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:17:55,337][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:17:55,340][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:17:55,340][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:17:55,487][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:17:56,017][root][INFO] - Full model selected, loading model
[2025-03-06 21:18:20,008][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:20:02,821][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:20:02,823][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:20:34,237][root][INFO] - Peft model loaded successfully
[2025-03-06 21:20:41,422][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:20:41,424][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:20:41,424][root][INFO] - Starting inference
[2025-03-06 21:20:41,593][root][INFO] - Processing question number 0
[2025-03-06 21:20:41,595][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:20:51,599][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:21:05,955][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:21:20,508][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:21:34,851][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:21:47,302][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:22:01,080][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:22:16,111][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:22:28,466][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:22:42,801][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:22:54,422][root][INFO] - Processing question number 10
[2025-03-06 21:22:54,423][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:23:08,316][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:23:18,997][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:23:32,483][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:23:43,040][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:23:53,938][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:24:08,171][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:24:19,634][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:24:30,229][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:24:41,491][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:24:52,881][root][INFO] - Processing question number 20
[2025-03-06 21:24:52,883][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:25:03,415][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:25:16,215][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:25:28,015][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:25:40,965][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:25:53,506][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:26:04,283][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:26:14,888][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:26:26,460][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:26:38,322][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:26:51,948][root][INFO] - Processing question number 30
[2025-03-06 21:26:51,950][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:27:03,770][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:27:15,859][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:27:26,951][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:27:39,025][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:27:50,990][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:28:03,504][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:28:15,575][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:28:27,351][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:28:40,889][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:28:55,155][root][INFO] - Processing question number 40
[2025-03-06 21:28:55,158][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:29:08,436][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:29:23,119][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:29:34,842][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:29:46,666][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:29:58,444][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:30:10,414][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:30:24,117][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:30:35,872][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:30:48,291][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:30:58,064][root][INFO] - Processing question number 50
[2025-03-06 21:30:58,067][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:31:09,993][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:31:22,445][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:31:34,083][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:31:48,679][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:32:02,138][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:32:11,922][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:32:25,358][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:32:35,330][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:32:46,906][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:32:56,257][root][INFO] - Processing question number 60
[2025-03-06 21:32:56,260][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:33:06,658][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:33:17,514][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:33:27,576][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:33:39,213][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:33:51,179][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:34:01,650][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:34:13,413][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:34:25,212][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:34:36,289][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:34:49,046][root][INFO] - Processing question number 70
[2025-03-06 21:34:49,050][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:35:01,061][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:35:15,401][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:35:26,577][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:35:39,758][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:35:51,250][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:36:03,117][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:36:18,775][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:36:30,063][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:36:44,219][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:36:54,447][root][INFO] - Processing question number 80
[2025-03-06 21:36:54,467][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:37:07,821][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:37:24,116][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:37:34,725][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:37:46,738][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:38:01,726][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:38:16,838][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:38:30,138][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:38:40,212][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:38:52,543][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:39:02,146][root][INFO] - Processing question number 90
[2025-03-06 21:39:02,150][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:39:15,966][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:39:25,823][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:39:38,596][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:39:49,043][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:40:01,416][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:40:13,494][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:40:24,894][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:40:37,719][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:40:54,258][root][INFO] - Inference complete
[2025-03-06 21:40:54,258][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,264][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,276][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,281][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,281][root][INFO] - Saved parsed outputs
[2025-03-06 21:40:54,281][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,282][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,282][root][INFO] - Saved parsing metadata
[2025-03-06 21:40:54,283][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,308][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:40:54,309][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_zero_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:40:54,427][root][INFO] - Evaluation completed for json_fact_first_zero_shot_structured, on test_set_1
[2025-03-06 21:40:54,427][root][INFO] - Summary of metrics : {'label_accuracy': 0.5656565656565656, 'misclassification_rate': 0.43434343434343436, 'combined_accuracy': 0.5353535353535354, 'malformed_label': 0, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 56, 'correct_label_and_domain': 53, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.6923076923076923, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.12121212121212122, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 40, 'correct_label_wrong_domain': 3, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 30 to status completed with exit code 0
Eval status update completed for job 30
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '30', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_zero_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 30 to status running with exit code None
Eval status update completed for job 30
[2025-03-06 21:41:24,562][root][INFO] - Setting global seed to 206
[2025-03-06 21:41:24,574][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:41:24,574][root][INFO] - Current evaluation config is : 
 Prompt type : zero_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:41:24,575][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:41:24,578][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:41:24,583][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:41:24,583][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:41:24,752][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:41:25,342][root][INFO] - Full model selected, loading model
[2025-03-06 21:41:49,617][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:43:31,145][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:43:31,146][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:44:04,711][root][INFO] - Peft model loaded successfully
[2025-03-06 21:44:12,500][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'zero_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:44:12,502][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_zero_shot_structured/test_set_1.json
[2025-03-06 21:44:12,502][root][INFO] - Starting inference
[2025-03-06 21:44:12,671][root][INFO] - Processing question number 0
[2025-03-06 21:44:12,674][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:44:23,986][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:44:37,088][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:44:50,832][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:45:06,180][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:45:18,787][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:45:32,336][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:45:48,067][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:46:01,166][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:46:12,988][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:46:24,105][root][INFO] - Processing question number 10
[2025-03-06 21:46:24,107][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:46:37,193][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:46:48,392][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:47:02,004][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:47:12,658][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:47:25,356][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:47:37,536][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:47:49,112][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:48:00,788][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:48:13,182][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:48:24,675][root][INFO] - Processing question number 20
[2025-03-06 21:48:24,678][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:48:36,524][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:48:48,218][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:48:59,906][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:49:11,401][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:49:23,308][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:49:34,236][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:49:44,936][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:49:56,668][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:50:08,829][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:50:22,588][root][INFO] - Processing question number 30
[2025-03-06 21:50:22,591][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:50:34,198][root][INFO] - Domain : Contracts, Question : 8
