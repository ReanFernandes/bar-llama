Starting job 26 at Thu Mar  6 19:02:58 CET 2025
Configuration: model=llama3 tokenizer=llama3 dataset=all_domains_10_samples prompt=json_fact_first_few_shot_structured train=json_fact_first_few_shot_structured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '26', 'training']
Updating job 26 to status training with exit code None
Status update completed for job 26
[2025-03-06 19:03:09,280][root][INFO] - Global seed set to 314
[2025-03-06 19:03:09,281][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 19:03:09,282][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 19:03:09,282][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 19:03:09,282][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 19:03:09,282][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/distilled_dataset.json
[2025-03-06 19:03:09,303][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 19:03:09,311][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 19:03:09,312][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 19:03:09,317][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 19:03:10,070][root][INFO] - Tokenizer meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 19:03:37,963][root][INFO] - Quantised model meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 19:04:06,525][root][INFO] - Model prepared for kbit training
[2025-03-06 19:04:06,526][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'up_proj', 'k_proj', 'gate_proj', 'o_proj', 'down_proj', 'v_proj', 'q_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 19:04:08,283][root][INFO] - Lora adapter added to model
[2025-03-06 19:04:08,286][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_fact_first_few_shot_structured
[2025-03-06 19:04:08,562][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.6096, 'grad_norm': 0.5168763399124146, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.5633, 'grad_norm': 0.3553123474121094, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.4744, 'grad_norm': 0.33777523040771484, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.2185, 'grad_norm': 0.3531544804573059, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.0377, 'grad_norm': 0.39038872718811035, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.6928, 'grad_norm': 0.37746381759643555, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.5562, 'grad_norm': 0.22520704567432404, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.5045, 'grad_norm': 0.21517960727214813, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.5317, 'grad_norm': 0.1936640739440918, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.5012, 'grad_norm': 0.16433373093605042, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.4967, 'grad_norm': 0.15916253626346588, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.451, 'grad_norm': 0.15806229412555695, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.4615, 'grad_norm': 0.17563216388225555, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.4304, 'grad_norm': 0.18298324942588806, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.4152, 'grad_norm': 0.18502479791641235, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.3986, 'grad_norm': 0.1796664297580719, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.381, 'grad_norm': 0.1755751371383667, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.3604, 'grad_norm': 0.18249449133872986, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.3739, 'grad_norm': 0.19674988090991974, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.3715, 'grad_norm': 0.19853802025318146, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.331, 'grad_norm': 0.18979403376579285, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.32, 'grad_norm': 0.2006215900182724, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.3571, 'grad_norm': 0.22571741044521332, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.3137, 'grad_norm': 0.22439101338386536, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.3306, 'grad_norm': 0.221550852060318, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.3087, 'grad_norm': 0.22977842390537262, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.3055, 'grad_norm': 0.25281161069869995, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.3494, 'grad_norm': 0.20811475813388824, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.2715, 'grad_norm': 0.2932724058628082, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.26, 'grad_norm': 0.3172770142555237, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.184, 'grad_norm': 0.4303554594516754, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.1915, 'grad_norm': 0.4927816092967987, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.1972, 'grad_norm': 0.40333104133605957, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.1054, 'grad_norm': 0.47111406922340393, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.0992, 'grad_norm': 0.3935033679008484, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.1026, 'grad_norm': 0.4345536530017853, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.1028, 'grad_norm': 0.3581158220767975, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.0415, 'grad_norm': 0.43602418899536133, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.0714, 'grad_norm': 0.4409327805042267, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.0458, 'grad_norm': 0.3255276381969452, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.0327, 'grad_norm': 0.2996048331260681, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.0289, 'grad_norm': 0.21839910745620728, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.0262, 'grad_norm': 0.364359974861145, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.0198, 'grad_norm': 0.12666210532188416, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.0139, 'grad_norm': 0.13312257826328278, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.0159, 'grad_norm': 0.15790510177612305, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0149, 'grad_norm': 0.12441952526569366, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.011, 'grad_norm': 0.10084524005651474, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0134, 'grad_norm': 0.13350796699523926, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0122, 'grad_norm': 0.07495509833097458, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 4196.6635, 'train_samples_per_second': 0.25, 'train_steps_per_second': 0.036, 'train_loss': 0.36615375642975173, 'epoch': 15.0}
[2025-03-06 20:14:12,842][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_fact_first_few_shot_structured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '26', 'trained', '0']
Updating job 26 to status trained with exit code 0
Status update completed for job 26
Starting evaluations for job 26
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-06 20:14:24,299][root][INFO] - Setting global seed to 206
[2025-03-06 20:14:24,307][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:14:24,307][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 20:14:24,308][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:14:24,310][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:14:24,318][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:14:24,318][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:14:24,469][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:14:25,261][root][INFO] - Full model selected, loading model
[2025-03-06 20:14:51,401][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:16:32,982][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:16:32,983][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:17:06,031][root][INFO] - Peft model loaded successfully
[2025-03-06 20:17:13,443][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:17:13,444][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:17:13,444][root][INFO] - Starting inference
[2025-03-06 20:17:13,655][root][INFO] - Processing question number 0
[2025-03-06 20:17:13,657][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:17:31,997][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:17:48,233][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:18:01,914][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:18:15,729][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:18:31,397][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:18:47,235][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:19:01,771][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:19:15,053][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:19:27,477][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:19:42,011][root][INFO] - Processing question number 10
[2025-03-06 20:19:42,023][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:19:57,154][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:20:11,127][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:20:24,548][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:20:39,290][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:20:52,646][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:21:06,011][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:21:18,089][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:21:31,732][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:21:47,705][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:22:00,319][root][INFO] - Processing question number 20
[2025-03-06 20:22:00,321][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:22:13,265][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:22:28,129][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:22:41,360][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:22:54,288][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:23:09,095][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:23:22,515][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:23:36,243][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:23:49,018][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:24:05,728][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:24:18,201][root][INFO] - Processing question number 30
[2025-03-06 20:24:18,203][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:24:33,233][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:24:47,496][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:25:05,236][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:25:18,759][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:25:30,703][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:25:45,368][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:26:00,817][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:26:17,203][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:26:31,764][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:26:47,530][root][INFO] - Processing question number 40
[2025-03-06 20:26:47,533][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:27:01,376][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:27:16,202][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:27:33,052][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:27:45,081][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:27:57,769][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:28:13,432][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:28:27,755][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:28:42,254][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:28:55,689][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:29:10,892][root][INFO] - Processing question number 50
[2025-03-06 20:29:10,896][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:29:24,968][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:29:44,144][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:29:57,137][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:30:11,975][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:30:25,358][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:30:38,040][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:30:56,010][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:31:08,609][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:31:23,050][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:31:36,734][root][INFO] - Processing question number 60
[2025-03-06 20:31:36,738][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:31:50,822][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:32:02,170][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:32:16,484][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:32:27,006][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:32:40,243][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:32:54,677][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:33:08,664][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:33:24,961][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:33:37,171][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:33:56,839][root][INFO] - Processing question number 70
[2025-03-06 20:33:56,843][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:34:10,749][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:34:25,300][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:34:37,362][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:34:55,277][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:35:10,671][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:35:25,644][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:35:42,342][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:35:55,633][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:36:10,183][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:36:29,927][root][INFO] - Processing question number 80
[2025-03-06 20:36:29,932][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:36:45,610][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:37:07,021][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:37:19,151][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:37:31,482][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:37:44,794][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:37:58,851][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:38:14,289][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:38:26,418][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:38:43,668][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:38:56,545][root][INFO] - Processing question number 90
[2025-03-06 20:38:56,550][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:39:13,420][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:39:30,447][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:39:44,496][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:39:56,762][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:40:10,623][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:40:25,534][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:40:37,963][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:40:51,538][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:41:05,546][root][INFO] - Inference complete
[2025-03-06 20:41:05,546][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:41:05,552][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:41:05,564][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:41:05,570][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:41:05,570][root][INFO] - Saved parsed outputs
[2025-03-06 20:41:05,570][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:41:05,572][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:41:05,572][root][INFO] - Saved parsing metadata
[2025-03-06 20:41:05,573][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:41:05,575][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:41:05,576][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:41:05,598][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_1
[2025-03-06 20:41:05,598][root][INFO] - Summary of metrics : {'label_accuracy': 0.47474747474747475, 'misclassification_rate': 0.5252525252525253, 'combined_accuracy': 0.43434343434343436, 'malformed_label': 1, 'malformed_domain': 10, 'total_predictions': 99, 'correct_predictions': 47, 'correct_label_and_domain': 43, 'Constitutional_Law_accuracy': 0.7142857142857143, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 4, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-06 20:41:13,846][root][INFO] - Setting global seed to 206
[2025-03-06 20:41:13,853][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:41:13,854][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 20:41:13,855][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:41:13,856][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:41:13,859][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:41:13,859][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:41:14,040][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:41:14,634][root][INFO] - Full model selected, loading model
[2025-03-06 20:41:42,362][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:43:24,981][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:43:24,982][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:43:56,584][root][INFO] - Peft model loaded successfully
[2025-03-06 20:44:04,238][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:44:04,240][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 20:44:04,240][root][INFO] - Starting inference
[2025-03-06 20:44:04,448][root][INFO] - Processing question number 0
[2025-03-06 20:44:04,450][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:44:20,492][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:44:37,478][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:44:51,070][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:45:06,118][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:45:19,707][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:45:33,943][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:45:49,221][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:46:01,755][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:46:15,853][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:46:31,011][root][INFO] - Processing question number 10
[2025-03-06 20:46:31,013][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:46:47,655][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:47:01,698][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:47:18,216][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:47:33,737][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:47:47,643][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:48:00,982][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:48:13,166][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:48:27,493][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:48:40,782][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:48:54,573][root][INFO] - Processing question number 20
[2025-03-06 20:48:54,575][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:49:08,808][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:49:22,512][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:49:35,475][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:49:48,625][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:50:03,987][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:50:17,964][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:50:32,629][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:50:46,306][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:51:02,264][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:51:14,479][root][INFO] - Processing question number 30
[2025-03-06 20:51:14,483][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:51:27,171][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:51:43,343][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:51:58,015][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:52:12,181][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:52:24,078][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:52:37,128][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:52:52,165][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:53:08,894][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:53:23,026][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:53:37,802][root][INFO] - Processing question number 40
[2025-03-06 20:53:37,805][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:53:50,351][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:54:04,942][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:54:20,649][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:54:32,628][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:54:45,445][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:54:59,637][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:55:13,807][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:55:28,053][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:55:44,124][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:56:00,008][root][INFO] - Processing question number 50
[2025-03-06 20:56:00,012][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:56:15,677][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:56:35,147][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:56:50,650][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:57:05,462][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:57:19,942][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:57:32,797][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:57:48,559][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:58:02,451][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:58:18,631][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:58:35,408][root][INFO] - Processing question number 60
[2025-03-06 20:58:35,412][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:58:49,534][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:59:02,055][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:59:16,089][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:59:27,517][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:59:41,319][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:59:55,986][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:00:08,166][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:00:22,355][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:00:34,507][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:00:50,226][root][INFO] - Processing question number 70
[2025-03-06 21:00:50,231][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:01:04,363][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:01:15,791][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:01:30,868][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:01:47,051][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:02:04,212][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:02:18,506][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:02:35,747][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:02:49,307][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:03:05,891][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:03:23,818][root][INFO] - Processing question number 80
[2025-03-06 21:03:23,822][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:03:39,888][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:04:00,611][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:04:13,825][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:04:27,617][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:04:40,400][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:04:53,369][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:05:09,038][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:05:21,567][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:05:39,089][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:05:51,566][root][INFO] - Processing question number 90
[2025-03-06 21:05:51,572][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:06:07,543][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:06:25,096][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:06:39,306][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:06:51,760][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:07:06,860][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:07:21,736][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:07:35,322][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:07:49,518][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:08:04,458][root][INFO] - Inference complete
[2025-03-06 21:08:04,458][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:08:04,464][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:08:04,478][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:08:04,486][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:08:04,486][root][INFO] - Saved parsed outputs
[2025-03-06 21:08:04,486][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:08:04,487][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:08:04,487][root][INFO] - Saved parsing metadata
[2025-03-06 21:08:04,488][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:08:04,490][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:08:04,491][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:08:04,532][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_1
[2025-03-06 21:08:04,532][root][INFO] - Summary of metrics : {'label_accuracy': 0.5252525252525253, 'misclassification_rate': 0.4747474747474747, 'combined_accuracy': 0.46464646464646464, 'malformed_label': 0, 'malformed_domain': 10, 'total_predictions': 99, 'correct_predictions': 52, 'correct_label_and_domain': 46, 'Constitutional_Law_accuracy': 0.7142857142857143, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 6, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-06 21:08:12,217][root][INFO] - Setting global seed to 206
[2025-03-06 21:08:12,223][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:08:12,223][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:08:12,225][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:08:12,226][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:08:12,229][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:08:12,229][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:08:12,384][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:08:12,948][root][INFO] - Full model selected, loading model
[2025-03-06 21:08:37,351][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:10:20,332][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:10:20,333][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:10:54,248][root][INFO] - Peft model loaded successfully
[2025-03-06 21:11:01,715][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:11:01,717][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:11:01,717][root][INFO] - Starting inference
[2025-03-06 21:11:01,913][root][INFO] - Processing question number 0
[2025-03-06 21:11:01,916][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:11:17,539][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:11:33,259][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:11:48,259][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:12:03,349][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:12:20,760][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:12:36,602][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:12:51,897][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:13:07,635][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:13:19,278][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:13:34,265][root][INFO] - Processing question number 10
[2025-03-06 21:13:34,267][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:13:49,505][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:14:02,463][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:14:15,793][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:14:32,401][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:14:46,279][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:15:01,538][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:15:15,412][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:15:28,178][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:15:43,037][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:15:57,874][root][INFO] - Processing question number 20
[2025-03-06 21:15:57,877][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:16:11,629][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:16:27,036][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:16:40,384][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:16:55,339][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:17:10,598][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:17:24,221][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:17:39,186][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:17:52,183][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:18:05,285][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:18:17,299][root][INFO] - Processing question number 30
[2025-03-06 21:18:17,302][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:18:30,556][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:18:45,234][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:19:01,029][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:19:14,604][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:19:26,891][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:19:42,257][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:19:56,550][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:20:12,962][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:20:29,224][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:20:44,693][root][INFO] - Processing question number 40
[2025-03-06 21:20:44,696][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:20:58,332][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:21:12,707][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:21:29,678][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:21:44,010][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:21:57,498][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:22:11,420][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:22:26,313][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:22:40,018][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:22:53,301][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:23:06,860][root][INFO] - Processing question number 50
[2025-03-06 21:23:06,864][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:23:21,243][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:23:38,794][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:23:52,006][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:24:05,483][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:24:19,101][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:24:30,262][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:24:44,870][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:24:58,248][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:25:17,072][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:25:30,575][root][INFO] - Processing question number 60
[2025-03-06 21:25:30,580][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:25:45,255][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:25:58,012][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:26:14,089][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:26:25,847][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:26:39,945][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:26:55,474][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:27:08,151][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:27:19,556][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:27:33,017][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:27:50,903][root][INFO] - Processing question number 70
[2025-03-06 21:27:50,908][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:28:06,176][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:28:21,846][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:28:36,332][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:28:54,010][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:29:09,132][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:29:22,165][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:29:38,742][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:29:53,431][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:30:09,420][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:30:26,496][root][INFO] - Processing question number 80
[2025-03-06 21:30:26,506][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:30:41,767][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:30:58,967][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:31:11,395][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:31:25,618][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:31:39,145][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:31:53,425][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:32:09,263][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:32:21,709][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:32:38,923][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:32:50,909][root][INFO] - Processing question number 90
[2025-03-06 21:32:50,915][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:33:07,353][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:33:23,321][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:33:37,860][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:33:50,142][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:34:04,845][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:34:19,881][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:34:32,471][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:34:47,036][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:35:02,091][root][INFO] - Inference complete
[2025-03-06 21:35:02,091][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:35:02,097][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:35:02,110][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:35:02,116][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:35:02,116][root][INFO] - Saved parsed outputs
[2025-03-06 21:35:02,116][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:35:02,117][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:35:02,117][root][INFO] - Saved parsing metadata
[2025-03-06 21:35:02,118][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:35:02,119][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:35:02,121][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:35:02,148][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_1
[2025-03-06 21:35:02,148][root][INFO] - Summary of metrics : {'label_accuracy': 0.5555555555555556, 'misclassification_rate': 0.4444444444444444, 'combined_accuracy': 0.48484848484848486, 'malformed_label': 0, 'malformed_domain': 10, 'total_predictions': 99, 'correct_predictions': 55, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.7142857142857143, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.5384615384615384, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 41, 'correct_label_wrong_domain': 7, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-06 21:35:09,304][root][INFO] - Setting global seed to 989
[2025-03-06 21:35:09,309][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:35:09,310][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:35:09,311][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:35:09,313][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:35:09,316][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:35:09,316][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:35:09,484][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:35:10,105][root][INFO] - Full model selected, loading model
[2025-03-06 21:35:35,262][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:37:18,114][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:37:18,114][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:37:51,886][root][INFO] - Peft model loaded successfully
[2025-03-06 21:37:59,095][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:37:59,096][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 21:37:59,096][root][INFO] - Starting inference
[2025-03-06 21:37:59,323][root][INFO] - Processing question number 0
[2025-03-06 21:37:59,325][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:38:17,779][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:38:34,037][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:38:47,739][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:39:01,574][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:39:17,260][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:39:33,115][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:39:47,688][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:40:01,081][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:40:13,583][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:40:28,156][root][INFO] - Processing question number 10
[2025-03-06 21:40:28,158][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:40:43,349][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:40:57,372][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:41:10,865][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:41:25,629][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:41:39,002][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:41:52,360][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:42:04,493][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:42:18,194][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:42:34,221][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:42:46,865][root][INFO] - Processing question number 20
[2025-03-06 21:42:46,868][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:42:59,843][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:43:14,741][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:43:28,014][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:43:40,977][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:43:55,840][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:44:09,280][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:44:23,030][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:44:35,829][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:44:52,578][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:45:05,064][root][INFO] - Processing question number 30
[2025-03-06 21:45:05,067][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:45:20,108][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:45:34,376][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:45:52,169][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:46:05,709][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:46:17,679][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:46:32,385][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:46:47,866][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:47:04,281][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:47:18,874][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:47:34,668][root][INFO] - Processing question number 40
[2025-03-06 21:47:34,673][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:47:48,558][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:48:03,458][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:48:20,395][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:48:32,471][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:48:45,210][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:49:00,928][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:49:15,295][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:49:29,876][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:49:43,389][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:49:58,616][root][INFO] - Processing question number 50
[2025-03-06 21:49:58,620][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:50:12,722][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:50:31,891][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:50:44,919][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:50:59,782][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:51:13,180][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:51:25,873][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:51:43,854][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:51:56,439][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:52:10,898][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:52:24,606][root][INFO] - Processing question number 60
[2025-03-06 21:52:24,610][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:52:38,713][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:52:50,062][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:53:04,375][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:53:14,903][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:53:28,167][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:53:42,573][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:53:56,545][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:54:12,826][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:54:25,036][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:54:44,719][root][INFO] - Processing question number 70
[2025-03-06 21:54:44,723][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:54:58,629][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:55:13,169][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:55:25,231][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:55:43,155][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:55:58,532][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:56:13,500][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:56:30,233][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:56:43,521][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:56:58,084][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:57:17,906][root][INFO] - Processing question number 80
[2025-03-06 21:57:17,911][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:57:33,644][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:57:55,101][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:58:07,254][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:58:19,619][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:58:32,956][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:58:47,042][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:59:02,518][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:59:14,686][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:59:31,991][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:59:44,900][root][INFO] - Processing question number 90
[2025-03-06 21:59:44,906][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:00:01,809][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:00:18,852][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:00:32,919][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:00:45,196][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:00:59,105][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:01:14,044][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:01:26,506][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:01:40,111][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:01:54,141][root][INFO] - Inference complete
[2025-03-06 22:01:54,141][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:01:54,148][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:01:54,160][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:01:54,167][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:01:54,167][root][INFO] - Saved parsed outputs
[2025-03-06 22:01:54,167][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:01:54,169][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:01:54,169][root][INFO] - Saved parsing metadata
[2025-03-06 22:01:54,170][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:01:54,172][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:01:54,173][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:01:54,186][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_1
[2025-03-06 22:01:54,186][root][INFO] - Summary of metrics : {'label_accuracy': 0.47474747474747475, 'misclassification_rate': 0.5252525252525253, 'combined_accuracy': 0.43434343434343436, 'malformed_label': 1, 'malformed_domain': 10, 'total_predictions': 99, 'correct_predictions': 47, 'correct_label_and_domain': 43, 'Constitutional_Law_accuracy': 0.7142857142857143, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 4, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-06 22:02:00,699][root][INFO] - Setting global seed to 989
[2025-03-06 22:02:00,704][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:02:00,704][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:02:00,706][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:02:00,707][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:02:00,709][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:02:00,709][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:02:00,863][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:02:01,458][root][INFO] - Full model selected, loading model
[2025-03-06 22:02:25,855][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:04:08,528][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:04:08,541][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:04:43,151][root][INFO] - Peft model loaded successfully
[2025-03-06 22:04:50,690][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:04:50,693][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:04:50,693][root][INFO] - Starting inference
[2025-03-06 22:04:50,872][root][INFO] - Processing question number 0
[2025-03-06 22:04:50,874][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:05:09,220][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:05:26,437][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:05:40,403][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:05:54,957][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:06:09,277][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:06:23,965][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:06:40,038][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:06:52,727][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:07:07,253][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:07:19,950][root][INFO] - Processing question number 10
[2025-03-06 22:07:19,952][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:07:34,741][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:07:48,441][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:08:00,962][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:08:15,812][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:08:29,818][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:08:42,534][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:08:54,939][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:09:08,607][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:09:23,864][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:09:38,287][root][INFO] - Processing question number 20
[2025-03-06 22:09:38,290][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:09:52,811][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:10:07,791][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:10:23,020][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:10:36,743][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:10:52,537][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:11:05,931][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:11:19,958][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:11:32,252][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:11:46,653][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:11:58,781][root][INFO] - Processing question number 30
[2025-03-06 22:11:58,784][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:12:14,877][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:12:29,081][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:12:43,628][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:12:58,250][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:13:10,461][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:13:25,329][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:13:40,573][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:13:58,995][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:14:16,213][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:14:32,131][root][INFO] - Processing question number 40
[2025-03-06 22:14:32,134][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:14:46,105][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:15:01,280][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:15:16,515][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:15:31,079][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:15:44,330][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:15:59,038][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:16:13,140][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:16:29,360][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:16:42,466][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:16:59,595][root][INFO] - Processing question number 50
[2025-03-06 22:16:59,599][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:17:14,222][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:17:34,013][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:17:48,472][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:18:01,984][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:18:16,246][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:18:27,477][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:18:43,141][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:18:55,824][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:19:10,334][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:19:22,819][root][INFO] - Processing question number 60
[2025-03-06 22:19:22,823][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:19:37,014][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:19:48,457][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:20:01,566][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:20:12,192][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:20:26,252][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:20:39,528][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:20:53,139][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:21:08,048][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:21:20,605][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:21:36,838][root][INFO] - Processing question number 70
[2025-03-06 22:21:36,843][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:21:52,129][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:22:06,631][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:22:19,698][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:22:35,358][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:22:51,063][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:23:07,260][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:23:25,198][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:23:39,568][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:23:55,202][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:24:12,465][root][INFO] - Processing question number 80
[2025-03-06 22:24:12,470][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:24:26,515][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:24:47,555][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:24:58,927][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:25:11,387][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:25:24,895][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:25:39,072][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:25:53,768][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:26:06,091][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:26:23,549][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:26:37,796][root][INFO] - Processing question number 90
[2025-03-06 22:26:37,801][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:26:54,875][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:27:11,642][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:27:25,450][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:27:37,156][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:27:51,513][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:28:06,455][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:28:18,869][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:28:33,194][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:28:48,733][root][INFO] - Inference complete
[2025-03-06 22:28:48,733][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:28:48,739][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:28:48,751][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:28:48,766][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:28:48,766][root][INFO] - Saved parsed outputs
[2025-03-06 22:28:48,766][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:28:48,767][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:28:48,768][root][INFO] - Saved parsing metadata
[2025-03-06 22:28:48,768][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:28:48,770][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:28:48,771][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:28:48,788][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_1
[2025-03-06 22:28:48,788][root][INFO] - Summary of metrics : {'label_accuracy': 0.5353535353535354, 'misclassification_rate': 0.46464646464646464, 'combined_accuracy': 0.48484848484848486, 'malformed_label': 0, 'malformed_domain': 10, 'total_predictions': 99, 'correct_predictions': 53, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.7142857142857143, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.5714285714285714, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 41, 'correct_label_wrong_domain': 5, 'both_wrong': 5}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-06 22:28:55,624][root][INFO] - Setting global seed to 989
[2025-03-06 22:28:55,629][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:28:55,629][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:28:55,630][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:28:55,632][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:28:55,634][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:28:55,634][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:28:55,805][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:28:56,371][root][INFO] - Full model selected, loading model
[2025-03-06 22:29:22,257][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:31:05,536][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:31:05,536][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:31:40,967][root][INFO] - Peft model loaded successfully
[2025-03-06 22:31:48,633][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:31:48,634][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:31:48,634][root][INFO] - Starting inference
[2025-03-06 22:31:48,849][root][INFO] - Processing question number 0
[2025-03-06 22:31:48,851][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:32:01,699][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:32:17,633][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:32:34,649][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:32:48,343][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:33:02,772][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:33:16,973][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:33:32,071][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:33:46,473][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:34:01,269][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:34:15,424][root][INFO] - Processing question number 10
[2025-03-06 22:34:15,426][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:34:31,888][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:34:44,536][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:34:58,708][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:35:13,892][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:35:27,049][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:35:40,597][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:35:53,056][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:36:06,175][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:36:19,192][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:36:33,783][root][INFO] - Processing question number 20
[2025-03-06 22:36:33,785][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:36:48,866][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:37:03,279][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:37:17,679][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:37:31,216][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:37:47,736][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:38:00,274][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:38:14,083][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:38:27,960][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:38:42,207][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:38:54,244][root][INFO] - Processing question number 30
[2025-03-06 22:38:54,247][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:39:09,222][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:39:23,743][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:39:37,487][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:39:51,174][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:40:06,456][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:40:22,321][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:40:37,483][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:40:53,873][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:41:07,716][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:41:24,106][root][INFO] - Processing question number 40
[2025-03-06 22:41:24,109][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:41:37,167][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:41:51,943][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:42:10,535][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:42:25,428][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:42:39,301][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:42:52,529][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:43:07,503][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:43:20,754][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:43:40,073][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:43:55,888][root][INFO] - Processing question number 50
[2025-03-06 22:43:55,892][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:44:12,066][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:44:30,728][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:44:44,795][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:45:00,251][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:45:14,119][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:45:26,512][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:45:42,817][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:45:55,970][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:46:09,661][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:46:25,418][root][INFO] - Processing question number 60
[2025-03-06 22:46:25,421][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:46:39,020][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:46:53,267][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:47:08,138][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:47:19,182][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:47:33,020][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:47:46,140][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:47:58,646][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:48:14,851][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:48:26,300][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:48:41,787][root][INFO] - Processing question number 70
[2025-03-06 22:48:41,791][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:48:57,941][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:49:13,108][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:49:27,842][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:49:43,948][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:50:00,216][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:50:15,686][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:50:31,550][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:50:45,070][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:51:01,628][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:51:17,103][root][INFO] - Processing question number 80
[2025-03-06 22:51:17,108][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:51:32,069][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:51:53,056][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:52:06,426][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:52:20,495][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:52:34,199][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:52:49,047][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:53:03,888][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:53:15,754][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:53:31,091][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:53:44,160][root][INFO] - Processing question number 90
[2025-03-06 22:53:44,165][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:54:02,311][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:54:18,186][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:54:32,783][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:54:45,035][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:54:59,061][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:55:15,462][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:55:27,677][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:55:44,132][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:55:59,688][root][INFO] - Inference complete
[2025-03-06 22:55:59,688][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:55:59,695][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:55:59,706][root][WARNING] - |Q. 92||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:55:59,707][root][WARNING] - |Q. 92||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:55:59,707][root][INFO] - |Q. 92||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:55:59,708][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:55:59,721][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:55:59,721][root][INFO] - Saved parsed outputs
[2025-03-06 22:55:59,721][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:55:59,722][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:55:59,722][root][INFO] - Saved parsing metadata
[2025-03-06 22:55:59,723][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:55:59,725][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
[2025-03-06 22:55:59,726][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:55:59,758][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_1
[2025-03-06 22:55:59,758][root][INFO] - Summary of metrics : {'label_accuracy': 0.5252525252525253, 'misclassification_rate': 0.4747474747474747, 'combined_accuracy': 0.494949494949495, 'malformed_label': 1, 'malformed_domain': 10, 'total_predictions': 99, 'correct_predictions': 52, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.7142857142857143, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.5714285714285714, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 40, 'correct_label_wrong_domain': 3, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-06 22:56:06,276][root][INFO] - Setting global seed to 206
[2025-03-06 22:56:06,282][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:56:06,282][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 22:56:06,283][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:56:06,285][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:56:06,286][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:56:06,287][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:56:06,437][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:56:06,995][root][INFO] - Full model selected, loading model
[2025-03-06 22:56:31,781][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:58:14,731][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:58:14,732][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:58:51,179][root][INFO] - Peft model loaded successfully
[2025-03-06 22:58:58,867][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:58:58,869][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 22:58:58,869][root][INFO] - Starting inference
[2025-03-06 22:58:59,062][root][INFO] - Processing question number 0
[2025-03-06 22:58:59,064][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:59:15,545][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:59:30,751][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:59:47,890][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:00:01,656][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:00:15,393][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:00:28,059][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:00:40,172][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:00:55,033][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:01:06,759][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:01:20,313][root][INFO] - Processing question number 10
[2025-03-06 23:01:20,320][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:01:30,743][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:01:45,783][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:01:59,314][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:02:12,855][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:02:27,485][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:02:40,047][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:02:52,030][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:03:05,138][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:03:18,000][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:03:34,503][root][INFO] - Processing question number 20
[2025-03-06 23:03:34,506][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:03:46,639][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:04:02,243][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:04:14,980][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:04:27,683][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:04:41,708][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:04:57,243][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:05:10,414][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:05:22,625][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:05:35,439][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:05:51,815][root][INFO] - Processing question number 30
[2025-03-06 23:05:51,817][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:06:05,945][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:06:20,793][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:06:33,787][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:06:48,410][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:07:02,417][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:07:19,062][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:07:34,214][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:07:49,852][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:08:02,521][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:08:18,833][root][INFO] - Processing question number 40
[2025-03-06 23:08:18,836][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:08:33,253][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:08:46,618][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:09:01,847][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:09:12,661][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:09:30,853][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:09:41,604][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:09:53,872][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:10:07,996][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:10:22,775][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:10:38,769][root][INFO] - Processing question number 50
[2025-03-06 23:10:38,773][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:10:52,899][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:11:05,207][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:11:23,466][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:11:37,321][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:11:51,063][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:12:09,031][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:12:23,826][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:12:38,554][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:12:52,910][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:13:09,099][root][INFO] - Processing question number 60
[2025-03-06 23:13:09,103][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:13:23,406][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:13:38,591][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:13:54,124][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:14:09,703][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:14:23,955][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:14:38,489][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:14:52,327][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:15:03,183][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:15:17,944][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:15:32,713][root][INFO] - Processing question number 70
[2025-03-06 23:15:32,717][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:15:46,699][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:16:00,237][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:16:17,804][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:16:33,684][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:16:47,371][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:17:02,202][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:17:17,545][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:17:35,533][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:17:47,770][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:18:00,422][root][INFO] - Processing question number 80
[2025-03-06 23:18:00,427][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:18:14,204][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:18:28,779][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:18:43,773][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:18:59,825][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:19:14,762][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:19:28,754][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:19:43,736][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:19:57,063][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:20:10,276][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:20:23,754][root][INFO] - Processing question number 90
[2025-03-06 23:20:23,759][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:20:36,455][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:20:53,295][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:21:06,693][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:21:18,550][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:21:33,944][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:21:49,489][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:22:05,929][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:22:18,484][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:22:30,927][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:22:45,658][root][INFO] - Inference complete
[2025-03-06 23:22:45,658][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:22:45,665][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:22:45,671][root][WARNING] - |Q. 60||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:22:45,672][root][WARNING] - |Q. 60||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:22:45,672][root][INFO] - |Q. 60||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:22:45,675][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:22:45,675][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:22:45,675][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:22:45,679][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:22:45,685][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:22:45,685][root][INFO] - Saved parsed outputs
[2025-03-06 23:22:45,685][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:22:45,686][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:22:45,687][root][INFO] - Saved parsing metadata
[2025-03-06 23:22:45,687][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:22:45,688][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:22:45,698][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:22:45,722][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_2
[2025-03-06 23:22:45,722][root][INFO] - Summary of metrics : {'label_accuracy': 0.63, 'misclassification_rate': 0.37, 'combined_accuracy': 0.52, 'malformed_label': 2, 'malformed_domain': 18, 'total_predictions': 100, 'correct_predictions': 63, 'correct_label_and_domain': 52, 'Constitutional_Law_accuracy': 0.9285714285714286, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.5384615384615384, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.07, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.13, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.16, 'correct_domain_wrong_label': 30, 'correct_label_wrong_domain': 11, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-06 23:22:52,926][root][INFO] - Setting global seed to 206
[2025-03-06 23:22:52,931][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:22:52,931][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 23:22:52,933][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:22:52,934][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:22:52,937][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:22:52,937][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:22:53,086][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 23:22:53,994][root][INFO] - Full model selected, loading model
[2025-03-06 23:23:20,542][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:25:05,279][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:25:05,280][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:25:39,499][root][INFO] - Peft model loaded successfully
[2025-03-06 23:25:46,994][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:25:46,996][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:25:46,996][root][INFO] - Starting inference
[2025-03-06 23:25:47,204][root][INFO] - Processing question number 0
[2025-03-06 23:25:47,206][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:26:02,746][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:26:18,183][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:26:38,500][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:26:52,327][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:27:06,128][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:27:18,792][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:27:30,992][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:27:44,893][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:27:57,425][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:28:11,082][root][INFO] - Processing question number 10
[2025-03-06 23:28:11,084][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:28:22,044][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:28:35,731][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:28:50,261][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:29:03,009][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:29:18,241][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:29:33,145][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:29:47,654][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:30:01,226][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:30:13,884][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:30:29,021][root][INFO] - Processing question number 20
[2025-03-06 23:30:29,024][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:30:42,006][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:30:58,456][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:31:11,852][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:31:24,658][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:31:39,154][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:31:53,006][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:32:08,771][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:32:20,615][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:32:34,975][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:32:49,420][root][INFO] - Processing question number 30
[2025-03-06 23:32:49,423][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:33:03,717][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:33:16,631][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:33:30,298][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:33:44,983][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:33:59,251][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:34:20,486][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:34:35,783][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:34:52,175][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:35:04,582][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:35:20,558][root][INFO] - Processing question number 40
[2025-03-06 23:35:20,562][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:35:34,214][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:35:49,724][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:36:05,052][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:36:17,386][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:36:35,642][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:36:46,950][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:36:59,486][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:37:13,944][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:37:28,501][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:37:41,656][root][INFO] - Processing question number 50
[2025-03-06 23:37:41,659][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:37:56,338][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:38:08,723][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:38:23,082][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:38:36,803][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:38:50,630][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:39:08,048][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:39:22,481][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:39:36,872][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:39:52,859][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:40:09,135][root][INFO] - Processing question number 60
[2025-03-06 23:40:09,140][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:40:23,261][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:40:38,370][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:40:54,613][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:41:09,817][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:41:24,211][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:41:38,328][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:41:54,830][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:42:06,828][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:42:21,288][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:42:37,138][root][INFO] - Processing question number 70
[2025-03-06 23:42:37,143][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:42:50,855][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:43:05,576][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:43:21,811][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:43:36,741][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:43:50,517][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:44:04,363][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:44:16,771][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:44:33,795][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:44:45,839][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:44:58,672][root][INFO] - Processing question number 80
[2025-03-06 23:44:58,677][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:45:12,563][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:45:27,561][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:45:43,085][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:45:56,890][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:46:15,518][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:46:33,166][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:46:49,244][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:47:04,384][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:47:17,700][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:47:31,352][root][INFO] - Processing question number 90
[2025-03-06 23:47:31,357][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:47:45,022][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:48:00,159][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:48:10,890][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:48:22,326][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:48:37,377][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:48:53,199][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:49:08,828][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:49:20,973][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:49:33,303][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:49:48,147][root][INFO] - Inference complete
[2025-03-06 23:49:48,147][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:49:48,154][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:49:48,166][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:49:48,172][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:49:48,172][root][INFO] - Saved parsed outputs
[2025-03-06 23:49:48,172][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:49:48,174][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:49:48,174][root][INFO] - Saved parsing metadata
[2025-03-06 23:49:48,175][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:49:48,176][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:49:48,178][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:49:48,219][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_2
[2025-03-06 23:49:48,219][root][INFO] - Summary of metrics : {'label_accuracy': 0.59, 'misclassification_rate': 0.41000000000000003, 'combined_accuracy': 0.48, 'malformed_label': 0, 'malformed_domain': 18, 'total_predictions': 100, 'correct_predictions': 59, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.7857142857142857, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.07, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.13, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.16, 'correct_domain_wrong_label': 34, 'correct_label_wrong_domain': 11, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-06 23:49:55,436][root][INFO] - Setting global seed to 206
[2025-03-06 23:49:55,442][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:49:55,442][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 23:49:55,443][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:49:55,445][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:49:55,447][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:49:55,448][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:49:55,616][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 23:49:56,242][root][INFO] - Full model selected, loading model
[2025-03-06 23:50:22,243][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:52:05,900][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:52:05,901][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:52:39,235][root][INFO] - Peft model loaded successfully
[2025-03-06 23:52:46,438][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:52:46,439][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-06 23:52:46,440][root][INFO] - Starting inference
[2025-03-06 23:52:46,633][root][INFO] - Processing question number 0
[2025-03-06 23:52:46,635][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:53:01,079][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:53:17,004][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:53:34,026][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:53:48,151][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:54:02,037][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:54:16,043][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:54:28,723][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:54:41,683][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:54:53,523][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:55:05,050][root][INFO] - Processing question number 10
[2025-03-06 23:55:05,052][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:55:20,607][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:55:35,694][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:55:50,919][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:56:01,615][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:56:15,681][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:56:28,331][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:56:41,732][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:56:57,877][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:57:11,825][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:57:28,251][root][INFO] - Processing question number 20
[2025-03-06 23:57:28,254][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:57:42,483][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:57:57,435][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:58:10,425][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:58:22,922][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:58:38,229][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:58:55,495][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:59:11,078][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:59:23,944][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:59:37,475][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:59:53,464][root][INFO] - Processing question number 30
[2025-03-06 23:59:53,467][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:00:07,551][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:00:20,295][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:00:34,871][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:00:48,381][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:01:03,114][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:01:18,444][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:01:32,749][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:01:48,200][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:02:02,092][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:02:18,480][root][INFO] - Processing question number 40
[2025-03-07 00:02:18,483][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:02:33,375][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:02:50,124][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:03:06,496][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:03:16,871][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:03:36,538][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:03:47,811][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:03:59,651][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:04:15,249][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:04:29,477][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:04:43,057][root][INFO] - Processing question number 50
[2025-03-07 00:04:43,061][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:04:56,566][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:05:08,821][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:05:28,416][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:05:45,249][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:05:59,942][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:06:15,888][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:06:31,673][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:06:46,164][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:06:58,681][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:07:13,585][root][INFO] - Processing question number 60
[2025-03-07 00:07:13,589][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:07:30,359][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:07:44,121][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:08:00,507][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:08:17,139][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:08:31,038][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:08:44,511][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:08:58,560][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:09:09,108][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:09:22,557][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:09:36,778][root][INFO] - Processing question number 70
[2025-03-07 00:09:36,783][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:09:52,771][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:10:07,653][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:10:21,779][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:10:37,500][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:10:51,483][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:11:06,778][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:11:24,007][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:11:39,620][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:11:52,378][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:12:09,244][root][INFO] - Processing question number 80
[2025-03-07 00:12:09,249][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:12:22,104][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:12:34,731][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:12:51,833][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:13:06,475][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:13:23,583][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:13:38,769][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:13:53,971][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:14:07,147][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:14:19,602][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:14:33,344][root][INFO] - Processing question number 90
[2025-03-07 00:14:33,350][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:14:46,658][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:15:00,452][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:15:13,399][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:15:26,631][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:15:42,369][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:15:58,005][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:16:12,890][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:16:25,536][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:16:37,092][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:16:52,959][root][INFO] - Inference complete
[2025-03-07 00:16:52,959][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:16:52,965][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:16:52,973][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:16:52,973][root][WARNING] - |Q. 19||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:16:52,974][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:16:52,975][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:16:52,975][root][WARNING] - |Q. 61||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:16:52,975][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:16:52,976][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:16:52,976][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:16:52,976][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:16:52,980][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:16:52,986][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:16:52,986][root][INFO] - Saved parsed outputs
[2025-03-07 00:16:52,986][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:16:52,987][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:16:52,988][root][INFO] - Saved parsing metadata
[2025-03-07 00:16:52,988][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:16:52,990][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:16:52,991][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:16:53,028][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_2
[2025-03-07 00:16:53,028][root][INFO] - Summary of metrics : {'label_accuracy': 0.54, 'misclassification_rate': 0.45999999999999996, 'combined_accuracy': 0.43, 'malformed_label': 3, 'malformed_domain': 18, 'total_predictions': 100, 'correct_predictions': 54, 'correct_label_and_domain': 43, 'Constitutional_Law_accuracy': 0.8571428571428571, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.5714285714285714, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.07, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.13, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.16, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 11, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-07 00:17:05,651][root][INFO] - Setting global seed to 989
[2025-03-07 00:17:05,674][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:17:05,674][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 00:17:05,676][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:17:05,677][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:17:05,680][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:17:05,680][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:17:05,824][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-07 00:17:06,565][root][INFO] - Full model selected, loading model
[2025-03-07 00:17:31,155][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:19:14,304][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:19:14,305][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:19:48,027][root][INFO] - Peft model loaded successfully
[2025-03-07 00:19:55,251][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:19:55,252][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:19:55,252][root][INFO] - Starting inference
[2025-03-07 00:19:55,423][root][INFO] - Processing question number 0
[2025-03-07 00:19:55,425][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:20:11,725][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:20:26,937][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:20:44,087][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:20:57,857][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:21:11,606][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:21:24,279][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:21:36,402][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:21:51,276][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:22:03,009][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:22:16,565][root][INFO] - Processing question number 10
[2025-03-07 00:22:16,568][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:22:26,996][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:22:42,056][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:22:55,620][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:23:09,169][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:23:23,790][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:23:36,373][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:23:48,405][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:24:01,559][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:24:14,447][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:24:31,006][root][INFO] - Processing question number 20
[2025-03-07 00:24:31,009][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:24:43,166][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:24:58,815][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:25:11,596][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:25:24,345][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:25:38,366][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:25:53,915][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:26:07,089][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:26:19,304][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:26:32,136][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:26:48,545][root][INFO] - Processing question number 30
[2025-03-07 00:26:48,548][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:27:02,691][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:27:17,532][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:27:30,523][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:27:45,184][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:27:59,200][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:28:15,859][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:28:31,029][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:28:46,683][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:28:59,358][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:29:15,681][root][INFO] - Processing question number 40
[2025-03-07 00:29:15,684][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:29:30,149][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:29:43,542][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:29:58,779][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:30:09,593][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:30:27,744][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:30:38,493][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:30:50,775][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:31:04,918][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:31:19,697][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:31:35,680][root][INFO] - Processing question number 50
[2025-03-07 00:31:35,684][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:31:49,792][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:32:02,098][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:32:20,342][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:32:34,180][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:32:47,905][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:33:05,875][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:33:20,672][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:33:35,416][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:33:49,789][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:34:05,980][root][INFO] - Processing question number 60
[2025-03-07 00:34:05,984][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:34:20,287][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:34:35,479][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:34:51,026][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:35:06,627][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:35:20,886][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:35:35,433][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:35:49,289][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:36:00,165][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:36:14,936][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:36:29,717][root][INFO] - Processing question number 70
[2025-03-07 00:36:29,721][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:36:43,713][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:36:57,262][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:37:14,844][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:37:30,717][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:37:44,397][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:37:59,244][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:38:14,587][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:38:32,573][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:38:44,789][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:38:57,420][root][INFO] - Processing question number 80
[2025-03-07 00:38:57,425][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:39:11,207][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:39:25,795][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:39:40,800][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:39:56,865][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:40:11,816][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:40:25,821][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:40:40,814][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:40:54,147][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:41:07,373][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:41:20,867][root][INFO] - Processing question number 90
[2025-03-07 00:41:20,873][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:41:33,572][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:41:50,424][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:42:03,820][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:42:15,678][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:42:31,079][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:42:46,637][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:43:03,073][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:43:15,630][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:43:28,075][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:43:42,821][root][INFO] - Inference complete
[2025-03-07 00:43:42,821][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:43:42,828][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:43:42,834][root][WARNING] - |Q. 60||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:43:42,834][root][WARNING] - |Q. 60||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:43:42,835][root][INFO] - |Q. 60||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:43:42,837][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:43:42,837][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:43:42,838][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:43:42,841][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:43:42,847][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:43:42,847][root][INFO] - Saved parsed outputs
[2025-03-07 00:43:42,847][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:43:42,848][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:43:42,848][root][INFO] - Saved parsing metadata
[2025-03-07 00:43:42,849][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:43:42,850][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:43:42,851][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:43:42,864][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_2
[2025-03-07 00:43:42,864][root][INFO] - Summary of metrics : {'label_accuracy': 0.63, 'misclassification_rate': 0.37, 'combined_accuracy': 0.52, 'malformed_label': 2, 'malformed_domain': 18, 'total_predictions': 100, 'correct_predictions': 63, 'correct_label_and_domain': 52, 'Constitutional_Law_accuracy': 0.9285714285714286, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.5384615384615384, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.07, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.13, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.16, 'correct_domain_wrong_label': 30, 'correct_label_wrong_domain': 11, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-07 00:43:49,649][root][INFO] - Setting global seed to 989
[2025-03-07 00:43:49,654][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:43:49,654][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 00:43:49,656][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:43:49,657][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:43:49,659][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:43:49,660][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:43:49,846][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-07 00:43:50,440][root][INFO] - Full model selected, loading model
[2025-03-07 00:44:14,778][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:45:56,227][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:45:56,227][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:46:29,307][root][INFO] - Peft model loaded successfully
[2025-03-07 00:46:36,582][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:46:36,583][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 00:46:36,584][root][INFO] - Starting inference
[2025-03-07 00:46:36,804][root][INFO] - Processing question number 0
[2025-03-07 00:46:36,805][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:46:52,014][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:47:07,991][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:47:25,799][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:47:41,967][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:47:56,037][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:48:08,014][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:48:20,186][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:48:34,518][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:48:46,057][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:48:59,470][root][INFO] - Processing question number 10
[2025-03-07 00:48:59,472][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:49:12,104][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:49:27,395][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:49:41,570][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:49:55,238][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:50:11,680][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:50:26,625][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:50:39,945][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:50:53,272][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:51:06,767][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:51:24,052][root][INFO] - Processing question number 20
[2025-03-07 00:51:24,055][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:51:38,608][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:51:55,637][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:52:08,188][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:52:20,708][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:52:35,565][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:52:51,241][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:53:06,266][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:53:18,582][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:53:31,562][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:53:49,207][root][INFO] - Processing question number 30
[2025-03-07 00:53:49,210][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:54:03,023][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:54:16,533][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:54:30,040][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:54:44,283][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:55:00,062][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:55:15,409][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:55:30,195][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:55:45,451][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:55:58,504][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:56:16,033][root][INFO] - Processing question number 40
[2025-03-07 00:56:16,036][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:56:30,181][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:56:44,393][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:57:00,645][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:57:11,790][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:57:30,078][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:57:41,583][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:57:53,484][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:58:09,276][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:58:24,500][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:58:37,877][root][INFO] - Processing question number 50
[2025-03-07 00:58:37,881][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:58:52,082][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:59:05,912][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:59:20,942][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:59:34,763][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:59:48,781][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 01:00:07,232][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 01:00:22,320][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 01:00:36,697][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 01:00:50,229][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 01:01:09,572][root][INFO] - Processing question number 60
[2025-03-07 01:01:09,576][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 01:01:23,343][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 01:01:37,618][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 01:01:52,156][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 01:02:08,700][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 01:02:23,774][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 01:02:39,645][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 01:02:54,449][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 01:03:07,242][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 01:03:20,580][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 01:03:37,696][root][INFO] - Processing question number 70
[2025-03-07 01:03:37,701][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 01:03:51,619][root][INFO] - Domain : Property, Question : 9
[2025-03-07 01:04:06,754][root][INFO] - Domain : Property, Question : 17
[2025-03-07 01:04:19,267][root][INFO] - Domain : Property, Question : 25
[2025-03-07 01:04:35,137][root][INFO] - Domain : Property, Question : 30
[2025-03-07 01:04:46,518][root][INFO] - Domain : Property, Question : 36
[2025-03-07 01:05:01,074][root][INFO] - Domain : Property, Question : 46
[2025-03-07 01:05:15,976][root][INFO] - Domain : Property, Question : 53
[2025-03-07 01:05:34,708][root][INFO] - Domain : Property, Question : 59
[2025-03-07 01:05:47,680][root][INFO] - Domain : Property, Question : 66
[2025-03-07 01:06:02,780][root][INFO] - Processing question number 80
[2025-03-07 01:06:02,785][root][INFO] - Domain : Property, Question : 69
[2025-03-07 01:06:16,702][root][INFO] - Domain : Property, Question : 81
[2025-03-07 01:06:31,181][root][INFO] - Domain : Property, Question : 88
[2025-03-07 01:06:46,337][root][INFO] - Domain : Property, Question : 91
[2025-03-07 01:07:01,087][root][INFO] - Domain : Property, Question : 94
[2025-03-07 01:07:16,923][root][INFO] - Domain : Property, Question : 100
[2025-03-07 01:07:31,593][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 01:07:47,727][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 01:08:01,929][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 01:08:14,727][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 01:08:28,661][root][INFO] - Processing question number 90
[2025-03-07 01:08:28,666][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 01:08:41,861][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 01:08:55,366][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 01:09:06,391][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 01:09:18,394][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 01:09:34,011][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 01:09:49,979][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 01:10:04,155][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 01:10:16,746][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 01:10:30,442][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 01:10:44,890][root][INFO] - Inference complete
[2025-03-07 01:10:44,891][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:10:44,898][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:10:44,910][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:10:44,916][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:10:44,916][root][INFO] - Saved parsed outputs
[2025-03-07 01:10:44,916][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:10:44,918][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:10:44,918][root][INFO] - Saved parsing metadata
[2025-03-07 01:10:44,918][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:10:44,920][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:10:44,921][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 01:10:45,040][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_2
[2025-03-07 01:10:45,041][root][INFO] - Summary of metrics : {'label_accuracy': 0.61, 'misclassification_rate': 0.39, 'combined_accuracy': 0.48, 'malformed_label': 0, 'malformed_domain': 18, 'total_predictions': 100, 'correct_predictions': 61, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.9285714285714286, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.5714285714285714, 'Civil_Procedure_accuracy': 0.46153846153846156, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.07, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.13, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.16, 'correct_domain_wrong_label': 34, 'correct_label_wrong_domain': 13, 'both_wrong': 5}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 26 to status running with exit code None
Eval status update completed for job 26
[2025-03-07 01:11:33,297][root][INFO] - Setting global seed to 989
[2025-03-07 01:11:33,409][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 01:11:33,410][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-07 01:11:33,411][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 01:11:33,414][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 01:11:33,419][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 01:11:33,420][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 01:11:33,604][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-07 01:11:34,310][root][INFO] - Full model selected, loading model
[2025-03-07 01:12:04,065][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-07 01:13:56,030][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 01:13:56,032][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 01:14:31,755][root][INFO] - Peft model loaded successfully
[2025-03-07 01:14:39,458][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 01:14:39,460][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:14:39,460][root][INFO] - Starting inference
[2025-03-07 01:14:39,715][root][INFO] - Processing question number 0
[2025-03-07 01:14:39,717][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 01:14:53,722][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 01:15:10,123][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 01:15:28,974][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 01:15:45,745][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 01:15:57,325][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 01:16:10,316][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 01:16:23,266][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 01:16:35,654][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 01:16:47,411][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 01:16:59,770][root][INFO] - Processing question number 10
[2025-03-07 01:16:59,772][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 01:17:11,050][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 01:17:22,260][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 01:17:35,832][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 01:17:47,706][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 01:18:03,294][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 01:18:15,848][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 01:18:29,939][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 01:18:41,593][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 01:18:54,942][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 01:19:11,818][root][INFO] - Processing question number 20
[2025-03-07 01:19:11,820][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 01:19:25,274][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 01:19:40,777][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 01:19:54,294][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 01:20:05,653][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 01:20:20,880][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 01:20:36,153][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 01:20:50,928][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 01:21:06,163][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 01:21:19,047][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 01:21:40,944][root][INFO] - Processing question number 30
[2025-03-07 01:21:40,947][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 01:21:54,925][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 01:22:07,709][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 01:22:21,895][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 01:22:36,201][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 01:22:51,896][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 01:23:05,034][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 01:23:19,153][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 01:23:35,421][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 01:23:49,802][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 01:24:07,365][root][INFO] - Processing question number 40
[2025-03-07 01:24:07,370][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 01:24:20,084][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 01:24:34,548][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 01:24:52,226][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 01:25:04,618][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 01:25:23,802][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 01:25:34,670][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 01:25:46,490][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 01:25:59,921][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 01:26:12,400][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 01:26:28,242][root][INFO] - Processing question number 50
[2025-03-07 01:26:28,246][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 01:26:42,747][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 01:26:55,009][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 01:27:11,371][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 01:27:26,662][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 01:27:40,357][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 01:27:59,212][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 01:28:14,125][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 01:28:30,706][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 01:28:44,980][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 01:29:00,518][root][INFO] - Processing question number 60
[2025-03-07 01:29:00,522][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 01:29:14,120][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 01:29:29,346][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 01:29:44,113][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 01:30:00,967][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 01:30:14,837][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 01:30:30,293][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 01:30:42,588][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 01:30:55,371][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 01:31:09,610][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 01:31:23,446][root][INFO] - Processing question number 70
[2025-03-07 01:31:23,452][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 01:31:38,730][root][INFO] - Domain : Property, Question : 9
[2025-03-07 01:31:52,450][root][INFO] - Domain : Property, Question : 17
[2025-03-07 01:32:07,787][root][INFO] - Domain : Property, Question : 25
[2025-03-07 01:32:22,966][root][INFO] - Domain : Property, Question : 30
[2025-03-07 01:32:37,166][root][INFO] - Domain : Property, Question : 36
[2025-03-07 01:32:53,878][root][INFO] - Domain : Property, Question : 46
[2025-03-07 01:33:09,495][root][INFO] - Domain : Property, Question : 53
[2025-03-07 01:33:24,561][root][INFO] - Domain : Property, Question : 59
[2025-03-07 01:33:37,620][root][INFO] - Domain : Property, Question : 66
[2025-03-07 01:33:50,042][root][INFO] - Processing question number 80
[2025-03-07 01:33:50,048][root][INFO] - Domain : Property, Question : 69
[2025-03-07 01:34:05,492][root][INFO] - Domain : Property, Question : 81
[2025-03-07 01:34:19,792][root][INFO] - Domain : Property, Question : 88
[2025-03-07 01:34:33,995][root][INFO] - Domain : Property, Question : 91
[2025-03-07 01:34:49,020][root][INFO] - Domain : Property, Question : 94
[2025-03-07 01:35:07,644][root][INFO] - Domain : Property, Question : 100
[2025-03-07 01:35:22,140][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 01:35:37,116][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 01:35:50,835][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 01:36:04,809][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 01:36:22,457][root][INFO] - Processing question number 90
[2025-03-07 01:36:22,464][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 01:36:36,572][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 01:36:54,299][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 01:37:06,502][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 01:37:19,700][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 01:37:34,649][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 01:37:49,286][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 01:38:05,780][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 01:38:18,511][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 01:38:30,881][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 01:38:44,836][root][INFO] - Inference complete
[2025-03-07 01:38:44,836][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:38:44,843][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:38:44,849][root][WARNING] - |Q. 60||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 01:38:44,850][root][WARNING] - |Q. 60||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 01:38:44,850][root][INFO] - |Q. 60||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 01:38:44,856][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:38:44,862][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:38:44,862][root][INFO] - Saved parsed outputs
[2025-03-07 01:38:44,862][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:38:44,863][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:38:44,863][root][INFO] - Saved parsing metadata
[2025-03-07 01:38:44,864][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:38:44,866][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
[2025-03-07 01:38:44,867][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 01:38:44,894][root][INFO] - Evaluation completed for json_fact_first_few_shot_structured, on test_set_2
[2025-03-07 01:38:44,894][root][INFO] - Summary of metrics : {'label_accuracy': 0.59, 'misclassification_rate': 0.41000000000000003, 'combined_accuracy': 0.48, 'malformed_label': 1, 'malformed_domain': 18, 'total_predictions': 100, 'correct_predictions': 59, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.7857142857142857, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.6428571428571429, 'Civil_Procedure_accuracy': 0.6153846153846154, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.16, 'Criminal_Law_confidence': 0.07, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.13, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.16, 'correct_domain_wrong_label': 34, 'correct_label_wrong_domain': 11, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '26', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 26 to status completed with exit code 0
Eval status update completed for job 26
Job 26 completed at Fri Mar  7 01:38:46 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n517
Job ID: 25358401
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 06:31:14
CPU Efficiency: 9.87% of 2-18:03:30 core-walltime
Job Wall-clock time: 06:36:21
Memory Utilized: 34.53 GB
Memory Efficiency: 95.93% of 36.00 GB
