Starting job 4 at Thu Mar  6 08:05:08 CET 2025
Configuration: model=llama3 tokenizer=llama3 dataset=all_domains_1_samples prompt=json_answer_first_few_shot_unstructured train=json_answer_first_few_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '4', 'training']
Updating job 4 to status training with exit code None
Status update completed for job 4
[2025-03-06 08:05:28,026][root][INFO] - Global seed set to 314
[2025-03-06 08:05:28,027][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 08:05:28,027][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 08:05:28,027][root][INFO] - Running Fine-tuning on the all_domains_1_samples dataset
[2025-03-06 08:05:28,028][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 08:05:28,028][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 08:05:28,045][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 08:05:28,080][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 08:05:28,082][root][INFO] - Questions selected, dataset contains 7 questions with 1.0 questions per domain
[2025-03-06 08:05:28,088][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 08:05:28,824][root][INFO] - Tokenizer meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 08:05:52,886][root][INFO] - Quantised model meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 08:06:22,689][root][INFO] - Model prepared for kbit training
[2025-03-06 08:06:22,690][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'o_proj', 'k_proj', 'gate_proj', 'up_proj', 'down_proj', 'q_proj', 'v_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 08:06:24,398][root][INFO] - Lora adapter added to model
[2025-03-06 08:06:24,401][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_1_samples/llama3_json_answer_first_few_shot_unstructured
[2025-03-06 08:06:24,715][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.8119, 'grad_norm': 0.3723083436489105, 'learning_rate': 9.42728012826605e-05, 'epoch': 3.0}
{'loss': 1.5064, 'grad_norm': 0.3444995582103729, 'learning_rate': 3.226975564787322e-05, 'epoch': 6.0}
{'loss': 1.2966, 'grad_norm': 0.3705584704875946, 'learning_rate': 9.85470908713026e-05, 'epoch': 9.0}
{'loss': 1.1216, 'grad_norm': 0.4922582507133484, 'learning_rate': 4.397316598723383e-05, 'epoch': 12.0}
{'loss': 0.8376, 'grad_norm': 0.4661714732646942, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 415.5316, 'train_samples_per_second': 0.253, 'train_steps_per_second': 0.036, 'train_loss': 1.3148217678070069, 'epoch': 15.0}
[2025-03-06 08:13:27,716][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_1_samples/llama3_json_answer_first_few_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '4', 'trained', '0']
Updating job 4 to status trained with exit code 0
Status update completed for job 4
Starting evaluations for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 08:13:37,733][root][INFO] - Setting global seed to 206
[2025-03-06 08:13:37,739][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 08:13:37,740][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 08:13:37,741][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 08:13:37,744][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 08:13:37,749][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 08:13:37,749][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 08:13:37,899][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 08:13:38,427][root][INFO] - Full model selected, loading model
[2025-03-06 08:13:59,956][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 08:15:48,762][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 08:15:48,763][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 08:16:19,959][root][INFO] - Peft model loaded successfully
[2025-03-06 08:16:27,549][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 08:16:27,551][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:16:27,551][root][INFO] - Starting inference
[2025-03-06 08:16:27,704][root][INFO] - Processing question number 0
[2025-03-06 08:16:27,706][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 08:16:37,752][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 08:16:50,868][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 08:17:04,491][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 08:17:35,779][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 08:17:46,893][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 08:18:05,003][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 08:18:14,112][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 08:18:25,432][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 08:18:35,249][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 08:19:06,526][root][INFO] - Processing question number 10
[2025-03-06 08:19:06,528][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 08:19:16,114][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 08:19:31,407][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 08:19:39,601][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 08:19:46,554][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 08:19:55,417][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 08:20:04,527][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 08:20:14,379][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 08:20:22,972][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 08:20:32,402][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 08:20:40,412][root][INFO] - Processing question number 20
[2025-03-06 08:20:40,414][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 08:20:52,297][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 08:21:04,138][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 08:21:15,351][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 08:21:46,126][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 08:21:55,193][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 08:22:05,495][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 08:22:16,130][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 08:22:30,756][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 08:23:01,901][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 08:23:11,097][root][INFO] - Processing question number 30
[2025-03-06 08:23:11,100][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 08:23:21,875][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 08:23:31,390][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 08:23:48,718][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 08:23:59,512][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 08:24:12,196][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 08:24:43,599][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 08:24:51,043][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 08:25:10,364][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 08:25:21,901][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 08:25:35,511][root][INFO] - Processing question number 40
[2025-03-06 08:25:35,514][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 08:25:47,471][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 08:25:58,571][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 08:26:13,729][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 08:26:22,835][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 08:26:35,020][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 08:26:46,695][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 08:26:54,427][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 08:27:05,437][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 08:27:13,730][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 08:27:27,069][root][INFO] - Processing question number 50
[2025-03-06 08:27:27,073][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 08:27:36,702][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 08:27:50,637][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 08:27:59,935][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 08:28:11,363][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 08:28:22,492][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 08:28:33,049][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 08:28:45,161][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 08:29:07,887][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 08:29:18,862][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 08:29:25,982][root][INFO] - Processing question number 60
[2025-03-06 08:29:25,986][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 08:29:33,285][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 08:29:45,720][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 08:29:58,747][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 08:30:09,829][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 08:30:22,008][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 08:30:53,121][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 08:31:08,628][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 08:31:39,893][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 08:32:11,098][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 08:32:42,439][root][INFO] - Processing question number 70
[2025-03-06 08:32:42,444][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 08:32:53,044][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 08:33:06,421][root][INFO] - Domain : Property, Question : 6
[2025-03-06 08:33:16,803][root][INFO] - Domain : Property, Question : 13
[2025-03-06 08:33:31,031][root][INFO] - Domain : Property, Question : 20
[2025-03-06 08:33:42,320][root][INFO] - Domain : Property, Question : 33
[2025-03-06 08:33:57,111][root][INFO] - Domain : Property, Question : 39
[2025-03-06 08:34:08,081][root][INFO] - Domain : Property, Question : 48
[2025-03-06 08:34:16,613][root][INFO] - Domain : Property, Question : 54
[2025-03-06 08:34:26,889][root][INFO] - Domain : Property, Question : 61
[2025-03-06 08:34:57,907][root][INFO] - Processing question number 80
[2025-03-06 08:34:57,912][root][INFO] - Domain : Property, Question : 67
[2025-03-06 08:35:06,748][root][INFO] - Domain : Property, Question : 75
[2025-03-06 08:35:16,897][root][INFO] - Domain : Property, Question : 83
[2025-03-06 08:35:27,516][root][INFO] - Domain : Property, Question : 89
[2025-03-06 08:35:38,740][root][INFO] - Domain : Property, Question : 97
[2025-03-06 08:35:49,506][root][INFO] - Domain : Property, Question : 100
[2025-03-06 08:36:02,081][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 08:36:11,506][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 08:36:17,076][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 08:36:33,576][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 08:36:47,013][root][INFO] - Processing question number 90
[2025-03-06 08:36:47,018][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 08:37:18,737][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 08:37:27,703][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 08:37:58,768][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 08:38:04,969][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 08:38:14,839][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 08:38:26,688][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 08:38:35,197][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 08:39:06,366][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 08:39:15,763][root][INFO] - Inference complete
[2025-03-06 08:39:15,764][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:39:15,771][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:39:15,772][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,772][root][WARNING] - |Q. 7||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,773][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,773][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,773][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,774][root][WARNING] - |Q. 21||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,774][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,774][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,775][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,775][root][WARNING] - |Q. 63||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,775][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,775][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,777][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,778][root][WARNING] - |Q. 55||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,778][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,778][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,779][root][WARNING] - |Q. 87||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,779][root][WARNING] - |Q. 87||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,779][root][INFO] - |Q. 87||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,779][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,780][root][WARNING] - |Q. 38||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,781][root][WARNING] - |Q. 38||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,781][root][INFO] - |Q. 38||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,781][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,785][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,785][root][WARNING] - |Q. 53||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,785][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,785][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,786][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,786][root][WARNING] - |Q. 68||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,786][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,786][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,787][root][WARNING] - |Q. 73||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,787][root][WARNING] - |Q. 73||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,787][root][INFO] - |Q. 73||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,787][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,788][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,788][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,788][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,788][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,790][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,790][root][WARNING] - |Q. 61||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,790][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,790][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,792][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,792][root][WARNING] - |Q. 36||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,792][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,792][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,792][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,793][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,793][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,793][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,794][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 08:39:15,794][root][WARNING] - |Q. 85||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:39:15,794][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 08:39:15,794][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:39:15,795][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:39:15,800][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:39:15,801][root][INFO] - Saved parsed outputs
[2025-03-06 08:39:15,801][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:39:15,802][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:39:15,802][root][INFO] - Saved parsing metadata
[2025-03-06 08:39:15,803][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:39:15,805][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:39:15,806][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 08:39:15,836][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 08:39:15,837][root][INFO] - Summary of metrics : {'label_accuracy': 0.48484848484848486, 'misclassification_rate': 0.5151515151515151, 'combined_accuracy': 0.41414141414141414, 'malformed_label': 0, 'malformed_domain': 13, 'total_predictions': 99, 'correct_predictions': 48, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.5384615384615384, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.10101010101010101, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 7, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 08:39:28,203][root][INFO] - Setting global seed to 206
[2025-03-06 08:39:28,210][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 08:39:28,210][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 08:39:28,212][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 08:39:28,214][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 08:39:28,217][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 08:39:28,217][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 08:39:28,396][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 08:39:28,932][root][INFO] - Full model selected, loading model
[2025-03-06 08:39:48,832][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 08:39:48,832][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 08:39:56,298][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 08:39:56,300][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:39:56,300][root][INFO] - Starting inference
[2025-03-06 08:39:56,484][root][INFO] - Processing question number 0
[2025-03-06 08:39:56,487][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 08:40:07,307][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 08:40:17,202][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 08:40:27,324][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 08:40:34,624][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 08:40:42,638][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 08:40:53,557][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 08:41:05,005][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 08:41:15,069][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 08:41:24,245][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 08:41:34,914][root][INFO] - Processing question number 10
[2025-03-06 08:41:34,916][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 08:41:43,875][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 08:41:52,152][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 08:41:59,176][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 08:42:05,998][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 08:42:12,532][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 08:42:21,421][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 08:42:29,854][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 08:42:37,714][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 08:42:45,662][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 08:42:56,075][root][INFO] - Processing question number 20
[2025-03-06 08:42:56,077][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 08:43:06,263][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 08:43:14,523][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 08:43:23,860][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 08:43:32,417][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 08:43:43,023][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 08:43:50,180][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 08:43:58,195][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 08:44:05,704][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 08:44:15,369][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 08:44:21,851][root][INFO] - Processing question number 30
[2025-03-06 08:44:21,854][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 08:44:30,735][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 08:44:38,512][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 08:44:48,320][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 08:44:57,822][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 08:45:05,900][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 08:45:13,811][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 08:45:20,875][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 08:45:34,057][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 08:45:42,072][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 08:45:50,370][root][INFO] - Processing question number 40
[2025-03-06 08:45:50,373][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 08:46:00,575][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 08:46:08,550][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 08:46:20,799][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 08:46:30,752][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 08:46:38,626][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 08:46:47,464][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 08:46:55,049][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 08:47:03,810][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 08:47:10,934][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 08:47:19,940][root][INFO] - Processing question number 50
[2025-03-06 08:47:19,944][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 08:47:29,054][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 08:47:38,918][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 08:47:48,258][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 08:47:56,738][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 08:48:08,002][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 08:48:15,064][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 08:48:26,897][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 08:48:36,007][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 08:48:47,777][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 08:48:56,654][root][INFO] - Processing question number 60
[2025-03-06 08:48:56,658][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 08:49:06,647][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 08:49:15,262][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 08:49:25,018][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 08:49:32,412][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 08:49:41,398][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 08:49:53,302][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 08:50:01,021][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 08:50:10,882][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 08:50:18,364][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 08:50:26,021][root][INFO] - Processing question number 70
[2025-03-06 08:50:26,025][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 08:50:34,445][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 08:50:43,208][root][INFO] - Domain : Property, Question : 6
[2025-03-06 08:50:50,157][root][INFO] - Domain : Property, Question : 13
[2025-03-06 08:51:01,495][root][INFO] - Domain : Property, Question : 20
[2025-03-06 08:51:10,085][root][INFO] - Domain : Property, Question : 33
[2025-03-06 08:51:19,544][root][INFO] - Domain : Property, Question : 39
[2025-03-06 08:51:28,844][root][INFO] - Domain : Property, Question : 48
[2025-03-06 08:51:38,165][root][INFO] - Domain : Property, Question : 54
[2025-03-06 08:51:50,378][root][INFO] - Domain : Property, Question : 61
[2025-03-06 08:51:59,651][root][INFO] - Processing question number 80
[2025-03-06 08:51:59,656][root][INFO] - Domain : Property, Question : 67
[2025-03-06 08:52:09,776][root][INFO] - Domain : Property, Question : 75
[2025-03-06 08:52:20,259][root][INFO] - Domain : Property, Question : 83
[2025-03-06 08:52:32,247][root][INFO] - Domain : Property, Question : 89
[2025-03-06 08:52:40,320][root][INFO] - Domain : Property, Question : 97
[2025-03-06 08:53:11,663][root][INFO] - Domain : Property, Question : 100
[2025-03-06 08:53:21,083][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 08:53:30,154][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 08:53:38,865][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 08:53:47,918][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 08:53:55,789][root][INFO] - Processing question number 90
[2025-03-06 08:53:55,805][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 08:54:05,811][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 08:54:14,013][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 08:54:22,903][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 08:54:31,426][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 08:54:40,102][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 08:54:49,344][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 08:54:56,677][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 08:55:07,050][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 08:55:13,987][root][INFO] - Inference complete
[2025-03-06 08:55:13,988][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:55:13,996][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:55:14,005][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 08:55:14,005][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 08:55:14,006][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 08:55:14,006][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 08:55:14,008][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:55:14,024][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:55:14,024][root][INFO] - Saved parsed outputs
[2025-03-06 08:55:14,024][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:55:14,035][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:55:14,035][root][INFO] - Saved parsing metadata
[2025-03-06 08:55:14,036][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:55:14,038][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:55:14,042][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 08:55:14,092][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 08:55:14,092][root][INFO] - Summary of metrics : {'label_accuracy': 0.5050505050505051, 'misclassification_rate': 0.4949494949494949, 'combined_accuracy': 0.15151515151515152, 'malformed_label': 0, 'malformed_domain': 72, 'total_predictions': 99, 'correct_predictions': 50, 'correct_label_and_domain': 15, 'Constitutional_Law_accuracy': 0.0, 'Contracts_accuracy': 0.07142857142857142, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.0625, 'Constitutional_Law_confidence': 0.010101010101010102, 'Contracts_confidence': 0.020202020202020204, 'Criminal_Law_confidence': 0.0707070707070707, 'Evidence_confidence': 0.050505050505050504, 'Real_Property_confidence': 0.04040404040404041, 'Torts_confidence': 0.0707070707070707, 'Civil_Procedure_confidence': 0.020202020202020204, 'correct_domain_wrong_label': 12, 'correct_label_wrong_domain': 35, 'both_wrong': 37}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 08:55:23,406][root][INFO] - Setting global seed to 206
[2025-03-06 08:55:23,429][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 08:55:23,430][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 08:55:23,431][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 08:55:23,432][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 08:55:23,436][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 08:55:23,436][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 08:55:23,604][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 08:55:24,171][root][INFO] - Full model selected, loading model
[2025-03-06 08:55:43,253][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 08:57:30,473][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 08:57:30,494][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 08:58:01,970][root][INFO] - Peft model loaded successfully
[2025-03-06 08:58:09,216][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 08:58:09,219][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 08:58:09,219][root][INFO] - Starting inference
[2025-03-06 08:58:09,363][root][INFO] - Processing question number 0
[2025-03-06 08:58:09,375][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 08:58:23,000][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 08:58:37,539][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 08:58:47,511][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 08:59:01,016][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 08:59:24,687][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 08:59:35,272][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 08:59:44,975][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 09:00:01,239][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 09:00:10,259][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 09:00:27,126][root][INFO] - Processing question number 10
[2025-03-06 09:00:27,128][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 09:00:40,124][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 09:01:00,450][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 09:01:06,509][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 09:01:16,464][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 09:01:27,374][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 09:01:43,097][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 09:01:52,297][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 09:02:23,505][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 09:02:36,182][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 09:02:52,166][root][INFO] - Processing question number 20
[2025-03-06 09:02:52,169][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 09:03:01,073][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 09:03:12,976][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 09:03:22,753][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 09:03:35,402][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 09:03:45,313][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 09:03:54,624][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 09:04:05,501][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 09:04:14,427][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 09:04:45,713][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 09:04:53,684][root][INFO] - Processing question number 30
[2025-03-06 09:04:53,700][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 09:05:09,474][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 09:05:26,010][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 09:05:36,817][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 09:05:49,171][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 09:05:58,769][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 09:06:06,126][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 09:06:12,419][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 09:06:21,303][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 09:06:38,267][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 09:06:45,898][root][INFO] - Processing question number 40
[2025-03-06 09:06:45,909][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 09:06:56,162][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 09:07:12,288][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 09:07:23,199][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 09:07:39,316][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 09:07:50,343][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 09:08:21,634][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 09:08:36,369][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 09:08:45,409][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 09:08:54,434][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 09:09:07,791][root][INFO] - Processing question number 50
[2025-03-06 09:09:07,799][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 09:09:20,467][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 09:09:51,876][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 09:10:02,253][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 09:10:34,319][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 09:10:49,030][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 09:10:57,866][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 09:11:09,069][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 09:11:21,137][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 09:11:34,031][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 09:11:42,138][root][INFO] - Processing question number 60
[2025-03-06 09:11:42,142][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 09:11:49,133][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 09:11:58,230][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 09:12:29,755][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 09:12:41,971][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 09:12:55,216][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 09:13:26,484][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 09:13:40,446][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 09:13:53,942][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 09:14:00,757][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 09:14:12,713][root][INFO] - Processing question number 70
[2025-03-06 09:14:12,718][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 09:14:22,418][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 09:14:28,266][root][INFO] - Domain : Property, Question : 6
[2025-03-06 09:14:36,267][root][INFO] - Domain : Property, Question : 13
[2025-03-06 09:14:48,174][root][INFO] - Domain : Property, Question : 20
[2025-03-06 09:15:00,026][root][INFO] - Domain : Property, Question : 33
[2025-03-06 09:15:11,415][root][INFO] - Domain : Property, Question : 39
[2025-03-06 09:15:23,546][root][INFO] - Domain : Property, Question : 48
[2025-03-06 09:15:54,953][root][INFO] - Domain : Property, Question : 54
[2025-03-06 09:16:07,952][root][INFO] - Domain : Property, Question : 61
[2025-03-06 09:16:31,300][root][INFO] - Processing question number 80
[2025-03-06 09:16:31,305][root][INFO] - Domain : Property, Question : 67
[2025-03-06 09:16:45,679][root][INFO] - Domain : Property, Question : 75
[2025-03-06 09:16:57,427][root][INFO] - Domain : Property, Question : 83
[2025-03-06 09:17:05,819][root][INFO] - Domain : Property, Question : 89
[2025-03-06 09:17:14,611][root][INFO] - Domain : Property, Question : 97
[2025-03-06 09:17:30,985][root][INFO] - Domain : Property, Question : 100
[2025-03-06 09:17:42,915][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 09:17:55,459][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 09:18:12,699][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 09:18:41,509][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 09:19:09,320][root][INFO] - Processing question number 90
[2025-03-06 09:19:09,326][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 09:19:26,874][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 09:19:38,095][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 09:20:09,301][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 09:20:17,078][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 09:20:26,998][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 09:20:42,562][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 09:20:49,575][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 09:21:05,617][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 09:21:17,177][root][INFO] - Inference complete
[2025-03-06 09:21:17,177][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:21:17,185][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:21:17,188][root][WARNING] - |Q. 9||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,189][root][WARNING] - |Q. 9||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,189][root][INFO] - |Q. 9||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,189][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,189][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,190][root][WARNING] - |Q. 25||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,190][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,190][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,191][root][WARNING] - |Q. 87||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,191][root][WARNING] - |Q. 87||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,191][root][INFO] - |Q. 87||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,192][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,194][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,194][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,194][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,194][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,195][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,195][root][WARNING] - |Q. 62||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,196][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,196][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,196][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,196][root][WARNING] - |Q. 82||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,196][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,196][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,198][root][WARNING] - |Q. 34||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,198][root][WARNING] - |Q. 34||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,198][root][INFO] - |Q. 34||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,198][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,199][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,199][root][WARNING] - |Q. 53||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,199][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,199][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,201][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,201][root][WARNING] - |Q. 48||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,201][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,202][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,204][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 09:21:17,204][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 09:21:17,204][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 09:21:17,204][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 09:21:17,206][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:21:17,229][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:21:17,229][root][INFO] - Saved parsed outputs
[2025-03-06 09:21:17,229][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:21:17,244][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:21:17,245][root][INFO] - Saved parsing metadata
[2025-03-06 09:21:17,245][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:21:17,247][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:21:17,259][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 09:21:17,415][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 09:21:17,415][root][INFO] - Summary of metrics : {'label_accuracy': 0.48484848484848486, 'misclassification_rate': 0.5151515151515151, 'combined_accuracy': 0.42424242424242425, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 48, 'correct_label_and_domain': 42, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.09090909090909091, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 6, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 09:21:29,005][root][INFO] - Setting global seed to 206
[2025-03-06 09:21:29,015][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 09:21:29,015][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 09:21:29,016][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 09:21:29,018][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 09:21:29,023][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 09:21:29,023][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 09:21:29,274][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 09:21:29,872][root][INFO] - Full model selected, loading model
[2025-03-06 09:21:51,536][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 09:21:51,560][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 09:21:59,223][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 09:21:59,225][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:21:59,225][root][INFO] - Starting inference
[2025-03-06 09:21:59,357][root][INFO] - Processing question number 0
[2025-03-06 09:21:59,368][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 09:22:09,974][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 09:22:20,764][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 09:22:32,733][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 09:22:42,197][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 09:22:49,720][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 09:22:59,852][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 09:23:07,059][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 09:23:17,666][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 09:23:24,198][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 09:23:34,416][root][INFO] - Processing question number 10
[2025-03-06 09:23:34,430][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 09:23:43,874][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 09:23:56,842][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 09:24:03,619][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 09:24:13,609][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 09:24:22,233][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 09:24:30,509][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 09:24:38,015][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 09:24:45,491][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 09:24:52,963][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 09:25:00,240][root][INFO] - Processing question number 20
[2025-03-06 09:25:00,242][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 09:25:08,782][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 09:25:18,005][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 09:25:26,093][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 09:25:35,417][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 09:25:45,671][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 09:25:57,719][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 09:26:07,068][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 09:26:21,867][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 09:26:32,177][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 09:26:42,160][root][INFO] - Processing question number 30
[2025-03-06 09:26:42,163][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 09:26:53,488][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 09:27:00,514][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 09:27:11,424][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 09:27:22,417][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 09:27:31,149][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 09:27:38,717][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 09:27:49,069][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 09:27:56,478][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 09:28:04,956][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 09:28:16,012][root][INFO] - Processing question number 40
[2025-03-06 09:28:16,015][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 09:28:23,900][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 09:28:31,193][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 09:28:41,838][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 09:28:51,214][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 09:29:00,196][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 09:29:11,221][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 09:29:20,186][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 09:29:30,155][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 09:29:37,133][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 09:29:44,495][root][INFO] - Processing question number 50
[2025-03-06 09:29:44,499][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 09:29:55,013][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 09:30:05,830][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 09:30:16,257][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 09:30:25,869][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 09:30:42,637][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 09:30:51,554][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 09:31:05,143][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 09:31:12,156][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 09:31:21,612][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 09:31:28,322][root][INFO] - Processing question number 60
[2025-03-06 09:31:28,326][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 09:31:34,802][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 09:31:42,988][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 09:31:53,796][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 09:32:00,205][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 09:32:09,719][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 09:32:18,978][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 09:32:26,995][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 09:32:37,101][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 09:32:44,739][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 09:32:53,302][root][INFO] - Processing question number 70
[2025-03-06 09:32:53,307][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 09:33:02,051][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 09:33:08,703][root][INFO] - Domain : Property, Question : 6
[2025-03-06 09:33:16,735][root][INFO] - Domain : Property, Question : 13
[2025-03-06 09:33:28,033][root][INFO] - Domain : Property, Question : 20
[2025-03-06 09:33:38,463][root][INFO] - Domain : Property, Question : 33
[2025-03-06 09:33:46,511][root][INFO] - Domain : Property, Question : 39
[2025-03-06 09:33:55,491][root][INFO] - Domain : Property, Question : 48
[2025-03-06 09:34:08,692][root][INFO] - Domain : Property, Question : 54
[2025-03-06 09:34:17,287][root][INFO] - Domain : Property, Question : 61
[2025-03-06 09:34:25,639][root][INFO] - Processing question number 80
[2025-03-06 09:34:25,644][root][INFO] - Domain : Property, Question : 67
[2025-03-06 09:34:33,804][root][INFO] - Domain : Property, Question : 75
[2025-03-06 09:34:42,778][root][INFO] - Domain : Property, Question : 83
[2025-03-06 09:34:54,830][root][INFO] - Domain : Property, Question : 89
[2025-03-06 09:35:04,806][root][INFO] - Domain : Property, Question : 97
[2025-03-06 09:35:13,230][root][INFO] - Domain : Property, Question : 100
[2025-03-06 09:35:22,168][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 09:35:33,135][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 09:35:40,736][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 09:35:51,284][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 09:36:01,192][root][INFO] - Processing question number 90
[2025-03-06 09:36:01,197][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 09:36:12,010][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 09:36:22,047][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 09:36:31,714][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 09:36:38,886][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 09:36:49,757][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 09:36:56,065][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 09:37:04,246][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 09:37:14,973][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 09:37:25,078][root][INFO] - Inference complete
[2025-03-06 09:37:25,078][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:37:25,086][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:37:25,086][root][WARNING] - |Q. 1||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 09:37:25,087][root][WARNING] - |Q. 1||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 09:37:25,087][root][INFO] - |Q. 1||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 09:37:25,098][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:37:25,103][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:37:25,103][root][INFO] - Saved parsed outputs
[2025-03-06 09:37:25,103][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:37:25,117][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:37:25,117][root][INFO] - Saved parsing metadata
[2025-03-06 09:37:25,118][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:37:25,119][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:37:25,125][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 09:37:25,374][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 09:37:25,374][root][INFO] - Summary of metrics : {'label_accuracy': 0.47474747474747475, 'misclassification_rate': 0.5252525252525253, 'combined_accuracy': 0.23232323232323232, 'malformed_label': 0, 'malformed_domain': 61, 'total_predictions': 99, 'correct_predictions': 47, 'correct_label_and_domain': 23, 'Constitutional_Law_accuracy': 0.0, 'Contracts_accuracy': 0.07142857142857142, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.020202020202020204, 'Contracts_confidence': 0.04040404040404041, 'Criminal_Law_confidence': 0.06060606060606061, 'Evidence_confidence': 0.0707070707070707, 'Real_Property_confidence': 0.0707070707070707, 'Torts_confidence': 0.0707070707070707, 'Civil_Procedure_confidence': 0.06060606060606061, 'correct_domain_wrong_label': 15, 'correct_label_wrong_domain': 24, 'both_wrong': 37}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 09:37:32,619][root][INFO] - Setting global seed to 206
[2025-03-06 09:37:32,626][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 09:37:32,626][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 09:37:32,627][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 09:37:32,629][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 09:37:32,631][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 09:37:32,631][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 09:37:32,784][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 09:37:33,326][root][INFO] - Full model selected, loading model
[2025-03-06 09:37:49,446][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 09:39:38,411][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 09:39:38,411][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 09:40:13,996][root][INFO] - Peft model loaded successfully
[2025-03-06 09:40:21,667][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 09:40:21,670][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 09:40:21,670][root][INFO] - Starting inference
[2025-03-06 09:40:21,825][root][INFO] - Processing question number 0
[2025-03-06 09:40:21,831][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 09:40:35,079][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 09:40:57,407][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 09:41:06,839][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 09:41:17,110][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 09:41:26,436][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 09:41:46,684][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 09:42:12,255][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 09:42:43,448][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 09:42:52,661][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 09:42:59,236][root][INFO] - Processing question number 10
[2025-03-06 09:42:59,238][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 09:43:06,852][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 09:43:21,362][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 09:43:29,684][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 09:43:36,928][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 09:43:50,820][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 09:44:01,850][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 09:44:18,932][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 09:44:32,467][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 09:44:47,615][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 09:44:57,936][root][INFO] - Processing question number 20
[2025-03-06 09:44:57,938][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 09:45:05,351][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 09:45:15,045][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 09:45:26,408][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 09:45:42,819][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 09:45:55,248][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 09:46:05,598][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 09:46:25,191][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 09:46:37,056][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 09:46:56,094][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 09:47:04,791][root][INFO] - Processing question number 30
[2025-03-06 09:47:04,794][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 09:47:14,466][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 09:47:27,864][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 09:47:39,127][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 09:47:50,623][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 09:47:58,772][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 09:48:15,924][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 09:48:25,828][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 09:48:56,110][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 09:49:11,445][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 09:49:22,146][root][INFO] - Processing question number 40
[2025-03-06 09:49:22,149][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 09:49:30,854][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 09:49:48,401][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 09:50:02,612][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 09:50:15,244][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 09:50:24,240][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 09:50:34,516][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 09:50:49,351][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 09:50:56,533][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 09:51:03,928][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 09:51:16,362][root][INFO] - Processing question number 50
[2025-03-06 09:51:16,365][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 09:51:25,211][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 09:51:33,876][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 09:51:41,399][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 09:51:53,380][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 09:52:06,617][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 09:52:17,419][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 09:52:28,313][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 09:52:38,355][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 09:52:50,036][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 09:53:03,203][root][INFO] - Processing question number 60
[2025-03-06 09:53:03,207][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 09:53:12,898][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 09:53:29,430][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 09:53:49,392][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 09:53:58,443][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 09:54:10,425][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 09:54:28,021][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 09:54:37,305][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 09:54:44,573][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 09:55:00,884][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 09:55:07,929][root][INFO] - Processing question number 70
[2025-03-06 09:55:07,933][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 09:55:23,400][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 09:55:36,439][root][INFO] - Domain : Property, Question : 6
[2025-03-06 09:55:47,268][root][INFO] - Domain : Property, Question : 13
[2025-03-06 09:56:01,553][root][INFO] - Domain : Property, Question : 20
[2025-03-06 09:56:15,524][root][INFO] - Domain : Property, Question : 33
[2025-03-06 09:56:25,965][root][INFO] - Domain : Property, Question : 39
[2025-03-06 09:56:37,029][root][INFO] - Domain : Property, Question : 48
[2025-03-06 09:56:47,449][root][INFO] - Domain : Property, Question : 54
[2025-03-06 09:56:58,624][root][INFO] - Domain : Property, Question : 61
[2025-03-06 09:57:12,502][root][INFO] - Processing question number 80
[2025-03-06 09:57:12,507][root][INFO] - Domain : Property, Question : 67
[2025-03-06 09:57:23,438][root][INFO] - Domain : Property, Question : 75
[2025-03-06 09:57:38,537][root][INFO] - Domain : Property, Question : 83
[2025-03-06 09:57:49,695][root][INFO] - Domain : Property, Question : 89
[2025-03-06 09:58:02,026][root][INFO] - Domain : Property, Question : 97
[2025-03-06 09:58:16,540][root][INFO] - Domain : Property, Question : 100
[2025-03-06 09:58:27,202][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 09:58:36,259][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 09:58:50,211][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 09:59:21,551][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 09:59:52,448][root][INFO] - Processing question number 90
[2025-03-06 09:59:52,453][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 10:00:08,812][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 10:00:21,164][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 10:00:40,555][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 10:00:51,679][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 10:01:02,605][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 10:01:14,069][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 10:01:20,931][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 10:01:31,614][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 10:01:41,714][root][INFO] - Inference complete
[2025-03-06 10:01:41,714][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:01:41,722][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:01:41,724][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:01:41,725][root][WARNING] - |Q. 35||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:01:41,725][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:01:41,725][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:01:41,726][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:01:41,726][root][WARNING] - |Q. 49||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:01:41,726][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:01:41,726][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:01:41,726][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:01:41,727][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 10:01:41,727][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:01:41,727][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:01:41,727][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 10:01:41,727][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:01:41,737][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:01:41,737][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:01:41,737][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:01:41,737][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:01:41,738][root][WARNING] - |Q. 30||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:01:41,738][root][WARNING] - |Q. 30||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:01:41,738][root][INFO] - |Q. 30||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:01:41,738][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:01:41,740][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:01:41,745][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:01:41,745][root][INFO] - Saved parsed outputs
[2025-03-06 10:01:41,746][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:01:41,747][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:01:41,747][root][INFO] - Saved parsing metadata
[2025-03-06 10:01:41,748][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:01:41,778][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:01:41,779][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 10:01:41,825][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 10:01:41,825][root][INFO] - Summary of metrics : {'label_accuracy': 0.4444444444444444, 'misclassification_rate': 0.5555555555555556, 'combined_accuracy': 0.37373737373737376, 'malformed_label': 0, 'malformed_domain': 17, 'total_predictions': 99, 'correct_predictions': 44, 'correct_label_and_domain': 37, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.5384615384615384, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.1414141414141414, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 7, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 10:01:54,716][root][INFO] - Setting global seed to 206
[2025-03-06 10:01:54,732][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 10:01:54,732][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 10:01:54,733][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 10:01:54,750][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:01:54,752][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 10:01:54,752][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 10:01:54,909][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 10:01:55,485][root][INFO] - Full model selected, loading model
[2025-03-06 10:02:25,384][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 10:02:25,399][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 10:02:33,188][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 10:02:33,190][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:02:33,190][root][INFO] - Starting inference
[2025-03-06 10:02:33,303][root][INFO] - Processing question number 0
[2025-03-06 10:02:33,305][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 10:02:41,881][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 10:02:53,076][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 10:03:04,737][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 10:03:11,461][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 10:03:21,478][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 10:03:38,545][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 10:03:47,334][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 10:03:59,457][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 10:04:09,163][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 10:04:17,969][root][INFO] - Processing question number 10
[2025-03-06 10:04:17,971][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 10:04:26,870][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 10:04:35,467][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 10:04:44,534][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 10:04:54,284][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 10:05:01,619][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 10:05:10,795][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 10:05:21,132][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 10:05:27,581][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 10:05:34,576][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 10:05:42,118][root][INFO] - Processing question number 20
[2025-03-06 10:05:42,120][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 10:05:48,896][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 10:06:00,900][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 10:06:09,389][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 10:06:17,490][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 10:06:23,956][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 10:06:32,815][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 10:06:43,334][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 10:06:55,147][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 10:07:05,452][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 10:07:15,041][root][INFO] - Processing question number 30
[2025-03-06 10:07:15,044][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 10:07:25,267][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 10:07:35,028][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 10:07:45,778][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 10:07:58,174][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 10:08:05,641][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 10:08:13,263][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 10:08:23,462][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 10:08:32,950][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 10:08:42,039][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 10:08:49,106][root][INFO] - Processing question number 40
[2025-03-06 10:08:49,110][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 10:08:57,914][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 10:09:05,169][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 10:09:15,164][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 10:09:24,812][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 10:09:35,535][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 10:09:47,003][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 10:09:55,626][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 10:10:04,767][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 10:10:14,127][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 10:10:20,319][root][INFO] - Processing question number 50
[2025-03-06 10:10:20,322][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 10:10:30,637][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 10:10:41,649][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 10:10:50,202][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 10:11:01,727][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 10:11:09,799][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 10:11:16,782][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 10:11:30,468][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 10:11:39,665][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 10:11:48,666][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 10:11:58,849][root][INFO] - Processing question number 60
[2025-03-06 10:11:58,853][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 10:12:08,055][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 10:12:17,837][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 10:12:25,882][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 10:12:33,547][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 10:12:42,859][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 10:12:56,487][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 10:13:01,514][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 10:13:07,932][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 10:13:17,776][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 10:13:26,098][root][INFO] - Processing question number 70
[2025-03-06 10:13:26,102][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 10:13:34,955][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 10:13:42,813][root][INFO] - Domain : Property, Question : 6
[2025-03-06 10:13:48,788][root][INFO] - Domain : Property, Question : 13
[2025-03-06 10:13:56,721][root][INFO] - Domain : Property, Question : 20
[2025-03-06 10:14:06,742][root][INFO] - Domain : Property, Question : 33
[2025-03-06 10:14:14,909][root][INFO] - Domain : Property, Question : 39
[2025-03-06 10:14:26,978][root][INFO] - Domain : Property, Question : 48
[2025-03-06 10:14:36,894][root][INFO] - Domain : Property, Question : 54
[2025-03-06 10:14:46,848][root][INFO] - Domain : Property, Question : 61
[2025-03-06 10:14:54,826][root][INFO] - Processing question number 80
[2025-03-06 10:14:54,831][root][INFO] - Domain : Property, Question : 67
[2025-03-06 10:15:03,498][root][INFO] - Domain : Property, Question : 75
[2025-03-06 10:15:14,031][root][INFO] - Domain : Property, Question : 83
[2025-03-06 10:15:22,418][root][INFO] - Domain : Property, Question : 89
[2025-03-06 10:15:29,671][root][INFO] - Domain : Property, Question : 97
[2025-03-06 10:15:40,017][root][INFO] - Domain : Property, Question : 100
[2025-03-06 10:15:48,725][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 10:15:58,585][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 10:16:06,632][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 10:16:16,521][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 10:16:27,476][root][INFO] - Processing question number 90
[2025-03-06 10:16:27,481][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 10:16:39,931][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 10:16:49,957][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 10:17:03,539][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 10:17:13,965][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 10:17:23,028][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 10:17:30,482][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 10:17:39,270][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 10:17:48,997][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 10:17:58,700][root][INFO] - Inference complete
[2025-03-06 10:17:58,700][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:17:58,707][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:17:58,712][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:17:58,713][root][WARNING] - |Q. 11||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 10:17:58,713][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:17:58,719][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:17:58,724][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:17:58,724][root][INFO] - Saved parsed outputs
[2025-03-06 10:17:58,724][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:17:58,726][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:17:58,726][root][INFO] - Saved parsing metadata
[2025-03-06 10:17:58,727][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:17:58,757][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:17:58,759][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 10:17:58,842][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 10:17:58,843][root][INFO] - Summary of metrics : {'label_accuracy': 0.5353535353535354, 'misclassification_rate': 0.46464646464646464, 'combined_accuracy': 0.20202020202020202, 'malformed_label': 0, 'malformed_domain': 63, 'total_predictions': 99, 'correct_predictions': 53, 'correct_label_and_domain': 20, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.0, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.0625, 'Constitutional_Law_confidence': 0.06060606060606061, 'Contracts_confidence': 0.06060606060606061, 'Criminal_Law_confidence': 0.06060606060606061, 'Evidence_confidence': 0.0707070707070707, 'Real_Property_confidence': 0.030303030303030304, 'Torts_confidence': 0.09090909090909091, 'Civil_Procedure_confidence': 0.04040404040404041, 'correct_domain_wrong_label': 16, 'correct_label_wrong_domain': 33, 'both_wrong': 30}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 10:18:07,202][root][INFO] - Setting global seed to 989
[2025-03-06 10:18:07,209][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 10:18:07,209][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 10:18:07,210][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 10:18:07,212][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:18:07,214][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 10:18:07,214][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 10:18:07,380][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 10:18:08,132][root][INFO] - Full model selected, loading model
[2025-03-06 10:18:24,805][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 10:20:12,446][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 10:20:12,446][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 10:20:47,025][root][INFO] - Peft model loaded successfully
[2025-03-06 10:20:54,349][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 10:20:54,352][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:20:54,352][root][INFO] - Starting inference
[2025-03-06 10:20:54,501][root][INFO] - Processing question number 0
[2025-03-06 10:20:54,503][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 10:21:04,420][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 10:21:17,471][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 10:21:31,031][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 10:22:02,195][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 10:22:13,252][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 10:22:31,280][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 10:22:40,339][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 10:22:51,605][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 10:23:01,379][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 10:23:32,539][root][INFO] - Processing question number 10
[2025-03-06 10:23:32,541][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 10:23:42,100][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 10:23:57,327][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 10:24:05,488][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 10:24:12,419][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 10:24:21,250][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 10:24:30,312][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 10:24:40,115][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 10:24:48,679][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 10:24:58,058][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 10:25:06,036][root][INFO] - Processing question number 20
[2025-03-06 10:25:06,038][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 10:25:17,869][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 10:25:29,665][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 10:25:40,824][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 10:26:11,461][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 10:26:20,494][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 10:26:30,753][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 10:26:41,350][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 10:26:55,911][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 10:27:26,929][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 10:27:36,100][root][INFO] - Processing question number 30
[2025-03-06 10:27:36,103][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 10:27:46,834][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 10:27:56,309][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 10:28:13,566][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 10:28:24,313][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 10:28:36,943][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 10:29:08,244][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 10:29:15,650][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 10:29:34,885][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 10:29:46,367][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 10:29:59,921][root][INFO] - Processing question number 40
[2025-03-06 10:29:59,924][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 10:30:11,836][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 10:30:22,892][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 10:30:37,987][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 10:30:47,065][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 10:30:59,193][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 10:31:10,811][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 10:31:18,512][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 10:31:29,479][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 10:31:37,730][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 10:31:51,010][root][INFO] - Processing question number 50
[2025-03-06 10:31:51,014][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 10:32:00,603][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 10:32:14,478][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 10:32:23,734][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 10:32:35,117][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 10:32:46,190][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 10:32:56,698][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 10:33:08,762][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 10:33:31,383][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 10:33:42,302][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 10:33:49,390][root][INFO] - Processing question number 60
[2025-03-06 10:33:49,394][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 10:33:56,661][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 10:34:09,038][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 10:34:22,005][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 10:34:33,037][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 10:34:45,168][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 10:35:16,158][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 10:35:31,604][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 10:36:02,757][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 10:36:33,847][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 10:37:05,062][root][INFO] - Processing question number 70
[2025-03-06 10:37:05,067][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 10:37:15,625][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 10:37:28,945][root][INFO] - Domain : Property, Question : 6
[2025-03-06 10:37:39,289][root][INFO] - Domain : Property, Question : 13
[2025-03-06 10:37:53,450][root][INFO] - Domain : Property, Question : 20
[2025-03-06 10:38:04,683][root][INFO] - Domain : Property, Question : 33
[2025-03-06 10:38:19,395][root][INFO] - Domain : Property, Question : 39
[2025-03-06 10:38:30,321][root][INFO] - Domain : Property, Question : 48
[2025-03-06 10:38:38,819][root][INFO] - Domain : Property, Question : 54
[2025-03-06 10:38:49,046][root][INFO] - Domain : Property, Question : 61
[2025-03-06 10:39:19,924][root][INFO] - Processing question number 80
[2025-03-06 10:39:19,929][root][INFO] - Domain : Property, Question : 67
[2025-03-06 10:39:28,722][root][INFO] - Domain : Property, Question : 75
[2025-03-06 10:39:38,824][root][INFO] - Domain : Property, Question : 83
[2025-03-06 10:39:49,400][root][INFO] - Domain : Property, Question : 89
[2025-03-06 10:40:00,580][root][INFO] - Domain : Property, Question : 97
[2025-03-06 10:40:11,299][root][INFO] - Domain : Property, Question : 100
[2025-03-06 10:40:23,816][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 10:40:33,201][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 10:40:38,754][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 10:40:55,175][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 10:41:08,557][root][INFO] - Processing question number 90
[2025-03-06 10:41:08,562][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 10:41:40,161][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 10:41:49,094][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 10:42:20,024][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 10:42:26,191][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 10:42:36,027][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 10:42:47,829][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 10:42:56,289][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 10:43:27,337][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 10:43:36,696][root][INFO] - Inference complete
[2025-03-06 10:43:36,696][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:43:36,704][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:43:36,706][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,706][root][WARNING] - |Q. 7||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,706][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,707][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,707][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,707][root][WARNING] - |Q. 21||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,707][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,708][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,709][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,709][root][WARNING] - |Q. 63||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,709][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,709][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,711][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,711][root][WARNING] - |Q. 55||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,711][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,711][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,712][root][WARNING] - |Q. 87||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,712][root][WARNING] - |Q. 87||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,713][root][INFO] - |Q. 87||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,713][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,714][root][WARNING] - |Q. 38||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,714][root][WARNING] - |Q. 38||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,714][root][INFO] - |Q. 38||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,714][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,718][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,718][root][WARNING] - |Q. 53||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,718][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,718][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,719][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,719][root][WARNING] - |Q. 68||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,719][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,719][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,720][root][WARNING] - |Q. 73||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,720][root][WARNING] - |Q. 73||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,720][root][INFO] - |Q. 73||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,720][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,720][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,721][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,721][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,721][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,722][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,722][root][WARNING] - |Q. 61||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,723][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,723][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,724][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,724][root][WARNING] - |Q. 36||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,724][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,724][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,725][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,725][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,725][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,725][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,726][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:43:36,726][root][WARNING] - |Q. 85||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:43:36,726][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:43:36,727][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:43:36,727][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:43:36,733][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:43:36,733][root][INFO] - Saved parsed outputs
[2025-03-06 10:43:36,733][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:43:36,734][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:43:36,734][root][INFO] - Saved parsing metadata
[2025-03-06 10:43:36,736][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:43:36,738][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:43:36,739][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 10:43:36,773][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 10:43:36,773][root][INFO] - Summary of metrics : {'label_accuracy': 0.48484848484848486, 'misclassification_rate': 0.5151515151515151, 'combined_accuracy': 0.41414141414141414, 'malformed_label': 0, 'malformed_domain': 13, 'total_predictions': 99, 'correct_predictions': 48, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.5384615384615384, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.10101010101010101, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 7, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 10:43:51,183][root][INFO] - Setting global seed to 989
[2025-03-06 10:43:51,201][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 10:43:51,201][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 10:43:51,203][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 10:43:51,219][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:43:51,221][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 10:43:51,221][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 10:43:51,419][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 10:43:52,054][root][INFO] - Full model selected, loading model
[2025-03-06 10:44:16,495][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 10:44:16,503][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 10:44:24,708][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 10:44:24,711][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:44:24,711][root][INFO] - Starting inference
[2025-03-06 10:44:24,825][root][INFO] - Processing question number 0
[2025-03-06 10:44:24,828][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 10:44:35,084][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 10:44:45,030][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 10:44:55,211][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 10:45:02,547][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 10:45:10,609][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 10:45:21,588][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 10:45:33,108][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 10:45:43,221][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 10:45:52,451][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 10:46:03,180][root][INFO] - Processing question number 10
[2025-03-06 10:46:03,182][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 10:46:12,182][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 10:46:20,508][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 10:46:27,565][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 10:46:34,418][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 10:46:40,979][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 10:46:49,915][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 10:46:58,394][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 10:47:06,284][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 10:47:14,286][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 10:47:24,754][root][INFO] - Processing question number 20
[2025-03-06 10:47:24,757][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 10:47:34,989][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 10:47:43,301][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 10:47:52,695][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 10:48:01,289][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 10:48:11,958][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 10:48:19,156][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 10:48:27,204][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 10:48:34,760][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 10:48:44,467][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 10:48:50,990][root][INFO] - Processing question number 30
[2025-03-06 10:48:50,992][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 10:48:59,920][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 10:49:07,734][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 10:49:17,595][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 10:49:27,145][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 10:49:35,269][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 10:49:43,221][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 10:49:50,318][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 10:50:03,574][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 10:50:11,635][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 10:50:19,969][root][INFO] - Processing question number 40
[2025-03-06 10:50:19,972][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 10:50:30,236][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 10:50:38,249][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 10:50:50,555][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 10:51:00,566][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 10:51:08,488][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 10:51:17,363][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 10:51:24,993][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 10:51:33,793][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 10:51:40,947][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 10:51:50,012][root][INFO] - Processing question number 50
[2025-03-06 10:51:50,016][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 10:51:59,167][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 10:52:09,089][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 10:52:18,490][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 10:52:27,008][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 10:52:38,337][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 10:52:45,444][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 10:52:57,335][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 10:53:06,486][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 10:53:18,320][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 10:53:27,246][root][INFO] - Processing question number 60
[2025-03-06 10:53:27,250][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 10:53:37,286][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 10:53:45,953][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 10:53:55,763][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 10:54:03,190][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 10:54:12,228][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 10:54:24,195][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 10:54:31,943][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 10:54:41,865][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 10:54:49,378][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 10:54:57,072][root][INFO] - Processing question number 70
[2025-03-06 10:54:57,076][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 10:55:05,548][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 10:55:14,344][root][INFO] - Domain : Property, Question : 6
[2025-03-06 10:55:21,334][root][INFO] - Domain : Property, Question : 13
[2025-03-06 10:55:32,733][root][INFO] - Domain : Property, Question : 20
[2025-03-06 10:55:41,358][root][INFO] - Domain : Property, Question : 33
[2025-03-06 10:55:50,869][root][INFO] - Domain : Property, Question : 39
[2025-03-06 10:56:00,227][root][INFO] - Domain : Property, Question : 48
[2025-03-06 10:56:09,588][root][INFO] - Domain : Property, Question : 54
[2025-03-06 10:56:21,869][root][INFO] - Domain : Property, Question : 61
[2025-03-06 10:56:31,197][root][INFO] - Processing question number 80
[2025-03-06 10:56:31,202][root][INFO] - Domain : Property, Question : 67
[2025-03-06 10:56:41,373][root][INFO] - Domain : Property, Question : 75
[2025-03-06 10:56:51,913][root][INFO] - Domain : Property, Question : 83
[2025-03-06 10:57:03,967][root][INFO] - Domain : Property, Question : 89
[2025-03-06 10:57:12,087][root][INFO] - Domain : Property, Question : 97
[2025-03-06 10:57:43,602][root][INFO] - Domain : Property, Question : 100
[2025-03-06 10:57:53,074][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 10:58:02,184][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 10:58:10,950][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 10:58:20,042][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 10:58:27,954][root][INFO] - Processing question number 90
[2025-03-06 10:58:27,959][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 10:58:38,024][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 10:58:46,262][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 10:58:55,205][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 10:59:03,782][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 10:59:12,494][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 10:59:21,794][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 10:59:29,159][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 10:59:39,595][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 10:59:46,574][root][INFO] - Inference complete
[2025-03-06 10:59:46,574][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:59:46,583][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:59:46,592][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 10:59:46,593][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:59:46,593][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 10:59:46,593][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:59:46,596][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:59:46,601][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:59:46,601][root][INFO] - Saved parsed outputs
[2025-03-06 10:59:46,601][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:59:46,617][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:59:46,617][root][INFO] - Saved parsing metadata
[2025-03-06 10:59:46,618][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:59:46,619][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:59:46,621][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 10:59:46,654][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 10:59:46,654][root][INFO] - Summary of metrics : {'label_accuracy': 0.5050505050505051, 'misclassification_rate': 0.4949494949494949, 'combined_accuracy': 0.15151515151515152, 'malformed_label': 0, 'malformed_domain': 72, 'total_predictions': 99, 'correct_predictions': 50, 'correct_label_and_domain': 15, 'Constitutional_Law_accuracy': 0.0, 'Contracts_accuracy': 0.07142857142857142, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.0625, 'Constitutional_Law_confidence': 0.010101010101010102, 'Contracts_confidence': 0.020202020202020204, 'Criminal_Law_confidence': 0.0707070707070707, 'Evidence_confidence': 0.050505050505050504, 'Real_Property_confidence': 0.04040404040404041, 'Torts_confidence': 0.0707070707070707, 'Civil_Procedure_confidence': 0.020202020202020204, 'correct_domain_wrong_label': 12, 'correct_label_wrong_domain': 35, 'both_wrong': 37}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 10:59:54,448][root][INFO] - Setting global seed to 989
[2025-03-06 10:59:54,455][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 10:59:54,455][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 10:59:54,456][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 10:59:54,458][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:59:54,460][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 10:59:54,460][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 10:59:54,613][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 10:59:55,147][root][INFO] - Full model selected, loading model
[2025-03-06 11:00:12,502][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 11:01:59,327][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 11:01:59,327][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 11:02:33,481][root][INFO] - Peft model loaded successfully
[2025-03-06 11:02:40,773][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 11:02:40,775][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:02:40,775][root][INFO] - Starting inference
[2025-03-06 11:02:40,924][root][INFO] - Processing question number 0
[2025-03-06 11:02:40,926][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 11:02:53,645][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 11:03:06,526][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 11:03:13,512][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 11:03:44,858][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 11:03:53,715][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 11:04:13,027][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 11:04:19,996][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 11:04:31,785][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 11:04:42,755][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 11:04:56,363][root][INFO] - Processing question number 10
[2025-03-06 11:04:56,365][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 11:05:28,839][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 11:05:42,502][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 11:05:49,674][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 11:05:56,243][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 11:06:05,012][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 11:06:18,136][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 11:06:30,465][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 11:06:38,476][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 11:06:49,759][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 11:06:55,664][root][INFO] - Processing question number 20
[2025-03-06 11:06:55,666][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 11:07:05,183][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 11:07:18,805][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 11:07:27,722][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 11:07:38,653][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 11:07:55,095][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 11:08:05,367][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 11:08:17,386][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 11:08:25,987][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 11:08:36,670][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 11:08:45,253][root][INFO] - Processing question number 30
[2025-03-06 11:08:45,256][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 11:09:02,859][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 11:09:10,886][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 11:09:19,765][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 11:09:32,129][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 11:09:39,575][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 11:09:48,908][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 11:09:59,084][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 11:10:09,391][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 11:10:18,401][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 11:10:27,416][root][INFO] - Processing question number 40
[2025-03-06 11:10:27,419][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 11:10:40,152][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 11:10:50,571][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 11:11:05,906][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 11:11:17,374][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 11:11:31,170][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 11:11:44,119][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 11:11:51,863][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 11:12:02,856][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 11:12:09,447][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 11:12:16,726][root][INFO] - Processing question number 50
[2025-03-06 11:12:16,730][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 11:12:48,552][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 11:13:01,538][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 11:13:12,937][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 11:13:44,952][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 11:14:16,194][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 11:14:29,045][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 11:15:00,749][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 11:15:10,280][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 11:15:34,897][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 11:15:43,297][root][INFO] - Processing question number 60
[2025-03-06 11:15:43,301][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 11:15:50,572][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 11:15:59,311][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 11:16:30,782][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 11:16:41,840][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 11:16:54,999][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 11:17:11,444][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 11:17:22,417][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 11:17:53,773][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 11:18:02,895][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 11:18:16,745][root][INFO] - Processing question number 70
[2025-03-06 11:18:16,749][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 11:18:27,221][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 11:18:36,847][root][INFO] - Domain : Property, Question : 6
[2025-03-06 11:18:47,563][root][INFO] - Domain : Property, Question : 13
[2025-03-06 11:19:02,279][root][INFO] - Domain : Property, Question : 20
[2025-03-06 11:19:13,298][root][INFO] - Domain : Property, Question : 33
[2025-03-06 11:19:23,621][root][INFO] - Domain : Property, Question : 39
[2025-03-06 11:19:55,234][root][INFO] - Domain : Property, Question : 48
[2025-03-06 11:20:26,588][root][INFO] - Domain : Property, Question : 54
[2025-03-06 11:20:58,081][root][INFO] - Domain : Property, Question : 61
[2025-03-06 11:21:29,191][root][INFO] - Processing question number 80
[2025-03-06 11:21:29,196][root][INFO] - Domain : Property, Question : 67
[2025-03-06 11:21:37,102][root][INFO] - Domain : Property, Question : 75
[2025-03-06 11:21:54,790][root][INFO] - Domain : Property, Question : 83
[2025-03-06 11:22:08,032][root][INFO] - Domain : Property, Question : 89
[2025-03-06 11:22:17,206][root][INFO] - Domain : Property, Question : 97
[2025-03-06 11:22:27,400][root][INFO] - Domain : Property, Question : 100
[2025-03-06 11:22:40,271][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 11:22:53,800][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 11:23:06,770][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 11:23:19,460][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 11:23:27,050][root][INFO] - Processing question number 90
[2025-03-06 11:23:27,056][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 11:23:37,355][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 11:23:49,152][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 11:24:20,302][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 11:24:34,019][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 11:24:45,780][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 11:25:16,646][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 11:25:26,761][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 11:25:38,477][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 11:25:48,607][root][INFO] - Inference complete
[2025-03-06 11:25:48,608][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:25:48,614][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:25:48,616][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,617][root][WARNING] - |Q. 21||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,617][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,618][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,619][root][WARNING] - |Q. 69||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,619][root][WARNING] - |Q. 69||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,619][root][INFO] - |Q. 69||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,619][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,624][root][WARNING] - |Q. 52||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,624][root][WARNING] - |Q. 52||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,624][root][INFO] - |Q. 52||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,624][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,625][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,625][root][WARNING] - |Q. 82||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,625][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,625][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,626][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,626][root][WARNING] - |Q. 90||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,626][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,626][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,627][root][WARNING] - |Q. 99||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,627][root][WARNING] - |Q. 99||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,627][root][INFO] - |Q. 99||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,627][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,628][root][WARNING] - |Q. 34||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,628][root][WARNING] - |Q. 34||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,628][root][INFO] - |Q. 34||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,628][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,629][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,630][root][WARNING] - |Q. 68||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,630][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,630][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,631][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,631][root][WARNING] - |Q. 39||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,631][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,632][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,632][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,632][root][WARNING] - |Q. 48||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,632][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,632][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,633][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,633][root][WARNING] - |Q. 54||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,633][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,633][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,633][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,634][root][WARNING] - |Q. 61||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,634][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,634][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,635][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,636][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,636][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,636][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,636][root][WARNING] - |Q. 74||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:25:48,637][root][WARNING] - |Q. 74||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:25:48,637][root][INFO] - |Q. 74||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:25:48,637][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:25:48,638][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:25:48,643][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:25:48,643][root][INFO] - Saved parsed outputs
[2025-03-06 11:25:48,643][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:25:48,645][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:25:48,645][root][INFO] - Saved parsing metadata
[2025-03-06 11:25:48,645][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:25:48,647][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:25:48,649][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 11:25:48,667][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 11:25:48,667][root][INFO] - Summary of metrics : {'label_accuracy': 0.43434343434343436, 'misclassification_rate': 0.5656565656565656, 'combined_accuracy': 0.37373737373737376, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 43, 'correct_label_and_domain': 37, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.10101010101010101, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 50, 'correct_label_wrong_domain': 6, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 11:26:00,493][root][INFO] - Setting global seed to 989
[2025-03-06 11:26:00,500][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 11:26:00,500][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 11:26:00,502][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 11:26:00,504][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 11:26:00,506][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 11:26:00,506][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 11:26:00,665][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 11:26:01,210][root][INFO] - Full model selected, loading model
[2025-03-06 11:26:21,219][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 11:26:21,219][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 11:26:28,807][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 11:26:28,808][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:26:28,808][root][INFO] - Starting inference
[2025-03-06 11:26:28,954][root][INFO] - Processing question number 0
[2025-03-06 11:26:28,956][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 11:26:38,447][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 11:26:46,263][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 11:26:56,271][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 11:27:06,128][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 11:27:13,411][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 11:27:23,576][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 11:27:38,268][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 11:27:48,270][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 11:27:55,200][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 11:28:06,962][root][INFO] - Processing question number 10
[2025-03-06 11:28:06,964][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 11:28:15,898][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 11:28:23,165][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 11:28:28,717][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 11:28:39,398][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 11:28:48,176][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 11:28:57,630][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 11:29:06,129][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 11:29:13,409][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 11:29:21,968][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 11:29:29,405][root][INFO] - Processing question number 20
[2025-03-06 11:29:29,407][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 11:29:40,221][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 11:29:50,747][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 11:30:00,216][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 11:30:07,607][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 11:30:16,249][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 11:30:24,056][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 11:30:32,187][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 11:30:41,090][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 11:30:54,852][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 11:31:03,887][root][INFO] - Processing question number 30
[2025-03-06 11:31:03,890][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 11:31:12,154][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 11:31:20,293][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 11:31:32,797][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 11:31:41,984][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 11:31:49,485][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 11:31:56,450][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 11:32:05,600][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 11:32:14,116][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 11:32:21,156][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 11:32:29,924][root][INFO] - Processing question number 40
[2025-03-06 11:32:29,927][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 11:32:40,265][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 11:32:49,048][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 11:33:01,092][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 11:33:09,916][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 11:33:18,644][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 11:33:28,998][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 11:33:35,988][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 11:33:45,749][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 11:33:52,484][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 11:33:59,207][root][INFO] - Processing question number 50
[2025-03-06 11:33:59,211][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 11:34:07,691][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 11:34:17,889][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 11:34:26,772][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 11:34:39,512][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 11:34:50,267][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 11:34:57,577][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 11:35:06,325][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 11:35:15,455][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 11:35:25,151][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 11:35:35,729][root][INFO] - Processing question number 60
[2025-03-06 11:35:35,733][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 11:35:43,934][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 11:35:50,844][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 11:36:00,778][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 11:36:08,924][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 11:36:19,377][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 11:36:28,678][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 11:36:39,294][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 11:36:49,393][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 11:36:56,091][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 11:37:03,709][root][INFO] - Processing question number 70
[2025-03-06 11:37:03,713][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 11:37:11,268][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 11:37:21,787][root][INFO] - Domain : Property, Question : 6
[2025-03-06 11:37:28,992][root][INFO] - Domain : Property, Question : 13
[2025-03-06 11:37:39,221][root][INFO] - Domain : Property, Question : 20
[2025-03-06 11:37:46,643][root][INFO] - Domain : Property, Question : 33
[2025-03-06 11:37:54,351][root][INFO] - Domain : Property, Question : 39
[2025-03-06 11:38:04,232][root][INFO] - Domain : Property, Question : 48
[2025-03-06 11:38:12,132][root][INFO] - Domain : Property, Question : 54
[2025-03-06 11:38:21,223][root][INFO] - Domain : Property, Question : 61
[2025-03-06 11:38:28,546][root][INFO] - Processing question number 80
[2025-03-06 11:38:28,550][root][INFO] - Domain : Property, Question : 67
[2025-03-06 11:38:36,708][root][INFO] - Domain : Property, Question : 75
[2025-03-06 11:38:45,176][root][INFO] - Domain : Property, Question : 83
[2025-03-06 11:38:56,221][root][INFO] - Domain : Property, Question : 89
[2025-03-06 11:39:07,129][root][INFO] - Domain : Property, Question : 97
[2025-03-06 11:39:16,256][root][INFO] - Domain : Property, Question : 100
[2025-03-06 11:39:26,301][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 11:39:36,648][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 11:39:42,720][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 11:39:51,695][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 11:40:01,404][root][INFO] - Processing question number 90
[2025-03-06 11:40:01,409][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 11:40:13,586][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 11:40:24,835][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 11:40:34,788][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 11:40:41,966][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 11:40:52,068][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 11:41:02,422][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 11:41:12,087][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 11:41:19,318][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 11:41:29,210][root][INFO] - Inference complete
[2025-03-06 11:41:29,211][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:41:29,217][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:41:29,228][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:41:29,232][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:41:29,233][root][INFO] - Saved parsed outputs
[2025-03-06 11:41:29,233][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:41:29,234][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:41:29,234][root][INFO] - Saved parsing metadata
[2025-03-06 11:41:29,234][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:41:29,236][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:41:29,238][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 11:41:29,312][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 11:41:29,312][root][INFO] - Summary of metrics : {'label_accuracy': 0.47474747474747475, 'misclassification_rate': 0.5252525252525253, 'combined_accuracy': 0.18181818181818182, 'malformed_label': 0, 'malformed_domain': 65, 'total_predictions': 99, 'correct_predictions': 47, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.07142857142857142, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.125, 'Constitutional_Law_confidence': 0.050505050505050504, 'Contracts_confidence': 0.030303030303030304, 'Criminal_Law_confidence': 0.06060606060606061, 'Evidence_confidence': 0.06060606060606061, 'Real_Property_confidence': 0.06060606060606061, 'Torts_confidence': 0.050505050505050504, 'Civil_Procedure_confidence': 0.04040404040404041, 'correct_domain_wrong_label': 16, 'correct_label_wrong_domain': 29, 'both_wrong': 36}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 11:41:40,927][root][INFO] - Setting global seed to 989
[2025-03-06 11:41:40,932][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 11:41:40,932][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 11:41:40,933][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 11:41:40,935][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 11:41:40,937][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 11:41:40,937][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 11:41:41,097][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 11:41:41,648][root][INFO] - Full model selected, loading model
[2025-03-06 11:41:55,216][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 11:43:43,408][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 11:43:43,425][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 11:44:16,506][root][INFO] - Peft model loaded successfully
[2025-03-06 11:44:23,780][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 11:44:23,782][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:44:23,782][root][INFO] - Starting inference
[2025-03-06 11:44:23,907][root][INFO] - Processing question number 0
[2025-03-06 11:44:23,909][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 11:44:44,008][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 11:44:52,923][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 11:45:06,191][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 11:45:19,083][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 11:45:26,857][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 11:45:40,238][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 11:45:52,257][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 11:46:06,454][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 11:46:16,149][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 11:46:33,749][root][INFO] - Processing question number 10
[2025-03-06 11:46:33,751][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 11:46:45,117][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 11:46:59,378][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 11:47:10,584][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 11:47:25,159][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 11:47:38,806][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 11:47:48,736][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 11:48:01,103][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 11:48:15,598][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 11:48:22,669][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 11:48:31,979][root][INFO] - Processing question number 20
[2025-03-06 11:48:31,981][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 11:48:41,809][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 11:48:51,035][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 11:49:08,583][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 11:49:20,930][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 11:49:34,469][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 11:49:43,116][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 11:49:57,432][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 11:50:11,920][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 11:50:27,789][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 11:50:38,611][root][INFO] - Processing question number 30
[2025-03-06 11:50:38,614][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 11:50:46,723][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 11:50:53,845][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 11:51:08,088][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 11:51:20,344][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 11:51:31,128][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 11:51:39,058][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 11:51:52,372][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 11:52:01,389][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 11:52:08,914][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 11:52:19,662][root][INFO] - Processing question number 40
[2025-03-06 11:52:19,666][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 11:52:27,553][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 11:52:59,032][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 11:53:13,754][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 11:53:41,295][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 11:53:55,036][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 11:54:09,593][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 11:54:17,593][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 11:54:27,766][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 11:54:42,617][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 11:54:58,742][root][INFO] - Processing question number 50
[2025-03-06 11:54:58,745][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 11:55:30,734][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 11:55:44,031][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 11:55:54,548][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 11:56:06,069][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 11:56:18,852][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 11:56:36,542][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 11:56:46,661][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 11:57:04,791][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 11:57:14,031][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 11:57:21,963][root][INFO] - Processing question number 60
[2025-03-06 11:57:21,967][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 11:57:29,226][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 11:57:39,206][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 11:57:51,374][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 11:58:08,074][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 11:58:18,333][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 11:58:29,185][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 11:58:45,691][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 11:58:59,589][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 11:59:09,215][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 11:59:20,405][root][INFO] - Processing question number 70
[2025-03-06 11:59:20,409][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 11:59:32,697][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 11:59:40,035][root][INFO] - Domain : Property, Question : 6
[2025-03-06 11:59:49,159][root][INFO] - Domain : Property, Question : 13
[2025-03-06 12:00:04,733][root][INFO] - Domain : Property, Question : 20
[2025-03-06 12:00:17,132][root][INFO] - Domain : Property, Question : 33
[2025-03-06 12:00:29,310][root][INFO] - Domain : Property, Question : 39
[2025-03-06 12:01:01,095][root][INFO] - Domain : Property, Question : 48
[2025-03-06 12:01:13,120][root][INFO] - Domain : Property, Question : 54
[2025-03-06 12:01:22,767][root][INFO] - Domain : Property, Question : 61
[2025-03-06 12:01:38,011][root][INFO] - Processing question number 80
[2025-03-06 12:01:38,016][root][INFO] - Domain : Property, Question : 67
[2025-03-06 12:01:51,628][root][INFO] - Domain : Property, Question : 75
[2025-03-06 12:02:06,169][root][INFO] - Domain : Property, Question : 83
[2025-03-06 12:02:14,039][root][INFO] - Domain : Property, Question : 89
[2025-03-06 12:02:25,557][root][INFO] - Domain : Property, Question : 97
[2025-03-06 12:02:33,329][root][INFO] - Domain : Property, Question : 100
[2025-03-06 12:02:47,187][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 12:03:00,693][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 12:03:12,774][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 12:03:29,971][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 12:03:41,268][root][INFO] - Processing question number 90
[2025-03-06 12:03:41,273][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 12:03:53,671][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 12:04:03,604][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 12:04:12,870][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 12:04:21,360][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 12:04:31,058][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 12:04:39,934][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 12:05:05,083][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 12:05:18,233][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 12:05:31,054][root][INFO] - Inference complete
[2025-03-06 12:05:31,055][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:05:31,061][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:05:31,062][root][WARNING] - |Q. 1||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:05:31,062][root][WARNING] - |Q. 1||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:05:31,063][root][INFO] - |Q. 1||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:05:31,063][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:05:31,063][root][WARNING] - |Q. 21||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:05:31,063][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:05:31,064][root][WARNING] - |Q. 69||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:05:31,064][root][WARNING] - |Q. 69||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:05:31,065][root][INFO] - |Q. 69||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:05:31,065][root][WARNING] - |Q. 9||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:05:31,066][root][WARNING] - |Q. 9||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:05:31,066][root][INFO] - |Q. 9||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:05:31,066][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:05:31,069][root][WARNING] - |Q. 81||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:05:31,069][root][WARNING] - |Q. 81||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:05:31,070][root][INFO] - |Q. 81||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:05:31,070][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:05:31,071][root][WARNING] - |Q. 52||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:05:31,071][root][WARNING] - |Q. 52||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:05:31,072][root][INFO] - |Q. 52||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:05:31,072][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:05:31,074][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:05:31,074][root][WARNING] - |Q. 53||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:05:31,074][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:05:31,075][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:05:31,076][root][WARNING] - |Q. 39||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:05:31,076][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:05:31,076][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:05:31,078][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:05:31,078][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:05:31,078][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:05:31,080][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:05:31,085][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:05:31,085][root][INFO] - Saved parsed outputs
[2025-03-06 12:05:31,085][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:05:31,086][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:05:31,086][root][INFO] - Saved parsing metadata
[2025-03-06 12:05:31,087][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:05:31,088][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:05:31,090][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 12:05:31,126][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 12:05:31,126][root][INFO] - Summary of metrics : {'label_accuracy': 0.48484848484848486, 'misclassification_rate': 0.5151515151515151, 'combined_accuracy': 0.41414141414141414, 'malformed_label': 0, 'malformed_domain': 15, 'total_predictions': 99, 'correct_predictions': 48, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.5384615384615384, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.1414141414141414, 'Criminal_Law_confidence': 0.09090909090909091, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 7, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 12:05:39,281][root][INFO] - Setting global seed to 989
[2025-03-06 12:05:39,288][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 12:05:39,288][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 12:05:39,289][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 12:05:39,291][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 12:05:39,293][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 12:05:39,293][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 12:05:39,451][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 12:05:40,003][root][INFO] - Full model selected, loading model
[2025-03-06 12:06:01,076][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 12:06:01,096][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 12:06:08,685][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 12:06:08,686][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:06:08,686][root][INFO] - Starting inference
[2025-03-06 12:06:08,803][root][INFO] - Processing question number 0
[2025-03-06 12:06:08,805][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 12:06:17,890][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 12:06:27,066][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 12:06:36,784][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 12:06:43,999][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 12:06:50,703][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 12:07:00,828][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 12:07:11,870][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 12:07:20,096][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 12:07:25,756][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 12:07:34,409][root][INFO] - Processing question number 10
[2025-03-06 12:07:34,411][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 12:07:44,122][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 12:07:52,821][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 12:08:01,286][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 12:08:10,215][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 12:08:18,397][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 12:08:28,450][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 12:08:36,506][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 12:08:48,670][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 12:08:57,485][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 12:09:08,938][root][INFO] - Processing question number 20
[2025-03-06 12:09:08,941][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 12:09:18,278][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 12:09:26,518][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 12:09:37,667][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 12:09:48,023][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 12:09:54,934][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 12:10:05,920][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 12:10:13,699][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 12:10:24,443][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 12:10:35,695][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 12:10:43,602][root][INFO] - Processing question number 30
[2025-03-06 12:10:43,605][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 12:10:52,468][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 12:11:00,158][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 12:11:10,555][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 12:11:19,800][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 12:11:29,679][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 12:11:37,695][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 12:11:47,446][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 12:11:55,767][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 12:12:03,153][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 12:12:14,804][root][INFO] - Processing question number 40
[2025-03-06 12:12:14,807][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 12:12:24,551][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 12:12:33,836][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 12:12:44,979][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 12:12:52,952][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 12:13:01,638][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 12:13:10,353][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 12:13:18,507][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 12:13:26,659][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 12:13:34,384][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 12:13:44,830][root][INFO] - Processing question number 50
[2025-03-06 12:13:44,833][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 12:13:55,083][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 12:14:04,588][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 12:14:13,325][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 12:14:23,867][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 12:14:36,240][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 12:14:43,943][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 12:14:56,895][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 12:15:06,420][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 12:15:17,887][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 12:15:26,992][root][INFO] - Processing question number 60
[2025-03-06 12:15:26,996][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 12:15:33,827][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:15:42,913][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 12:15:56,032][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 12:16:07,790][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 12:16:18,806][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 12:16:30,663][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 12:16:38,644][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 12:16:50,611][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:16:56,475][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 12:17:05,958][root][INFO] - Processing question number 70
[2025-03-06 12:17:05,962][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 12:17:13,965][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 12:17:22,114][root][INFO] - Domain : Property, Question : 6
[2025-03-06 12:17:27,846][root][INFO] - Domain : Property, Question : 13
[2025-03-06 12:17:41,106][root][INFO] - Domain : Property, Question : 20
[2025-03-06 12:17:49,077][root][INFO] - Domain : Property, Question : 33
[2025-03-06 12:17:56,207][root][INFO] - Domain : Property, Question : 39
[2025-03-06 12:18:05,494][root][INFO] - Domain : Property, Question : 48
[2025-03-06 12:18:14,952][root][INFO] - Domain : Property, Question : 54
[2025-03-06 12:18:24,959][root][INFO] - Domain : Property, Question : 61
[2025-03-06 12:18:35,658][root][INFO] - Processing question number 80
[2025-03-06 12:18:35,662][root][INFO] - Domain : Property, Question : 67
[2025-03-06 12:18:45,428][root][INFO] - Domain : Property, Question : 75
[2025-03-06 12:18:54,552][root][INFO] - Domain : Property, Question : 83
[2025-03-06 12:19:05,448][root][INFO] - Domain : Property, Question : 89
[2025-03-06 12:19:14,729][root][INFO] - Domain : Property, Question : 97
[2025-03-06 12:19:26,836][root][INFO] - Domain : Property, Question : 100
[2025-03-06 12:19:34,929][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 12:19:45,487][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 12:19:52,797][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 12:20:04,285][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 12:20:14,240][root][INFO] - Processing question number 90
[2025-03-06 12:20:14,245][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 12:20:25,557][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 12:20:32,764][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 12:20:44,123][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 12:20:51,158][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 12:20:59,407][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 12:21:06,072][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 12:21:13,818][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 12:21:22,193][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 12:21:34,973][root][INFO] - Inference complete
[2025-03-06 12:21:34,973][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:21:34,979][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:21:34,991][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:21:34,996][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:21:34,996][root][INFO] - Saved parsed outputs
[2025-03-06 12:21:34,996][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:21:34,997][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:21:34,997][root][INFO] - Saved parsing metadata
[2025-03-06 12:21:34,998][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:21:34,999][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:21:35,000][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 12:21:35,012][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 12:21:35,012][root][INFO] - Summary of metrics : {'label_accuracy': 0.48484848484848486, 'misclassification_rate': 0.5151515151515151, 'combined_accuracy': 0.18181818181818182, 'malformed_label': 0, 'malformed_domain': 64, 'total_predictions': 99, 'correct_predictions': 48, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.0, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.0, 'Constitutional_Law_confidence': 0.10101010101010101, 'Contracts_confidence': 0.020202020202020204, 'Criminal_Law_confidence': 0.06060606060606061, 'Evidence_confidence': 0.050505050505050504, 'Real_Property_confidence': 0.0707070707070707, 'Torts_confidence': 0.08080808080808081, 'Civil_Procedure_confidence': 0.0, 'correct_domain_wrong_label': 17, 'correct_label_wrong_domain': 30, 'both_wrong': 34}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 12:21:41,684][root][INFO] - Setting global seed to 206
[2025-03-06 12:21:41,691][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 12:21:41,692][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 12:21:41,693][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 12:21:41,703][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 12:21:41,705][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 12:21:41,705][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 12:21:41,867][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 12:21:42,413][root][INFO] - Full model selected, loading model
[2025-03-06 12:21:56,835][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 12:23:43,570][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 12:23:43,571][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 12:24:17,672][root][INFO] - Peft model loaded successfully
[2025-03-06 12:24:25,012][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 12:24:25,013][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:24:25,013][root][INFO] - Starting inference
[2025-03-06 12:24:25,175][root][INFO] - Processing question number 0
[2025-03-06 12:24:25,177][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 12:24:35,312][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 12:24:47,770][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 12:25:00,549][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 12:25:31,765][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 12:25:39,081][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 12:25:50,401][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 12:25:59,751][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 12:26:07,364][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 12:26:13,258][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 12:26:24,997][root][INFO] - Processing question number 10
[2025-03-06 12:26:24,998][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 12:26:34,570][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 12:26:50,423][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 12:27:21,287][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 12:27:34,717][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 12:27:44,670][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 12:27:59,473][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 12:28:08,803][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 12:28:17,015][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 12:28:28,342][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 12:28:38,028][root][INFO] - Processing question number 20
[2025-03-06 12:28:38,031][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 12:28:49,508][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 12:28:57,146][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 12:29:27,856][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 12:29:36,711][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 12:29:49,152][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 12:30:20,287][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 12:30:29,788][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 12:30:45,331][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 12:30:59,145][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 12:31:11,005][root][INFO] - Processing question number 30
[2025-03-06 12:31:11,008][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 12:31:21,925][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 12:31:31,271][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 12:31:41,270][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 12:32:08,800][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 12:32:20,192][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 12:32:30,700][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 12:32:38,191][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 12:32:47,941][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 12:32:58,949][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 12:33:09,554][root][INFO] - Processing question number 40
[2025-03-06 12:33:09,557][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 12:33:20,467][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 12:33:30,406][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 12:33:40,139][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 12:33:50,596][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 12:34:09,435][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 12:34:16,054][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 12:34:24,626][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:34:55,646][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 12:35:26,584][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 12:35:45,820][root][INFO] - Processing question number 50
[2025-03-06 12:35:45,824][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 12:35:51,956][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 12:36:00,954][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 12:36:13,353][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:36:29,228][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 12:36:41,743][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 12:36:54,201][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 12:37:15,851][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 12:37:36,107][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 12:37:46,800][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 12:37:58,833][root][INFO] - Processing question number 60
[2025-03-06 12:37:58,838][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 12:38:19,935][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 12:38:35,977][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 12:38:48,164][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 12:39:02,127][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 12:39:17,366][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 12:39:30,521][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 12:39:40,264][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 12:39:50,866][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 12:39:59,114][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 12:40:12,264][root][INFO] - Processing question number 70
[2025-03-06 12:40:12,268][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 12:40:24,126][root][INFO] - Domain : Property, Question : 9
[2025-03-06 12:40:36,088][root][INFO] - Domain : Property, Question : 17
[2025-03-06 12:40:49,737][root][INFO] - Domain : Property, Question : 25
[2025-03-06 12:41:21,276][root][INFO] - Domain : Property, Question : 30
[2025-03-06 12:41:35,987][root][INFO] - Domain : Property, Question : 36
[2025-03-06 12:41:44,680][root][INFO] - Domain : Property, Question : 46
[2025-03-06 12:41:55,493][root][INFO] - Domain : Property, Question : 53
[2025-03-06 12:42:26,730][root][INFO] - Domain : Property, Question : 59
[2025-03-06 12:42:36,593][root][INFO] - Domain : Property, Question : 66
[2025-03-06 12:42:48,148][root][INFO] - Processing question number 80
[2025-03-06 12:42:48,153][root][INFO] - Domain : Property, Question : 69
[2025-03-06 12:42:55,482][root][INFO] - Domain : Property, Question : 81
[2025-03-06 12:43:05,700][root][INFO] - Domain : Property, Question : 88
[2025-03-06 12:43:18,576][root][INFO] - Domain : Property, Question : 91
[2025-03-06 12:43:31,426][root][INFO] - Domain : Property, Question : 94
[2025-03-06 12:43:41,512][root][INFO] - Domain : Property, Question : 100
[2025-03-06 12:43:48,041][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 12:44:01,057][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 12:44:08,976][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 12:44:20,722][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 12:44:51,686][root][INFO] - Processing question number 90
[2025-03-06 12:44:51,691][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 12:44:58,689][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 12:45:30,132][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 12:45:49,311][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 12:45:59,737][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 12:46:31,232][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 12:46:39,716][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 12:46:54,230][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 12:47:04,615][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 12:47:13,567][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 12:47:29,756][root][INFO] - Inference complete
[2025-03-06 12:47:29,756][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:47:29,763][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:47:29,764][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,765][root][WARNING] - |Q. 20||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,765][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,765][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,767][root][WARNING] - |Q. 86||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,767][root][WARNING] - |Q. 86||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,767][root][INFO] - |Q. 86||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,767][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,768][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,769][root][WARNING] - |Q. 64||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,769][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,769][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,769][root][WARNING] - |Q. 83||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,770][root][WARNING] - |Q. 83||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,770][root][INFO] - |Q. 83||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,770][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,773][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,773][root][WARNING] - |Q. 31||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,773][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,773][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,774][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,774][root][WARNING] - |Q. 38||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,774][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,774][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,777][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,777][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:47:29,777][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,778][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,778][root][WARNING] - |Q. 25||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,778][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,778][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,779][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,779][root][WARNING] - |Q. 53||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,779][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,779][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,781][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,781][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,781][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,781][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,782][root][WARNING] - |Q. 45||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,782][root][WARNING] - |Q. 45||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,782][root][INFO] - |Q. 45||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,782][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,783][root][WARNING] - |Q. 63||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:47:29,783][root][WARNING] - |Q. 63||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:47:29,783][root][INFO] - |Q. 63||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:47:29,783][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:47:29,785][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:47:29,790][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:47:29,790][root][INFO] - Saved parsed outputs
[2025-03-06 12:47:29,791][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:47:29,792][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:47:29,792][root][INFO] - Saved parsing metadata
[2025-03-06 12:47:29,793][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:47:29,794][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:47:29,795][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 12:47:29,815][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 12:47:29,815][root][INFO] - Summary of metrics : {'label_accuracy': 0.54, 'misclassification_rate': 0.45999999999999996, 'combined_accuracy': 0.39, 'malformed_label': 0, 'malformed_domain': 21, 'total_predictions': 100, 'correct_predictions': 54, 'correct_label_and_domain': 39, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.46153846153846156, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.15, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 40, 'correct_label_wrong_domain': 15, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 12:47:37,807][root][INFO] - Setting global seed to 206
[2025-03-06 12:47:37,812][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 12:47:37,813][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 12:47:37,814][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 12:47:37,816][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 12:47:37,818][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 12:47:37,818][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 12:47:37,995][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 12:47:38,579][root][INFO] - Full model selected, loading model
[2025-03-06 12:48:01,104][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 12:48:01,116][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 12:48:09,064][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 12:48:09,065][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 12:48:09,065][root][INFO] - Starting inference
[2025-03-06 12:48:09,187][root][INFO] - Processing question number 0
[2025-03-06 12:48:09,189][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 12:48:21,972][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 12:48:31,026][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 12:48:39,536][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 12:48:49,310][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 12:48:58,102][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 12:49:05,304][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 12:49:14,325][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 12:49:22,389][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 12:49:31,012][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 12:49:43,467][root][INFO] - Processing question number 10
[2025-03-06 12:49:43,469][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 12:49:50,199][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 12:50:01,533][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 12:50:10,036][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 12:50:16,941][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 12:50:24,632][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 12:50:33,566][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 12:50:43,641][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 12:50:52,605][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 12:51:02,546][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 12:51:10,447][root][INFO] - Processing question number 20
[2025-03-06 12:51:10,450][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 12:51:19,946][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 12:51:28,085][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 12:51:36,099][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 12:51:44,817][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 12:51:51,479][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 12:52:00,877][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 12:52:08,180][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 12:52:16,625][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 12:52:27,019][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 12:52:36,651][root][INFO] - Processing question number 30
[2025-03-06 12:52:36,654][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 12:52:45,551][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 12:52:53,488][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 12:53:03,844][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 12:53:13,057][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 12:53:22,286][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 12:53:31,516][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 12:53:40,831][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 12:53:49,498][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 12:53:56,762][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 12:54:05,243][root][INFO] - Processing question number 40
[2025-03-06 12:54:05,246][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 12:54:13,692][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 12:54:23,194][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 12:54:32,192][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 12:54:39,993][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 12:54:51,977][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 12:55:01,164][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 12:55:10,136][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:55:17,614][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 12:55:34,092][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 12:55:42,154][root][INFO] - Processing question number 50
[2025-03-06 12:55:42,157][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 12:55:50,329][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 12:55:57,833][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 12:56:11,407][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:56:20,534][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 12:56:30,813][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 12:56:41,500][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 12:56:52,618][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 12:57:00,455][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 12:57:09,162][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 12:57:17,186][root][INFO] - Processing question number 60
[2025-03-06 12:57:17,190][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 12:57:24,710][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 12:57:34,435][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 12:57:43,858][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 12:57:52,151][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 12:58:00,652][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 12:58:11,039][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 12:58:19,661][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 12:58:27,597][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 12:58:36,490][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 12:58:47,240][root][INFO] - Processing question number 70
[2025-03-06 12:58:47,245][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 12:58:53,811][root][INFO] - Domain : Property, Question : 9
[2025-03-06 12:59:00,598][root][INFO] - Domain : Property, Question : 17
[2025-03-06 12:59:14,014][root][INFO] - Domain : Property, Question : 25
[2025-03-06 12:59:27,274][root][INFO] - Domain : Property, Question : 30
[2025-03-06 12:59:35,701][root][INFO] - Domain : Property, Question : 36
[2025-03-06 12:59:46,005][root][INFO] - Domain : Property, Question : 46
[2025-03-06 12:59:55,099][root][INFO] - Domain : Property, Question : 53
[2025-03-06 13:00:09,495][root][INFO] - Domain : Property, Question : 59
[2025-03-06 13:00:19,717][root][INFO] - Domain : Property, Question : 66
[2025-03-06 13:00:28,389][root][INFO] - Processing question number 80
[2025-03-06 13:00:28,394][root][INFO] - Domain : Property, Question : 69
[2025-03-06 13:00:35,868][root][INFO] - Domain : Property, Question : 81
[2025-03-06 13:00:43,895][root][INFO] - Domain : Property, Question : 88
[2025-03-06 13:00:51,930][root][INFO] - Domain : Property, Question : 91
[2025-03-06 13:01:02,439][root][INFO] - Domain : Property, Question : 94
[2025-03-06 13:01:11,419][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:01:22,171][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 13:01:32,394][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 13:01:40,507][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 13:01:49,826][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 13:01:58,034][root][INFO] - Processing question number 90
[2025-03-06 13:01:58,039][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 13:02:09,056][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 13:02:17,791][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 13:02:28,572][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 13:02:33,452][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 13:02:42,713][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 13:02:53,055][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 13:03:02,234][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 13:03:12,278][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 13:03:20,569][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 13:03:29,716][root][INFO] - Inference complete
[2025-03-06 13:03:29,717][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:03:29,723][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:03:29,730][root][WARNING] - |Q. 68||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:03:29,730][root][WARNING] - |Q. 68||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:03:29,731][root][INFO] - |Q. 68||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:03:29,731][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:03:29,731][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:03:29,731][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:03:29,735][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:03:29,753][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:03:29,753][root][INFO] - Saved parsed outputs
[2025-03-06 13:03:29,753][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:03:29,780][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:03:29,780][root][INFO] - Saved parsing metadata
[2025-03-06 13:03:29,780][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:03:29,816][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:03:29,826][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 13:03:29,955][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 13:03:29,955][root][INFO] - Summary of metrics : {'label_accuracy': 0.52, 'misclassification_rate': 0.48, 'combined_accuracy': 0.18, 'malformed_label': 0, 'malformed_domain': 66, 'total_predictions': 100, 'correct_predictions': 52, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.06666666666666667, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.2857142857142857, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.03, 'Contracts_confidence': 0.01, 'Criminal_Law_confidence': 0.05, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.1, 'Torts_confidence': 0.07, 'Civil_Procedure_confidence': 0.02, 'correct_domain_wrong_label': 16, 'correct_label_wrong_domain': 34, 'both_wrong': 32}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 13:03:42,294][root][INFO] - Setting global seed to 206
[2025-03-06 13:03:42,300][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 13:03:42,301][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 13:03:42,302][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 13:03:42,352][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:03:42,354][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:03:42,354][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 13:03:42,508][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 13:03:43,080][root][INFO] - Full model selected, loading model
[2025-03-06 13:03:58,576][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 13:05:45,452][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 13:05:45,473][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 13:06:20,320][root][INFO] - Peft model loaded successfully
[2025-03-06 13:06:27,644][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 13:06:27,645][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:06:27,645][root][INFO] - Starting inference
[2025-03-06 13:06:27,812][root][INFO] - Processing question number 0
[2025-03-06 13:06:27,825][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 13:06:43,939][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 13:06:59,355][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 13:07:22,256][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 13:07:33,059][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 13:07:45,455][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 13:07:54,362][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 13:08:04,095][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 13:08:11,309][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 13:08:24,542][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 13:08:37,197][root][INFO] - Processing question number 10
[2025-03-06 13:08:37,209][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 13:08:47,709][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 13:08:59,793][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 13:09:09,649][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 13:09:19,298][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 13:09:24,992][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 13:09:36,511][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:09:52,884][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 13:10:02,955][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 13:10:11,810][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 13:10:22,429][root][INFO] - Processing question number 20
[2025-03-06 13:10:22,446][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 13:10:31,479][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 13:10:43,650][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:10:57,108][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 13:11:06,532][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 13:11:19,357][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 13:11:29,221][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 13:11:45,816][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 13:11:55,064][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 13:12:04,901][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 13:12:15,507][root][INFO] - Processing question number 30
[2025-03-06 13:12:15,510][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 13:12:26,074][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 13:12:38,908][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 13:13:10,159][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 13:13:41,766][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 13:13:54,534][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 13:14:05,588][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 13:14:13,140][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 13:14:44,896][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 13:14:54,104][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 13:15:10,089][root][INFO] - Processing question number 40
[2025-03-06 13:15:10,092][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 13:15:41,378][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 13:15:52,049][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 13:16:23,605][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 13:16:31,457][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 13:16:52,013][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 13:17:00,858][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 13:17:13,296][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 13:17:44,728][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 13:18:06,470][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 13:18:26,497][root][INFO] - Processing question number 50
[2025-03-06 13:18:26,501][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 13:18:35,473][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 13:18:51,194][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 13:19:03,866][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 13:19:35,371][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 13:19:48,414][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 13:20:00,782][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 13:20:20,786][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 13:20:30,277][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 13:20:45,637][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 13:20:55,313][root][INFO] - Processing question number 60
[2025-03-06 13:20:55,318][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 13:21:07,897][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 13:21:25,492][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 13:21:37,479][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 13:22:09,002][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 13:22:20,938][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 13:22:33,866][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 13:22:45,983][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 13:22:53,313][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 13:23:24,465][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 13:23:37,047][root][INFO] - Processing question number 70
[2025-03-06 13:23:37,051][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 13:23:48,053][root][INFO] - Domain : Property, Question : 9
[2025-03-06 13:24:00,573][root][INFO] - Domain : Property, Question : 17
[2025-03-06 13:24:32,185][root][INFO] - Domain : Property, Question : 25
[2025-03-06 13:25:04,153][root][INFO] - Domain : Property, Question : 30
[2025-03-06 13:25:14,068][root][INFO] - Domain : Property, Question : 36
[2025-03-06 13:25:23,690][root][INFO] - Domain : Property, Question : 46
[2025-03-06 13:25:32,182][root][INFO] - Domain : Property, Question : 53
[2025-03-06 13:26:03,842][root][INFO] - Domain : Property, Question : 59
[2025-03-06 13:26:13,936][root][INFO] - Domain : Property, Question : 66
[2025-03-06 13:26:45,140][root][INFO] - Processing question number 80
[2025-03-06 13:26:45,145][root][INFO] - Domain : Property, Question : 69
[2025-03-06 13:26:52,310][root][INFO] - Domain : Property, Question : 81
[2025-03-06 13:27:03,476][root][INFO] - Domain : Property, Question : 88
[2025-03-06 13:27:21,938][root][INFO] - Domain : Property, Question : 91
[2025-03-06 13:27:34,509][root][INFO] - Domain : Property, Question : 94
[2025-03-06 13:27:46,790][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:27:56,732][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 13:28:17,314][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 13:28:26,694][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 13:28:40,118][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 13:28:53,860][root][INFO] - Processing question number 90
[2025-03-06 13:28:53,865][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 13:29:04,824][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 13:29:19,082][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 13:29:27,119][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 13:29:33,939][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 13:29:43,468][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 13:29:56,996][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 13:30:07,405][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 13:30:15,682][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 13:30:28,435][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 13:30:38,367][root][INFO] - Inference complete
[2025-03-06 13:30:38,368][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:30:38,374][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:30:38,379][root][WARNING] - |Q. 14||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,380][root][WARNING] - |Q. 14||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:30:38,380][root][INFO] - |Q. 14||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,380][root][WARNING] - |Q. 28||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,381][root][WARNING] - |Q. 28||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,381][root][INFO] - |Q. 28||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,381][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,382][root][WARNING] - |Q. 34||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,382][root][WARNING] - |Q. 34||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,382][root][INFO] - |Q. 34||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,382][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,383][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,383][root][WARNING] - |Q. 65||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,383][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,383][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,384][root][WARNING] - |Q. 84||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,384][root][WARNING] - |Q. 84||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,384][root][INFO] - |Q. 84||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,384][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,385][root][WARNING] - |Q. 97||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,385][root][WARNING] - |Q. 97||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,385][root][INFO] - |Q. 97||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,385][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,386][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,387][root][WARNING] - |Q. 31||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,387][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,387][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,388][root][WARNING] - |Q. 73||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,388][root][WARNING] - |Q. 73||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,388][root][INFO] - |Q. 73||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,388][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,389][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,389][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:30:38,389][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,390][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,391][root][WARNING] - |Q. 40||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,391][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,391][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,391][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,391][root][WARNING] - |Q. 54||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,391][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,391][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,392][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,392][root][WARNING] - |Q. 75||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,392][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,392][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,393][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,393][root][WARNING] - |Q. 17||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,393][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,393][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,394][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,394][root][WARNING] - |Q. 25||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,394][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,394][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,395][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,395][root][WARNING] - |Q. 53||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,395][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,395][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,395][root][WARNING] - |Q. 66||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:30:38,396][root][WARNING] - |Q. 66||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:30:38,396][root][INFO] - |Q. 66||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:30:38,396][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:30:38,399][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:30:38,405][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:30:38,405][root][INFO] - Saved parsed outputs
[2025-03-06 13:30:38,405][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:30:38,406][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:30:38,406][root][INFO] - Saved parsing metadata
[2025-03-06 13:30:38,407][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:30:38,408][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:30:38,409][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 13:30:38,469][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 13:30:38,469][root][INFO] - Summary of metrics : {'label_accuracy': 0.56, 'misclassification_rate': 0.43999999999999995, 'combined_accuracy': 0.41, 'malformed_label': 0, 'malformed_domain': 21, 'total_predictions': 100, 'correct_predictions': 56, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.46153846153846156, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.07, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.12, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 38, 'correct_label_wrong_domain': 15, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 13:30:46,564][root][INFO] - Setting global seed to 206
[2025-03-06 13:30:46,570][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 13:30:46,570][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 13:30:46,572][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 13:30:46,577][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:30:46,580][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:30:46,580][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 13:30:46,763][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 13:30:47,360][root][INFO] - Full model selected, loading model
[2025-03-06 13:31:11,284][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 13:31:11,299][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 13:31:19,252][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 13:31:19,254][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:31:19,254][root][INFO] - Starting inference
[2025-03-06 13:31:19,365][root][INFO] - Processing question number 0
[2025-03-06 13:31:19,367][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 13:31:33,543][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 13:31:46,216][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 13:31:56,152][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 13:32:03,090][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 13:32:11,760][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 13:32:22,106][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 13:32:30,399][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 13:32:39,120][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 13:32:46,080][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 13:32:53,555][root][INFO] - Processing question number 10
[2025-03-06 13:32:53,557][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 13:33:02,578][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 13:33:12,255][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 13:33:21,116][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 13:33:31,811][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 13:33:41,352][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 13:33:50,605][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:33:59,569][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 13:34:08,891][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 13:34:18,309][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 13:34:27,524][root][INFO] - Processing question number 20
[2025-03-06 13:34:27,526][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 13:34:39,169][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 13:34:45,580][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:34:54,150][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 13:35:03,073][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 13:35:10,476][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 13:35:17,247][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 13:35:24,012][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 13:35:32,782][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 13:35:40,735][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 13:35:48,688][root][INFO] - Processing question number 30
[2025-03-06 13:35:48,690][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 13:35:58,345][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 13:36:06,781][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 13:36:15,775][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 13:36:24,099][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 13:36:34,395][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 13:36:42,362][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 13:36:48,533][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 13:36:55,409][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 13:37:02,928][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 13:37:10,182][root][INFO] - Processing question number 40
[2025-03-06 13:37:10,185][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 13:37:17,555][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 13:37:25,252][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 13:37:36,576][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 13:37:45,948][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 13:37:56,652][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 13:38:04,717][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 13:38:13,509][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 13:38:21,587][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 13:38:36,718][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 13:38:45,191][root][INFO] - Processing question number 50
[2025-03-06 13:38:45,195][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 13:38:55,185][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 13:39:01,761][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 13:39:14,318][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 13:39:25,273][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 13:39:36,220][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 13:39:47,875][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 13:39:58,765][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 13:40:07,814][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 13:40:16,889][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 13:40:26,062][root][INFO] - Processing question number 60
[2025-03-06 13:40:26,065][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 13:40:35,870][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 13:40:46,217][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 13:40:56,319][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 13:41:01,845][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 13:41:10,863][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 13:41:19,245][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 13:41:25,533][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 13:41:34,254][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 13:41:43,766][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 13:41:54,599][root][INFO] - Processing question number 70
[2025-03-06 13:41:54,604][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 13:42:02,102][root][INFO] - Domain : Property, Question : 9
[2025-03-06 13:42:09,535][root][INFO] - Domain : Property, Question : 17
[2025-03-06 13:42:23,967][root][INFO] - Domain : Property, Question : 25
[2025-03-06 13:42:34,668][root][INFO] - Domain : Property, Question : 30
[2025-03-06 13:42:43,545][root][INFO] - Domain : Property, Question : 36
[2025-03-06 13:42:54,071][root][INFO] - Domain : Property, Question : 46
[2025-03-06 13:43:02,174][root][INFO] - Domain : Property, Question : 53
[2025-03-06 13:43:11,316][root][INFO] - Domain : Property, Question : 59
[2025-03-06 13:43:19,200][root][INFO] - Domain : Property, Question : 66
[2025-03-06 13:43:25,963][root][INFO] - Processing question number 80
[2025-03-06 13:43:25,967][root][INFO] - Domain : Property, Question : 69
[2025-03-06 13:43:33,002][root][INFO] - Domain : Property, Question : 81
[2025-03-06 13:43:42,652][root][INFO] - Domain : Property, Question : 88
[2025-03-06 13:43:52,348][root][INFO] - Domain : Property, Question : 91
[2025-03-06 13:44:00,439][root][INFO] - Domain : Property, Question : 94
[2025-03-06 13:44:08,480][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:44:17,372][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 13:44:29,938][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 13:44:38,371][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 13:44:47,110][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 13:44:56,210][root][INFO] - Processing question number 90
[2025-03-06 13:44:56,215][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 13:45:04,813][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 13:45:14,575][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 13:45:24,924][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 13:45:30,734][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 13:45:42,800][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 13:45:53,414][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 13:46:03,264][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 13:46:14,335][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 13:46:24,460][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 13:46:35,589][root][INFO] - Inference complete
[2025-03-06 13:46:35,589][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:46:35,596][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:46:35,607][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:46:35,612][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:46:35,612][root][INFO] - Saved parsed outputs
[2025-03-06 13:46:35,613][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:46:35,614][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:46:35,614][root][INFO] - Saved parsing metadata
[2025-03-06 13:46:35,615][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:46:35,617][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:46:35,618][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 13:46:35,631][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 13:46:35,631][root][INFO] - Summary of metrics : {'label_accuracy': 0.5, 'misclassification_rate': 0.5, 'combined_accuracy': 0.18, 'malformed_label': 0, 'malformed_domain': 63, 'total_predictions': 100, 'correct_predictions': 50, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.06666666666666667, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.26666666666666666, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.23076923076923078, 'Constitutional_Law_confidence': 0.06, 'Contracts_confidence': 0.02, 'Criminal_Law_confidence': 0.04, 'Evidence_confidence': 0.05, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.08, 'Civil_Procedure_confidence': 0.05, 'correct_domain_wrong_label': 19, 'correct_label_wrong_domain': 32, 'both_wrong': 31}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 13:46:48,981][root][INFO] - Setting global seed to 206
[2025-03-06 13:46:48,990][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 13:46:48,990][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 13:46:48,992][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 13:46:48,994][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:46:48,996][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:46:48,996][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 13:46:49,146][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 13:46:49,799][root][INFO] - Full model selected, loading model
[2025-03-06 13:47:09,341][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 13:48:55,680][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 13:48:55,681][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 13:49:30,986][root][INFO] - Peft model loaded successfully
[2025-03-06 13:49:38,376][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 13:49:38,379][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 13:49:38,379][root][INFO] - Starting inference
[2025-03-06 13:49:38,557][root][INFO] - Processing question number 0
[2025-03-06 13:49:38,559][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 13:50:00,553][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 13:50:12,578][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 13:50:21,317][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 13:50:37,222][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 13:50:47,784][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 13:51:00,376][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 13:51:31,493][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 13:51:43,163][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 13:51:53,834][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 13:52:02,205][root][INFO] - Processing question number 10
[2025-03-06 13:52:02,207][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 13:52:10,997][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 13:52:25,906][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 13:52:34,388][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 13:52:45,031][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 13:52:55,541][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 13:53:05,415][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:53:20,664][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 13:53:32,185][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 13:53:49,935][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 13:53:58,812][root][INFO] - Processing question number 20
[2025-03-06 13:53:58,815][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 13:54:09,084][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 13:54:19,499][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:54:41,722][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 13:54:51,404][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 13:54:58,275][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 13:55:10,284][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 13:55:20,269][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 13:55:31,284][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 13:55:47,871][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 13:56:01,572][root][INFO] - Processing question number 30
[2025-03-06 13:56:01,575][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 13:56:13,508][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 13:56:30,500][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 13:56:43,761][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 13:57:06,949][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 13:57:19,768][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 13:57:28,344][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 13:57:38,640][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 13:57:47,427][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 13:57:58,345][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 13:58:11,529][root][INFO] - Processing question number 40
[2025-03-06 13:58:11,532][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 13:58:23,502][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 13:58:33,933][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 13:58:45,621][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 13:58:53,782][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 13:59:08,176][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 13:59:19,991][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 13:59:28,307][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 13:59:45,120][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 13:59:59,713][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 14:00:12,486][root][INFO] - Processing question number 50
[2025-03-06 14:00:12,489][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 14:00:23,764][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 14:00:54,502][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 14:01:06,477][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 14:01:17,444][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 14:01:25,636][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 14:01:56,717][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 14:02:16,260][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 14:02:25,620][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 14:02:36,173][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 14:02:45,724][root][INFO] - Processing question number 60
[2025-03-06 14:02:45,728][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 14:02:53,963][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 14:03:09,372][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 14:03:23,738][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 14:03:42,568][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 14:03:54,371][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 14:04:07,970][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 14:04:17,470][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 14:04:35,250][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 14:04:42,594][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 14:04:50,578][root][INFO] - Processing question number 70
[2025-03-06 14:04:50,582][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 14:04:57,902][root][INFO] - Domain : Property, Question : 9
[2025-03-06 14:05:21,712][root][INFO] - Domain : Property, Question : 17
[2025-03-06 14:05:41,366][root][INFO] - Domain : Property, Question : 25
[2025-03-06 14:05:51,625][root][INFO] - Domain : Property, Question : 30
[2025-03-06 14:06:02,644][root][INFO] - Domain : Property, Question : 36
[2025-03-06 14:06:12,187][root][INFO] - Domain : Property, Question : 46
[2025-03-06 14:06:19,894][root][INFO] - Domain : Property, Question : 53
[2025-03-06 14:06:51,444][root][INFO] - Domain : Property, Question : 59
[2025-03-06 14:07:00,372][root][INFO] - Domain : Property, Question : 66
[2025-03-06 14:07:05,771][root][INFO] - Processing question number 80
[2025-03-06 14:07:05,776][root][INFO] - Domain : Property, Question : 69
[2025-03-06 14:07:22,401][root][INFO] - Domain : Property, Question : 81
[2025-03-06 14:07:40,750][root][INFO] - Domain : Property, Question : 88
[2025-03-06 14:07:58,233][root][INFO] - Domain : Property, Question : 91
[2025-03-06 14:08:11,869][root][INFO] - Domain : Property, Question : 94
[2025-03-06 14:08:20,173][root][INFO] - Domain : Property, Question : 100
[2025-03-06 14:08:30,178][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 14:08:51,581][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 14:09:04,035][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 14:09:15,448][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 14:09:25,072][root][INFO] - Processing question number 90
[2025-03-06 14:09:25,077][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 14:09:33,441][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 14:09:45,646][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 14:09:55,367][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 14:10:05,703][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 14:10:19,368][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 14:10:30,207][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 14:10:49,904][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 14:11:00,145][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 14:11:10,584][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 14:11:21,123][root][INFO] - Inference complete
[2025-03-06 14:11:21,123][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:11:21,130][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:11:21,132][root][WARNING] - |Q. 41||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:11:21,133][root][WARNING] - |Q. 41||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:11:21,133][root][INFO] - |Q. 41||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:11:21,133][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:11:21,136][root][WARNING] - |Q. 14||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:11:21,137][root][WARNING] - |Q. 14||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:11:21,137][root][INFO] - |Q. 14||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:11:21,139][root][WARNING] - |Q. 51||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:11:21,140][root][WARNING] - |Q. 51||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:11:21,140][root][INFO] - |Q. 51||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:11:21,140][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:11:21,141][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:11:21,141][root][WARNING] - |Q. 85||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:11:21,141][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:11:21,141][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:11:21,142][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:11:21,142][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:11:21,142][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:11:21,143][root][WARNING] - |Q. 47||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:11:21,143][root][WARNING] - |Q. 47||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:11:21,143][root][INFO] - |Q. 47||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:11:21,143][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:11:21,144][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:11:21,144][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:11:21,145][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:11:21,145][root][WARNING] - |Q. 53||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:11:21,145][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:11:21,145][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:11:21,149][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:11:21,154][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:11:21,154][root][INFO] - Saved parsed outputs
[2025-03-06 14:11:21,154][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:11:21,157][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:11:21,157][root][INFO] - Saved parsing metadata
[2025-03-06 14:11:21,158][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:11:21,160][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:11:21,168][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 14:11:21,189][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 14:11:21,189][root][INFO] - Summary of metrics : {'label_accuracy': 0.55, 'misclassification_rate': 0.44999999999999996, 'combined_accuracy': 0.39, 'malformed_label': 0, 'malformed_domain': 25, 'total_predictions': 100, 'correct_predictions': 55, 'correct_label_and_domain': 39, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.46153846153846156, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.13, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.09, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 36, 'correct_label_wrong_domain': 16, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 14:11:29,351][root][INFO] - Setting global seed to 206
[2025-03-06 14:11:29,356][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 14:11:29,356][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 14:11:29,358][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 14:11:29,359][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:11:29,361][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:11:29,361][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 14:11:29,519][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 14:11:30,060][root][INFO] - Full model selected, loading model
[2025-03-06 14:11:53,875][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 14:11:53,894][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 14:12:02,104][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:12:02,106][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:12:02,106][root][INFO] - Starting inference
[2025-03-06 14:12:02,242][root][INFO] - Processing question number 0
[2025-03-06 14:12:02,245][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 14:12:12,278][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 14:12:23,388][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 14:12:32,976][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 14:12:43,490][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 14:12:55,495][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 14:13:03,492][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 14:13:11,101][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 14:13:19,837][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 14:13:27,000][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 14:13:37,212][root][INFO] - Processing question number 10
[2025-03-06 14:13:37,214][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 14:13:45,130][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 14:13:54,024][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 14:14:03,198][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 14:14:12,381][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 14:14:23,386][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 14:14:32,389][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:14:39,881][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 14:14:47,875][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 14:15:01,386][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 14:15:11,169][root][INFO] - Processing question number 20
[2025-03-06 14:15:11,178][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 14:15:20,667][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 14:15:30,618][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:15:39,946][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 14:15:46,813][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 14:15:53,280][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 14:16:00,466][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 14:16:10,947][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 14:16:19,823][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 14:16:27,732][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 14:16:38,599][root][INFO] - Processing question number 30
[2025-03-06 14:16:38,602][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 14:16:47,089][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 14:16:54,695][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 14:17:05,194][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 14:17:14,943][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 14:17:23,715][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 14:17:31,939][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 14:17:41,048][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 14:17:49,686][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 14:17:57,817][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 14:18:06,275][root][INFO] - Processing question number 40
[2025-03-06 14:18:06,278][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 14:18:14,601][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 14:18:22,016][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 14:18:32,749][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 14:18:39,066][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 14:18:52,433][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 14:19:00,258][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 14:19:08,710][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 14:19:17,499][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 14:19:27,531][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 14:19:37,347][root][INFO] - Processing question number 50
[2025-03-06 14:19:37,350][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 14:19:47,278][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 14:19:55,687][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 14:20:04,741][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 14:20:13,048][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 14:20:22,681][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 14:20:29,847][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 14:20:40,046][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 14:20:49,103][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 14:20:58,841][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 14:21:07,824][root][INFO] - Processing question number 60
[2025-03-06 14:21:07,828][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 14:21:19,909][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 14:21:28,181][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 14:21:40,632][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 14:21:50,590][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 14:22:03,094][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 14:22:11,547][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 14:22:18,767][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 14:22:27,163][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 14:22:37,973][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 14:22:46,730][root][INFO] - Processing question number 70
[2025-03-06 14:22:46,735][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 14:22:53,211][root][INFO] - Domain : Property, Question : 9
[2025-03-06 14:23:00,498][root][INFO] - Domain : Property, Question : 17
[2025-03-06 14:23:18,300][root][INFO] - Domain : Property, Question : 25
[2025-03-06 14:23:28,246][root][INFO] - Domain : Property, Question : 30
[2025-03-06 14:23:35,121][root][INFO] - Domain : Property, Question : 36
[2025-03-06 14:23:45,103][root][INFO] - Domain : Property, Question : 46
[2025-03-06 14:23:54,428][root][INFO] - Domain : Property, Question : 53
[2025-03-06 14:24:05,351][root][INFO] - Domain : Property, Question : 59
[2025-03-06 14:24:13,249][root][INFO] - Domain : Property, Question : 66
[2025-03-06 14:24:18,790][root][INFO] - Processing question number 80
[2025-03-06 14:24:18,795][root][INFO] - Domain : Property, Question : 69
[2025-03-06 14:24:26,483][root][INFO] - Domain : Property, Question : 81
[2025-03-06 14:24:33,930][root][INFO] - Domain : Property, Question : 88
[2025-03-06 14:24:41,824][root][INFO] - Domain : Property, Question : 91
[2025-03-06 14:24:48,491][root][INFO] - Domain : Property, Question : 94
[2025-03-06 14:24:59,954][root][INFO] - Domain : Property, Question : 100
[2025-03-06 14:25:10,247][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 14:25:20,904][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 14:25:29,196][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 14:25:39,908][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 14:25:50,567][root][INFO] - Processing question number 90
[2025-03-06 14:25:50,572][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 14:25:59,135][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 14:26:08,051][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 14:26:20,682][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 14:26:27,980][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 14:26:35,454][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 14:26:44,871][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 14:26:56,459][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 14:27:06,056][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 14:27:17,527][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 14:27:27,661][root][INFO] - Inference complete
[2025-03-06 14:27:27,661][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:27:27,667][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:27:27,668][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:27:27,669][root][WARNING] - |Q. 13||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:27:27,669][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:27:27,669][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:27:27,680][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:27:27,685][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:27:27,685][root][INFO] - Saved parsed outputs
[2025-03-06 14:27:27,685][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:27:27,686][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:27:27,686][root][INFO] - Saved parsing metadata
[2025-03-06 14:27:27,687][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:27:27,689][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:27:27,690][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 14:27:27,727][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 14:27:27,727][root][INFO] - Summary of metrics : {'label_accuracy': 0.52, 'misclassification_rate': 0.48, 'combined_accuracy': 0.17, 'malformed_label': 0, 'malformed_domain': 69, 'total_predictions': 100, 'correct_predictions': 52, 'correct_label_and_domain': 17, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.13333333333333333, 'Criminal_Law_accuracy': 0.14285714285714285, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.05, 'Contracts_confidence': 0.06, 'Criminal_Law_confidence': 0.04, 'Evidence_confidence': 0.08, 'Real_Property_confidence': 0.03, 'Torts_confidence': 0.05, 'Civil_Procedure_confidence': 0.02, 'correct_domain_wrong_label': 14, 'correct_label_wrong_domain': 35, 'both_wrong': 34}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 14:27:36,902][root][INFO] - Setting global seed to 989
[2025-03-06 14:27:36,914][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 14:27:36,915][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 14:27:36,916][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 14:27:36,931][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:27:36,932][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:27:36,933][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 14:27:37,118][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 14:27:37,723][root][INFO] - Full model selected, loading model
[2025-03-06 14:27:56,034][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 14:29:45,120][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 14:29:45,121][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 14:30:19,674][root][INFO] - Peft model loaded successfully
[2025-03-06 14:30:26,975][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:30:26,977][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:30:26,977][root][INFO] - Starting inference
[2025-03-06 14:30:27,110][root][INFO] - Processing question number 0
[2025-03-06 14:30:27,112][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 14:30:37,113][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 14:30:49,586][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 14:31:02,378][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 14:31:33,632][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 14:31:40,967][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 14:31:52,301][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 14:32:01,653][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 14:32:09,282][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 14:32:15,184][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 14:32:26,942][root][INFO] - Processing question number 10
[2025-03-06 14:32:26,944][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 14:32:36,532][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 14:32:52,409][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 14:33:23,310][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 14:33:36,761][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 14:33:46,725][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 14:34:01,543][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:34:10,874][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 14:34:19,104][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 14:34:30,449][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 14:34:40,139][root][INFO] - Processing question number 20
[2025-03-06 14:34:40,142][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 14:34:51,635][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 14:34:59,288][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:35:30,031][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 14:35:38,892][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 14:35:51,339][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 14:36:22,522][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 14:36:32,029][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 14:36:47,589][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 14:37:01,419][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 14:37:13,293][root][INFO] - Processing question number 30
[2025-03-06 14:37:13,296][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 14:37:24,224][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 14:37:33,588][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 14:37:43,592][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 14:38:11,158][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 14:38:22,564][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 14:38:33,082][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 14:38:40,578][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 14:38:50,344][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 14:39:01,365][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 14:39:11,980][root][INFO] - Processing question number 40
[2025-03-06 14:39:11,983][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 14:39:22,886][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 14:39:32,832][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 14:39:42,579][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 14:39:53,042][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 14:40:11,905][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 14:40:18,528][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 14:40:27,111][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 14:40:58,160][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 14:41:29,136][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 14:41:48,397][root][INFO] - Processing question number 50
[2025-03-06 14:41:48,400][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 14:41:54,534][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 14:42:03,550][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 14:42:15,955][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 14:42:31,845][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 14:42:44,361][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 14:42:56,821][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 14:43:18,489][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 14:43:38,740][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 14:43:49,437][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 14:44:01,483][root][INFO] - Processing question number 60
[2025-03-06 14:44:01,487][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 14:44:22,600][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 14:44:38,660][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 14:44:50,845][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 14:45:04,827][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 14:45:20,082][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 14:45:33,250][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 14:45:43,005][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 14:45:53,619][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 14:46:01,869][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 14:46:15,032][root][INFO] - Processing question number 70
[2025-03-06 14:46:15,036][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 14:46:26,905][root][INFO] - Domain : Property, Question : 9
[2025-03-06 14:46:38,883][root][INFO] - Domain : Property, Question : 17
[2025-03-06 14:46:52,543][root][INFO] - Domain : Property, Question : 25
[2025-03-06 14:47:24,102][root][INFO] - Domain : Property, Question : 30
[2025-03-06 14:47:38,823][root][INFO] - Domain : Property, Question : 36
[2025-03-06 14:47:47,532][root][INFO] - Domain : Property, Question : 46
[2025-03-06 14:47:58,349][root][INFO] - Domain : Property, Question : 53
[2025-03-06 14:48:29,615][root][INFO] - Domain : Property, Question : 59
[2025-03-06 14:48:39,482][root][INFO] - Domain : Property, Question : 66
[2025-03-06 14:48:51,051][root][INFO] - Processing question number 80
[2025-03-06 14:48:51,056][root][INFO] - Domain : Property, Question : 69
[2025-03-06 14:48:58,391][root][INFO] - Domain : Property, Question : 81
[2025-03-06 14:49:08,610][root][INFO] - Domain : Property, Question : 88
[2025-03-06 14:49:21,503][root][INFO] - Domain : Property, Question : 91
[2025-03-06 14:49:34,366][root][INFO] - Domain : Property, Question : 94
[2025-03-06 14:49:44,464][root][INFO] - Domain : Property, Question : 100
[2025-03-06 14:49:50,992][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 14:50:04,020][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 14:50:11,951][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 14:50:23,709][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 14:50:54,694][root][INFO] - Processing question number 90
[2025-03-06 14:50:54,700][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 14:51:01,699][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 14:51:33,168][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 14:51:52,352][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 14:52:02,786][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 14:52:34,299][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 14:52:42,788][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 14:52:57,319][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 14:53:07,714][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 14:53:16,676][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 14:53:32,882][root][INFO] - Inference complete
[2025-03-06 14:53:32,882][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:53:32,889][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:53:32,891][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,891][root][WARNING] - |Q. 20||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,892][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,892][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,893][root][WARNING] - |Q. 86||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,893][root][WARNING] - |Q. 86||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,893][root][INFO] - |Q. 86||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,894][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,895][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,895][root][WARNING] - |Q. 64||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,895][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,895][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,896][root][WARNING] - |Q. 83||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,896][root][WARNING] - |Q. 83||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,896][root][INFO] - |Q. 83||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,896][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,899][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,900][root][WARNING] - |Q. 31||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,900][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,900][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,900][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,900][root][WARNING] - |Q. 38||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,900][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,901][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,903][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,903][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:53:32,903][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,904][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,905][root][WARNING] - |Q. 25||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,905][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,905][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,905][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,906][root][WARNING] - |Q. 53||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,906][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,906][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,907][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,908][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,908][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,908][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,908][root][WARNING] - |Q. 45||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,909][root][WARNING] - |Q. 45||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,909][root][INFO] - |Q. 45||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,909][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,909][root][WARNING] - |Q. 63||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:53:32,910][root][WARNING] - |Q. 63||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:53:32,910][root][INFO] - |Q. 63||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:53:32,910][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:53:32,911][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:53:32,917][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:53:32,917][root][INFO] - Saved parsed outputs
[2025-03-06 14:53:32,917][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:53:32,918][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:53:32,918][root][INFO] - Saved parsing metadata
[2025-03-06 14:53:32,919][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:53:32,920][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:53:32,921][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 14:53:32,937][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 14:53:32,937][root][INFO] - Summary of metrics : {'label_accuracy': 0.54, 'misclassification_rate': 0.45999999999999996, 'combined_accuracy': 0.39, 'malformed_label': 0, 'malformed_domain': 21, 'total_predictions': 100, 'correct_predictions': 54, 'correct_label_and_domain': 39, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.46153846153846156, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.15, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 40, 'correct_label_wrong_domain': 15, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 14:53:42,514][root][INFO] - Setting global seed to 989
[2025-03-06 14:53:42,520][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 14:53:42,520][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 14:53:42,521][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 14:53:42,523][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:53:42,525][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:53:42,525][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 14:53:42,693][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 14:53:43,379][root][INFO] - Full model selected, loading model
[2025-03-06 14:54:04,619][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 14:54:04,643][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 14:54:12,642][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:54:12,644][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:54:12,645][root][INFO] - Starting inference
[2025-03-06 14:54:12,761][root][INFO] - Processing question number 0
[2025-03-06 14:54:12,763][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 14:54:25,360][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 14:54:34,411][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 14:54:42,921][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 14:54:52,681][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 14:55:01,484][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 14:55:08,672][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 14:55:17,696][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 14:55:25,765][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 14:55:34,372][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 14:55:46,826][root][INFO] - Processing question number 10
[2025-03-06 14:55:46,830][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 14:55:53,568][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 14:56:04,897][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 14:56:13,406][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 14:56:20,305][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 14:56:28,003][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 14:56:36,932][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:56:47,004][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 14:56:55,975][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 14:57:05,916][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 14:57:13,817][root][INFO] - Processing question number 20
[2025-03-06 14:57:13,819][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 14:57:23,326][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 14:57:31,453][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:57:39,480][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 14:57:48,190][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 14:57:54,854][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 14:58:04,255][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 14:58:11,550][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 14:58:20,004][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 14:58:30,397][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 14:58:40,026][root][INFO] - Processing question number 30
[2025-03-06 14:58:40,028][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 14:58:48,931][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 14:58:56,866][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 14:59:07,226][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 14:59:16,435][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 14:59:25,661][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 14:59:34,897][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 14:59:44,206][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 14:59:52,867][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 15:00:00,139][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 15:00:08,609][root][INFO] - Processing question number 40
[2025-03-06 15:00:08,613][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 15:00:17,080][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 15:00:26,621][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 15:00:35,603][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 15:00:43,392][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 15:00:55,357][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 15:01:04,524][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 15:01:13,480][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 15:01:20,945][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 15:01:37,388][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 15:01:45,434][root][INFO] - Processing question number 50
[2025-03-06 15:01:45,437][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 15:01:53,595][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 15:02:01,080][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 15:02:14,632][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 15:02:23,738][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 15:02:33,997][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 15:02:44,660][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 15:02:55,761][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 15:03:03,587][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 15:03:12,278][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 15:03:20,291][root][INFO] - Processing question number 60
[2025-03-06 15:03:20,295][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 15:03:27,802][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 15:03:37,501][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 15:03:46,903][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 15:03:55,171][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 15:04:03,652][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 15:04:14,021][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 15:04:22,629][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 15:04:30,542][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 15:04:39,421][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 15:04:50,194][root][INFO] - Processing question number 70
[2025-03-06 15:04:50,198][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 15:04:56,782][root][INFO] - Domain : Property, Question : 9
[2025-03-06 15:05:03,588][root][INFO] - Domain : Property, Question : 17
[2025-03-06 15:05:16,998][root][INFO] - Domain : Property, Question : 25
[2025-03-06 15:05:30,197][root][INFO] - Domain : Property, Question : 30
[2025-03-06 15:05:38,588][root][INFO] - Domain : Property, Question : 36
[2025-03-06 15:05:48,865][root][INFO] - Domain : Property, Question : 46
[2025-03-06 15:05:57,990][root][INFO] - Domain : Property, Question : 53
[2025-03-06 15:06:12,413][root][INFO] - Domain : Property, Question : 59
[2025-03-06 15:06:22,647][root][INFO] - Domain : Property, Question : 66
[2025-03-06 15:06:31,323][root][INFO] - Processing question number 80
[2025-03-06 15:06:31,328][root][INFO] - Domain : Property, Question : 69
[2025-03-06 15:06:38,816][root][INFO] - Domain : Property, Question : 81
[2025-03-06 15:06:46,951][root][INFO] - Domain : Property, Question : 88
[2025-03-06 15:06:55,015][root][INFO] - Domain : Property, Question : 91
[2025-03-06 15:07:05,499][root][INFO] - Domain : Property, Question : 94
[2025-03-06 15:07:14,560][root][INFO] - Domain : Property, Question : 100
[2025-03-06 15:07:25,560][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 15:07:35,801][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 15:07:43,915][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 15:07:53,285][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 15:08:01,532][root][INFO] - Processing question number 90
[2025-03-06 15:08:01,537][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 15:08:12,612][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 15:08:21,400][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 15:08:32,244][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 15:08:37,154][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 15:08:46,480][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 15:08:56,885][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 15:09:06,127][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 15:09:16,239][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 15:09:24,583][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 15:09:33,799][root][INFO] - Inference complete
[2025-03-06 15:09:33,799][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:09:33,813][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:09:33,821][root][WARNING] - |Q. 68||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:09:33,822][root][WARNING] - |Q. 68||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:09:33,822][root][INFO] - |Q. 68||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:09:33,822][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:09:33,822][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:09:33,822][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:09:33,827][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:09:33,832][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:09:33,832][root][INFO] - Saved parsed outputs
[2025-03-06 15:09:33,832][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:09:33,833][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:09:33,833][root][INFO] - Saved parsing metadata
[2025-03-06 15:09:33,835][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:09:33,836][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:09:33,838][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 15:09:33,898][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 15:09:33,898][root][INFO] - Summary of metrics : {'label_accuracy': 0.52, 'misclassification_rate': 0.48, 'combined_accuracy': 0.18, 'malformed_label': 0, 'malformed_domain': 66, 'total_predictions': 100, 'correct_predictions': 52, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.06666666666666667, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.2857142857142857, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.03, 'Contracts_confidence': 0.01, 'Criminal_Law_confidence': 0.05, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.1, 'Torts_confidence': 0.07, 'Civil_Procedure_confidence': 0.02, 'correct_domain_wrong_label': 16, 'correct_label_wrong_domain': 34, 'both_wrong': 32}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 15:09:45,685][root][INFO] - Setting global seed to 989
[2025-03-06 15:09:45,694][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 15:09:45,694][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 15:09:45,696][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 15:09:45,703][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 15:09:45,709][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 15:09:45,709][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 15:09:45,920][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 15:09:46,520][root][INFO] - Full model selected, loading model
[2025-03-06 15:10:10,980][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 15:12:08,977][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 15:12:08,977][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 15:12:44,892][root][INFO] - Peft model loaded successfully
[2025-03-06 15:12:52,310][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 15:12:52,313][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:12:52,313][root][INFO] - Starting inference
[2025-03-06 15:12:52,462][root][INFO] - Processing question number 0
[2025-03-06 15:12:52,464][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 15:13:24,934][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 15:13:34,930][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 15:13:54,553][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 15:14:26,107][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 15:14:38,968][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 15:14:50,369][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 15:15:00,509][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 15:15:10,339][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 15:15:22,048][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 15:15:34,865][root][INFO] - Processing question number 10
[2025-03-06 15:15:34,868][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 15:15:44,150][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 15:15:54,491][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 15:16:05,659][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 15:16:36,343][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 15:16:44,897][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 15:16:57,987][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 15:17:29,183][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 15:17:44,330][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 15:17:54,910][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 15:18:02,788][root][INFO] - Processing question number 20
[2025-03-06 15:18:02,790][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 15:18:14,395][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 15:18:23,400][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 15:18:32,776][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 15:18:42,904][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 15:18:51,748][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 15:19:00,585][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 15:19:11,369][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 15:19:20,285][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 15:19:27,309][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 15:19:38,273][root][INFO] - Processing question number 30
[2025-03-06 15:19:38,276][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 15:19:51,870][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 15:20:01,709][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 15:20:18,599][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 15:20:50,111][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 15:21:02,429][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 15:21:12,291][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 15:21:24,183][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 15:21:37,627][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 15:21:44,119][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 15:21:59,013][root][INFO] - Processing question number 40
[2025-03-06 15:21:59,016][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 15:22:12,739][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 15:22:23,360][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 15:22:33,035][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 15:22:43,749][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 15:22:59,367][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 15:23:08,677][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 15:23:17,338][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 15:23:30,243][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 15:23:49,740][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 15:23:59,936][root][INFO] - Processing question number 50
[2025-03-06 15:23:59,940][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 15:24:08,530][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 15:24:22,782][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 15:24:34,649][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 15:24:45,568][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 15:24:59,471][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 15:25:17,353][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 15:25:38,868][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 15:25:49,580][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 15:26:05,655][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 15:26:13,857][root][INFO] - Processing question number 60
[2025-03-06 15:26:13,861][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 15:26:24,786][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 15:26:35,647][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 15:26:47,794][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 15:26:58,208][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 15:27:14,983][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 15:27:46,070][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 15:27:56,204][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 15:28:11,701][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 15:28:42,729][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 15:28:58,980][root][INFO] - Processing question number 70
[2025-03-06 15:28:58,984][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 15:29:09,501][root][INFO] - Domain : Property, Question : 9
[2025-03-06 15:29:18,782][root][INFO] - Domain : Property, Question : 17
[2025-03-06 15:29:50,275][root][INFO] - Domain : Property, Question : 25
[2025-03-06 15:29:59,879][root][INFO] - Domain : Property, Question : 30
[2025-03-06 15:30:08,917][root][INFO] - Domain : Property, Question : 36
[2025-03-06 15:30:19,810][root][INFO] - Domain : Property, Question : 46
[2025-03-06 15:30:30,822][root][INFO] - Domain : Property, Question : 53
[2025-03-06 15:30:43,614][root][INFO] - Domain : Property, Question : 59
[2025-03-06 15:30:50,822][root][INFO] - Domain : Property, Question : 66
[2025-03-06 15:30:58,723][root][INFO] - Processing question number 80
[2025-03-06 15:30:58,728][root][INFO] - Domain : Property, Question : 69
[2025-03-06 15:31:13,130][root][INFO] - Domain : Property, Question : 81
[2025-03-06 15:31:21,533][root][INFO] - Domain : Property, Question : 88
[2025-03-06 15:31:53,236][root][INFO] - Domain : Property, Question : 91
[2025-03-06 15:32:03,186][root][INFO] - Domain : Property, Question : 94
[2025-03-06 15:32:35,219][root][INFO] - Domain : Property, Question : 100
[2025-03-06 15:32:45,710][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 15:32:56,622][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 15:33:28,490][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 15:33:39,294][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 15:34:10,555][root][INFO] - Processing question number 90
[2025-03-06 15:34:10,561][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 15:34:20,818][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 15:34:34,308][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 15:34:44,370][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 15:34:52,159][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 15:35:07,984][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 15:35:23,364][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 15:35:54,771][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 15:36:07,151][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 15:36:15,513][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 15:36:29,971][root][INFO] - Inference complete
[2025-03-06 15:36:29,971][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:36:29,979][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:36:29,980][root][WARNING] - |Q. 1||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,981][root][WARNING] - |Q. 1||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,981][root][INFO] - |Q. 1||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,981][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,982][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,983][root][WARNING] - |Q. 20||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,983][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,983][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,984][root][WARNING] - |Q. 99||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,985][root][WARNING] - |Q. 99||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,985][root][INFO] - |Q. 99||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,985][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,985][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,986][root][WARNING] - |Q. 15||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,986][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,986][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,987][root][WARNING] - |Q. 14||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,988][root][WARNING] - |Q. 14||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:36:29,988][root][INFO] - |Q. 14||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,988][root][WARNING] - |Q. 34||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,989][root][WARNING] - |Q. 34||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,989][root][INFO] - |Q. 34||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,989][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,993][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,994][root][WARNING] - |Q. 54||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,994][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,994][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,994][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,995][root][WARNING] - |Q. 75||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,995][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,995][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,996][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,996][root][WARNING] - |Q. 17||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,996][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,996][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,997][root][WARNING] - |Q. 88||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,998][root][WARNING] - |Q. 88||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,998][root][INFO] - |Q. 88||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,998][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,998][root][WARNING] - |Q. 94||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:29,999][root][WARNING] - |Q. 94||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:29,999][root][INFO] - |Q. 94||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:29,999][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:29,999][root][WARNING] - |Q. 18||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:30,000][root][WARNING] - |Q. 18||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:30,000][root][INFO] - |Q. 18||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:30,000][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:30,000][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:30,000][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:30,001][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:30,001][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:30,002][root][WARNING] - |Q. 74||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:36:30,002][root][WARNING] - |Q. 74||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:36:30,002][root][INFO] - |Q. 74||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:36:30,002][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:36:30,004][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:36:30,009][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:36:30,009][root][INFO] - Saved parsed outputs
[2025-03-06 15:36:30,009][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:36:30,011][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:36:30,011][root][INFO] - Saved parsing metadata
[2025-03-06 15:36:30,012][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:36:30,014][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:36:30,015][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 15:36:30,107][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 15:36:30,107][root][INFO] - Summary of metrics : {'label_accuracy': 0.53, 'misclassification_rate': 0.47, 'combined_accuracy': 0.38, 'malformed_label': 0, 'malformed_domain': 22, 'total_predictions': 100, 'correct_predictions': 53, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.46153846153846156, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.15, 'Criminal_Law_confidence': 0.07, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.1, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 40, 'correct_label_wrong_domain': 15, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 15:36:38,330][root][INFO] - Setting global seed to 989
[2025-03-06 15:36:38,337][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 15:36:38,337][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 15:36:38,338][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 15:36:38,342][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 15:36:38,345][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 15:36:38,345][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 15:36:38,517][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 15:36:39,108][root][INFO] - Full model selected, loading model
[2025-03-06 15:37:07,246][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 15:37:07,260][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 15:37:15,594][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 15:37:15,597][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:37:15,597][root][INFO] - Starting inference
[2025-03-06 15:37:15,725][root][INFO] - Processing question number 0
[2025-03-06 15:37:15,727][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 15:37:26,362][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 15:37:37,588][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 15:37:49,496][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 15:37:56,440][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 15:38:04,722][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 15:38:12,816][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 15:38:22,471][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 15:38:28,814][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 15:38:36,427][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 15:38:44,053][root][INFO] - Processing question number 10
[2025-03-06 15:38:44,055][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 15:38:53,493][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 15:39:04,696][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 15:39:15,778][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 15:39:24,758][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 15:39:34,266][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 15:39:43,876][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 15:39:54,804][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 15:40:03,297][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 15:40:14,242][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 15:40:28,247][root][INFO] - Processing question number 20
[2025-03-06 15:40:28,250][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 15:40:38,687][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 15:40:46,743][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 15:40:55,727][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 15:41:05,474][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 15:41:13,822][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 15:41:22,613][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 15:41:31,025][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 15:41:38,457][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 15:41:48,464][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 15:41:58,794][root][INFO] - Processing question number 30
[2025-03-06 15:41:58,796][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 15:42:06,427][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 15:42:13,142][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 15:42:22,408][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 15:42:31,710][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 15:42:40,588][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 15:42:48,867][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 15:42:59,877][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 15:43:08,673][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 15:43:18,706][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 15:43:28,624][root][INFO] - Processing question number 40
[2025-03-06 15:43:28,627][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 15:43:37,101][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 15:43:44,652][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 15:43:59,996][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 15:44:07,377][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 15:44:17,660][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 15:44:25,290][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 15:44:33,203][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 15:44:43,100][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 15:44:54,229][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 15:45:01,808][root][INFO] - Processing question number 50
[2025-03-06 15:45:01,823][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 15:45:11,690][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 15:45:23,238][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 15:45:34,974][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 15:45:47,692][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 15:45:56,540][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 15:46:07,694][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 15:46:20,404][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 15:46:30,371][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 15:46:40,273][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 15:46:47,223][root][INFO] - Processing question number 60
[2025-03-06 15:46:47,227][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 15:46:56,711][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 15:47:05,186][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 15:47:15,625][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 15:47:24,450][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 15:47:32,479][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 15:47:41,736][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 15:47:49,604][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 15:47:56,938][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 15:48:06,626][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 15:48:16,004][root][INFO] - Processing question number 70
[2025-03-06 15:48:16,009][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 15:48:23,685][root][INFO] - Domain : Property, Question : 9
[2025-03-06 15:48:31,534][root][INFO] - Domain : Property, Question : 17
[2025-03-06 15:48:45,298][root][INFO] - Domain : Property, Question : 25
[2025-03-06 15:48:55,733][root][INFO] - Domain : Property, Question : 30
[2025-03-06 15:49:03,851][root][INFO] - Domain : Property, Question : 36
[2025-03-06 15:49:15,988][root][INFO] - Domain : Property, Question : 46
[2025-03-06 15:49:25,286][root][INFO] - Domain : Property, Question : 53
[2025-03-06 15:49:35,976][root][INFO] - Domain : Property, Question : 59
[2025-03-06 15:49:42,767][root][INFO] - Domain : Property, Question : 66
[2025-03-06 15:49:49,401][root][INFO] - Processing question number 80
[2025-03-06 15:49:49,405][root][INFO] - Domain : Property, Question : 69
[2025-03-06 15:49:55,469][root][INFO] - Domain : Property, Question : 81
[2025-03-06 15:50:08,289][root][INFO] - Domain : Property, Question : 88
[2025-03-06 15:50:19,082][root][INFO] - Domain : Property, Question : 91
[2025-03-06 15:50:30,007][root][INFO] - Domain : Property, Question : 94
[2025-03-06 15:50:39,233][root][INFO] - Domain : Property, Question : 100
[2025-03-06 15:50:49,401][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 15:51:00,699][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 15:51:09,566][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 15:51:19,287][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 15:51:28,726][root][INFO] - Processing question number 90
[2025-03-06 15:51:28,731][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 15:51:37,355][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 15:51:47,606][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 15:52:03,607][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 15:52:08,243][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 15:52:17,702][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 15:52:27,640][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 15:52:36,666][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 15:52:46,329][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 15:52:59,419][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 15:53:08,062][root][INFO] - Inference complete
[2025-03-06 15:53:08,063][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:53:08,070][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:53:08,082][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:53:08,088][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:53:08,088][root][INFO] - Saved parsed outputs
[2025-03-06 15:53:08,088][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:53:08,089][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:53:08,089][root][INFO] - Saved parsing metadata
[2025-03-06 15:53:08,091][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:53:08,093][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:53:08,094][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 15:53:08,136][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 15:53:08,136][root][INFO] - Summary of metrics : {'label_accuracy': 0.5, 'misclassification_rate': 0.5, 'combined_accuracy': 0.15, 'malformed_label': 0, 'malformed_domain': 69, 'total_predictions': 100, 'correct_predictions': 50, 'correct_label_and_domain': 15, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.06666666666666667, 'Criminal_Law_accuracy': 0.14285714285714285, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.26666666666666666, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.23076923076923078, 'Constitutional_Law_confidence': 0.05, 'Contracts_confidence': 0.01, 'Criminal_Law_confidence': 0.04, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.04, 'Civil_Procedure_confidence': 0.04, 'correct_domain_wrong_label': 16, 'correct_label_wrong_domain': 35, 'both_wrong': 34}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 15:53:18,411][root][INFO] - Setting global seed to 989
[2025-03-06 15:53:18,420][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 15:53:18,420][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 15:53:18,422][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 15:53:18,425][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 15:53:18,427][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 15:53:18,427][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 15:53:18,592][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 15:53:19,175][root][INFO] - Full model selected, loading model
[2025-03-06 15:53:43,811][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 15:55:39,444][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 15:55:39,444][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 15:56:16,879][root][INFO] - Peft model loaded successfully
[2025-03-06 15:56:24,365][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 15:56:24,367][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:56:24,367][root][INFO] - Starting inference
[2025-03-06 15:56:24,513][root][INFO] - Processing question number 0
[2025-03-06 15:56:24,516][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 15:56:50,685][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 15:57:05,555][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 15:57:19,082][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 15:57:31,024][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 15:57:43,800][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 15:57:55,757][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 15:58:04,276][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 15:58:13,220][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 15:58:23,010][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 15:58:32,840][root][INFO] - Processing question number 10
[2025-03-06 15:58:32,842][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 15:58:46,092][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 15:58:59,811][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 15:59:12,453][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 15:59:24,657][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 15:59:33,764][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 15:59:45,655][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 15:59:58,051][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 16:00:09,945][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 16:00:19,337][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 16:00:25,586][root][INFO] - Processing question number 20
[2025-03-06 16:00:25,590][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 16:00:35,833][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 16:00:44,503][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 16:00:54,186][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 16:01:01,854][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 16:01:08,583][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 16:01:18,738][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 16:01:32,763][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 16:01:46,425][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 16:01:56,187][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 16:02:05,301][root][INFO] - Processing question number 30
[2025-03-06 16:02:05,303][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 16:02:17,903][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 16:02:27,460][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 16:02:41,097][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 16:02:57,877][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 16:03:08,259][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 16:03:18,238][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 16:03:32,064][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 16:03:41,377][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 16:03:52,909][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 16:04:06,610][root][INFO] - Processing question number 40
[2025-03-06 16:04:06,614][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 16:04:18,039][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 16:04:28,681][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 16:04:39,983][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 16:04:47,912][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 16:04:59,819][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 16:05:08,800][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 16:05:17,217][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 16:05:31,206][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 16:05:47,749][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 16:05:58,565][root][INFO] - Processing question number 50
[2025-03-06 16:05:58,569][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 16:06:08,030][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 16:06:19,858][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 16:06:35,945][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 16:06:56,345][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 16:07:07,183][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 16:07:18,273][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 16:07:35,757][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 16:07:50,894][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 16:08:00,450][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 16:08:15,465][root][INFO] - Processing question number 60
[2025-03-06 16:08:15,469][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 16:08:28,843][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 16:08:41,844][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 16:08:55,714][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 16:09:07,153][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 16:09:25,355][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 16:09:37,011][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 16:09:57,442][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 16:10:07,029][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 16:10:14,563][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 16:10:26,968][root][INFO] - Processing question number 70
[2025-03-06 16:10:26,972][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 16:10:38,869][root][INFO] - Domain : Property, Question : 9
[2025-03-06 16:10:54,333][root][INFO] - Domain : Property, Question : 17
[2025-03-06 16:11:07,596][root][INFO] - Domain : Property, Question : 25
[2025-03-06 16:11:21,061][root][INFO] - Domain : Property, Question : 30
[2025-03-06 16:11:32,098][root][INFO] - Domain : Property, Question : 36
[2025-03-06 16:11:42,197][root][INFO] - Domain : Property, Question : 46
[2025-03-06 16:11:56,292][root][INFO] - Domain : Property, Question : 53
[2025-03-06 16:12:11,785][root][INFO] - Domain : Property, Question : 59
[2025-03-06 16:12:18,643][root][INFO] - Domain : Property, Question : 66
[2025-03-06 16:12:26,745][root][INFO] - Processing question number 80
[2025-03-06 16:12:26,750][root][INFO] - Domain : Property, Question : 69
[2025-03-06 16:12:39,356][root][INFO] - Domain : Property, Question : 81
[2025-03-06 16:12:48,923][root][INFO] - Domain : Property, Question : 88
[2025-03-06 16:13:03,502][root][INFO] - Domain : Property, Question : 91
[2025-03-06 16:13:12,413][root][INFO] - Domain : Property, Question : 94
[2025-03-06 16:13:24,216][root][INFO] - Domain : Property, Question : 100
[2025-03-06 16:13:35,286][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 16:13:50,109][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 16:14:00,029][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 16:14:15,423][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 16:14:27,128][root][INFO] - Processing question number 90
[2025-03-06 16:14:27,133][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 16:14:34,109][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 16:14:50,761][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 16:15:09,993][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 16:15:17,494][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 16:15:33,552][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 16:15:45,620][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 16:16:05,747][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 16:16:20,149][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 16:16:30,339][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 16:16:42,107][root][INFO] - Inference complete
[2025-03-06 16:16:42,108][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:16:42,117][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:16:42,125][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 16:16:42,126][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 16:16:42,126][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 16:16:42,131][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:16:42,137][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:16:42,137][root][INFO] - Saved parsed outputs
[2025-03-06 16:16:42,137][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:16:42,138][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:16:42,138][root][INFO] - Saved parsing metadata
[2025-03-06 16:16:42,139][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:16:42,167][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:16:42,168][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 16:16:42,207][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 16:16:42,208][root][INFO] - Summary of metrics : {'label_accuracy': 0.52, 'misclassification_rate': 0.48, 'combined_accuracy': 0.37, 'malformed_label': 0, 'malformed_domain': 24, 'total_predictions': 100, 'correct_predictions': 52, 'correct_label_and_domain': 37, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.46153846153846156, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.09, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 15, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 4 to status running with exit code None
Eval status update completed for job 4
[2025-03-06 16:17:04,790][root][INFO] - Setting global seed to 989
[2025-03-06 16:17:04,805][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 16:17:04,805][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 16:17:04,806][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 16:17:04,809][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 16:17:04,812][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 16:17:04,812][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 16:17:04,973][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 16:17:05,567][root][INFO] - Full model selected, loading model
[2025-03-06 16:17:29,505][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 16:17:29,521][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 16:17:38,285][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 16:17:38,286][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:17:38,286][root][INFO] - Starting inference
[2025-03-06 16:17:38,438][root][INFO] - Processing question number 0
[2025-03-06 16:17:38,440][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 16:17:50,322][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 16:18:01,590][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 16:18:13,533][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 16:18:24,416][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 16:18:36,278][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 16:18:46,052][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 16:18:55,059][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 16:19:03,499][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 16:19:12,052][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 16:19:20,222][root][INFO] - Processing question number 10
[2025-03-06 16:19:20,224][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 16:19:30,402][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 16:19:42,758][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 16:19:54,431][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 16:20:02,527][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 16:20:13,543][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 16:20:22,953][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 16:20:30,397][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 16:20:40,087][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 16:20:49,821][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 16:20:59,708][root][INFO] - Processing question number 20
[2025-03-06 16:20:59,711][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 16:21:09,451][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 16:21:19,217][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 16:21:27,653][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 16:21:36,052][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 16:21:46,229][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 16:21:54,908][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 16:22:04,207][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 16:22:16,241][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 16:22:23,908][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 16:22:33,927][root][INFO] - Processing question number 30
[2025-03-06 16:22:33,929][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 16:22:43,453][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 16:22:51,070][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 16:23:00,335][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 16:23:09,840][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 16:23:18,917][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 16:23:27,890][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 16:23:35,367][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 16:23:45,072][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 16:23:53,702][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 16:24:01,616][root][INFO] - Processing question number 40
[2025-03-06 16:24:01,619][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 16:24:10,248][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 16:24:20,931][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 16:24:34,300][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 16:24:40,228][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 16:24:51,965][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 16:25:00,734][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 16:25:09,239][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 16:25:19,322][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 16:25:32,710][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 16:25:41,853][root][INFO] - Processing question number 50
[2025-03-06 16:25:41,857][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 16:25:50,151][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 16:25:57,382][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 16:26:07,891][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 16:26:19,777][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 16:26:29,457][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 16:26:41,336][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 16:26:52,307][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 16:27:04,640][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 16:27:13,480][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 16:27:26,959][root][INFO] - Processing question number 60
[2025-03-06 16:27:26,963][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 16:27:39,709][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 16:27:48,877][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 16:27:57,524][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 16:28:04,997][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 16:28:19,949][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 16:28:27,963][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 16:28:34,501][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 16:28:43,685][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 16:28:56,753][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 16:29:06,763][root][INFO] - Processing question number 70
[2025-03-06 16:29:06,767][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 16:29:17,893][root][INFO] - Domain : Property, Question : 9
[2025-03-06 16:29:24,445][root][INFO] - Domain : Property, Question : 17
[2025-03-06 16:29:49,136][root][INFO] - Domain : Property, Question : 25
[2025-03-06 16:30:00,520][root][INFO] - Domain : Property, Question : 30
[2025-03-06 16:30:09,508][root][INFO] - Domain : Property, Question : 36
[2025-03-06 16:30:20,265][root][INFO] - Domain : Property, Question : 46
[2025-03-06 16:30:30,014][root][INFO] - Domain : Property, Question : 53
[2025-03-06 16:30:40,541][root][INFO] - Domain : Property, Question : 59
[2025-03-06 16:30:46,906][root][INFO] - Domain : Property, Question : 66
[2025-03-06 16:30:56,159][root][INFO] - Processing question number 80
[2025-03-06 16:30:56,163][root][INFO] - Domain : Property, Question : 69
[2025-03-06 16:31:01,940][root][INFO] - Domain : Property, Question : 81
[2025-03-06 16:31:10,796][root][INFO] - Domain : Property, Question : 88
[2025-03-06 16:31:18,003][root][INFO] - Domain : Property, Question : 91
[2025-03-06 16:31:29,062][root][INFO] - Domain : Property, Question : 94
[2025-03-06 16:31:38,026][root][INFO] - Domain : Property, Question : 100
[2025-03-06 16:31:46,300][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 16:31:58,575][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 16:32:08,024][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 16:32:20,156][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 16:32:28,092][root][INFO] - Processing question number 90
[2025-03-06 16:32:28,098][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 16:32:35,316][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 16:32:45,552][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 16:32:55,892][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 16:33:03,115][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 16:33:11,999][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 16:33:21,492][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 16:33:30,611][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 16:33:39,736][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 16:33:46,718][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 16:33:56,185][root][INFO] - Inference complete
[2025-03-06 16:33:56,185][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:33:56,193][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:33:56,194][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 16:33:56,194][root][WARNING] - |Q. 13||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:33:56,195][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 16:33:56,195][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:33:56,199][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:33:56,199][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 16:33:56,199][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:33:56,203][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:33:56,203][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 16:33:56,203][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:33:56,207][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:33:56,228][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:33:56,229][root][INFO] - Saved parsed outputs
[2025-03-06 16:33:56,229][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:33:56,230][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:33:56,230][root][INFO] - Saved parsing metadata
[2025-03-06 16:33:56,231][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:33:56,246][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:33:56,256][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 16:33:56,329][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 16:33:56,329][root][INFO] - Summary of metrics : {'label_accuracy': 0.54, 'misclassification_rate': 0.45999999999999996, 'combined_accuracy': 0.16, 'malformed_label': 0, 'malformed_domain': 66, 'total_predictions': 100, 'correct_predictions': 54, 'correct_label_and_domain': 16, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.06666666666666667, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.05, 'Contracts_confidence': 0.04, 'Criminal_Law_confidence': 0.05, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.05, 'Torts_confidence': 0.06, 'Civil_Procedure_confidence': 0.05, 'correct_domain_wrong_label': 18, 'correct_label_wrong_domain': 38, 'both_wrong': 28}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '4', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 4 to status completed with exit code 0
Eval status update completed for job 4
Job 4 completed at Thu Mar  6 16:34:00 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n516
Job ID: 25358379
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 08:22:06
CPU Efficiency: 9.86% of 3-12:53:50 core-walltime
Job Wall-clock time: 08:29:23
Memory Utilized: 35.95 GB
Memory Efficiency: 99.87% of 36.00 GB
