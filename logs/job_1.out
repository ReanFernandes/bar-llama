Starting job 1 at Thu Mar  6 09:36:18 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_1_samples prompt=json_answer_first_few_shot_structured train=json_answer_first_few_shot_structured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '1', 'training']
Updating job 1 to status training with exit code None
Status update completed for job 1
[2025-03-06 09:36:38,401][root][INFO] - Global seed set to 314
[2025-03-06 09:36:38,402][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 09:36:38,402][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 09:36:38,402][root][INFO] - Running Fine-tuning on the all_domains_1_samples dataset
[2025-03-06 09:36:38,403][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 09:36:38,403][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/distilled_dataset.json
[2025-03-06 09:36:38,445][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 09:36:38,462][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 09:36:38,465][root][INFO] - Questions selected, dataset contains 7 questions with 1.0 questions per domain
[2025-03-06 09:36:38,536][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 09:36:39,024][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 09:36:50,917][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 09:37:19,467][root][INFO] - Model prepared for kbit training
[2025-03-06 09:37:19,467][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'up_proj', 'k_proj', 'o_proj', 'gate_proj', 'v_proj', 'down_proj', 'q_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 09:37:21,046][root][INFO] - Lora adapter added to model
[2025-03-06 09:37:21,050][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_1_samples/llama2_json_answer_first_few_shot_structured
[2025-03-06 09:37:21,191][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.4313, 'grad_norm': 0.1437080353498459, 'learning_rate': 9.42728012826605e-05, 'epoch': 3.0}
{'loss': 1.2759, 'grad_norm': 0.18951784074306488, 'learning_rate': 3.226975564787322e-05, 'epoch': 6.0}
{'loss': 1.1498, 'grad_norm': 0.19817401468753815, 'learning_rate': 9.85470908713026e-05, 'epoch': 9.0}
{'loss': 1.042, 'grad_norm': 0.2374774068593979, 'learning_rate': 4.397316598723383e-05, 'epoch': 12.0}
{'loss': 0.851, 'grad_norm': 0.24011147022247314, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 367.367, 'train_samples_per_second': 0.286, 'train_steps_per_second': 0.041, 'train_loss': 1.1500048319498697, 'epoch': 15.0}
[2025-03-06 09:43:31,848][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_1_samples/llama2_json_answer_first_few_shot_structured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '1', 'trained', '0']
Updating job 1 to status trained with exit code 0
Status update completed for job 1
Starting evaluations for job 1
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 09:43:42,092][root][INFO] - Setting global seed to 206
[2025-03-06 09:43:42,099][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 09:43:42,099][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 09:43:42,101][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 09:43:42,104][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 09:43:42,106][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 09:43:42,106][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 09:43:42,249][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 09:43:42,546][root][INFO] - Full model selected, loading model
[2025-03-06 09:43:55,530][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 09:44:55,171][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 09:44:55,171][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 09:45:31,010][root][INFO] - Peft model loaded successfully
[2025-03-06 09:45:37,686][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 09:45:37,689][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 09:45:37,689][root][INFO] - Starting inference
[2025-03-06 09:45:37,884][root][INFO] - Processing question number 0
[2025-03-06 09:45:37,903][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 09:46:08,071][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 09:46:38,988][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 09:47:09,485][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 09:47:31,215][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 09:47:53,615][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 09:48:23,974][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 09:48:55,183][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 09:49:16,787][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 09:49:47,123][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 09:50:18,091][root][INFO] - Processing question number 10
[2025-03-06 09:50:18,094][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 09:50:50,550][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 09:51:20,679][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 09:51:51,343][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 09:52:22,594][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 09:52:53,827][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 09:53:24,032][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 09:53:54,100][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 09:54:24,728][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 09:54:55,328][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 09:55:25,648][root][INFO] - Processing question number 20
[2025-03-06 09:55:25,662][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 09:55:56,197][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 09:56:14,955][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 09:56:45,157][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 09:57:15,291][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 09:57:46,126][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 09:58:10,175][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 09:58:41,563][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 09:59:12,155][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 09:59:42,867][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 10:00:12,889][root][INFO] - Processing question number 30
[2025-03-06 10:00:12,905][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 10:00:43,823][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 10:01:15,113][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 10:01:45,836][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 10:02:16,338][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 10:02:46,747][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 10:03:17,914][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 10:03:48,380][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 10:04:19,288][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 10:04:50,063][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 10:05:21,549][root][INFO] - Processing question number 40
[2025-03-06 10:05:21,552][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 10:05:52,385][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 10:06:23,204][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 10:06:54,450][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 10:07:25,624][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 10:07:56,031][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 10:08:26,726][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 10:08:56,230][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 10:09:26,023][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 10:09:56,623][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 10:10:27,916][root][INFO] - Processing question number 50
[2025-03-06 10:10:27,920][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 10:10:59,382][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 10:11:22,960][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 10:11:52,983][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 10:12:24,714][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 10:12:55,504][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 10:13:25,312][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 10:13:56,724][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 10:14:26,995][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 10:14:58,323][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 10:15:30,433][root][INFO] - Processing question number 60
[2025-03-06 10:15:30,437][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 10:16:00,701][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 10:16:31,273][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 10:17:02,542][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 10:17:32,721][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 10:18:03,387][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 10:18:34,108][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 10:19:04,858][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 10:19:35,953][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 10:20:06,790][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 10:20:38,144][root][INFO] - Processing question number 70
[2025-03-06 10:20:38,149][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 10:21:08,626][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 10:21:33,077][root][INFO] - Domain : Property, Question : 6
[2025-03-06 10:22:03,476][root][INFO] - Domain : Property, Question : 13
[2025-03-06 10:22:34,566][root][INFO] - Domain : Property, Question : 20
[2025-03-06 10:23:12,087][root][INFO] - Domain : Property, Question : 33
[2025-03-06 10:23:42,379][root][INFO] - Domain : Property, Question : 39
[2025-03-06 10:24:13,503][root][INFO] - Domain : Property, Question : 48
[2025-03-06 10:24:44,365][root][INFO] - Domain : Property, Question : 54
[2025-03-06 10:25:15,481][root][INFO] - Domain : Property, Question : 61
[2025-03-06 10:25:45,949][root][INFO] - Processing question number 80
[2025-03-06 10:25:45,956][root][INFO] - Domain : Property, Question : 67
[2025-03-06 10:26:16,856][root][INFO] - Domain : Property, Question : 75
[2025-03-06 10:26:47,734][root][INFO] - Domain : Property, Question : 83
[2025-03-06 10:27:18,132][root][INFO] - Domain : Property, Question : 89
[2025-03-06 10:27:48,572][root][INFO] - Domain : Property, Question : 97
[2025-03-06 10:28:19,827][root][INFO] - Domain : Property, Question : 100
[2025-03-06 10:28:50,903][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 10:29:22,030][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 10:29:52,428][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 10:30:23,284][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 10:30:53,474][root][INFO] - Processing question number 90
[2025-03-06 10:30:53,479][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 10:31:25,090][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 10:31:54,789][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 10:32:25,361][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 10:32:55,204][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 10:33:26,331][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 10:33:56,495][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 10:34:26,947][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 10:34:57,719][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 10:35:29,000][root][INFO] - Inference complete
[2025-03-06 10:35:29,000][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 10:35:29,007][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 10:35:29,009][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,010][root][WARNING] - |Q. 42||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,010][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,012][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,012][root][WARNING] - |Q. 17||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 10:35:29,012][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,013][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,013][root][WARNING] - |Q. 55||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,014][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,015][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,016][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,016][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,016][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,017][root][WARNING] - |Q. 66||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,017][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,018][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,018][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,018][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,019][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,019][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,019][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,022][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,023][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,023][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,024][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,024][root][WARNING] - |Q. 48||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,025][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,026][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,026][root][WARNING] - |Q. 100||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 10:35:29,026][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,027][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,027][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,027][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,027][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:35:29,028][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:35:29,028][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:35:29,030][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 10:35:29,036][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 10:35:29,036][root][INFO] - Saved parsed outputs
[2025-03-06 10:35:29,036][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 10:35:29,038][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 10:35:29,038][root][INFO] - Saved parsing metadata
[2025-03-06 10:35:29,039][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 10:35:29,053][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 10:35:29,055][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 10:35:29,150][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 10:35:29,150][root][INFO] - Summary of metrics : {'label_accuracy': 0.3434343434343434, 'misclassification_rate': 0.6565656565656566, 'combined_accuracy': 0.15151515151515152, 'malformed_label': 0, 'malformed_domain': 48, 'total_predictions': 99, 'correct_predictions': 34, 'correct_label_and_domain': 15, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.0, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.0, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.0625, 'Constitutional_Law_confidence': 0.1111111111111111, 'Contracts_confidence': 0.0, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.050505050505050504, 'Real_Property_confidence': 0.10101010101010101, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.050505050505050504, 'correct_domain_wrong_label': 36, 'correct_label_wrong_domain': 19, 'both_wrong': 29}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 10:35:47,244][root][INFO] - Setting global seed to 206
[2025-03-06 10:35:47,254][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 10:35:47,254][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 10:35:47,255][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 10:35:47,270][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:35:47,277][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 10:35:47,277][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 10:35:47,455][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 10:35:47,714][root][INFO] - Full model selected, loading model
[2025-03-06 10:36:06,740][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 10:36:06,740][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 10:36:14,131][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 10:36:14,132][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 10:36:14,132][root][INFO] - Starting inference
[2025-03-06 10:36:14,320][root][INFO] - Processing question number 0
[2025-03-06 10:36:14,323][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 10:36:44,348][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 10:37:15,133][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 10:37:45,464][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 10:38:16,288][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 10:38:46,549][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 10:39:16,774][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 10:39:47,823][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 10:40:18,368][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 10:40:48,538][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 10:41:19,366][root][INFO] - Processing question number 10
[2025-03-06 10:41:19,368][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 10:41:51,537][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 10:42:21,483][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 10:42:51,924][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 10:43:23,032][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 10:43:54,118][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 10:44:24,127][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 10:44:54,076][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 10:45:24,490][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 10:45:54,881][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 10:46:25,050][root][INFO] - Processing question number 20
[2025-03-06 10:46:25,053][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 10:46:55,418][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 10:47:26,027][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 10:47:56,034][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 10:48:25,976][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 10:48:59,466][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 10:49:29,918][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 10:50:01,175][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 10:50:31,564][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 10:51:02,131][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 10:51:31,993][root][INFO] - Processing question number 30
[2025-03-06 10:51:31,997][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 10:52:02,754][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 10:52:33,851][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 10:53:04,417][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 10:53:34,761][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 10:54:04,999][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 10:54:36,028][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 10:55:06,339][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 10:55:37,086][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 10:56:07,631][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 10:56:38,892][root][INFO] - Processing question number 40
[2025-03-06 10:56:38,895][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 10:57:09,496][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 10:57:40,088][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 10:58:11,182][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 10:58:42,229][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 10:59:12,488][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 10:59:43,048][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 11:00:14,831][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 11:00:44,487][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 11:01:14,883][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 11:01:46,018][root][INFO] - Processing question number 50
[2025-03-06 11:01:46,021][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 11:02:17,321][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 11:02:47,994][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 11:03:17,866][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 11:03:49,470][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 11:04:20,111][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 11:04:49,791][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 11:05:21,055][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 11:05:51,087][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 11:06:22,217][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 11:06:54,133][root][INFO] - Processing question number 60
[2025-03-06 11:06:54,137][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 11:07:24,139][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 11:07:54,489][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 11:08:25,536][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 11:08:55,522][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 11:09:26,053][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 11:09:56,638][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 11:10:27,250][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 11:10:58,119][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 11:11:28,807][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 11:12:00,022][root][INFO] - Processing question number 70
[2025-03-06 11:12:00,027][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 11:12:30,345][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 11:13:00,747][root][INFO] - Domain : Property, Question : 6
[2025-03-06 11:13:31,057][root][INFO] - Domain : Property, Question : 13
[2025-03-06 11:14:01,963][root][INFO] - Domain : Property, Question : 20
[2025-03-06 11:14:32,821][root][INFO] - Domain : Property, Question : 33
[2025-03-06 11:15:03,014][root][INFO] - Domain : Property, Question : 39
[2025-03-06 11:15:33,970][root][INFO] - Domain : Property, Question : 48
[2025-03-06 11:16:04,784][root][INFO] - Domain : Property, Question : 54
[2025-03-06 11:16:35,743][root][INFO] - Domain : Property, Question : 61
[2025-03-06 11:17:07,240][root][INFO] - Processing question number 80
[2025-03-06 11:17:07,248][root][INFO] - Domain : Property, Question : 67
[2025-03-06 11:17:38,034][root][INFO] - Domain : Property, Question : 75
[2025-03-06 11:18:08,785][root][INFO] - Domain : Property, Question : 83
[2025-03-06 11:18:39,034][root][INFO] - Domain : Property, Question : 89
[2025-03-06 11:19:09,332][root][INFO] - Domain : Property, Question : 97
[2025-03-06 11:19:40,439][root][INFO] - Domain : Property, Question : 100
[2025-03-06 11:20:11,280][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 11:20:42,176][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 11:21:12,422][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 11:21:43,127][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 11:22:13,105][root][INFO] - Processing question number 90
[2025-03-06 11:22:13,111][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 11:22:44,567][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 11:23:14,066][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 11:23:44,430][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 11:24:14,128][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 11:24:45,026][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 11:25:15,015][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 11:25:45,310][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 11:26:15,937][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 11:26:47,050][root][INFO] - Inference complete
[2025-03-06 11:26:47,050][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 11:26:47,059][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 11:26:47,064][root][WARNING] - |Q. 60||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,064][root][WARNING] - |Q. 60||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,065][root][INFO] - |Q. 60||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,066][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,067][root][WARNING] - |Q. 8||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,067][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,068][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,068][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,069][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,070][root][WARNING] - |Q. 4||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,070][root][WARNING] - |Q. 4||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,070][root][INFO] - |Q. 4||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,071][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,071][root][WARNING] - |Q. 11||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 11:26:47,071][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,071][root][WARNING] - |Q. 24||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,071][root][WARNING] - |Q. 24||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,072][root][INFO] - |Q. 24||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,072][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,072][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,072][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,073][root][WARNING] - |Q. 41||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,073][root][WARNING] - |Q. 41||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,073][root][INFO] - |Q. 41||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,074][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,074][root][WARNING] - |Q. 82||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,074][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,077][root][WARNING] - |Q. 73||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,077][root][WARNING] - |Q. 73||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,077][root][INFO] - |Q. 73||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,078][root][WARNING] - |Q. 86||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,078][root][WARNING] - |Q. 86||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,078][root][INFO] - |Q. 86||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,078][root][WARNING] - |Q. 96||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,079][root][WARNING] - |Q. 96||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,079][root][INFO] - |Q. 96||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,079][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,079][root][WARNING] - |Q. 6||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,079][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,080][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,080][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,080][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,080][root][WARNING] - |Q. 20||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,081][root][WARNING] - |Q. 20||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,081][root][INFO] - |Q. 20||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,081][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,082][root][WARNING] - |Q. 54||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,082][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,083][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,083][root][WARNING] - |Q. 89||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,083][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,084][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,084][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,085][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,085][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,085][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 11:26:47,085][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,086][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,086][root][WARNING] - |Q. 85||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:26:47,087][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,087][root][WARNING] - |Q. 92||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:26:47,087][root][WARNING] - |Q. 92||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 11:26:47,087][root][INFO] - |Q. 92||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:26:47,088][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 11:26:47,094][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 11:26:47,094][root][INFO] - Saved parsed outputs
[2025-03-06 11:26:47,094][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 11:26:47,096][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 11:26:47,096][root][INFO] - Saved parsing metadata
[2025-03-06 11:26:47,097][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 11:26:47,100][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 11:26:47,102][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 11:26:47,181][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 11:26:47,181][root][INFO] - Summary of metrics : {'label_accuracy': 0.37373737373737376, 'misclassification_rate': 0.6262626262626263, 'combined_accuracy': 0.21212121212121213, 'malformed_label': 0, 'malformed_domain': 45, 'total_predictions': 99, 'correct_predictions': 37, 'correct_label_and_domain': 21, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.07142857142857142, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.1111111111111111, 'Contracts_confidence': 0.020202020202020204, 'Criminal_Law_confidence': 0.1919191919191919, 'Evidence_confidence': 0.08080808080808081, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.08080808080808081, 'correct_domain_wrong_label': 33, 'correct_label_wrong_domain': 16, 'both_wrong': 29}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 11:27:03,786][root][INFO] - Setting global seed to 206
[2025-03-06 11:27:03,796][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 11:27:03,796][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 11:27:03,797][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 11:27:03,800][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 11:27:03,806][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 11:27:03,806][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 11:27:03,975][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 11:27:04,244][root][INFO] - Full model selected, loading model
[2025-03-06 11:27:23,196][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 11:28:22,523][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 11:28:22,524][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 11:28:59,949][root][INFO] - Peft model loaded successfully
[2025-03-06 11:29:07,260][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 11:29:07,262][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 11:29:07,262][root][INFO] - Starting inference
[2025-03-06 11:29:07,495][root][INFO] - Processing question number 0
[2025-03-06 11:29:07,497][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 11:29:38,290][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 11:30:09,387][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 11:30:40,045][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 11:31:11,168][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 11:31:41,748][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 11:32:12,285][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 11:32:43,655][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 11:33:14,529][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 11:33:45,022][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 11:34:12,398][root][INFO] - Processing question number 10
[2025-03-06 11:34:12,400][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 11:34:45,014][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 11:35:15,323][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 11:35:46,148][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 11:36:17,568][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 11:36:48,965][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 11:37:19,340][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 11:37:49,590][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 11:38:20,371][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 11:38:51,128][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 11:39:12,624][root][INFO] - Processing question number 20
[2025-03-06 11:39:12,628][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 11:39:43,317][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 11:40:14,268][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 11:40:37,442][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 11:41:07,750][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 11:41:38,758][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 11:42:09,555][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 11:42:41,127][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 11:43:11,889][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 11:43:42,772][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 11:44:17,561][root][INFO] - Processing question number 30
[2025-03-06 11:44:17,589][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 11:44:42,433][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 11:45:13,848][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 11:45:44,734][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 11:46:15,413][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 11:46:45,979][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 11:47:07,297][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 11:47:37,943][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 11:48:09,006][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 11:48:39,876][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 11:49:11,466][root][INFO] - Processing question number 40
[2025-03-06 11:49:11,469][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 11:49:42,388][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 11:50:13,304][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 11:50:44,716][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 11:51:16,076][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 11:51:46,658][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 11:52:17,545][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 11:52:47,975][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 11:53:17,955][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 11:53:48,730][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 11:54:20,178][root][INFO] - Processing question number 50
[2025-03-06 11:54:20,183][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 11:54:51,815][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 11:55:17,816][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 11:55:48,008][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 11:56:19,924][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 11:56:50,891][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 11:57:20,897][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 11:57:52,486][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 11:58:22,884][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 11:58:54,330][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 11:59:26,560][root][INFO] - Processing question number 60
[2025-03-06 11:59:26,564][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 11:59:56,940][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:00:27,627][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 12:00:58,984][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 12:01:29,341][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 12:02:00,190][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 12:02:31,097][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 12:03:02,030][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 12:03:33,307][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:04:04,313][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 12:04:30,472][root][INFO] - Processing question number 70
[2025-03-06 12:04:30,477][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 12:05:01,135][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 12:05:31,879][root][INFO] - Domain : Property, Question : 6
[2025-03-06 12:06:02,433][root][INFO] - Domain : Property, Question : 13
[2025-03-06 12:06:33,674][root][INFO] - Domain : Property, Question : 20
[2025-03-06 12:07:04,783][root][INFO] - Domain : Property, Question : 33
[2025-03-06 12:07:35,229][root][INFO] - Domain : Property, Question : 39
[2025-03-06 12:08:06,526][root][INFO] - Domain : Property, Question : 48
[2025-03-06 12:08:37,572][root][INFO] - Domain : Property, Question : 54
[2025-03-06 12:09:08,869][root][INFO] - Domain : Property, Question : 61
[2025-03-06 12:09:39,519][root][INFO] - Processing question number 80
[2025-03-06 12:09:39,524][root][INFO] - Domain : Property, Question : 67
[2025-03-06 12:10:10,604][root][INFO] - Domain : Property, Question : 75
[2025-03-06 12:10:41,667][root][INFO] - Domain : Property, Question : 83
[2025-03-06 12:11:12,241][root][INFO] - Domain : Property, Question : 89
[2025-03-06 12:11:42,861][root][INFO] - Domain : Property, Question : 97
[2025-03-06 12:12:14,297][root][INFO] - Domain : Property, Question : 100
[2025-03-06 12:12:45,569][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 12:13:08,046][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 12:13:38,620][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 12:14:09,649][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 12:14:40,010][root][INFO] - Processing question number 90
[2025-03-06 12:14:40,016][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 12:15:02,856][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 12:15:32,733][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 12:16:03,482][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 12:16:33,515][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 12:17:04,838][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 12:17:35,200][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 12:18:05,821][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 12:18:36,787][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 12:19:08,247][root][INFO] - Inference complete
[2025-03-06 12:19:08,247][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:19:08,255][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:19:08,256][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,256][root][WARNING] - |Q. 7||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,257][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,258][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,258][root][WARNING] - |Q. 42||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,258][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,259][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,259][root][WARNING] - |Q. 63||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,259][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,260][root][WARNING] - |Q. 69||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,260][root][WARNING] - |Q. 69||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,260][root][INFO] - |Q. 69||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,261][root][WARNING] - |Q. 98||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,261][root][WARNING] - |Q. 98||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,261][root][INFO] - |Q. 98||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,262][root][WARNING] - |Q. 9||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,262][root][WARNING] - |Q. 9||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,262][root][INFO] - |Q. 9||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,262][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,263][root][WARNING] - |Q. 17||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,263][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,264][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,264][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:19:08,264][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,264][root][WARNING] - |Q. 60||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,265][root][WARNING] - |Q. 60||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,265][root][INFO] - |Q. 60||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,266][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,266][root][WARNING] - |Q. 8||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,267][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,267][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,268][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,268][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,268][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,269][root][WARNING] - |Q. 66||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:19:08,269][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,269][root][WARNING] - |Q. 88||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,269][root][WARNING] - |Q. 88||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,270][root][INFO] - |Q. 88||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,271][root][WARNING] - |Q. 76||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,271][root][WARNING] - |Q. 76||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:19:08,271][root][INFO] - |Q. 76||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,272][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,273][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,273][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,274][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,274][root][WARNING] - |Q. 68||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,274][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,275][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,275][root][WARNING] - |Q. 78||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:19:08,275][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,275][root][WARNING] - |Q. 86||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,275][root][WARNING] - |Q. 86||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:19:08,276][root][INFO] - |Q. 86||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,276][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,276][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,276][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,278][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,278][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,279][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,279][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,279][root][WARNING] - |Q. 100||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:19:08,279][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,280][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:19:08,280][root][WARNING] - |Q. 15||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:19:08,280][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:19:08,282][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:19:08,289][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:19:08,289][root][INFO] - Saved parsed outputs
[2025-03-06 12:19:08,290][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:19:08,291][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:19:08,291][root][INFO] - Saved parsing metadata
[2025-03-06 12:19:08,293][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:19:08,314][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:19:08,316][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 12:19:08,441][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 12:19:08,441][root][INFO] - Summary of metrics : {'label_accuracy': 0.3838383838383838, 'misclassification_rate': 0.6161616161616161, 'combined_accuracy': 0.1717171717171717, 'malformed_label': 0, 'malformed_domain': 50, 'total_predictions': 99, 'correct_predictions': 38, 'correct_label_and_domain': 17, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.0, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.0, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.125, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.0, 'Criminal_Law_confidence': 0.1919191919191919, 'Evidence_confidence': 0.030303030303030304, 'Real_Property_confidence': 0.10101010101010101, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.06060606060606061, 'correct_domain_wrong_label': 32, 'correct_label_wrong_domain': 21, 'both_wrong': 29}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 12:19:33,127][root][INFO] - Setting global seed to 206
[2025-03-06 12:19:33,136][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 12:19:33,136][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 12:19:33,138][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 12:19:33,141][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 12:19:33,147][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 12:19:33,147][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 12:19:33,346][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 12:19:33,631][root][INFO] - Full model selected, loading model
[2025-03-06 12:19:52,999][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 12:19:53,000][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 12:20:00,441][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 12:20:00,443][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 12:20:00,443][root][INFO] - Starting inference
[2025-03-06 12:20:00,637][root][INFO] - Processing question number 0
[2025-03-06 12:20:00,640][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 12:20:31,188][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 12:21:02,168][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 12:21:32,693][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 12:22:03,730][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 12:22:34,167][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 12:23:04,562][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 12:23:35,932][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 12:24:06,706][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 12:24:37,097][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 12:25:08,148][root][INFO] - Processing question number 10
[2025-03-06 12:25:08,150][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 12:25:40,550][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 12:26:10,726][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 12:26:41,399][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 12:27:12,748][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 12:27:44,055][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 12:28:14,312][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 12:28:44,447][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 12:29:15,106][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 12:29:45,717][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 12:30:16,103][root][INFO] - Processing question number 20
[2025-03-06 12:30:16,105][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 12:30:46,726][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 12:31:17,551][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 12:31:47,796][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 12:32:17,948][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 12:32:48,894][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 12:33:19,535][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 12:33:51,029][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 12:34:21,634][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 12:34:52,425][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 12:35:22,538][root][INFO] - Processing question number 30
[2025-03-06 12:35:22,541][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 12:35:53,521][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 12:36:24,860][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 12:36:55,644][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 12:37:26,247][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 12:37:56,710][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 12:38:27,994][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 12:38:58,531][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 12:39:29,529][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 12:40:00,333][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 12:40:31,798][root][INFO] - Processing question number 40
[2025-03-06 12:40:31,801][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 12:41:02,640][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 12:41:33,520][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 12:42:04,851][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 12:42:36,147][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 12:43:06,644][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 12:43:37,418][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 12:44:09,441][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 12:44:39,305][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 12:45:09,958][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 12:45:41,294][root][INFO] - Processing question number 50
[2025-03-06 12:45:41,298][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 12:46:12,847][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 12:46:43,740][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 12:47:13,865][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 12:47:45,678][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 12:48:16,562][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 12:48:46,413][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 12:49:17,881][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 12:49:48,167][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 12:50:19,514][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 12:50:51,671][root][INFO] - Processing question number 60
[2025-03-06 12:50:51,675][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 12:51:21,895][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:51:52,508][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 12:52:23,768][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 12:52:54,006][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 12:53:24,751][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 12:53:55,587][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 12:54:26,415][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 12:54:57,532][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:55:28,438][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 12:55:59,906][root][INFO] - Processing question number 70
[2025-03-06 12:55:59,910][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 12:56:30,442][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 12:57:01,021][root][INFO] - Domain : Property, Question : 6
[2025-03-06 12:57:31,462][root][INFO] - Domain : Property, Question : 13
[2025-03-06 12:58:02,499][root][INFO] - Domain : Property, Question : 20
[2025-03-06 12:58:33,541][root][INFO] - Domain : Property, Question : 33
[2025-03-06 12:59:03,887][root][INFO] - Domain : Property, Question : 39
[2025-03-06 12:59:35,057][root][INFO] - Domain : Property, Question : 48
[2025-03-06 13:00:06,020][root][INFO] - Domain : Property, Question : 54
[2025-03-06 13:00:37,140][root][INFO] - Domain : Property, Question : 61
[2025-03-06 13:01:07,650][root][INFO] - Processing question number 80
[2025-03-06 13:01:07,673][root][INFO] - Domain : Property, Question : 67
[2025-03-06 13:01:38,646][root][INFO] - Domain : Property, Question : 75
[2025-03-06 13:02:09,667][root][INFO] - Domain : Property, Question : 83
[2025-03-06 13:02:40,177][root][INFO] - Domain : Property, Question : 89
[2025-03-06 13:03:10,727][root][INFO] - Domain : Property, Question : 97
[2025-03-06 13:03:42,061][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:04:13,155][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 13:04:44,282][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:05:14,780][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 13:05:45,709][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 13:06:15,911][root][INFO] - Processing question number 90
[2025-03-06 13:06:15,916][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 13:06:47,634][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 13:07:17,368][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 13:07:47,984][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 13:08:17,904][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:08:49,061][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 13:09:19,252][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 13:09:49,782][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 13:10:20,676][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 13:10:52,016][root][INFO] - Inference complete
[2025-03-06 13:10:52,016][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:10:52,023][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:10:52,024][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,025][root][WARNING] - |Q. 7||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,026][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,026][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,027][root][WARNING] - |Q. 35||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,027][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,027][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,028][root][WARNING] - |Q. 42||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,028][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,029][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,029][root][WARNING] - |Q. 77||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,029][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,030][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,030][root][WARNING] - |Q. 91||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:10:52,030][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,031][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,032][root][WARNING] - |Q. 55||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,032][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,033][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,033][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,034][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,034][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,035][root][WARNING] - |Q. 22||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,035][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,037][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,037][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,037][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,039][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,039][root][WARNING] - |Q. 82||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,039][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,040][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,040][root][WARNING] - |Q. 12||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,041][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,041][root][WARNING] - |Q. 23||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,041][root][WARNING] - |Q. 23||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:10:52,041][root][INFO] - |Q. 23||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,043][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,044][root][WARNING] - |Q. 6||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,044][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,044][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,044][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,045][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,045][root][WARNING] - |Q. 20||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,045][root][WARNING] - |Q. 20||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,045][root][INFO] - |Q. 20||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,047][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,047][root][WARNING] - |Q. 89||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,048][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,048][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,048][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,049][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,049][root][WARNING] - |Q. 10||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,049][root][WARNING] - |Q. 10||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,049][root][INFO] - |Q. 10||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,050][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,050][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,050][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,051][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,051][root][WARNING] - |Q. 45||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:10:52,051][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,052][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:10:52,052][root][WARNING] - |Q. 85||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:10:52,053][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:10:52,054][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:10:52,060][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:10:52,060][root][INFO] - Saved parsed outputs
[2025-03-06 13:10:52,060][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:10:52,062][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:10:52,062][root][INFO] - Saved parsing metadata
[2025-03-06 13:10:52,062][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:10:52,075][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:10:52,077][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 13:10:52,120][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 13:10:52,121][root][INFO] - Summary of metrics : {'label_accuracy': 0.37373737373737376, 'misclassification_rate': 0.6262626262626263, 'combined_accuracy': 0.2222222222222222, 'malformed_label': 0, 'malformed_domain': 37, 'total_predictions': 99, 'correct_predictions': 37, 'correct_label_and_domain': 22, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.1111111111111111, 'Contracts_confidence': 0.08080808080808081, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.08080808080808081, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.08080808080808081, 'correct_domain_wrong_label': 40, 'correct_label_wrong_domain': 15, 'both_wrong': 22}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 13:10:59,870][root][INFO] - Setting global seed to 206
[2025-03-06 13:10:59,877][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 13:10:59,878][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 13:10:59,879][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 13:10:59,893][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:10:59,896][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:10:59,896][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 13:11:00,054][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 13:11:00,327][root][INFO] - Full model selected, loading model
[2025-03-06 13:11:17,861][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 13:12:17,117][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 13:12:17,117][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 13:12:56,805][root][INFO] - Peft model loaded successfully
[2025-03-06 13:13:04,425][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 13:13:04,427][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 13:13:04,427][root][INFO] - Starting inference
[2025-03-06 13:13:04,672][root][INFO] - Processing question number 0
[2025-03-06 13:13:04,674][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 13:13:35,128][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 13:14:06,248][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 13:14:36,943][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 13:14:51,956][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 13:15:22,571][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 13:15:53,167][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 13:16:24,568][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 13:16:55,497][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 13:17:26,006][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 13:17:57,164][root][INFO] - Processing question number 10
[2025-03-06 13:17:57,166][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 13:18:29,888][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 13:19:00,220][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 13:19:31,100][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 13:20:02,549][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 13:20:34,009][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 13:21:04,401][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 13:21:26,433][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 13:21:57,286][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 13:22:28,072][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 13:22:58,609][root][INFO] - Processing question number 20
[2025-03-06 13:22:58,612][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 13:23:29,325][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 13:23:48,158][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 13:24:18,584][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 13:24:48,906][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 13:25:08,494][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 13:25:39,316][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 13:26:10,927][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 13:26:41,717][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 13:27:12,648][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 13:27:42,829][root][INFO] - Processing question number 30
[2025-03-06 13:27:42,838][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 13:28:13,909][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 13:28:45,383][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 13:29:16,296][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 13:29:47,034][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 13:30:17,628][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 13:30:49,009][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 13:31:19,640][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 13:31:50,723][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 13:32:21,630][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 13:32:53,244][root][INFO] - Processing question number 40
[2025-03-06 13:32:53,247][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 13:33:24,239][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 13:33:55,177][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 13:34:26,647][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 13:34:58,033][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 13:35:28,650][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 13:35:59,615][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 13:36:31,820][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 13:37:01,859][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 13:37:32,664][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 13:38:04,177][root][INFO] - Processing question number 50
[2025-03-06 13:38:04,181][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 13:38:35,855][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 13:39:06,886][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 13:39:37,154][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 13:39:54,883][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 13:40:25,919][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 13:40:55,953][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 13:41:27,611][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 13:41:58,014][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 13:42:29,498][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 13:43:01,797][root][INFO] - Processing question number 60
[2025-03-06 13:43:01,802][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 13:43:32,215][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 13:44:02,964][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 13:44:34,362][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 13:45:04,784][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 13:45:35,679][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 13:46:06,644][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 13:46:37,614][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 13:47:08,926][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 13:47:39,985][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 13:48:11,553][root][INFO] - Processing question number 70
[2025-03-06 13:48:11,558][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 13:48:42,277][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 13:49:13,051][root][INFO] - Domain : Property, Question : 6
[2025-03-06 13:49:43,686][root][INFO] - Domain : Property, Question : 13
[2025-03-06 13:50:14,971][root][INFO] - Domain : Property, Question : 20
[2025-03-06 13:50:46,115][root][INFO] - Domain : Property, Question : 33
[2025-03-06 13:51:16,616][root][INFO] - Domain : Property, Question : 39
[2025-03-06 13:51:47,970][root][INFO] - Domain : Property, Question : 48
[2025-03-06 13:52:19,100][root][INFO] - Domain : Property, Question : 54
[2025-03-06 13:52:50,439][root][INFO] - Domain : Property, Question : 61
[2025-03-06 13:53:21,163][root][INFO] - Processing question number 80
[2025-03-06 13:53:21,169][root][INFO] - Domain : Property, Question : 67
[2025-03-06 13:53:52,304][root][INFO] - Domain : Property, Question : 75
[2025-03-06 13:54:23,392][root][INFO] - Domain : Property, Question : 83
[2025-03-06 13:54:53,972][root][INFO] - Domain : Property, Question : 89
[2025-03-06 13:55:24,598][root][INFO] - Domain : Property, Question : 97
[2025-03-06 13:55:56,025][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:56:27,283][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 13:56:58,686][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:57:29,359][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 13:58:00,528][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 13:58:31,033][root][INFO] - Processing question number 90
[2025-03-06 13:58:31,040][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 13:59:02,922][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 13:59:32,892][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 14:00:03,732][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 14:00:33,843][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:01:05,246][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 14:01:35,686][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 14:02:06,407][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 14:02:37,450][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 14:03:09,003][root][INFO] - Inference complete
[2025-03-06 14:03:09,003][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:03:09,011][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:03:09,012][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,013][root][WARNING] - |Q. 7||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,013][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,015][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,016][root][WARNING] - |Q. 91||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,016][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,016][root][WARNING] - |Q. 9||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,017][root][WARNING] - |Q. 9||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,017][root][INFO] - |Q. 9||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,018][root][WARNING] - |Q. 65||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,018][root][WARNING] - |Q. 65||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,018][root][INFO] - |Q. 65||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,019][root][WARNING] - |Q. 93||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,019][root][WARNING] - |Q. 93||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,019][root][INFO] - |Q. 93||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,020][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,020][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,020][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,020][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,021][root][WARNING] - |Q. 22||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,021][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,022][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,022][root][WARNING] - |Q. 66||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:03:09,023][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,024][root][WARNING] - |Q. 88||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,024][root][WARNING] - |Q. 88||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,024][root][INFO] - |Q. 88||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,024][root][WARNING] - |Q. 4||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,025][root][WARNING] - |Q. 4||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:03:09,025][root][INFO] - |Q. 4||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,025][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,025][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:03:09,025][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,026][root][WARNING] - |Q. 24||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,026][root][WARNING] - |Q. 24||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,026][root][INFO] - |Q. 24||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,027][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,027][root][WARNING] - |Q. 62||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,027][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,028][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,028][root][WARNING] - |Q. 12||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:03:09,029][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,029][root][WARNING] - |Q. 34||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,029][root][WARNING] - |Q. 34||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,030][root][INFO] - |Q. 34||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,030][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,030][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,030][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,031][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,031][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:03:09,032][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,032][root][WARNING] - |Q. 96||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,032][root][WARNING] - |Q. 96||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:03:09,032][root][INFO] - |Q. 96||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,033][root][WARNING] - |Q. 20||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,033][root][WARNING] - |Q. 20||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,033][root][INFO] - |Q. 20||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,034][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,034][root][WARNING] - |Q. 39||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:03:09,034][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,035][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,036][root][WARNING] - |Q. 100||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:03:09,036][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,036][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,037][root][WARNING] - |Q. 15||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,037][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,038][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,038][root][WARNING] - |Q. 85||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,038][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,039][root][WARNING] - |Q. 92||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:03:09,039][root][WARNING] - |Q. 92||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:03:09,039][root][INFO] - |Q. 92||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:03:09,040][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:03:09,046][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:03:09,046][root][INFO] - Saved parsed outputs
[2025-03-06 14:03:09,046][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:03:09,048][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:03:09,048][root][INFO] - Saved parsing metadata
[2025-03-06 14:03:09,049][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:03:09,074][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:03:09,075][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 14:03:09,150][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 14:03:09,150][root][INFO] - Summary of metrics : {'label_accuracy': 0.3434343434343434, 'misclassification_rate': 0.6565656565656566, 'combined_accuracy': 0.18181818181818182, 'malformed_label': 0, 'malformed_domain': 50, 'total_predictions': 99, 'correct_predictions': 34, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.07142857142857142, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.125, 'Constitutional_Law_confidence': 0.10101010101010101, 'Contracts_confidence': 0.020202020202020204, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.04040404040404041, 'Real_Property_confidence': 0.0707070707070707, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.050505050505050504, 'correct_domain_wrong_label': 31, 'correct_label_wrong_domain': 16, 'both_wrong': 34}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 14:03:21,782][root][INFO] - Setting global seed to 206
[2025-03-06 14:03:21,791][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 14:03:21,792][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 14:03:21,793][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 14:03:21,828][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:03:21,832][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:03:21,833][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 14:03:22,048][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 14:03:22,330][root][INFO] - Full model selected, loading model
[2025-03-06 14:03:45,340][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 14:03:45,362][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 14:03:54,288][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:03:54,290][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:03:54,290][root][INFO] - Starting inference
[2025-03-06 14:03:54,519][root][INFO] - Processing question number 0
[2025-03-06 14:03:54,521][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 14:04:25,205][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 14:04:56,275][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 14:05:26,883][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 14:05:57,971][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 14:06:28,499][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 14:06:58,973][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 14:07:30,292][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 14:08:01,101][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 14:08:31,540][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 14:09:02,630][root][INFO] - Processing question number 10
[2025-03-06 14:09:02,632][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 14:09:35,078][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 14:10:05,268][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 14:10:35,985][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 14:11:07,351][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 14:11:38,697][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 14:12:08,966][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 14:12:39,156][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 14:13:09,828][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 14:13:40,477][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 14:14:10,900][root][INFO] - Processing question number 20
[2025-03-06 14:14:10,903][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 14:14:41,523][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 14:15:12,387][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 14:15:42,654][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 14:16:12,850][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 14:16:43,774][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 14:17:14,431][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 14:17:45,914][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 14:18:16,525][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 14:18:47,330][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 14:19:17,418][root][INFO] - Processing question number 30
[2025-03-06 14:19:17,421][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 14:19:48,418][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 14:20:19,747][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 14:20:50,545][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 14:21:21,132][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 14:21:51,616][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 14:22:22,885][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 14:22:53,446][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 14:23:24,436][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 14:23:55,226][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 14:24:26,732][root][INFO] - Processing question number 40
[2025-03-06 14:24:26,736][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 14:24:57,582][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 14:26:07,774][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 14:26:39,171][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 14:27:10,451][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 14:27:40,962][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 14:28:11,774][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 14:28:43,806][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 14:29:13,710][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 14:29:44,359][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 14:30:15,749][root][INFO] - Processing question number 50
[2025-03-06 14:30:15,754][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 14:30:47,313][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 14:31:18,254][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 14:31:48,387][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 14:32:20,252][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 14:32:51,168][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 14:33:21,109][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 14:33:52,650][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 14:34:22,944][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 14:34:54,346][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 14:35:26,534][root][INFO] - Processing question number 60
[2025-03-06 14:35:26,539][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 14:35:56,813][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 14:36:27,435][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 14:36:58,749][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 14:37:28,998][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 14:37:59,800][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 14:38:30,657][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 14:39:01,541][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 14:39:32,674][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 14:40:03,633][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 14:40:35,124][root][INFO] - Processing question number 70
[2025-03-06 14:40:35,129][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 14:41:05,729][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 14:41:36,654][root][INFO] - Domain : Property, Question : 6
[2025-03-06 14:42:07,211][root][INFO] - Domain : Property, Question : 13
[2025-03-06 14:42:38,405][root][INFO] - Domain : Property, Question : 20
[2025-03-06 14:43:09,480][root][INFO] - Domain : Property, Question : 33
[2025-03-06 14:43:39,877][root][INFO] - Domain : Property, Question : 39
[2025-03-06 14:44:11,033][root][INFO] - Domain : Property, Question : 48
[2025-03-06 14:44:42,052][root][INFO] - Domain : Property, Question : 54
[2025-03-06 14:45:13,221][root][INFO] - Domain : Property, Question : 61
[2025-03-06 14:45:43,826][root][INFO] - Processing question number 80
[2025-03-06 14:45:43,832][root][INFO] - Domain : Property, Question : 67
[2025-03-06 14:46:14,886][root][INFO] - Domain : Property, Question : 75
[2025-03-06 14:46:45,929][root][INFO] - Domain : Property, Question : 83
[2025-03-06 14:47:16,466][root][INFO] - Domain : Property, Question : 89
[2025-03-06 14:47:47,046][root][INFO] - Domain : Property, Question : 97
[2025-03-06 14:48:18,446][root][INFO] - Domain : Property, Question : 100
[2025-03-06 14:48:49,572][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 14:49:20,757][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:49:51,290][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 14:50:22,284][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 14:50:52,543][root][INFO] - Processing question number 90
[2025-03-06 14:50:52,549][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 14:51:24,287][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 14:51:54,071][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 14:52:24,714][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 14:52:54,691][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:53:25,874][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 14:53:56,122][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 14:54:26,692][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 14:54:57,594][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 14:55:28,993][root][INFO] - Inference complete
[2025-03-06 14:55:28,994][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:55:29,001][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:55:29,004][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,004][root][WARNING] - |Q. 63||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,005][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,006][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,006][root][WARNING] - |Q. 70||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,006][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,007][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,008][root][WARNING] - |Q. 17||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:55:29,008][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,009][root][WARNING] - |Q. 60||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,009][root][WARNING] - |Q. 60||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,009][root][INFO] - |Q. 60||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,011][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,011][root][WARNING] - |Q. 46||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:55:29,012][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,012][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,012][root][WARNING] - |Q. 58||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,013][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,014][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,014][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,014][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,015][root][WARNING] - |Q. 24||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,015][root][WARNING] - |Q. 24||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,015][root][INFO] - |Q. 24||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,015][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,016][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,016][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,018][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,018][root][WARNING] - |Q. 12||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,018][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,020][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,020][root][WARNING] - |Q. 59||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,020][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,021][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,022][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,022][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,022][root][WARNING] - |Q. 20||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,022][root][WARNING] - |Q. 20||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,023][root][INFO] - |Q. 20||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,024][root][WARNING] - |Q. 67||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,024][root][WARNING] - |Q. 67||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,024][root][INFO] - |Q. 67||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,024][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,025][root][WARNING] - |Q. 75||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,025][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,025][root][WARNING] - |Q. 83||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,025][root][WARNING] - |Q. 83||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,026][root][INFO] - |Q. 83||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,026][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,026][root][WARNING] - |Q. 89||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,026][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,027][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,027][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,027][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,028][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,028][root][WARNING] - |Q. 15||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,028][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,029][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,029][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,029][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,030][root][WARNING] - |Q. 57||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,030][root][WARNING] - |Q. 57||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,030][root][INFO] - |Q. 57||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,030][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 14:55:29,031][root][WARNING] - |Q. 64||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:55:29,031][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 14:55:29,033][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:55:29,039][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:55:29,039][root][INFO] - Saved parsed outputs
[2025-03-06 14:55:29,039][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:55:29,041][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:55:29,041][root][INFO] - Saved parsing metadata
[2025-03-06 14:55:29,042][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:55:29,044][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:55:29,045][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 14:55:29,115][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 14:55:29,115][root][INFO] - Summary of metrics : {'label_accuracy': 0.30303030303030304, 'misclassification_rate': 0.696969696969697, 'combined_accuracy': 0.16161616161616163, 'malformed_label': 0, 'malformed_domain': 44, 'total_predictions': 99, 'correct_predictions': 30, 'correct_label_and_domain': 16, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.23076923076923078, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.07692307692307693, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.1111111111111111, 'Contracts_confidence': 0.08080808080808081, 'Criminal_Law_confidence': 0.20202020202020202, 'Evidence_confidence': 0.04040404040404041, 'Real_Property_confidence': 0.030303030303030304, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.0707070707070707, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 14, 'both_wrong': 30}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 14:55:44,041][root][INFO] - Setting global seed to 989
[2025-03-06 14:55:44,050][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 14:55:44,050][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 14:55:44,052][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 14:55:44,054][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:55:44,059][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:55:44,059][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 14:55:44,215][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 14:55:44,512][root][INFO] - Full model selected, loading model
[2025-03-06 14:56:01,896][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 14:57:11,194][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 14:57:11,262][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 14:57:36,990][root][INFO] - Peft model loaded successfully
[2025-03-06 14:57:42,810][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:57:42,813][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 14:57:42,813][root][INFO] - Starting inference
[2025-03-06 14:57:43,094][root][INFO] - Processing question number 0
[2025-03-06 14:57:43,096][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 14:58:14,026][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 14:58:45,027][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 14:59:15,592][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 14:59:37,374][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 14:59:59,823][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 15:00:30,272][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 15:01:01,545][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 15:01:23,190][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 15:01:53,579][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 15:02:24,608][root][INFO] - Processing question number 10
[2025-03-06 15:02:24,610][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 15:02:57,128][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 15:03:27,331][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 15:03:58,061][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 15:04:29,375][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 15:05:00,666][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 15:05:30,930][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 15:06:01,062][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 15:06:31,758][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 15:07:02,435][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 15:07:32,819][root][INFO] - Processing question number 20
[2025-03-06 15:07:32,844][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 15:08:03,443][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 15:08:22,238][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 15:08:52,505][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 15:09:22,711][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 15:09:53,611][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 15:10:17,724][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 15:10:49,190][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 15:11:19,871][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 15:11:50,647][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 15:12:20,717][root][INFO] - Processing question number 30
[2025-03-06 15:12:20,721][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 15:12:51,676][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 15:13:22,970][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 15:13:53,763][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 15:14:24,320][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 15:14:54,803][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 15:15:26,042][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 15:15:56,577][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 15:16:27,541][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 15:16:58,306][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 15:17:29,792][root][INFO] - Processing question number 40
[2025-03-06 15:17:29,796][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 15:18:00,616][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 15:18:31,415][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 15:19:02,712][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 15:19:33,966][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 15:20:04,457][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 15:20:35,239][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 15:21:04,827][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 15:21:34,726][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 15:22:05,430][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 15:22:36,784][root][INFO] - Processing question number 50
[2025-03-06 15:22:36,788][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 15:23:08,334][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 15:23:31,978][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 15:24:02,080][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 15:24:33,908][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 15:25:04,794][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 15:25:34,682][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 15:26:06,172][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 15:26:36,469][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 15:27:07,818][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 15:27:39,950][root][INFO] - Processing question number 60
[2025-03-06 15:27:39,987][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 15:28:10,271][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 15:28:40,858][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 15:29:12,145][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 15:29:42,408][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 15:30:13,160][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 15:30:43,964][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 15:31:14,792][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 15:31:45,961][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 15:32:16,872][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 15:32:48,302][root][INFO] - Processing question number 70
[2025-03-06 15:32:48,308][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 15:33:18,859][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 15:33:43,369][root][INFO] - Domain : Property, Question : 6
[2025-03-06 15:34:13,831][root][INFO] - Domain : Property, Question : 13
[2025-03-06 15:34:44,966][root][INFO] - Domain : Property, Question : 20
[2025-03-06 15:35:15,970][root][INFO] - Domain : Property, Question : 33
[2025-03-06 15:35:46,315][root][INFO] - Domain : Property, Question : 39
[2025-03-06 15:36:17,513][root][INFO] - Domain : Property, Question : 48
[2025-03-06 15:36:48,454][root][INFO] - Domain : Property, Question : 54
[2025-03-06 15:37:19,646][root][INFO] - Domain : Property, Question : 61
[2025-03-06 15:37:50,194][root][INFO] - Processing question number 80
[2025-03-06 15:37:50,199][root][INFO] - Domain : Property, Question : 67
[2025-03-06 15:38:21,174][root][INFO] - Domain : Property, Question : 75
[2025-03-06 15:38:52,142][root][INFO] - Domain : Property, Question : 83
[2025-03-06 15:39:22,617][root][INFO] - Domain : Property, Question : 89
[2025-03-06 15:39:53,138][root][INFO] - Domain : Property, Question : 97
[2025-03-06 15:40:24,471][root][INFO] - Domain : Property, Question : 100
[2025-03-06 15:40:55,622][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 15:41:26,838][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 15:41:57,318][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 15:42:28,249][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 15:42:58,501][root][INFO] - Processing question number 90
[2025-03-06 15:42:58,507][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 15:43:30,190][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 15:43:59,968][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 15:44:30,623][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 15:45:00,547][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 15:45:31,756][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 15:46:01,996][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 15:46:32,524][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 15:47:03,371][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 15:47:34,729][root][INFO] - Inference complete
[2025-03-06 15:47:34,729][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 15:47:34,765][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 15:47:34,767][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,767][root][WARNING] - |Q. 42||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,768][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,770][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,770][root][WARNING] - |Q. 17||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:47:34,770][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,771][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,771][root][WARNING] - |Q. 55||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,771][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,773][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,773][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,774][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,774][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,774][root][WARNING] - |Q. 66||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,775][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,776][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,776][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,776][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,776][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,777][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,777][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,780][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,780][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,781][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,782][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,782][root][WARNING] - |Q. 48||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,782][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,783][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,784][root][WARNING] - |Q. 100||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:47:34,784][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,784][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,785][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,785][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,785][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:47:34,786][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:47:34,786][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:47:34,788][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 15:47:34,794][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 15:47:34,794][root][INFO] - Saved parsed outputs
[2025-03-06 15:47:34,794][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 15:47:34,796][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 15:47:34,796][root][INFO] - Saved parsing metadata
[2025-03-06 15:47:34,797][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 15:47:34,800][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 15:47:34,815][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 15:47:34,895][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 15:47:34,895][root][INFO] - Summary of metrics : {'label_accuracy': 0.3434343434343434, 'misclassification_rate': 0.6565656565656566, 'combined_accuracy': 0.15151515151515152, 'malformed_label': 0, 'malformed_domain': 48, 'total_predictions': 99, 'correct_predictions': 34, 'correct_label_and_domain': 15, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.0, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.0, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.0625, 'Constitutional_Law_confidence': 0.1111111111111111, 'Contracts_confidence': 0.0, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.050505050505050504, 'Real_Property_confidence': 0.10101010101010101, 'Torts_confidence': 0.16161616161616163, 'Civil_Procedure_confidence': 0.050505050505050504, 'correct_domain_wrong_label': 36, 'correct_label_wrong_domain': 19, 'both_wrong': 29}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 15:47:58,815][root][INFO] - Setting global seed to 989
[2025-03-06 15:47:58,831][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 15:47:58,831][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 15:47:58,832][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 15:47:58,846][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 15:47:58,852][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 15:47:58,852][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 15:47:59,034][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 15:47:59,321][root][INFO] - Full model selected, loading model
[2025-03-06 15:48:17,886][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 15:48:17,887][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 15:48:23,887][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 15:48:23,888][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 15:48:23,889][root][INFO] - Starting inference
[2025-03-06 15:48:24,089][root][INFO] - Processing question number 0
[2025-03-06 15:48:24,091][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 15:48:53,958][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 15:49:24,848][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 15:49:55,282][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 15:50:26,198][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 15:50:56,557][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 15:51:26,867][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 15:51:58,003][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 15:52:28,626][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 15:52:58,879][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 15:53:29,784][root][INFO] - Processing question number 10
[2025-03-06 15:53:29,828][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 15:54:02,088][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 15:54:32,105][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 15:55:02,638][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 15:55:33,825][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 15:56:04,993][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 15:56:35,076][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 15:57:05,091][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 15:57:35,580][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 15:58:06,057][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 15:58:36,302][root][INFO] - Processing question number 20
[2025-03-06 15:58:36,358][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 15:59:06,811][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 15:59:37,502][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 16:00:07,590][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 16:00:37,605][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 16:01:08,383][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 16:01:38,888][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 16:02:10,232][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 16:02:40,707][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 16:03:11,364][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 16:03:41,306][root][INFO] - Processing question number 30
[2025-03-06 16:03:41,310][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 16:04:12,158][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 16:04:43,336][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 16:05:13,982][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 16:05:44,408][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 16:06:14,729][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 16:06:45,839][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 16:07:16,239][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 16:07:47,072][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 16:08:17,686][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 16:08:49,032][root][INFO] - Processing question number 40
[2025-03-06 16:08:49,035][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 16:09:19,736][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 16:09:50,408][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 16:10:21,590][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 16:10:52,719][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 16:11:23,066][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 16:11:53,688][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 16:12:25,501][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 16:12:55,180][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 16:13:25,619][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 16:13:56,877][root][INFO] - Processing question number 50
[2025-03-06 16:13:56,881][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 16:14:28,461][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 16:14:59,389][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 16:15:29,326][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 16:16:00,960][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 16:16:31,633][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 16:17:01,335][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 16:17:32,632][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 16:18:02,687][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 16:18:33,852][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 16:19:05,788][root][INFO] - Processing question number 60
[2025-03-06 16:19:05,792][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 16:19:35,826][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 16:20:06,204][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 16:20:37,280][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 16:21:07,288][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 16:21:37,849][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 16:22:08,460][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 16:22:39,107][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 16:23:10,004][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 16:23:40,727][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 16:24:11,972][root][INFO] - Processing question number 70
[2025-03-06 16:24:11,978][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 16:24:42,337][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 16:25:12,729][root][INFO] - Domain : Property, Question : 6
[2025-03-06 16:25:43,003][root][INFO] - Domain : Property, Question : 13
[2025-03-06 16:26:13,872][root][INFO] - Domain : Property, Question : 20
[2025-03-06 16:26:44,696][root][INFO] - Domain : Property, Question : 33
[2025-03-06 16:27:14,849][root][INFO] - Domain : Property, Question : 39
[2025-03-06 16:27:45,769][root][INFO] - Domain : Property, Question : 48
[2025-03-06 16:28:16,536][root][INFO] - Domain : Property, Question : 54
[2025-03-06 16:28:47,461][root][INFO] - Domain : Property, Question : 61
[2025-03-06 16:29:17,834][root][INFO] - Processing question number 80
[2025-03-06 16:29:17,839][root][INFO] - Domain : Property, Question : 67
[2025-03-06 16:29:48,648][root][INFO] - Domain : Property, Question : 75
[2025-03-06 16:30:19,442][root][INFO] - Domain : Property, Question : 83
[2025-03-06 16:30:49,736][root][INFO] - Domain : Property, Question : 89
[2025-03-06 16:31:20,062][root][INFO] - Domain : Property, Question : 97
[2025-03-06 16:31:51,215][root][INFO] - Domain : Property, Question : 100
[2025-03-06 16:32:22,095][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 16:32:53,038][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 16:33:23,316][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 16:33:54,064][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 16:34:24,074][root][INFO] - Processing question number 90
[2025-03-06 16:34:24,079][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 16:34:55,572][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 16:35:25,109][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 16:35:55,515][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 16:36:25,250][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 16:36:56,191][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 16:37:26,202][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 16:37:56,537][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 16:38:27,198][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 16:38:58,356][root][INFO] - Inference complete
[2025-03-06 16:38:58,356][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 16:38:58,364][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 16:38:58,368][root][WARNING] - |Q. 60||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,369][root][WARNING] - |Q. 60||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,370][root][INFO] - |Q. 60||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,371][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,371][root][WARNING] - |Q. 8||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,372][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,373][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,373][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,373][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,374][root][WARNING] - |Q. 4||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,375][root][WARNING] - |Q. 4||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,375][root][INFO] - |Q. 4||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,375][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,375][root][WARNING] - |Q. 11||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 16:38:58,375][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,376][root][WARNING] - |Q. 24||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,376][root][WARNING] - |Q. 24||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,376][root][INFO] - |Q. 24||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,377][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,377][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,377][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,377][root][WARNING] - |Q. 41||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,378][root][WARNING] - |Q. 41||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,378][root][INFO] - |Q. 41||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,379][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,379][root][WARNING] - |Q. 82||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,379][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,381][root][WARNING] - |Q. 73||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,382][root][WARNING] - |Q. 73||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,382][root][INFO] - |Q. 73||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,382][root][WARNING] - |Q. 86||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,383][root][WARNING] - |Q. 86||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,383][root][INFO] - |Q. 86||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,383][root][WARNING] - |Q. 96||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,384][root][WARNING] - |Q. 96||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,384][root][INFO] - |Q. 96||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,384][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,384][root][WARNING] - |Q. 6||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,384][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,385][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,385][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,385][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,385][root][WARNING] - |Q. 20||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,386][root][WARNING] - |Q. 20||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,386][root][INFO] - |Q. 20||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,387][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,387][root][WARNING] - |Q. 54||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,387][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,388][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,388][root][WARNING] - |Q. 89||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,389][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,390][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,390][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,390][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,390][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,391][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 16:38:58,391][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,392][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,392][root][WARNING] - |Q. 85||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:38:58,392][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,392][root][WARNING] - |Q. 92||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 16:38:58,393][root][WARNING] - |Q. 92||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 16:38:58,393][root][INFO] - |Q. 92||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 16:38:58,394][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 16:38:58,401][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 16:38:58,401][root][INFO] - Saved parsed outputs
[2025-03-06 16:38:58,401][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 16:38:58,402][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 16:38:58,402][root][INFO] - Saved parsing metadata
[2025-03-06 16:38:58,403][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 16:38:58,404][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 16:38:58,406][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 16:38:58,450][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 16:38:58,450][root][INFO] - Summary of metrics : {'label_accuracy': 0.37373737373737376, 'misclassification_rate': 0.6262626262626263, 'combined_accuracy': 0.21212121212121213, 'malformed_label': 0, 'malformed_domain': 45, 'total_predictions': 99, 'correct_predictions': 37, 'correct_label_and_domain': 21, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.07142857142857142, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.1111111111111111, 'Contracts_confidence': 0.020202020202020204, 'Criminal_Law_confidence': 0.1919191919191919, 'Evidence_confidence': 0.08080808080808081, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.08080808080808081, 'correct_domain_wrong_label': 33, 'correct_label_wrong_domain': 16, 'both_wrong': 29}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 16:39:08,640][root][INFO] - Setting global seed to 989
[2025-03-06 16:39:08,648][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 16:39:08,649][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 16:39:08,650][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 16:39:08,651][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 16:39:08,656][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 16:39:08,657][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 16:39:08,827][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 16:39:09,093][root][INFO] - Full model selected, loading model
[2025-03-06 16:39:23,734][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 16:40:21,636][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 16:40:21,658][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 16:40:46,205][root][INFO] - Peft model loaded successfully
[2025-03-06 16:40:51,995][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 16:40:51,996][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 16:40:51,996][root][INFO] - Starting inference
[2025-03-06 16:40:52,238][root][INFO] - Processing question number 0
[2025-03-06 16:40:52,240][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 16:41:22,857][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 16:41:53,961][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 16:42:24,639][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 16:42:55,772][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 16:43:26,370][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 16:43:56,921][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 16:44:28,309][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 16:44:59,196][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 16:45:29,716][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 16:46:00,868][root][INFO] - Processing question number 10
[2025-03-06 16:46:00,870][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 16:46:33,525][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 16:47:03,856][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 16:47:34,709][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 16:48:06,152][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 16:48:37,569][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 16:49:07,959][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 16:49:38,227][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 16:50:09,030][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 16:50:39,816][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 16:51:10,322][root][INFO] - Processing question number 20
[2025-03-06 16:51:10,325][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 16:51:41,038][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 16:52:11,980][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 16:52:42,370][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 16:53:12,691][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 16:53:43,722][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 16:54:14,540][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 16:54:46,138][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 16:55:16,915][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 16:55:47,827][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 16:56:18,025][root][INFO] - Processing question number 30
[2025-03-06 16:56:18,028][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 16:56:49,120][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 16:57:20,542][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 16:57:51,451][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 16:58:22,140][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 16:58:52,727][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 16:59:14,988][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 16:59:45,650][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 17:00:16,727][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 17:00:47,616][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 17:01:19,219][root][INFO] - Processing question number 40
[2025-03-06 17:01:19,223][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 17:01:50,173][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 17:02:21,110][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 17:02:52,545][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 17:03:23,925][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 17:03:54,533][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 17:04:25,436][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 17:04:57,629][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 17:05:27,618][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 17:05:58,416][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 17:06:29,885][root][INFO] - Processing question number 50
[2025-03-06 17:06:29,889][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 17:07:01,549][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 17:07:22,516][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 17:07:52,742][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 17:08:18,509][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 17:08:49,502][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 17:09:19,516][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 17:09:51,132][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 17:10:21,554][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 17:10:53,034][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 17:11:25,293][root][INFO] - Processing question number 60
[2025-03-06 17:11:25,299][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 17:11:55,709][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 17:12:26,427][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 17:12:57,824][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 17:13:28,197][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 17:13:46,531][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 17:14:17,461][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 17:14:37,362][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 17:15:08,667][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 17:15:29,480][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 17:16:01,040][root][INFO] - Processing question number 70
[2025-03-06 17:16:01,045][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 17:16:31,719][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 17:17:02,479][root][INFO] - Domain : Property, Question : 6
[2025-03-06 17:17:33,070][root][INFO] - Domain : Property, Question : 13
[2025-03-06 17:18:04,335][root][INFO] - Domain : Property, Question : 20
[2025-03-06 17:18:35,472][root][INFO] - Domain : Property, Question : 33
[2025-03-06 17:19:05,971][root][INFO] - Domain : Property, Question : 39
[2025-03-06 17:19:37,337][root][INFO] - Domain : Property, Question : 48
[2025-03-06 17:20:08,458][root][INFO] - Domain : Property, Question : 54
[2025-03-06 17:20:39,787][root][INFO] - Domain : Property, Question : 61
[2025-03-06 17:21:10,465][root][INFO] - Processing question number 80
[2025-03-06 17:21:10,470][root][INFO] - Domain : Property, Question : 67
[2025-03-06 17:21:41,578][root][INFO] - Domain : Property, Question : 75
[2025-03-06 17:22:12,681][root][INFO] - Domain : Property, Question : 83
[2025-03-06 17:22:43,296][root][INFO] - Domain : Property, Question : 89
[2025-03-06 17:23:13,948][root][INFO] - Domain : Property, Question : 97
[2025-03-06 17:23:45,414][root][INFO] - Domain : Property, Question : 100
[2025-03-06 17:24:16,706][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 17:24:48,054][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 17:25:18,661][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 17:25:49,737][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 17:26:20,123][root][INFO] - Processing question number 90
[2025-03-06 17:26:20,129][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 17:26:51,949][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 17:27:21,854][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 17:27:52,638][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 17:28:22,687][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 17:28:54,038][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 17:29:24,410][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 17:29:55,076][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 17:30:26,063][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 17:30:57,569][root][INFO] - Inference complete
[2025-03-06 17:30:57,569][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 17:30:57,576][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 17:30:57,578][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,578][root][WARNING] - |Q. 21||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,579][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,580][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,580][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 17:30:57,580][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,581][root][WARNING] - |Q. 69||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,581][root][WARNING] - |Q. 69||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,581][root][INFO] - |Q. 69||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,581][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,582][root][WARNING] - |Q. 91||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,582][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,583][root][WARNING] - |Q. 60||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,584][root][WARNING] - |Q. 60||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,584][root][INFO] - |Q. 60||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,585][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,585][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,585][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,586][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,586][root][WARNING] - |Q. 46||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,586][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,587][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,587][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,587][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,588][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,588][root][WARNING] - |Q. 66||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,588][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,589][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,590][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,590][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,592][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,592][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,592][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,593][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,593][root][WARNING] - |Q. 53||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,593][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,594][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,594][root][WARNING] - |Q. 68||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,594][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,595][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,595][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,595][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,596][root][WARNING] - |Q. 96||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,596][root][WARNING] - |Q. 96||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 17:30:57,596][root][INFO] - |Q. 96||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,598][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,598][root][WARNING] - |Q. 75||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,598][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,599][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,599][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,599][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,600][root][WARNING] - |Q. 10||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,600][root][WARNING] - |Q. 10||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:30:57,600][root][INFO] - |Q. 10||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,601][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 17:30:57,601][root][WARNING] - |Q. 50||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 17:30:57,601][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 17:30:57,603][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 17:30:57,610][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 17:30:57,610][root][INFO] - Saved parsed outputs
[2025-03-06 17:30:57,610][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 17:30:57,611][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 17:30:57,611][root][INFO] - Saved parsing metadata
[2025-03-06 17:30:57,612][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 17:30:57,614][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 17:30:57,615][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 17:30:57,709][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 17:30:57,709][root][INFO] - Summary of metrics : {'label_accuracy': 0.3838383838383838, 'misclassification_rate': 0.6161616161616161, 'combined_accuracy': 0.1919191919191919, 'malformed_label': 0, 'malformed_domain': 48, 'total_predictions': 99, 'correct_predictions': 38, 'correct_label_and_domain': 19, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.07142857142857142, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.0625, 'Constitutional_Law_confidence': 0.1111111111111111, 'Contracts_confidence': 0.010101010101010102, 'Criminal_Law_confidence': 0.20202020202020202, 'Evidence_confidence': 0.04040404040404041, 'Real_Property_confidence': 0.09090909090909091, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.06060606060606061, 'correct_domain_wrong_label': 32, 'correct_label_wrong_domain': 19, 'both_wrong': 29}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 17:31:06,095][root][INFO] - Setting global seed to 989
[2025-03-06 17:31:06,103][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 17:31:06,103][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 17:31:06,104][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 17:31:06,107][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 17:31:06,110][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 17:31:06,110][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 17:31:06,294][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 17:31:06,603][root][INFO] - Full model selected, loading model
[2025-03-06 17:31:24,253][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 17:31:24,253][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 17:31:30,206][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 17:31:30,207][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 17:31:30,207][root][INFO] - Starting inference
[2025-03-06 17:31:30,431][root][INFO] - Processing question number 0
[2025-03-06 17:31:30,433][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 17:32:00,494][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 17:32:31,504][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 17:33:02,065][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 17:33:33,105][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 17:34:03,588][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 17:34:34,022][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 17:35:05,290][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 17:35:36,055][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 17:36:06,454][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 17:36:37,505][root][INFO] - Processing question number 10
[2025-03-06 17:36:37,507][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 17:37:09,904][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 17:37:40,056][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 17:38:10,734][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 17:38:42,061][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 17:39:13,364][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 17:39:43,586][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 17:40:13,730][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 17:40:44,367][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 17:41:14,978][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 17:41:45,362][root][INFO] - Processing question number 20
[2025-03-06 17:41:45,365][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 17:42:15,950][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 17:42:46,776][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 17:43:16,999][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 17:43:47,150][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 17:44:18,062][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 17:44:48,710][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 17:45:20,218][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 17:45:50,840][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 17:46:21,644][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 17:46:51,723][root][INFO] - Processing question number 30
[2025-03-06 17:46:51,726][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 17:47:22,708][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 17:47:54,014][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 17:48:24,799][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 17:48:55,364][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 17:49:25,834][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 17:49:57,083][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 17:50:27,624][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 17:50:58,592][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 17:51:29,356][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 17:52:00,834][root][INFO] - Processing question number 40
[2025-03-06 17:52:00,838][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 17:52:31,658][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 17:53:02,465][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 17:53:33,778][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 17:54:05,042][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 17:54:35,527][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 17:55:06,311][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 17:55:38,313][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 17:56:08,186][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 17:56:38,812][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 17:57:10,167][root][INFO] - Processing question number 50
[2025-03-06 17:57:10,171][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 17:57:41,694][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 17:58:12,591][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 17:58:42,680][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 17:59:14,497][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 17:59:45,374][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 18:00:15,275][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 18:00:46,771][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 18:01:17,023][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 18:01:48,383][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 18:02:20,526][root][INFO] - Processing question number 60
[2025-03-06 18:02:20,530][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 18:02:50,761][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 18:03:21,347][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 18:03:52,620][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 18:04:22,860][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 18:04:53,621][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 18:05:24,426][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 18:05:55,263][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 18:06:26,360][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 18:06:57,284][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 18:07:28,725][root][INFO] - Processing question number 70
[2025-03-06 18:07:28,730][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 18:07:59,287][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 18:08:29,877][root][INFO] - Domain : Property, Question : 6
[2025-03-06 18:09:00,351][root][INFO] - Domain : Property, Question : 13
[2025-03-06 18:09:31,416][root][INFO] - Domain : Property, Question : 20
[2025-03-06 18:10:02,437][root][INFO] - Domain : Property, Question : 33
[2025-03-06 18:10:32,783][root][INFO] - Domain : Property, Question : 39
[2025-03-06 18:11:03,896][root][INFO] - Domain : Property, Question : 48
[2025-03-06 18:11:34,864][root][INFO] - Domain : Property, Question : 54
[2025-03-06 18:12:05,985][root][INFO] - Domain : Property, Question : 61
[2025-03-06 18:12:36,532][root][INFO] - Processing question number 80
[2025-03-06 18:12:36,537][root][INFO] - Domain : Property, Question : 67
[2025-03-06 18:13:07,537][root][INFO] - Domain : Property, Question : 75
[2025-03-06 18:13:38,526][root][INFO] - Domain : Property, Question : 83
[2025-03-06 18:14:09,016][root][INFO] - Domain : Property, Question : 89
[2025-03-06 18:14:39,540][root][INFO] - Domain : Property, Question : 97
[2025-03-06 18:15:10,885][root][INFO] - Domain : Property, Question : 100
[2025-03-06 18:15:41,959][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 18:16:13,097][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 18:16:43,580][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 18:17:14,524][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 18:17:44,736][root][INFO] - Processing question number 90
[2025-03-06 18:17:44,742][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 18:18:16,430][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 18:18:46,167][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 18:19:16,763][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 18:19:46,671][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 18:20:17,801][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 18:20:48,008][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 18:21:18,539][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 18:21:49,404][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 18:22:20,755][root][INFO] - Inference complete
[2025-03-06 18:22:20,755][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 18:22:20,764][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 18:22:20,766][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,766][root][WARNING] - |Q. 35||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,767][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,768][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,768][root][WARNING] - |Q. 49||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,768][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,770][root][WARNING] - |Q. 9||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,770][root][WARNING] - |Q. 9||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,770][root][INFO] - |Q. 9||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,771][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,771][root][WARNING] - |Q. 17||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,771][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,773][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,773][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,773][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,774][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,774][root][WARNING] - |Q. 22||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,775][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,775][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,775][root][WARNING] - |Q. 46||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,776][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,776][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,776][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,776][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,778][root][WARNING] - |Q. 24||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,778][root][WARNING] - |Q. 24||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,778][root][INFO] - |Q. 24||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,782][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,782][root][WARNING] - |Q. 68||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,782][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,783][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,783][root][WARNING] - |Q. 6||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,784][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,784][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,784][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,784][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,785][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,785][root][WARNING] - |Q. 39||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,785][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,786][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,787][root][WARNING] - |Q. 89||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,787][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,789][root][WARNING] - |Q. 74||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,789][root][WARNING] - |Q. 74||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,789][root][INFO] - |Q. 74||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,790][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 18:22:20,790][root][WARNING] - |Q. 85||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 18:22:20,790][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 18:22:20,792][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 18:22:20,798][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 18:22:20,798][root][INFO] - Saved parsed outputs
[2025-03-06 18:22:20,798][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 18:22:20,800][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 18:22:20,800][root][INFO] - Saved parsing metadata
[2025-03-06 18:22:20,801][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 18:22:20,803][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 18:22:20,804][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 18:22:20,862][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 18:22:20,862][root][INFO] - Summary of metrics : {'label_accuracy': 0.35353535353535354, 'misclassification_rate': 0.6464646464646464, 'combined_accuracy': 0.18181818181818182, 'malformed_label': 0, 'malformed_domain': 44, 'total_predictions': 99, 'correct_predictions': 35, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.15384615384615385, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.12121212121212122, 'Contracts_confidence': 0.04040404040404041, 'Criminal_Law_confidence': 0.20202020202020202, 'Evidence_confidence': 0.06060606060606061, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.08080808080808081, 'correct_domain_wrong_label': 37, 'correct_label_wrong_domain': 17, 'both_wrong': 27}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 18:22:28,679][root][INFO] - Setting global seed to 989
[2025-03-06 18:22:28,685][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 18:22:28,685][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 18:22:28,686][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 18:22:28,716][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 18:22:28,718][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 18:22:28,718][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 18:22:28,890][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 18:22:29,139][root][INFO] - Full model selected, loading model
[2025-03-06 18:22:40,720][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 18:23:39,247][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 18:23:39,248][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 18:24:02,625][root][INFO] - Peft model loaded successfully
[2025-03-06 18:24:08,415][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 18:24:08,417][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 18:24:08,417][root][INFO] - Starting inference
[2025-03-06 18:24:08,624][root][INFO] - Processing question number 0
[2025-03-06 18:24:08,626][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 18:24:38,925][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 18:25:10,008][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 18:25:40,659][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 18:26:11,774][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 18:26:42,347][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 18:27:12,874][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 18:27:44,225][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 18:28:15,087][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 18:28:45,570][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 18:29:16,694][root][INFO] - Processing question number 10
[2025-03-06 18:29:16,696][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 18:29:49,316][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 18:30:19,613][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 18:30:50,429][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 18:31:21,835][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 18:31:53,224][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 18:32:23,585][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 18:32:53,820][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 18:33:18,243][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 18:33:49,001][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 18:34:19,477][root][INFO] - Processing question number 20
[2025-03-06 18:34:19,480][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 18:34:50,157][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 18:35:21,072][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 18:35:51,430][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 18:36:16,472][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 18:36:47,476][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 18:37:18,261][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 18:37:49,827][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 18:38:20,569][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 18:38:51,450][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 18:39:18,989][root][INFO] - Processing question number 30
[2025-03-06 18:39:18,993][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 18:39:50,056][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 18:40:21,455][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 18:40:52,331][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 18:41:22,998][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 18:41:53,552][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 18:42:24,891][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 18:42:55,521][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 18:43:26,572][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 18:43:47,928][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 18:44:19,496][root][INFO] - Processing question number 40
[2025-03-06 18:44:19,500][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 18:44:50,415][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 18:45:21,325][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 18:45:52,729][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 18:46:24,075][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 18:46:54,647][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 18:47:25,522][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 18:47:47,320][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 18:48:17,361][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 18:48:48,186][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 18:49:19,681][root][INFO] - Processing question number 50
[2025-03-06 18:49:19,685][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 18:49:51,369][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 18:50:22,412][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 18:50:52,655][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 18:51:24,627][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 18:51:55,645][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 18:52:25,690][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 18:52:57,336][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 18:53:27,783][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 18:53:59,275][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 18:54:31,551][root][INFO] - Processing question number 60
[2025-03-06 18:54:31,555][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 18:55:01,978][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 18:55:32,712][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 18:56:04,124][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 18:56:34,522][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 18:57:05,427][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 18:57:36,390][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 18:58:07,381][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 18:58:38,708][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 18:59:09,766][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 18:59:41,348][root][INFO] - Processing question number 70
[2025-03-06 18:59:41,353][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 19:00:12,045][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 19:00:34,526][root][INFO] - Domain : Property, Question : 6
[2025-03-06 19:01:05,132][root][INFO] - Domain : Property, Question : 13
[2025-03-06 19:01:36,423][root][INFO] - Domain : Property, Question : 20
[2025-03-06 19:02:07,570][root][INFO] - Domain : Property, Question : 33
[2025-03-06 19:02:38,060][root][INFO] - Domain : Property, Question : 39
[2025-03-06 19:03:09,403][root][INFO] - Domain : Property, Question : 48
[2025-03-06 19:03:40,498][root][INFO] - Domain : Property, Question : 54
[2025-03-06 19:04:11,838][root][INFO] - Domain : Property, Question : 61
[2025-03-06 19:04:42,534][root][INFO] - Processing question number 80
[2025-03-06 19:04:42,540][root][INFO] - Domain : Property, Question : 67
[2025-03-06 19:05:13,661][root][INFO] - Domain : Property, Question : 75
[2025-03-06 19:05:34,890][root][INFO] - Domain : Property, Question : 83
[2025-03-06 19:06:05,510][root][INFO] - Domain : Property, Question : 89
[2025-03-06 19:06:36,171][root][INFO] - Domain : Property, Question : 97
[2025-03-06 19:07:07,644][root][INFO] - Domain : Property, Question : 100
[2025-03-06 19:07:38,942][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 19:08:10,297][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 19:08:40,920][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 19:09:12,000][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 19:09:42,395][root][INFO] - Processing question number 90
[2025-03-06 19:09:42,401][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 19:10:14,235][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 19:10:44,140][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 19:11:14,917][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 19:11:44,975][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 19:12:16,328][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 19:12:41,544][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 19:13:12,216][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 19:13:43,215][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 19:14:14,715][root][INFO] - Inference complete
[2025-03-06 19:14:14,715][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 19:14:14,724][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 19:14:14,725][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,726][root][WARNING] - |Q. 21||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,726][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,729][root][WARNING] - |Q. 37||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,730][root][WARNING] - |Q. 37||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,730][root][INFO] - |Q. 37||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,730][root][WARNING] - |Q. 60||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,731][root][WARNING] - |Q. 60||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,731][root][INFO] - |Q. 60||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,731][root][WARNING] - |Q. 65||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,731][root][WARNING] - |Q. 65||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,731][root][INFO] - |Q. 65||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,732][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,732][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,733][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,733][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,733][root][WARNING] - |Q. 22||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,734][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,734][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,734][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,735][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,735][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,735][root][WARNING] - |Q. 66||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,735][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,737][root][WARNING] - |Q. 47||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,737][root][WARNING] - |Q. 47||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,737][root][INFO] - |Q. 47||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,738][root][WARNING] - |Q. 52||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,738][root][WARNING] - |Q. 52||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,738][root][INFO] - |Q. 52||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,739][root][WARNING] - |Q. 99||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,739][root][WARNING] - |Q. 99||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,739][root][INFO] - |Q. 99||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,741][root][WARNING] - |Q. 73||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,742][root][WARNING] - |Q. 73||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,742][root][INFO] - |Q. 73||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,742][root][WARNING] - |Q. 86||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,742][root][WARNING] - |Q. 86||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,742][root][INFO] - |Q. 86||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,743][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,743][root][WARNING] - |Q. 39||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,744][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,744][root][WARNING] - |Q. 67||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,744][root][WARNING] - |Q. 67||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,745][root][INFO] - |Q. 67||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,745][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,745][root][WARNING] - |Q. 89||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,746][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,746][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,746][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,746][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,747][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,747][root][WARNING] - |Q. 15||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,747][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,747][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,748][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,748][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,748][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,748][root][WARNING] - |Q. 36||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 19:14:14,748][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,749][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 19:14:14,750][root][WARNING] - |Q. 85||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 19:14:14,750][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 19:14:14,751][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 19:14:14,757][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 19:14:14,757][root][INFO] - Saved parsed outputs
[2025-03-06 19:14:14,757][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 19:14:14,758][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 19:14:14,758][root][INFO] - Saved parsing metadata
[2025-03-06 19:14:14,760][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 19:14:14,761][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 19:14:14,762][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 19:14:14,777][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 19:14:14,777][root][INFO] - Summary of metrics : {'label_accuracy': 0.31313131313131315, 'misclassification_rate': 0.6868686868686869, 'combined_accuracy': 0.1111111111111111, 'malformed_label': 0, 'malformed_domain': 53, 'total_predictions': 99, 'correct_predictions': 31, 'correct_label_and_domain': 11, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.0, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.0, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.07692307692307693, 'Civil_Procedure_accuracy': 0.125, 'Constitutional_Law_confidence': 0.09090909090909091, 'Contracts_confidence': 0.0, 'Criminal_Law_confidence': 0.20202020202020202, 'Evidence_confidence': 0.04040404040404041, 'Real_Property_confidence': 0.0707070707070707, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.06060606060606061, 'correct_domain_wrong_label': 35, 'correct_label_wrong_domain': 20, 'both_wrong': 33}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 19:14:22,267][root][INFO] - Setting global seed to 989
[2025-03-06 19:14:22,274][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 19:14:22,274][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 19:14:22,276][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 19:14:22,277][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 19:14:22,280][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 19:14:22,280][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 19:14:22,694][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 19:14:23,072][root][INFO] - Full model selected, loading model
[2025-03-06 19:14:39,385][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 19:14:39,385][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 19:14:45,431][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 19:14:45,433][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 19:14:45,433][root][INFO] - Starting inference
[2025-03-06 19:14:45,610][root][INFO] - Processing question number 0
[2025-03-06 19:14:45,612][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 19:15:15,917][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 19:15:46,973][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 19:16:17,579][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 19:16:48,661][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 19:17:19,173][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 19:17:49,637][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 19:18:20,938][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 19:18:51,738][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 19:19:22,169][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 19:19:53,249][root][INFO] - Processing question number 10
[2025-03-06 19:19:53,251][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 19:20:25,677][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 19:20:55,858][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 19:21:26,541][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 19:21:57,872][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 19:22:29,183][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 19:22:59,424][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 19:23:29,582][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 19:24:00,220][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 19:24:30,836][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 19:25:01,234][root][INFO] - Processing question number 20
[2025-03-06 19:25:01,237][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 19:25:31,833][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 19:26:02,662][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 19:26:32,888][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 19:27:03,048][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 19:27:33,967][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 19:28:04,623][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 19:28:36,100][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 19:29:06,715][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 19:29:37,511][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 19:30:07,598][root][INFO] - Processing question number 30
[2025-03-06 19:30:07,601][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 19:30:38,593][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 19:31:09,909][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 19:31:40,702][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 19:32:11,279][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 19:32:41,758][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 19:33:13,021][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 19:33:43,574][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 19:34:14,558][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 19:34:45,334][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 19:35:16,809][root][INFO] - Processing question number 40
[2025-03-06 19:35:16,813][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 19:35:47,644][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 19:36:18,466][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 19:36:49,798][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 19:37:21,070][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 19:37:51,563][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 19:38:22,386][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 19:38:54,396][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 19:39:24,286][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 19:39:54,918][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 19:40:26,279][root][INFO] - Processing question number 50
[2025-03-06 19:40:26,285][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 19:40:57,803][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 19:41:28,736][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 19:41:58,836][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 19:42:30,650][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 19:43:01,522][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 19:43:31,432][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 19:44:02,923][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 19:44:33,183][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 19:45:04,534][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 19:45:36,675][root][INFO] - Processing question number 60
[2025-03-06 19:45:36,681][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 19:46:06,924][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 19:46:37,522][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 19:47:08,792][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 19:47:39,010][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 19:48:09,769][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 19:48:40,588][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 19:49:11,434][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 19:49:42,532][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 19:50:13,448][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 19:50:44,885][root][INFO] - Processing question number 70
[2025-03-06 19:50:44,890][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 19:51:15,440][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 19:51:46,038][root][INFO] - Domain : Property, Question : 6
[2025-03-06 19:52:16,519][root][INFO] - Domain : Property, Question : 13
[2025-03-06 19:52:47,593][root][INFO] - Domain : Property, Question : 20
[2025-03-06 19:53:18,622][root][INFO] - Domain : Property, Question : 33
[2025-03-06 19:53:48,983][root][INFO] - Domain : Property, Question : 39
[2025-03-06 19:54:20,108][root][INFO] - Domain : Property, Question : 48
[2025-03-06 19:54:51,080][root][INFO] - Domain : Property, Question : 54
[2025-03-06 19:55:22,203][root][INFO] - Domain : Property, Question : 61
[2025-03-06 19:55:52,760][root][INFO] - Processing question number 80
[2025-03-06 19:55:52,766][root][INFO] - Domain : Property, Question : 67
[2025-03-06 19:56:23,769][root][INFO] - Domain : Property, Question : 75
[2025-03-06 19:56:54,763][root][INFO] - Domain : Property, Question : 83
[2025-03-06 19:57:25,255][root][INFO] - Domain : Property, Question : 89
[2025-03-06 19:57:55,784][root][INFO] - Domain : Property, Question : 97
[2025-03-06 19:58:27,130][root][INFO] - Domain : Property, Question : 100
[2025-03-06 19:58:58,201][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 19:59:29,336][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 19:59:59,827][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:00:30,771][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:01:00,988][root][INFO] - Processing question number 90
[2025-03-06 20:01:00,993][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:01:32,682][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:02:02,431][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:02:33,038][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:03:02,975][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:03:34,116][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:04:04,328][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:04:34,867][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:05:05,735][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:05:37,087][root][INFO] - Inference complete
[2025-03-06 20:05:37,087][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 20:05:37,095][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 20:05:37,096][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,097][root][WARNING] - |Q. 21||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,097][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,099][root][WARNING] - |Q. 69||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,099][root][WARNING] - |Q. 69||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,099][root][INFO] - |Q. 69||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,100][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,100][root][WARNING] - |Q. 70||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,100][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,101][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,101][root][WARNING] - |Q. 2||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,101][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,102][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,102][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:05:37,102][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,107][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,107][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,107][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,110][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,110][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,110][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,111][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,111][root][WARNING] - |Q. 59||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,112][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,113][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,113][root][WARNING] - |Q. 6||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,113][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,113][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,114][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,114][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,114][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,115][root][WARNING] - |Q. 33||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,115][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,115][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,115][root][WARNING] - |Q. 39||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,116][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,116][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,116][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:05:37,116][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,117][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,117][root][WARNING] - |Q. 75||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,117][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,118][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,118][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,118][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,119][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,119][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,119][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,120][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,120][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:05:37,120][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,121][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,122][root][WARNING] - |Q. 64||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,122][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,122][root][WARNING] - |Q. 74||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:05:37,122][root][WARNING] - |Q. 74||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:05:37,122][root][INFO] - |Q. 74||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:05:37,124][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 20:05:37,130][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 20:05:37,131][root][INFO] - Saved parsed outputs
[2025-03-06 20:05:37,131][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 20:05:37,133][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 20:05:37,133][root][INFO] - Saved parsing metadata
[2025-03-06 20:05:37,133][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 20:05:37,135][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
[2025-03-06 20:05:37,137][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_answer_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:05:37,183][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_1
[2025-03-06 20:05:37,183][root][INFO] - Summary of metrics : {'label_accuracy': 0.32323232323232326, 'misclassification_rate': 0.6767676767676767, 'combined_accuracy': 0.16161616161616163, 'malformed_label': 0, 'malformed_domain': 49, 'total_predictions': 99, 'correct_predictions': 32, 'correct_label_and_domain': 16, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.15384615384615385, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.125, 'Constitutional_Law_confidence': 0.1111111111111111, 'Contracts_confidence': 0.09090909090909091, 'Criminal_Law_confidence': 0.1919191919191919, 'Evidence_confidence': 0.030303030303030304, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.050505050505050504, 'correct_domain_wrong_label': 34, 'correct_label_wrong_domain': 16, 'both_wrong': 33}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 20:05:45,940][root][INFO] - Setting global seed to 206
[2025-03-06 20:05:45,949][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 20:05:45,949][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 20:05:45,950][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 20:05:45,953][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:05:45,958][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:05:45,959][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 20:05:46,116][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:05:46,381][root][INFO] - Full model selected, loading model
[2025-03-06 20:06:05,388][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:07:07,145][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:07:07,146][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:07:32,437][root][INFO] - Peft model loaded successfully
[2025-03-06 20:07:38,294][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:07:38,295][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:07:38,296][root][INFO] - Starting inference
[2025-03-06 20:07:38,503][root][INFO] - Processing question number 0
[2025-03-06 20:07:38,505][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 20:08:09,748][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 20:08:41,209][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 20:09:12,817][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 20:09:43,958][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 20:10:14,447][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 20:10:44,411][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 20:11:14,886][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 20:11:45,650][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 20:12:09,775][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 20:12:33,782][root][INFO] - Processing question number 10
[2025-03-06 20:12:33,785][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 20:13:03,663][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 20:13:34,115][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 20:14:04,721][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 20:14:34,780][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 20:15:05,771][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 20:15:36,442][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:16:07,021][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 20:16:37,472][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 20:17:08,439][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 20:17:25,805][root][INFO] - Processing question number 20
[2025-03-06 20:17:25,807][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 20:17:55,765][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 20:18:26,547][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:18:56,872][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 20:19:27,328][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 20:19:57,862][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 20:20:29,003][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 20:20:59,637][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 20:21:30,428][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:22:01,060][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 20:22:32,311][root][INFO] - Processing question number 30
[2025-03-06 20:22:32,315][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 20:23:03,005][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 20:23:33,498][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 20:24:03,939][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 20:24:35,154][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 20:25:05,726][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 20:25:36,422][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:26:07,063][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 20:26:38,376][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:27:09,179][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 20:27:40,026][root][INFO] - Processing question number 40
[2025-03-06 20:27:40,030][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 20:28:10,817][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 20:28:41,371][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 20:29:12,502][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 20:29:42,468][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 20:30:13,788][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 20:30:44,563][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:31:15,182][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:31:45,971][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 20:32:16,659][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 20:32:47,658][root][INFO] - Processing question number 50
[2025-03-06 20:32:47,662][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 20:33:18,974][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 20:33:49,209][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 20:34:20,529][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:34:51,443][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 20:35:21,736][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 20:35:52,247][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 20:36:23,685][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 20:36:54,906][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 20:37:26,127][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 20:37:57,069][root][INFO] - Processing question number 60
[2025-03-06 20:37:57,074][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 20:38:27,815][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 20:38:58,618][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 20:39:30,128][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 20:40:01,125][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 20:40:32,036][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 20:40:55,309][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 20:41:25,566][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 20:41:55,656][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 20:42:26,067][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 20:42:56,405][root][INFO] - Processing question number 70
[2025-03-06 20:42:56,410][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 20:43:18,119][root][INFO] - Domain : Property, Question : 9
[2025-03-06 20:43:48,938][root][INFO] - Domain : Property, Question : 17
[2025-03-06 20:44:19,945][root][INFO] - Domain : Property, Question : 25
[2025-03-06 20:44:51,477][root][INFO] - Domain : Property, Question : 30
[2025-03-06 20:45:21,816][root][INFO] - Domain : Property, Question : 36
[2025-03-06 20:45:52,768][root][INFO] - Domain : Property, Question : 46
[2025-03-06 20:46:24,775][root][INFO] - Domain : Property, Question : 53
[2025-03-06 20:46:55,732][root][INFO] - Domain : Property, Question : 59
[2025-03-06 20:47:25,721][root][INFO] - Domain : Property, Question : 66
[2025-03-06 20:47:56,128][root][INFO] - Processing question number 80
[2025-03-06 20:47:56,133][root][INFO] - Domain : Property, Question : 69
[2025-03-06 20:48:24,381][root][INFO] - Domain : Property, Question : 81
[2025-03-06 20:48:55,732][root][INFO] - Domain : Property, Question : 88
[2025-03-06 20:49:27,016][root][INFO] - Domain : Property, Question : 91
[2025-03-06 20:49:57,983][root][INFO] - Domain : Property, Question : 94
[2025-03-06 20:50:29,906][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:51:00,473][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:51:31,646][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 20:52:03,308][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 20:52:33,552][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:53:04,397][root][INFO] - Processing question number 90
[2025-03-06 20:53:04,404][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 20:53:35,246][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 20:54:06,479][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:54:37,452][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 20:55:08,226][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 20:55:39,669][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 20:56:11,000][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 20:56:41,981][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 20:57:12,549][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 20:57:42,685][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:58:14,061][root][INFO] - Inference complete
[2025-03-06 20:58:14,061][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:58:14,071][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:58:14,072][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,073][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:58:14,073][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,074][root][WARNING] - |Q. 56||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,074][root][WARNING] - |Q. 56||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:58:14,074][root][INFO] - |Q. 56||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,076][root][WARNING] - |Q. 29||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,076][root][WARNING] - |Q. 29||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,077][root][INFO] - |Q. 29||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,078][root][WARNING] - |Q. 83||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,078][root][WARNING] - |Q. 83||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:58:14,078][root][INFO] - |Q. 83||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,079][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,079][root][WARNING] - |Q. 96||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,079][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,080][root][WARNING] - |Q. 28||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,080][root][WARNING] - |Q. 28||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:58:14,080][root][INFO] - |Q. 28||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,081][root][WARNING] - |Q. 34||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,081][root][WARNING] - |Q. 34||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,081][root][INFO] - |Q. 34||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,081][root][WARNING] - |Q. 42||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,082][root][WARNING] - |Q. 42||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,082][root][INFO] - |Q. 42||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,082][root][WARNING] - |Q. 48||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,082][root][WARNING] - |Q. 48||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:58:14,082][root][INFO] - |Q. 48||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,083][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,083][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:58:14,083][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,084][root][WARNING] - |Q. 87||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,084][root][WARNING] - |Q. 87||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,084][root][INFO] - |Q. 87||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,084][root][WARNING] - |Q. 97||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,085][root][WARNING] - |Q. 97||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,085][root][INFO] - |Q. 97||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,087][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,087][root][WARNING] - |Q. 98||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,087][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,088][root][WARNING] - |Q. 33||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,088][root][WARNING] - |Q. 33||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,088][root][INFO] - |Q. 33||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,089][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,090][root][WARNING] - |Q. 75||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,090][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,090][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,090][root][WARNING] - |Q. 82||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,091][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,091][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,091][root][WARNING] - |Q. 93||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,091][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,092][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,092][root][WARNING] - |Q. 25||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,092][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,092][root][WARNING] - |Q. 36||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,093][root][WARNING] - |Q. 36||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:58:14,093][root][INFO] - |Q. 36||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,094][root][WARNING] - |Q. 94||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,094][root][WARNING] - |Q. 94||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,095][root][INFO] - |Q. 94||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,095][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,095][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,095][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,096][root][WARNING] - |Q. 18||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,096][root][WARNING] - |Q. 18||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,096][root][INFO] - |Q. 18||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,097][root][WARNING] - |Q. 45||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,097][root][WARNING] - |Q. 45||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:58:14,097][root][INFO] - |Q. 45||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,098][root][WARNING] - |Q. 67||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,098][root][WARNING] - |Q. 67||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,098][root][INFO] - |Q. 67||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,099][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:58:14,099][root][WARNING] - |Q. 95||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:58:14,099][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:58:14,100][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:58:14,107][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:58:14,107][root][INFO] - Saved parsed outputs
[2025-03-06 20:58:14,107][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:58:14,108][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:58:14,109][root][INFO] - Saved parsing metadata
[2025-03-06 20:58:14,110][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:58:14,112][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:58:14,114][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 20:58:14,165][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_2
[2025-03-06 20:58:14,165][root][INFO] - Summary of metrics : {'label_accuracy': 0.29, 'misclassification_rate': 0.71, 'combined_accuracy': 0.11, 'malformed_label': 0, 'malformed_domain': 51, 'total_predictions': 100, 'correct_predictions': 29, 'correct_label_and_domain': 11, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.0, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.0, 'Torts_accuracy': 0.07142857142857142, 'Civil_Procedure_accuracy': 0.0, 'Constitutional_Law_confidence': 0.09, 'Contracts_confidence': 0.0, 'Criminal_Law_confidence': 0.22, 'Evidence_confidence': 0.05, 'Real_Property_confidence': 0.05, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.06, 'correct_domain_wrong_label': 38, 'correct_label_wrong_domain': 18, 'both_wrong': 33}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 20:58:22,184][root][INFO] - Setting global seed to 206
[2025-03-06 20:58:22,191][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 20:58:22,191][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 20:58:22,193][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 20:58:22,194][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:58:22,197][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:58:22,197][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 20:58:22,366][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:58:22,659][root][INFO] - Full model selected, loading model
[2025-03-06 20:58:40,887][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 20:58:40,887][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 20:58:46,965][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:58:46,967][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 20:58:46,967][root][INFO] - Starting inference
[2025-03-06 20:58:47,167][root][INFO] - Processing question number 0
[2025-03-06 20:58:47,170][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 20:59:17,841][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 20:59:49,185][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 21:00:20,690][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 21:00:51,638][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 21:01:22,011][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 21:01:51,852][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 21:02:22,195][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 21:02:52,869][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 21:03:22,783][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 21:03:53,284][root][INFO] - Processing question number 10
[2025-03-06 21:03:53,286][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 21:04:23,045][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 21:04:53,374][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 21:05:23,807][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 21:05:53,742][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 21:06:24,619][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 21:06:55,098][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:07:25,510][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 21:07:55,819][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 21:08:26,655][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 21:08:57,583][root][INFO] - Processing question number 20
[2025-03-06 21:08:57,586][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 21:09:27,371][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 21:09:58,017][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:10:28,200][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 21:10:58,526][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 21:11:28,912][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 21:11:59,831][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 21:12:30,276][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 21:13:00,940][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:13:31,391][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 21:14:02,519][root][INFO] - Processing question number 30
[2025-03-06 21:14:02,524][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 21:14:33,020][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 21:15:03,377][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 21:15:33,694][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 21:16:04,795][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 21:16:35,216][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 21:17:05,714][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:17:36,169][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 21:18:07,363][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:18:38,037][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 21:19:08,738][root][INFO] - Processing question number 40
[2025-03-06 21:19:08,742][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 21:19:39,408][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 21:20:09,822][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 21:20:40,739][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 21:21:10,569][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 21:21:41,776][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 21:22:12,412][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:22:42,840][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:23:13,502][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 21:23:44,007][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 21:24:14,885][root][INFO] - Processing question number 50
[2025-03-06 21:24:14,889][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 21:24:46,086][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 21:25:16,132][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 21:25:47,323][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:26:18,093][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 21:26:48,246][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 21:27:18,621][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 21:27:49,936][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 21:28:21,031][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 21:28:52,128][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 21:29:22,954][root][INFO] - Processing question number 60
[2025-03-06 21:29:22,958][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 21:29:53,558][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 21:30:24,184][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 21:30:55,508][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 21:31:26,526][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 21:31:57,685][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 21:32:28,014][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 21:32:58,097][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 21:33:28,037][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 21:33:58,282][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 21:34:28,474][root][INFO] - Processing question number 70
[2025-03-06 21:34:28,478][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 21:34:59,349][root][INFO] - Domain : Property, Question : 9
[2025-03-06 21:35:30,008][root][INFO] - Domain : Property, Question : 17
[2025-03-06 21:36:00,876][root][INFO] - Domain : Property, Question : 25
[2025-03-06 21:36:32,239][root][INFO] - Domain : Property, Question : 30
[2025-03-06 21:37:02,410][root][INFO] - Domain : Property, Question : 36
[2025-03-06 21:37:33,227][root][INFO] - Domain : Property, Question : 46
[2025-03-06 21:38:05,027][root][INFO] - Domain : Property, Question : 53
[2025-03-06 21:38:35,858][root][INFO] - Domain : Property, Question : 59
[2025-03-06 21:39:05,689][root][INFO] - Domain : Property, Question : 66
[2025-03-06 21:39:35,918][root][INFO] - Processing question number 80
[2025-03-06 21:39:35,924][root][INFO] - Domain : Property, Question : 69
[2025-03-06 21:40:07,097][root][INFO] - Domain : Property, Question : 81
[2025-03-06 21:40:38,309][root][INFO] - Domain : Property, Question : 88
[2025-03-06 21:41:09,448][root][INFO] - Domain : Property, Question : 91
[2025-03-06 21:41:40,243][root][INFO] - Domain : Property, Question : 94
[2025-03-06 21:42:11,973][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:42:42,346][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:43:13,275][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 21:43:44,783][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 21:44:15,448][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:44:46,140][root][INFO] - Processing question number 90
[2025-03-06 21:44:46,146][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 21:45:16,836][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 21:45:47,930][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:46:18,757][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 21:46:49,386][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 21:47:20,678][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 21:47:51,875][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 21:48:22,721][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 21:48:53,116][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 21:49:23,089][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:49:54,306][root][INFO] - Inference complete
[2025-03-06 21:49:54,307][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 21:49:54,317][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 21:49:54,318][root][WARNING] - |Q. 1||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,318][root][WARNING] - |Q. 1||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,319][root][INFO] - |Q. 1||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,320][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,320][root][WARNING] - |Q. 13||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,320][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,322][root][WARNING] - |Q. 62||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,322][root][WARNING] - |Q. 62||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,322][root][INFO] - |Q. 62||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,323][root][WARNING] - |Q. 78||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,323][root][WARNING] - |Q. 78||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,323][root][INFO] - |Q. 78||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,325][root][WARNING] - |Q. 83||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,326][root][WARNING] - |Q. 83||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,326][root][INFO] - |Q. 83||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,327][root][WARNING] - |Q. 28||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,327][root][WARNING] - |Q. 28||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:49:54,327][root][INFO] - |Q. 28||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,328][root][WARNING] - |Q. 34||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,328][root][WARNING] - |Q. 34||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,328][root][INFO] - |Q. 34||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,329][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,329][root][WARNING] - |Q. 58||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,329][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,329][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,330][root][WARNING] - |Q. 65||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,330][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,331][root][WARNING] - |Q. 10||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,331][root][WARNING] - |Q. 10||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,332][root][INFO] - |Q. 10||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,334][root][WARNING] - |Q. 33||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,335][root][WARNING] - |Q. 33||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,335][root][INFO] - |Q. 33||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,335][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,335][root][WARNING] - |Q. 40||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,336][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,336][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,337][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:49:54,337][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,338][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,338][root][WARNING] - |Q. 25||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,338][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,339][root][WARNING] - |Q. 46||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,339][root][WARNING] - |Q. 46||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,339][root][INFO] - |Q. 46||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,340][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,340][root][WARNING] - |Q. 59||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,340][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,340][root][WARNING] - |Q. 66||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,341][root][WARNING] - |Q. 66||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,341][root][INFO] - |Q. 66||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,341][root][WARNING] - |Q. 81||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,342][root][WARNING] - |Q. 81||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,342][root][INFO] - |Q. 81||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,343][root][WARNING] - |Q. 94||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,343][root][WARNING] - |Q. 94||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,343][root][INFO] - |Q. 94||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,344][root][WARNING] - |Q. 22||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,344][root][WARNING] - |Q. 22||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:49:54,344][root][INFO] - |Q. 22||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,345][root][WARNING] - |Q. 67||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:49:54,346][root][WARNING] - |Q. 67||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:49:54,346][root][INFO] - |Q. 67||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:49:54,348][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 21:49:54,354][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 21:49:54,354][root][INFO] - Saved parsed outputs
[2025-03-06 21:49:54,354][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 21:49:54,356][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 21:49:54,356][root][INFO] - Saved parsing metadata
[2025-03-06 21:49:54,357][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 21:49:54,359][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
[2025-03-06 21:49:54,360][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_answer_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 21:49:54,407][root][INFO] - Evaluation completed for json_answer_first_few_shot_structured, on test_set_2
[2025-03-06 21:49:54,407][root][INFO] - Summary of metrics : {'label_accuracy': 0.32, 'misclassification_rate': 0.6799999999999999, 'combined_accuracy': 0.13, 'malformed_label': 0, 'malformed_domain': 45, 'total_predictions': 100, 'correct_predictions': 32, 'correct_label_and_domain': 13, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.0, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.0, 'Torts_accuracy': 0.07142857142857142, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.12, 'Contracts_confidence': 0.02, 'Criminal_Law_confidence': 0.22, 'Evidence_confidence': 0.05, 'Real_Property_confidence': 0.03, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.08, 'correct_domain_wrong_label': 42, 'correct_label_wrong_domain': 19, 'both_wrong': 26}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 1 to status completed with exit code 0
Eval status update completed for job 1
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '1', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 1 to status running with exit code None
Eval status update completed for job 1
[2025-03-06 21:50:04,701][root][INFO] - Setting global seed to 206
[2025-03-06 21:50:04,710][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 21:50:04,710][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : structured 
 Response Format : json 
[2025-03-06 21:50:04,711][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 21:50:04,713][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:50:04,719][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:50:04,719][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 21:50:04,873][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:50:05,143][root][INFO] - Full model selected, loading model
[2025-03-06 21:50:28,143][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
