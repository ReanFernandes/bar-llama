Starting job 20 at Thu Mar  6 18:58:33 CET 2025
Configuration: model=llama3 tokenizer=llama3 dataset=all_domains_10_samples prompt=json_answer_first_few_shot_unstructured train=json_answer_first_few_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '20', 'training']
Updating job 20 to status training with exit code None
Status update completed for job 20
[2025-03-06 18:59:01,962][root][INFO] - Global seed set to 314
[2025-03-06 18:59:01,963][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 18:59:01,964][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 18:59:01,964][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 18:59:01,964][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 18:59:01,964][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 18:59:02,018][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 18:59:02,053][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 18:59:02,091][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 18:59:02,113][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 18:59:03,109][root][INFO] - Tokenizer meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 18:59:27,981][root][INFO] - Quantised model meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 18:59:59,512][root][INFO] - Model prepared for kbit training
[2025-03-06 18:59:59,513][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'v_proj', 'k_proj', 'down_proj', 'up_proj', 'gate_proj', 'o_proj', 'q_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 19:00:01,278][root][INFO] - Lora adapter added to model
[2025-03-06 19:00:01,282][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_answer_first_few_shot_unstructured
[2025-03-06 19:00:01,583][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.8312, 'grad_norm': 0.5030161142349243, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.8226, 'grad_norm': 0.4132191240787506, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.6183, 'grad_norm': 0.3314892053604126, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.4739, 'grad_norm': 0.39765048027038574, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.1659, 'grad_norm': 0.4314953088760376, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.8234, 'grad_norm': 0.4808138906955719, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.6945, 'grad_norm': 0.25248798727989197, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.5866, 'grad_norm': 0.3208150863647461, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.6654, 'grad_norm': 0.20364783704280853, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.5866, 'grad_norm': 0.18625624477863312, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.5663, 'grad_norm': 0.19193652272224426, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.5693, 'grad_norm': 0.21182739734649658, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.5465, 'grad_norm': 0.19335490465164185, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.5411, 'grad_norm': 0.24825838208198547, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.474, 'grad_norm': 0.22503598034381866, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.4732, 'grad_norm': 0.21869085729122162, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.4895, 'grad_norm': 0.21493232250213623, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.4178, 'grad_norm': 0.2264328896999359, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.4569, 'grad_norm': 0.29156139492988586, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.4363, 'grad_norm': 0.23843544721603394, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.4364, 'grad_norm': 0.23856334388256073, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.3473, 'grad_norm': 0.24854864180088043, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.4269, 'grad_norm': 0.2917148172855377, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.3448, 'grad_norm': 0.2691066861152649, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.3924, 'grad_norm': 0.26165199279785156, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.4096, 'grad_norm': 0.2906138002872467, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.3963, 'grad_norm': 0.27983930706977844, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.361, 'grad_norm': 0.2693720757961273, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.3612, 'grad_norm': 0.46361982822418213, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.2989, 'grad_norm': 0.6409990191459656, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.2658, 'grad_norm': 0.9021474123001099, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.2355, 'grad_norm': 0.7751797437667847, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.2482, 'grad_norm': 0.5359278917312622, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.1405, 'grad_norm': 0.4024280607700348, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.1662, 'grad_norm': 0.5467926263809204, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.1341, 'grad_norm': 0.6872882843017578, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.1908, 'grad_norm': 0.7254897356033325, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.0703, 'grad_norm': 0.7107929587364197, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.1126, 'grad_norm': 0.568631112575531, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.0718, 'grad_norm': 0.3621402680873871, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.0662, 'grad_norm': 0.4620600640773773, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.0362, 'grad_norm': 0.40234366059303284, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.0437, 'grad_norm': 0.40994516015052795, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.0306, 'grad_norm': 0.17896662652492523, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.0288, 'grad_norm': 0.29012638330459595, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.0273, 'grad_norm': 0.4144211709499359, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0221, 'grad_norm': 0.23437416553497314, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.0195, 'grad_norm': 0.14595945179462433, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0193, 'grad_norm': 0.17100141942501068, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0197, 'grad_norm': 0.13378438353538513, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 3981.9333, 'train_samples_per_second': 0.264, 'train_steps_per_second': 0.038, 'train_loss': 0.4392706012974183, 'epoch': 15.0}
[2025-03-06 20:06:31,170][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_answer_first_few_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '20', 'trained', '0']
Updating job 20 to status trained with exit code 0
Status update completed for job 20
Starting evaluations for job 20
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 20:06:40,163][root][INFO] - Setting global seed to 206
[2025-03-06 20:06:40,168][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:06:40,168][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:06:40,170][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:06:40,171][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:06:40,173][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:06:40,174][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:06:40,349][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:06:41,027][root][INFO] - Full model selected, loading model
[2025-03-06 20:07:12,167][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:09:02,347][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:09:02,347][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:09:36,390][root][INFO] - Peft model loaded successfully
[2025-03-06 20:09:44,048][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:09:44,050][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:09:44,050][root][INFO] - Starting inference
[2025-03-06 20:09:44,283][root][INFO] - Processing question number 0
[2025-03-06 20:09:44,285][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:09:52,449][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:10:10,322][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:10:26,835][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:10:45,036][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:10:58,331][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:11:14,498][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:11:31,178][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:11:56,645][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:12:13,550][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:12:36,816][root][INFO] - Processing question number 10
[2025-03-06 20:12:36,818][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:12:48,166][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:13:01,698][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:13:10,120][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:13:26,897][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:13:34,446][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:13:39,889][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:13:46,823][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:13:53,631][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:14:01,408][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:14:11,203][root][INFO] - Processing question number 20
[2025-03-06 20:14:11,205][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:14:21,017][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:14:27,004][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:14:32,534][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:14:45,769][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:14:52,256][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:14:59,439][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:15:13,985][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:15:24,408][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:15:33,109][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:15:38,649][root][INFO] - Processing question number 30
[2025-03-06 20:15:38,652][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:15:44,964][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:15:49,317][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:15:59,543][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:16:09,067][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:16:18,490][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:16:34,458][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:16:43,796][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:16:52,068][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:16:59,621][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:17:07,215][root][INFO] - Processing question number 40
[2025-03-06 20:17:07,218][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:17:17,204][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:17:36,349][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:17:43,944][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:17:51,638][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:18:07,469][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:18:12,325][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:18:27,859][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:18:32,223][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:18:39,476][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:18:50,221][root][INFO] - Processing question number 50
[2025-03-06 20:18:50,224][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:19:04,668][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:19:16,295][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:19:35,601][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:19:48,007][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:19:55,785][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:20:04,156][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:20:10,376][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:20:18,915][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:20:29,695][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:20:38,455][root][INFO] - Processing question number 60
[2025-03-06 20:20:38,459][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:20:44,476][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:20:49,747][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:20:58,085][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:21:07,211][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:21:14,647][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:21:32,640][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:21:37,690][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:21:45,210][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:21:52,565][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:21:59,023][root][INFO] - Processing question number 70
[2025-03-06 20:21:59,027][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:22:05,863][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:22:11,136][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:22:15,296][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:22:33,677][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:22:41,361][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:22:50,988][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:23:10,946][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:23:39,571][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:23:58,902][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:24:06,337][root][INFO] - Processing question number 80
[2025-03-06 20:24:06,341][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:24:21,644][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:24:27,953][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:24:32,973][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:24:39,509][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:24:45,375][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:24:55,451][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:25:02,558][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:25:09,197][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:25:16,363][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:25:29,446][root][INFO] - Processing question number 90
[2025-03-06 20:25:29,451][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:25:37,346][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:25:41,065][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:25:49,731][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:25:54,332][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:26:03,924][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:26:09,645][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:26:15,598][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:26:30,586][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:26:41,871][root][INFO] - Inference complete
[2025-03-06 20:26:41,871][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:26:41,878][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:26:41,879][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,879][root][WARNING] - |Q. 7||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,879][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,880][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,880][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,880][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,881][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,881][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,881][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,881][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,881][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,882][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,882][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,882][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,882][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,882][root][WARNING] - |Q. 69||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,883][root][WARNING] - |Q. 69||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,883][root][INFO] - |Q. 69||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,884][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,884][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,884][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,885][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,885][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,886][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,889][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,889][root][WARNING] - |Q. 53||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,889][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,892][root][WARNING] - |Q. 30||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:26:41,892][root][WARNING] - |Q. 30||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:26:41,892][root][INFO] - |Q. 30||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:26:41,894][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:26:41,899][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:26:41,899][root][INFO] - Saved parsed outputs
[2025-03-06 20:26:41,899][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:26:41,900][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:26:41,900][root][INFO] - Saved parsing metadata
[2025-03-06 20:26:41,901][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:26:41,903][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:26:41,904][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:26:41,958][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:26:41,959][root][INFO] - Summary of metrics : {'label_accuracy': 0.47474747474747475, 'misclassification_rate': 0.5252525252525253, 'combined_accuracy': 0.41414141414141414, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 47, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.13131313131313133, 'Criminal_Law_confidence': 0.16161616161616163, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.18181818181818182, 'Civil_Procedure_confidence': 0.12121212121212122, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 6, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 20:26:49,347][root][INFO] - Setting global seed to 206
[2025-03-06 20:26:49,353][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:26:49,354][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:26:49,355][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:26:49,357][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:26:49,360][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:26:49,360][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:26:49,578][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:26:50,198][root][INFO] - Full model selected, loading model
[2025-03-06 20:27:23,461][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:29:15,653][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:29:15,653][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:29:47,868][root][INFO] - Peft model loaded successfully
[2025-03-06 20:29:55,592][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:29:55,593][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:55,593][root][INFO] - Starting inference
[2025-03-06 20:29:55,833][root][INFO] - Processing question number 0
[2025-03-06 20:29:55,835][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:30:07,170][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:30:19,011][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:30:33,464][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:30:50,873][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:31:07,531][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:31:23,004][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:31:39,956][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:31:56,696][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:32:25,154][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:32:56,488][root][INFO] - Processing question number 10
[2025-03-06 20:32:56,490][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:33:07,917][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:33:19,512][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:33:26,557][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:33:34,049][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:33:42,188][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:33:49,710][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:33:58,312][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:34:08,376][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:34:18,190][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:34:28,843][root][INFO] - Processing question number 20
[2025-03-06 20:34:28,845][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:34:40,865][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:34:46,501][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:34:54,213][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:35:02,704][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:35:10,220][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:35:16,465][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:35:25,067][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:35:35,071][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:35:49,595][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:35:56,388][root][INFO] - Processing question number 30
[2025-03-06 20:35:56,391][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:36:02,745][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:36:07,324][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:36:16,824][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:36:26,370][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:36:36,998][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:36:47,305][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:36:59,844][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:37:05,752][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:37:14,687][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:37:34,517][root][INFO] - Processing question number 40
[2025-03-06 20:37:34,520][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:37:50,569][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:37:59,709][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:38:06,555][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:38:14,400][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:38:25,912][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:38:30,791][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:38:47,737][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:38:52,032][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:39:03,145][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:39:08,266][root][INFO] - Processing question number 50
[2025-03-06 20:39:08,269][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:39:27,454][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:39:40,875][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:40:05,695][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:40:12,252][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:40:23,216][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:40:30,485][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:40:37,503][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:40:51,101][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:41:10,629][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:41:19,451][root][INFO] - Processing question number 60
[2025-03-06 20:41:19,454][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:41:24,836][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:41:31,713][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:41:42,963][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:41:55,459][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:42:04,337][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:42:13,501][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:42:19,571][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:42:27,139][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:42:34,551][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:42:41,498][root][INFO] - Processing question number 70
[2025-03-06 20:42:41,502][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:42:52,481][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:42:57,543][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:43:03,042][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:43:20,600][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:43:32,442][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:43:39,633][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:43:53,739][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:44:08,826][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:44:17,985][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:44:27,593][root][INFO] - Processing question number 80
[2025-03-06 20:44:27,608][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:44:39,382][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:44:46,186][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:44:51,145][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:45:01,226][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:45:06,595][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:45:18,963][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:45:37,309][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:45:44,039][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:46:00,316][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:46:11,207][root][INFO] - Processing question number 90
[2025-03-06 20:46:11,212][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:46:25,950][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:46:29,696][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:46:47,355][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:46:52,614][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:46:59,220][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:47:04,153][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:47:08,964][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:47:16,113][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:47:25,010][root][INFO] - Inference complete
[2025-03-06 20:47:25,010][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:47:25,016][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:47:25,018][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,018][root][WARNING] - |Q. 21||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,018][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,019][root][WARNING] - |Q. 28||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,019][root][WARNING] - |Q. 28||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,019][root][INFO] - |Q. 28||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,019][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,019][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,020][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,020][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,020][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,020][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,020][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,021][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,021][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,021][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,021][root][WARNING] - |Q. 63||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:47:25,022][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,022][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:47:25,022][root][WARNING] - |Q. 69||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,022][root][WARNING] - |Q. 69||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,022][root][INFO] - |Q. 69||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,023][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,023][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,023][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,023][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,023][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,023][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,024][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,025][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,025][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,029][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,029][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,029][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,029][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:47:25,030][root][WARNING] - |Q. 59||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:47:25,030][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:47:25,034][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:47:25,039][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:47:25,039][root][INFO] - Saved parsed outputs
[2025-03-06 20:47:25,039][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:47:25,040][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:47:25,040][root][INFO] - Saved parsing metadata
[2025-03-06 20:47:25,041][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:47:25,042][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:47:25,044][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:47:25,067][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:47:25,067][root][INFO] - Summary of metrics : {'label_accuracy': 0.47474747474747475, 'misclassification_rate': 0.5252525252525253, 'combined_accuracy': 0.41414141414141414, 'malformed_label': 0, 'malformed_domain': 13, 'total_predictions': 99, 'correct_predictions': 47, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.12121212121212122, 'Criminal_Law_confidence': 0.1717171717171717, 'Evidence_confidence': 0.10101010101010101, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.1919191919191919, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 6, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 20:47:32,156][root][INFO] - Setting global seed to 206
[2025-03-06 20:47:32,162][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:47:32,162][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:47:32,163][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:47:32,165][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:47:32,168][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:47:32,168][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:47:32,337][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:47:32,966][root][INFO] - Full model selected, loading model
[2025-03-06 20:47:58,200][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:49:51,709][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:49:51,710][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:50:27,247][root][INFO] - Peft model loaded successfully
[2025-03-06 20:50:35,025][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:50:35,027][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:50:35,027][root][INFO] - Starting inference
[2025-03-06 20:50:35,256][root][INFO] - Processing question number 0
[2025-03-06 20:50:35,259][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:50:45,065][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:50:57,157][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:51:08,014][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:51:20,647][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:51:29,966][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:51:42,095][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:52:07,766][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:52:39,009][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:52:50,218][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:53:01,680][root][INFO] - Processing question number 10
[2025-03-06 20:53:01,682][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:53:07,674][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:53:13,943][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:53:27,751][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:53:44,077][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:53:48,168][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:53:55,009][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:54:04,052][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:54:13,518][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:54:23,675][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:54:31,418][root][INFO] - Processing question number 20
[2025-03-06 20:54:31,420][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:54:44,846][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:54:50,671][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:54:59,460][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:55:09,963][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:55:16,343][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:55:24,852][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:55:36,995][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:55:47,303][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:56:06,355][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:56:12,348][root][INFO] - Processing question number 30
[2025-03-06 20:56:12,351][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:56:23,014][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:56:30,763][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:56:42,065][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:56:52,996][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:57:03,486][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:57:09,203][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:57:21,345][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:57:27,202][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:57:34,455][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:57:45,614][root][INFO] - Processing question number 40
[2025-03-06 20:57:45,617][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:57:55,766][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:58:10,537][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:58:20,535][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:58:32,999][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:58:41,351][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:58:51,917][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:59:00,297][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:59:04,686][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:59:11,931][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:59:21,342][root][INFO] - Processing question number 50
[2025-03-06 20:59:21,346][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:59:39,658][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:59:52,027][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:59:59,839][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:00:09,525][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:00:15,097][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:00:22,078][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:00:31,807][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:00:39,333][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:00:49,140][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:00:56,649][root][INFO] - Processing question number 60
[2025-03-06 21:00:56,652][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:01:01,454][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:01:09,222][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:01:16,225][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:01:27,342][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:01:36,316][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:01:42,574][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:01:48,347][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:02:08,771][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:02:13,815][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:02:22,506][root][INFO] - Processing question number 70
[2025-03-06 21:02:22,510][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:02:32,399][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:02:39,721][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:02:44,636][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:02:50,645][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:03:01,373][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:03:11,753][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:03:36,289][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:03:51,028][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:03:59,183][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:04:06,031][root][INFO] - Processing question number 80
[2025-03-06 21:04:06,035][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:04:20,382][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:04:26,980][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:04:31,940][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:04:43,254][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:04:54,414][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:05:13,476][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:05:25,100][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:05:32,372][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:05:39,679][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:05:50,823][root][INFO] - Processing question number 90
[2025-03-06 21:05:50,830][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:06:12,571][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:06:18,814][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:06:24,243][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:06:29,359][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:06:38,964][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:06:44,288][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:06:54,858][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:07:04,739][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:07:14,550][root][INFO] - Inference complete
[2025-03-06 21:07:14,551][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:07:14,556][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:07:14,558][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:07:14,558][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:07:14,559][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:07:14,559][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:07:14,559][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:07:14,559][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:07:14,560][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:07:14,560][root][WARNING] - |Q. 49||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:07:14,560][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:07:14,560][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:07:14,561][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:07:14,561][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:07:14,561][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:07:14,563][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:07:14,564][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:07:14,564][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:07:14,565][root][WARNING] - |Q. 81||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:07:14,565][root][WARNING] - |Q. 81||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:07:14,565][root][INFO] - |Q. 81||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:07:14,570][root][WARNING] - |Q. 15||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:07:14,570][root][WARNING] - |Q. 15||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:07:14,570][root][INFO] - |Q. 15||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:07:14,572][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:07:14,577][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:07:14,577][root][INFO] - Saved parsed outputs
[2025-03-06 21:07:14,577][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:07:14,579][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:07:14,579][root][INFO] - Saved parsing metadata
[2025-03-06 21:07:14,579][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:07:14,581][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:07:14,582][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:07:14,618][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:07:14,618][root][INFO] - Summary of metrics : {'label_accuracy': 0.48484848484848486, 'misclassification_rate': 0.5151515151515151, 'combined_accuracy': 0.4444444444444444, 'malformed_label': 0, 'malformed_domain': 9, 'total_predictions': 99, 'correct_predictions': 48, 'correct_label_and_domain': 44, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.13131313131313133, 'Criminal_Law_confidence': 0.16161616161616163, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1717171717171717, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 4, 'both_wrong': 5}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 21:07:22,199][root][INFO] - Setting global seed to 989
[2025-03-06 21:07:22,204][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:07:22,204][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:07:22,206][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:07:22,207][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:07:22,210][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:07:22,210][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:07:22,367][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:07:22,924][root][INFO] - Full model selected, loading model
[2025-03-06 21:07:47,940][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:09:41,969][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:09:41,980][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:10:18,394][root][INFO] - Peft model loaded successfully
[2025-03-06 21:10:25,776][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:10:25,779][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:10:25,779][root][INFO] - Starting inference
[2025-03-06 21:10:26,003][root][INFO] - Processing question number 0
[2025-03-06 21:10:26,006][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:10:34,196][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:10:52,061][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:11:08,545][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:11:26,720][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:11:40,000][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:11:56,141][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:12:12,799][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:12:38,219][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:12:55,110][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:13:18,362][root][INFO] - Processing question number 10
[2025-03-06 21:13:18,364][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:13:29,700][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:13:43,206][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:13:51,611][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:14:08,373][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:14:15,906][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:14:21,346][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:14:28,270][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:14:35,069][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:14:42,836][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:14:52,617][root][INFO] - Processing question number 20
[2025-03-06 21:14:52,620][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:15:02,420][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:15:08,402][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:15:13,924][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:15:27,194][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:15:33,714][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:15:40,931][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:15:55,548][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:16:05,979][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:16:14,703][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:16:20,267][root][INFO] - Processing question number 30
[2025-03-06 21:16:20,270][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:16:26,619][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:16:30,989][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:16:41,219][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:16:50,774][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:17:00,256][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:17:16,308][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:17:25,632][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:17:33,901][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:17:41,437][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:17:49,014][root][INFO] - Processing question number 40
[2025-03-06 21:17:49,017][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:17:58,976][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:18:18,076][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:18:25,654][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:18:33,338][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:18:49,133][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:18:53,978][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:19:09,495][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:19:13,848][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:19:21,083][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:19:31,802][root][INFO] - Processing question number 50
[2025-03-06 21:19:31,805][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:19:46,226][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:19:57,841][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:20:17,121][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:20:29,517][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:20:37,283][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:20:45,647][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:20:51,872][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:21:00,400][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:21:11,169][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:21:19,923][root][INFO] - Processing question number 60
[2025-03-06 21:21:19,927][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:21:25,936][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:21:31,204][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:21:39,533][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:21:48,651][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:21:56,081][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:22:14,055][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:22:19,100][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:22:26,615][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:22:33,960][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:22:40,411][root][INFO] - Processing question number 70
[2025-03-06 21:22:40,415][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:22:47,245][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:22:52,514][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:22:56,671][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:23:15,027][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:23:22,699][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:23:32,311][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:23:52,249][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:24:20,853][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:24:40,172][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:24:47,597][root][INFO] - Processing question number 80
[2025-03-06 21:24:47,603][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:25:02,893][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:25:09,195][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:25:14,210][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:25:20,740][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:25:26,602][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:25:36,673][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:25:43,776][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:25:50,404][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:25:57,556][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:26:10,617][root][INFO] - Processing question number 90
[2025-03-06 21:26:10,622][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:26:18,504][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:26:22,221][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:26:30,876][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:26:35,474][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:26:45,050][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:26:50,765][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:26:56,703][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:27:11,672][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:27:22,953][root][INFO] - Inference complete
[2025-03-06 21:27:22,953][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:27:22,960][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:27:22,961][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,962][root][WARNING] - |Q. 7||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,962][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,963][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,963][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,963][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,963][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,963][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,964][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,964][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,964][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,964][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,965][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,965][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,965][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,965][root][WARNING] - |Q. 69||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,965][root][WARNING] - |Q. 69||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,965][root][INFO] - |Q. 69||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,967][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,967][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,967][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,968][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,968][root][WARNING] - |Q. 16||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,968][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,972][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,972][root][WARNING] - |Q. 53||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,972][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,975][root][WARNING] - |Q. 30||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:27:22,975][root][WARNING] - |Q. 30||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:27:22,975][root][INFO] - |Q. 30||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:27:22,977][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:27:22,982][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:27:22,982][root][INFO] - Saved parsed outputs
[2025-03-06 21:27:22,982][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:27:22,983][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:27:22,983][root][INFO] - Saved parsing metadata
[2025-03-06 21:27:22,984][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:27:22,985][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:27:22,987][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:27:22,999][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:27:22,999][root][INFO] - Summary of metrics : {'label_accuracy': 0.47474747474747475, 'misclassification_rate': 0.5252525252525253, 'combined_accuracy': 0.41414141414141414, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 47, 'correct_label_and_domain': 41, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.13131313131313133, 'Criminal_Law_confidence': 0.16161616161616163, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.18181818181818182, 'Civil_Procedure_confidence': 0.12121212121212122, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 6, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 21:27:29,544][root][INFO] - Setting global seed to 989
[2025-03-06 21:27:29,549][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:27:29,549][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:27:29,550][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:27:29,552][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:27:29,554][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:27:29,554][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:27:29,740][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:27:30,356][root][INFO] - Full model selected, loading model
[2025-03-06 21:27:56,006][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:29:48,548][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:29:48,549][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:30:25,459][root][INFO] - Peft model loaded successfully
[2025-03-06 21:30:33,316][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:30:33,317][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:30:33,317][root][INFO] - Starting inference
[2025-03-06 21:30:33,548][root][INFO] - Processing question number 0
[2025-03-06 21:30:33,551][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:30:44,284][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:30:49,542][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:31:01,147][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:31:16,917][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:31:30,310][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:31:42,221][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:32:01,905][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:32:22,698][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:32:32,547][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:32:37,404][root][INFO] - Processing question number 10
[2025-03-06 21:32:37,407][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:32:55,775][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:33:02,996][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:33:22,082][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:33:35,572][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:33:47,329][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:33:56,272][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:34:03,701][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:34:11,783][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:34:18,731][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:34:28,592][root][INFO] - Processing question number 20
[2025-03-06 21:34:28,594][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:34:38,285][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:34:44,318][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:34:49,898][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:35:01,152][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:35:11,524][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:35:17,040][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:35:31,791][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:35:43,399][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:35:54,855][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:36:00,866][root][INFO] - Processing question number 30
[2025-03-06 21:36:00,869][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:36:07,229][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:36:17,186][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:36:26,942][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:36:36,535][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:36:41,257][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:36:49,106][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:37:02,346][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:37:19,001][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:37:27,632][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:37:36,516][root][INFO] - Processing question number 40
[2025-03-06 21:37:36,519][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:37:44,029][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:37:59,555][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:38:07,648][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:38:17,945][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:38:26,783][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:38:31,665][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:38:46,788][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:38:51,079][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:38:56,210][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:39:01,233][root][INFO] - Processing question number 50
[2025-03-06 21:39:01,236][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:39:16,851][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:39:30,321][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:39:50,169][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:40:02,314][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:40:07,857][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:40:19,057][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:40:26,058][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:40:34,960][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:40:52,548][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:41:00,284][root][INFO] - Processing question number 60
[2025-03-06 21:41:00,287][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:41:06,378][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:41:12,064][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:41:18,791][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:41:28,331][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:41:34,420][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:41:41,064][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:41:45,391][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:41:53,010][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:42:00,505][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:42:13,505][root][INFO] - Processing question number 70
[2025-03-06 21:42:13,509][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:42:27,686][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:42:32,652][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:42:41,783][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:42:55,582][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:43:07,358][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:43:12,299][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:43:32,394][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:43:45,406][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:43:54,208][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:44:02,181][root][INFO] - Processing question number 80
[2025-03-06 21:44:02,186][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:44:08,769][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:44:18,742][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:44:24,860][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:44:32,860][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:44:38,711][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:44:50,717][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:45:05,671][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:45:14,709][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:45:26,139][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:45:36,630][root][INFO] - Processing question number 90
[2025-03-06 21:45:36,635][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:45:44,315][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:45:48,059][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:45:57,914][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:46:02,541][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:46:12,187][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:46:17,956][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:46:22,787][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:46:32,965][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:46:46,071][root][INFO] - Inference complete
[2025-03-06 21:46:46,071][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:46:46,078][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:46:46,079][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:46,080][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:46,080][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:46,080][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:46,081][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:46,081][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:46,081][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:46,081][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:46,081][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:46,082][root][WARNING] - |Q. 69||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:46,082][root][WARNING] - |Q. 69||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:46,082][root][INFO] - |Q. 69||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:46,082][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:46,082][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:46,082][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:46,086][root][WARNING] - |Q. 4||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:46,086][root][WARNING] - |Q. 4||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:46,086][root][INFO] - |Q. 4||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:46,091][root][WARNING] - |Q. 30||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:46:46,091][root][WARNING] - |Q. 30||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:46:46,091][root][INFO] - |Q. 30||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:46:46,093][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:46:46,098][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:46:46,098][root][INFO] - Saved parsed outputs
[2025-03-06 21:46:46,098][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:46:46,100][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:46:46,100][root][INFO] - Saved parsing metadata
[2025-03-06 21:46:46,101][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:46:46,102][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:46:46,104][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:46:46,116][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:46:46,116][root][INFO] - Summary of metrics : {'label_accuracy': 0.48484848484848486, 'misclassification_rate': 0.5151515151515151, 'combined_accuracy': 0.42424242424242425, 'malformed_label': 0, 'malformed_domain': 13, 'total_predictions': 99, 'correct_predictions': 48, 'correct_label_and_domain': 42, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.5333333333333333, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.12121212121212122, 'Criminal_Law_confidence': 0.16161616161616163, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.1919191919191919, 'Civil_Procedure_confidence': 0.12121212121212122, 'correct_domain_wrong_label': 44, 'correct_label_wrong_domain': 6, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 21:46:52,772][root][INFO] - Setting global seed to 989
[2025-03-06 21:46:52,777][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:46:52,777][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:46:52,778][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:46:52,780][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:46:52,782][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:46:52,782][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:46:52,938][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:46:53,537][root][INFO] - Full model selected, loading model
[2025-03-06 21:47:19,454][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:49:09,181][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:49:09,200][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:49:45,986][root][INFO] - Peft model loaded successfully
[2025-03-06 21:49:53,270][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:49:53,271][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:49:53,271][root][INFO] - Starting inference
[2025-03-06 21:49:53,498][root][INFO] - Processing question number 0
[2025-03-06 21:49:53,500][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:50:03,370][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:50:14,199][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:50:28,197][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:50:43,964][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:50:58,353][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:51:08,326][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:51:22,512][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:51:33,819][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:51:38,229][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:51:49,140][root][INFO] - Processing question number 10
[2025-03-06 21:51:49,141][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:52:00,870][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:52:12,758][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:52:25,408][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:52:39,235][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:52:47,023][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:52:52,890][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:53:00,067][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:53:08,294][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:53:17,707][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:53:37,924][root][INFO] - Processing question number 20
[2025-03-06 21:53:37,926][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:53:53,508][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:54:00,173][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:54:05,733][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:54:14,415][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:54:20,892][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:54:26,598][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:54:36,404][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:54:42,022][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:54:52,223][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:55:00,819][root][INFO] - Processing question number 30
[2025-03-06 21:55:00,822][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:55:07,422][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:55:16,373][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:55:31,906][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:55:40,709][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:55:51,730][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:55:57,248][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:56:10,486][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:56:19,015][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:56:26,463][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:56:38,833][root][INFO] - Processing question number 40
[2025-03-06 21:56:38,836][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:56:59,128][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:57:13,993][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:57:25,040][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:57:39,896][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:57:48,298][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:57:53,231][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:58:02,317][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:58:07,567][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:58:15,797][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:58:20,817][root][INFO] - Processing question number 50
[2025-03-06 21:58:20,821][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:58:40,991][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:58:51,299][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:59:03,985][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:59:30,112][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:59:39,630][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:59:45,888][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:59:50,326][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:59:57,503][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:00:08,310][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:00:28,296][root][INFO] - Processing question number 60
[2025-03-06 22:00:28,300][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:00:42,318][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:00:49,258][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:00:56,421][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:01:07,491][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:01:14,842][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:01:25,597][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:01:33,295][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:01:49,212][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:01:55,878][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:02:04,561][root][INFO] - Processing question number 70
[2025-03-06 22:02:04,572][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:02:16,060][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:02:22,991][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:02:33,912][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:02:44,145][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:02:57,341][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:03:02,284][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:03:20,993][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:03:32,212][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:03:45,775][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:03:50,688][root][INFO] - Processing question number 80
[2025-03-06 22:03:50,693][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:03:56,622][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:04:06,070][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:04:17,602][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:04:25,063][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:04:30,951][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:04:38,309][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:04:45,476][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:04:51,746][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:04:59,453][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:05:11,019][root][INFO] - Processing question number 90
[2025-03-06 22:05:11,024][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:05:21,104][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:05:24,851][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:05:35,409][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:05:38,887][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:05:47,035][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:05:54,987][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:06:04,905][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:06:18,734][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:06:26,686][root][INFO] - Inference complete
[2025-03-06 22:06:26,686][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:06:26,692][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:06:26,693][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,694][root][WARNING] - |Q. 7||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,694][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,694][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,695][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,695][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,695][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,695][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,695][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,696][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,696][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,696][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,697][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,698][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,698][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,699][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,699][root][WARNING] - |Q. 46||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,699][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,703][root][WARNING] - |Q. 59||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,703][root][WARNING] - |Q. 59||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,703][root][INFO] - |Q. 59||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,704][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,704][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,704][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,704][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,705][root][WARNING] - |Q. 48||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,705][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,706][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:06:26,706][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:06:26,706][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:06:26,708][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:06:26,713][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:06:26,713][root][INFO] - Saved parsed outputs
[2025-03-06 22:06:26,713][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:06:26,714][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:06:26,715][root][INFO] - Saved parsing metadata
[2025-03-06 22:06:26,716][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:06:26,717][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:06:26,718][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:06:26,731][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 22:06:26,731][root][INFO] - Summary of metrics : {'label_accuracy': 0.45454545454545453, 'misclassification_rate': 0.5454545454545454, 'combined_accuracy': 0.40404040404040403, 'malformed_label': 0, 'malformed_domain': 10, 'total_predictions': 99, 'correct_predictions': 45, 'correct_label_and_domain': 40, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.13131313131313133, 'Criminal_Law_confidence': 0.15151515151515152, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.13131313131313133, 'Torts_confidence': 0.1717171717171717, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 5, 'both_wrong': 5}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 22:06:33,248][root][INFO] - Setting global seed to 206
[2025-03-06 22:06:33,254][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:06:33,254][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:06:33,255][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:06:33,256][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:06:33,258][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:06:33,259][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:06:33,414][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:06:33,989][root][INFO] - Full model selected, loading model
[2025-03-06 22:06:59,353][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:08:48,765][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:08:48,766][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:09:23,484][root][INFO] - Peft model loaded successfully
[2025-03-06 22:09:31,302][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:09:31,305][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:09:31,305][root][INFO] - Starting inference
[2025-03-06 22:09:31,537][root][INFO] - Processing question number 0
[2025-03-06 22:09:31,541][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:09:42,918][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:09:52,626][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:09:58,752][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:10:09,723][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:10:24,439][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:10:29,811][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:10:40,061][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:10:51,741][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:11:18,869][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:11:30,181][root][INFO] - Processing question number 10
[2025-03-06 22:11:30,183][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:11:38,308][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:11:49,447][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:11:59,368][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:12:11,734][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:12:22,251][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:12:31,305][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:12:39,961][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:12:46,682][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:12:58,421][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:13:07,077][root][INFO] - Processing question number 20
[2025-03-06 22:13:07,079][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:13:14,491][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:13:23,721][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:13:33,113][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:13:37,702][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:13:54,842][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:14:07,183][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:14:19,858][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:14:24,604][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:14:32,309][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:14:48,467][root][INFO] - Processing question number 30
[2025-03-06 22:14:48,469][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:14:53,804][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:15:01,551][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:15:10,724][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:15:24,535][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:15:36,938][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:15:44,018][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:16:00,581][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:16:09,303][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:16:28,140][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:16:36,821][root][INFO] - Processing question number 40
[2025-03-06 22:16:36,824][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:16:44,499][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:16:55,668][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:17:05,570][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:17:12,076][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:17:22,901][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:17:34,655][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:17:40,606][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:17:48,632][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:17:56,349][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:18:05,423][root][INFO] - Processing question number 50
[2025-03-06 22:18:05,426][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:18:11,284][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:18:31,038][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:18:41,004][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:18:48,809][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:18:56,299][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:19:27,038][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:19:41,675][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:19:51,600][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 22:20:04,897][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 22:20:10,535][root][INFO] - Processing question number 60
[2025-03-06 22:20:10,541][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 22:20:29,842][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 22:20:36,386][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 22:20:49,955][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 22:21:01,131][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 22:21:10,874][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 22:21:16,918][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 22:21:35,085][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 22:21:43,940][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:21:51,327][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:21:57,585][root][INFO] - Processing question number 70
[2025-03-06 22:21:57,589][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:22:09,755][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:22:24,226][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:22:36,928][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:22:44,416][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:22:52,936][root][INFO] - Domain : Property, Question : 36
[2025-03-06 22:23:04,433][root][INFO] - Domain : Property, Question : 46
[2025-03-06 22:23:16,375][root][INFO] - Domain : Property, Question : 53
[2025-03-06 22:23:24,665][root][INFO] - Domain : Property, Question : 59
[2025-03-06 22:23:36,975][root][INFO] - Domain : Property, Question : 66
[2025-03-06 22:23:40,698][root][INFO] - Processing question number 80
[2025-03-06 22:23:40,702][root][INFO] - Domain : Property, Question : 69
[2025-03-06 22:23:45,009][root][INFO] - Domain : Property, Question : 81
[2025-03-06 22:23:54,093][root][INFO] - Domain : Property, Question : 88
[2025-03-06 22:24:14,515][root][INFO] - Domain : Property, Question : 91
[2025-03-06 22:24:25,280][root][INFO] - Domain : Property, Question : 94
[2025-03-06 22:24:32,477][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:24:39,556][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:24:50,877][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 22:25:03,884][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 22:25:14,986][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:25:45,926][root][INFO] - Processing question number 90
[2025-03-06 22:25:45,931][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 22:25:56,100][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 22:26:07,747][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:26:13,526][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 22:26:22,432][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 22:26:28,865][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 22:26:41,463][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 22:26:53,534][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 22:26:58,218][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 22:27:03,804][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:27:13,095][root][INFO] - Inference complete
[2025-03-06 22:27:13,095][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:27:13,102][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:27:13,104][root][WARNING] - |Q. 27||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,104][root][WARNING] - |Q. 27||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,104][root][INFO] - |Q. 27||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,106][root][WARNING] - |Q. 21||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,106][root][WARNING] - |Q. 21||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,106][root][INFO] - |Q. 21||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,108][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,108][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,108][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,109][root][WARNING] - |Q. 48||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,109][root][WARNING] - |Q. 48||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,109][root][INFO] - |Q. 48||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,109][root][WARNING] - |Q. 72||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,110][root][WARNING] - |Q. 72||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,110][root][INFO] - |Q. 72||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,111][root][WARNING] - |Q. 51||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,111][root][WARNING] - |Q. 51||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,112][root][INFO] - |Q. 51||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,112][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,113][root][WARNING] - |Q. 85||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:27:13,113][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,113][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:27:13,114][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,114][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,114][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,115][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,115][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,115][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,116][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,116][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,116][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,116][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,117][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:13,117][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,118][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:13,119][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:27:13,119][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:13,119][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:27:13,121][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:27:13,127][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:27:13,127][root][INFO] - Saved parsed outputs
[2025-03-06 22:27:13,127][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:27:13,128][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:27:13,128][root][INFO] - Saved parsing metadata
[2025-03-06 22:27:13,130][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:27:13,132][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:27:13,134][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 22:27:13,142][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 22:27:13,142][root][INFO] - Summary of metrics : {'label_accuracy': 0.59, 'misclassification_rate': 0.41000000000000003, 'combined_accuracy': 0.49, 'malformed_label': 0, 'malformed_domain': 17, 'total_predictions': 100, 'correct_predictions': 59, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.5714285714285714, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.4666666666666667, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.1, 'Criminal_Law_confidence': 0.13, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.14, 'Torts_confidence': 0.21, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 34, 'correct_label_wrong_domain': 10, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 22:27:19,750][root][INFO] - Setting global seed to 206
[2025-03-06 22:27:19,755][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:27:19,756][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:27:19,757][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:27:19,758][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:27:19,760][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:27:19,760][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:27:19,920][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:27:20,527][root][INFO] - Full model selected, loading model
[2025-03-06 22:27:46,533][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:29:38,619][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:29:38,620][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:30:14,242][root][INFO] - Peft model loaded successfully
[2025-03-06 22:30:21,652][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:30:21,654][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:30:21,654][root][INFO] - Starting inference
[2025-03-06 22:30:21,869][root][INFO] - Processing question number 0
[2025-03-06 22:30:21,872][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:30:29,212][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:30:36,449][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:30:42,449][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:30:53,082][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:30:59,068][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:31:05,612][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:31:13,993][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:31:25,806][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:31:35,605][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:31:53,877][root][INFO] - Processing question number 10
[2025-03-06 22:31:53,880][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:32:01,565][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:32:11,029][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:32:17,950][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:32:25,264][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:32:36,842][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:32:47,685][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:32:52,827][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:32:59,666][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:33:14,053][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:33:20,760][root][INFO] - Processing question number 20
[2025-03-06 22:33:20,763][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:33:26,174][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:33:33,414][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:33:38,380][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:33:44,581][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:33:56,764][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:34:02,431][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:34:11,747][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:34:24,094][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:34:29,074][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:34:41,474][root][INFO] - Processing question number 30
[2025-03-06 22:34:41,477][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:35:00,132][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:35:10,437][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:35:17,685][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:35:29,872][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:35:45,826][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:35:52,391][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:36:10,815][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:36:19,678][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:36:31,614][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:36:40,385][root][INFO] - Processing question number 40
[2025-03-06 22:36:40,389][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:36:46,417][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:36:57,459][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:37:07,806][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:37:20,068][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:37:32,942][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:37:38,426][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:37:44,440][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:37:51,514][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:37:59,513][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:38:14,036][root][INFO] - Processing question number 50
[2025-03-06 22:38:14,039][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:38:21,855][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:38:52,591][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:39:00,148][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:39:09,528][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:39:15,638][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:39:32,363][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:39:42,642][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:39:52,775][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 22:40:03,997][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 22:40:16,181][root][INFO] - Processing question number 60
[2025-03-06 22:40:16,185][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 22:40:30,136][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 22:40:42,833][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 22:41:02,334][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 22:41:17,581][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 22:41:24,832][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 22:41:35,433][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 22:41:45,989][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 22:41:56,820][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:42:08,350][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:42:14,484][root][INFO] - Processing question number 70
[2025-03-06 22:42:14,489][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:42:22,723][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:42:30,088][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:42:46,968][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:43:00,625][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:43:09,882][root][INFO] - Domain : Property, Question : 36
[2025-03-06 22:43:15,558][root][INFO] - Domain : Property, Question : 46
[2025-03-06 22:43:23,807][root][INFO] - Domain : Property, Question : 53
[2025-03-06 22:43:36,560][root][INFO] - Domain : Property, Question : 59
[2025-03-06 22:43:42,816][root][INFO] - Domain : Property, Question : 66
[2025-03-06 22:43:50,548][root][INFO] - Processing question number 80
[2025-03-06 22:43:50,553][root][INFO] - Domain : Property, Question : 69
[2025-03-06 22:43:56,935][root][INFO] - Domain : Property, Question : 81
[2025-03-06 22:44:04,807][root][INFO] - Domain : Property, Question : 88
[2025-03-06 22:44:15,554][root][INFO] - Domain : Property, Question : 91
[2025-03-06 22:44:26,791][root][INFO] - Domain : Property, Question : 94
[2025-03-06 22:44:32,553][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:44:49,526][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:45:06,805][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 22:45:20,826][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 22:45:33,215][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:45:44,663][root][INFO] - Processing question number 90
[2025-03-06 22:45:44,668][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 22:45:55,565][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 22:46:09,951][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:46:18,134][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 22:46:24,416][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 22:46:33,784][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 22:46:47,128][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 22:46:55,814][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 22:47:07,470][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 22:47:15,799][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:47:24,420][root][INFO] - Inference complete
[2025-03-06 22:47:24,420][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:47:24,426][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:47:24,429][root][WARNING] - |Q. 78||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,429][root][WARNING] - |Q. 78||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,430][root][INFO] - |Q. 78||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,431][root][WARNING] - |Q. 89||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,431][root][WARNING] - |Q. 89||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,431][root][INFO] - |Q. 89||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,432][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,432][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,432][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,432][root][WARNING] - |Q. 14||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,433][root][WARNING] - |Q. 14||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,433][root][INFO] - |Q. 14||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,434][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,434][root][WARNING] - |Q. 58||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:47:24,434][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,434][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:47:24,435][root][WARNING] - |Q. 4||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,435][root][WARNING] - |Q. 4||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,435][root][INFO] - |Q. 4||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,436][root][WARNING] - |Q. 51||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,437][root][WARNING] - |Q. 51||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:47:24,437][root][INFO] - |Q. 51||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,437][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:47:24,438][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,438][root][WARNING] - |Q. 85||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,438][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,438][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,438][root][WARNING] - |Q. 98||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,438][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,439][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,439][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,439][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,440][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,440][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,440][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,440][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,440][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,441][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,441][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,441][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,441][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,441][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,442][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,442][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,442][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,442][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,442][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,443][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:47:24,443][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:47:24,443][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:47:24,446][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:47:24,452][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:47:24,452][root][INFO] - Saved parsed outputs
[2025-03-06 22:47:24,452][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:47:24,455][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:47:24,455][root][INFO] - Saved parsing metadata
[2025-03-06 22:47:24,455][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:47:24,457][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:47:24,459][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 22:47:24,491][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 22:47:24,491][root][INFO] - Summary of metrics : {'label_accuracy': 0.58, 'misclassification_rate': 0.42000000000000004, 'combined_accuracy': 0.48, 'malformed_label': 0, 'malformed_domain': 16, 'total_predictions': 100, 'correct_predictions': 58, 'correct_label_and_domain': 48, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.5, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.4666666666666667, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.11, 'Criminal_Law_confidence': 0.12, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.14, 'Torts_confidence': 0.19, 'Civil_Procedure_confidence': 0.11, 'correct_domain_wrong_label': 36, 'correct_label_wrong_domain': 10, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 22:47:31,290][root][INFO] - Setting global seed to 206
[2025-03-06 22:47:31,296][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:47:31,296][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:47:31,297][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:47:31,298][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:47:31,300][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:47:31,301][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:47:31,467][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 22:47:32,030][root][INFO] - Full model selected, loading model
[2025-03-06 22:47:56,373][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:49:47,374][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:49:47,375][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:50:22,228][root][INFO] - Peft model loaded successfully
[2025-03-06 22:50:30,032][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:50:30,034][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:50:30,035][root][INFO] - Starting inference
[2025-03-06 22:50:30,261][root][INFO] - Processing question number 0
[2025-03-06 22:50:30,266][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:50:38,231][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:50:43,602][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:50:49,729][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:51:06,377][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:51:18,767][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:51:24,324][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:51:34,065][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:51:44,993][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:51:52,454][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:52:04,451][root][INFO] - Processing question number 10
[2025-03-06 22:52:04,453][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:52:12,758][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:52:19,363][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:52:30,810][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:52:40,086][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:52:49,193][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:52:58,201][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:53:04,964][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:53:16,267][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:53:22,670][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:53:27,816][root][INFO] - Processing question number 20
[2025-03-06 22:53:27,818][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:53:32,987][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:53:39,582][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:53:47,426][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:53:52,919][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:54:05,635][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:54:16,471][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:54:25,719][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:54:35,289][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:54:43,018][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:54:56,059][root][INFO] - Processing question number 30
[2025-03-06 22:54:56,063][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:55:05,789][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:55:24,271][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:55:34,960][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:55:46,866][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:55:55,587][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:56:01,693][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:56:11,832][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:56:21,629][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:56:28,723][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:56:34,314][root][INFO] - Processing question number 40
[2025-03-06 22:56:34,317][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:56:43,290][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:56:53,811][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:57:00,803][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:57:09,062][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:57:29,979][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:57:33,780][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:57:49,377][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:58:10,627][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:58:19,945][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:58:25,312][root][INFO] - Processing question number 50
[2025-03-06 22:58:25,315][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:58:37,332][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:58:49,532][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:58:58,226][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:59:08,989][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:59:16,160][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:59:28,927][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:59:44,362][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:59:57,989][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:00:15,584][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:00:24,727][root][INFO] - Processing question number 60
[2025-03-06 23:00:24,731][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:00:40,230][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:00:58,257][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:01:12,862][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:01:27,967][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:01:36,943][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:01:47,028][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:02:03,297][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:02:12,477][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:02:18,897][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:02:30,181][root][INFO] - Processing question number 70
[2025-03-06 23:02:30,185][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:02:51,851][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:03:00,387][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:03:06,994][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:03:17,914][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:03:27,051][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:03:43,416][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:03:49,778][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:04:08,395][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:04:14,638][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:04:22,597][root][INFO] - Processing question number 80
[2025-03-06 23:04:22,603][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:04:28,079][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:04:37,136][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:04:47,002][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:04:58,159][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:05:08,660][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:05:18,067][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:05:30,090][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:05:36,586][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:05:42,424][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:05:50,308][root][INFO] - Processing question number 90
[2025-03-06 23:05:50,313][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:06:04,299][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:06:13,575][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:06:20,444][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:06:31,073][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:06:43,813][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:06:57,032][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:07:03,026][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:07:07,847][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:07:21,985][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:07:28,788][root][INFO] - Inference complete
[2025-03-06 23:07:28,788][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:07:28,794][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:07:28,795][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,796][root][WARNING] - |Q. 20||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,796][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,797][root][WARNING] - |Q. 41||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,797][root][WARNING] - |Q. 41||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,797][root][INFO] - |Q. 41||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,797][root][WARNING] - |Q. 56||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,797][root][WARNING] - |Q. 56||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,797][root][INFO] - |Q. 56||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,798][root][WARNING] - |Q. 21||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,799][root][WARNING] - |Q. 21||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,799][root][INFO] - |Q. 21||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,800][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,800][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,800][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,801][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,801][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,802][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,803][root][WARNING] - |Q. 51||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,803][root][WARNING] - |Q. 51||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,803][root][INFO] - |Q. 51||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,804][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,804][root][WARNING] - |Q. 85||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,804][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,805][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,805][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,805][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,805][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,805][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,806][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,806][root][WARNING] - |Q. 26||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,806][root][WARNING] - |Q. 26||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,806][root][INFO] - |Q. 26||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,806][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,807][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,807][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,807][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,807][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,807][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,807][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,808][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,808][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,808][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,808][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,808][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,809][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,809][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,809][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,809][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,809][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,810][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,810][root][WARNING] - |Q. 36||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:07:28,810][root][WARNING] - |Q. 36||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:07:28,810][root][INFO] - |Q. 36||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:07:28,813][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:07:28,818][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:07:28,818][root][INFO] - Saved parsed outputs
[2025-03-06 23:07:28,818][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:07:28,820][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:07:28,820][root][INFO] - Saved parsing metadata
[2025-03-06 23:07:28,820][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:07:28,822][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:07:28,823][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:07:28,836][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 23:07:28,836][root][INFO] - Summary of metrics : {'label_accuracy': 0.55, 'misclassification_rate': 0.44999999999999996, 'combined_accuracy': 0.47, 'malformed_label': 0, 'malformed_domain': 14, 'total_predictions': 100, 'correct_predictions': 55, 'correct_label_and_domain': 47, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.5714285714285714, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.11, 'Criminal_Law_confidence': 0.14, 'Evidence_confidence': 0.12, 'Real_Property_confidence': 0.13, 'Torts_confidence': 0.2, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 8, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 23:07:35,446][root][INFO] - Setting global seed to 989
[2025-03-06 23:07:35,451][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:07:35,452][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:07:35,453][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:07:35,454][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:07:35,456][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:07:35,456][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:07:35,655][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 23:07:36,263][root][INFO] - Full model selected, loading model
[2025-03-06 23:08:01,327][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:09:50,258][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:09:50,259][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:10:22,394][root][INFO] - Peft model loaded successfully
[2025-03-06 23:10:30,095][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:10:30,096][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:10:30,097][root][INFO] - Starting inference
[2025-03-06 23:10:30,306][root][INFO] - Processing question number 0
[2025-03-06 23:10:30,314][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:10:41,604][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:10:51,302][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:10:57,426][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:11:08,382][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:11:23,078][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:11:28,443][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:11:38,674][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:11:50,337][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:12:17,422][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:12:28,710][root][INFO] - Processing question number 10
[2025-03-06 23:12:28,712][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:12:36,827][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:12:47,952][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:12:57,863][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:13:10,208][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:13:20,710][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:13:29,748][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:13:38,396][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:13:45,110][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:13:56,833][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:14:05,478][root][INFO] - Processing question number 20
[2025-03-06 23:14:05,481][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:14:12,885][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:14:22,103][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:14:31,482][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:14:36,062][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:14:53,180][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:15:05,510][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:15:18,165][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:15:22,903][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:15:30,599][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:15:46,741][root][INFO] - Processing question number 30
[2025-03-06 23:15:46,744][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:15:52,075][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:15:59,815][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:16:08,977][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:16:22,773][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:16:35,203][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:16:42,332][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:16:58,987][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:17:07,759][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:17:26,627][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:17:35,358][root][INFO] - Processing question number 40
[2025-03-06 23:17:35,362][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:17:43,063][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:17:54,236][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:18:04,184][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:18:10,731][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:18:21,621][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:18:33,391][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:18:39,334][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:18:47,351][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:18:55,062][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:19:04,120][root][INFO] - Processing question number 50
[2025-03-06 23:19:04,123][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:19:09,988][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:19:29,761][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:19:39,724][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:19:47,521][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:19:55,006][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:20:25,726][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:20:40,362][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:20:50,278][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:21:03,560][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:21:09,190][root][INFO] - Processing question number 60
[2025-03-06 23:21:09,194][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:21:28,477][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:21:35,012][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:21:48,561][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:21:59,719][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:22:09,449][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:22:15,482][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:22:33,623][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:22:42,465][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:22:49,839][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:22:56,085][root][INFO] - Processing question number 70
[2025-03-06 23:22:56,090][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:23:08,233][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:23:22,674][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:23:35,356][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:23:42,831][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:23:51,339][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:24:02,820][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:24:14,744][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:24:23,025][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:24:35,315][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:24:39,035][root][INFO] - Processing question number 80
[2025-03-06 23:24:39,039][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:24:43,343][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:24:52,408][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:25:12,795][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:25:23,538][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:25:30,726][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:25:37,792][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:25:49,095][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:26:02,082][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:26:13,169][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:26:44,049][root][INFO] - Processing question number 90
[2025-03-06 23:26:44,054][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:26:54,209][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:27:05,836][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:27:11,607][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:27:20,501][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:27:26,925][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:27:39,506][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:27:51,562][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:27:56,236][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:28:01,807][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:28:11,068][root][INFO] - Inference complete
[2025-03-06 23:28:11,068][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:28:11,075][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:28:11,076][root][WARNING] - |Q. 27||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,077][root][WARNING] - |Q. 27||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,077][root][INFO] - |Q. 27||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,078][root][WARNING] - |Q. 21||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,079][root][WARNING] - |Q. 21||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,079][root][INFO] - |Q. 21||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,080][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,080][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,080][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,081][root][WARNING] - |Q. 48||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,081][root][WARNING] - |Q. 48||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,081][root][INFO] - |Q. 48||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,082][root][WARNING] - |Q. 72||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,082][root][WARNING] - |Q. 72||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,082][root][INFO] - |Q. 72||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,083][root][WARNING] - |Q. 51||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,083][root][WARNING] - |Q. 51||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,084][root][INFO] - |Q. 51||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,084][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,085][root][WARNING] - |Q. 85||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:28:11,085][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,085][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:28:11,086][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,086][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,086][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,086][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,087][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,087][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,087][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,088][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,088][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,088][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,088][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:28:11,088][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,090][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:28:11,090][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:28:11,091][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:28:11,091][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:28:11,092][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:28:11,097][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:28:11,097][root][INFO] - Saved parsed outputs
[2025-03-06 23:28:11,097][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:28:11,098][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:28:11,099][root][INFO] - Saved parsing metadata
[2025-03-06 23:28:11,099][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:28:11,101][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:28:11,102][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:28:11,114][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 23:28:11,114][root][INFO] - Summary of metrics : {'label_accuracy': 0.59, 'misclassification_rate': 0.41000000000000003, 'combined_accuracy': 0.49, 'malformed_label': 0, 'malformed_domain': 17, 'total_predictions': 100, 'correct_predictions': 59, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.5714285714285714, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.4666666666666667, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.1, 'Criminal_Law_confidence': 0.13, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.14, 'Torts_confidence': 0.21, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 34, 'correct_label_wrong_domain': 10, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 23:28:17,461][root][INFO] - Setting global seed to 989
[2025-03-06 23:28:17,466][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:28:17,466][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:28:17,468][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:28:17,469][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:28:17,471][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:28:17,471][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:28:17,617][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 23:28:18,213][root][INFO] - Full model selected, loading model
[2025-03-06 23:28:44,649][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:30:35,408][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:30:35,408][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:31:07,858][root][INFO] - Peft model loaded successfully
[2025-03-06 23:31:15,108][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:31:15,109][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:31:15,109][root][INFO] - Starting inference
[2025-03-06 23:31:15,288][root][INFO] - Processing question number 0
[2025-03-06 23:31:15,290][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:31:39,071][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:31:47,682][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:31:55,598][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:32:19,980][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:32:27,802][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:32:37,288][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:32:43,075][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:32:50,311][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:33:20,913][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:33:31,644][root][INFO] - Processing question number 10
[2025-03-06 23:33:31,646][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:33:38,520][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:33:48,414][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:33:56,322][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:34:03,381][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:34:18,102][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:34:26,781][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:34:33,824][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:34:40,347][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:34:50,065][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:34:55,424][root][INFO] - Processing question number 20
[2025-03-06 23:34:55,426][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:34:59,909][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:35:07,727][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:35:19,282][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:35:24,979][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:35:34,812][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:35:42,502][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:35:53,628][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:36:00,873][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:36:07,954][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:36:24,862][root][INFO] - Processing question number 30
[2025-03-06 23:36:24,865][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:36:30,243][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:36:37,221][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:36:50,061][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:37:13,627][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:37:25,728][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:37:33,506][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:37:49,401][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:38:02,519][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:38:12,927][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:38:21,184][root][INFO] - Processing question number 40
[2025-03-06 23:38:21,187][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:38:29,268][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:38:39,294][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:38:51,942][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:38:55,707][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:39:04,370][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:39:09,252][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:39:15,298][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:39:23,393][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:39:31,172][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:39:41,010][root][INFO] - Processing question number 50
[2025-03-06 23:39:41,013][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:39:49,255][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:39:59,182][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:40:07,371][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:40:14,345][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:40:22,688][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:40:36,503][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:40:41,518][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:40:59,676][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:41:15,326][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:41:30,721][root][INFO] - Processing question number 60
[2025-03-06 23:41:30,725][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:41:39,110][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:41:54,737][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:42:06,165][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:42:17,344][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:42:25,366][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:42:34,664][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:42:54,877][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:43:03,325][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:43:13,749][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:43:22,750][root][INFO] - Processing question number 70
[2025-03-06 23:43:22,754][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:43:33,920][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:43:44,988][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:43:53,433][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:44:00,970][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:44:17,253][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:44:34,633][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:44:41,094][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:44:50,256][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:45:06,161][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:45:18,022][root][INFO] - Processing question number 80
[2025-03-06 23:45:18,027][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:45:27,877][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:45:33,634][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:45:43,795][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:45:56,489][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:46:03,565][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:46:10,555][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:46:26,910][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:46:35,108][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:46:47,566][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:46:59,227][root][INFO] - Processing question number 90
[2025-03-06 23:46:59,232][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:47:10,137][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:47:15,908][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:47:22,081][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:47:30,869][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:47:43,708][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:47:56,813][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:48:05,369][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:48:09,313][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:48:15,031][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:48:27,043][root][INFO] - Inference complete
[2025-03-06 23:48:27,043][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:48:27,049][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:48:27,051][root][WARNING] - |Q. 56||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,052][root][WARNING] - |Q. 56||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:48:27,052][root][INFO] - |Q. 56||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,052][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:48:27,053][root][WARNING] - |Q. 78||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,053][root][WARNING] - |Q. 78||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,053][root][INFO] - |Q. 78||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,053][root][WARNING] - |Q. 2||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,054][root][WARNING] - |Q. 2||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,054][root][INFO] - |Q. 2||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,055][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,055][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,055][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,056][root][WARNING] - |Q. 48||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,056][root][WARNING] - |Q. 48||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,057][root][INFO] - |Q. 48||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,057][root][WARNING] - |Q. 72||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,057][root][WARNING] - |Q. 72||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,057][root][INFO] - |Q. 72||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,059][root][WARNING] - |Q. 5||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,060][root][WARNING] - |Q. 5||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,060][root][INFO] - |Q. 5||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,060][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,060][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,060][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,061][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,061][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,061][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,061][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,061][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,061][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,062][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,062][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,062][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,062][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,063][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,063][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,063][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,063][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,063][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,063][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,063][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,064][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,064][root][WARNING] - |Q. 9||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:48:27,064][root][WARNING] - |Q. 9||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:48:27,064][root][INFO] - |Q. 9||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:48:27,068][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:48:27,072][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:48:27,072][root][INFO] - Saved parsed outputs
[2025-03-06 23:48:27,072][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:48:27,074][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:48:27,074][root][INFO] - Saved parsing metadata
[2025-03-06 23:48:27,074][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:48:27,076][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:48:27,077][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:48:27,092][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 23:48:27,092][root][INFO] - Summary of metrics : {'label_accuracy': 0.59, 'misclassification_rate': 0.41000000000000003, 'combined_accuracy': 0.49, 'malformed_label': 0, 'malformed_domain': 17, 'total_predictions': 100, 'correct_predictions': 59, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.5714285714285714, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.4666666666666667, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.1, 'Criminal_Law_confidence': 0.13, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.14, 'Torts_confidence': 0.21, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 34, 'correct_label_wrong_domain': 10, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 20 to status running with exit code None
Eval status update completed for job 20
[2025-03-06 23:48:33,542][root][INFO] - Setting global seed to 989
[2025-03-06 23:48:33,547][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:48:33,547][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:48:33,549][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:48:33,550][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:48:33,552][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:48:33,552][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:48:33,704][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 23:48:34,285][root][INFO] - Full model selected, loading model
[2025-03-06 23:48:58,233][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:50:50,328][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:50:50,339][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:51:23,575][root][INFO] - Peft model loaded successfully
[2025-03-06 23:51:31,277][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:51:31,279][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:51:31,279][root][INFO] - Starting inference
[2025-03-06 23:51:31,520][root][INFO] - Processing question number 0
[2025-03-06 23:51:31,522][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:51:38,275][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:51:46,808][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:51:53,488][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:52:13,843][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:52:26,482][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:52:31,895][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:52:44,723][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:52:50,491][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:52:57,222][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:53:06,634][root][INFO] - Processing question number 10
[2025-03-06 23:53:06,636][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:53:15,951][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:53:23,960][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:53:32,681][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:53:40,127][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:53:52,232][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:54:05,001][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:54:12,640][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:54:22,119][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:54:31,991][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:54:42,115][root][INFO] - Processing question number 20
[2025-03-06 23:54:42,117][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:54:49,448][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:54:58,803][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:55:09,060][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:55:24,034][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:55:39,911][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:55:52,860][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:55:59,294][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:56:05,601][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:56:12,141][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:56:22,698][root][INFO] - Processing question number 30
[2025-03-06 23:56:22,701][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:56:31,533][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:56:42,011][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:56:51,607][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:56:58,854][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:57:10,650][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:57:17,885][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:57:30,867][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:57:42,777][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:57:49,767][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:57:54,621][root][INFO] - Processing question number 40
[2025-03-06 23:57:54,624][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:58:07,883][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:58:20,450][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:58:27,443][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:58:34,197][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:59:02,794][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:59:08,800][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:59:14,895][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:59:21,211][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:59:28,108][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:59:34,170][root][INFO] - Processing question number 50
[2025-03-06 23:59:34,174][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:59:39,635][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:59:53,215][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:00:03,110][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:00:16,433][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:00:25,562][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:00:39,029][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:00:48,130][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:01:09,469][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:01:21,565][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:01:35,822][root][INFO] - Processing question number 60
[2025-03-07 00:01:35,826][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:01:46,089][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:02:17,271][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:02:32,073][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:02:42,039][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:02:50,968][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:03:06,449][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:03:24,575][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:03:32,281][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:03:38,701][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:03:45,892][root][INFO] - Processing question number 70
[2025-03-07 00:03:45,896][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:03:57,155][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:04:15,816][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:04:25,964][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:04:33,609][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:04:44,518][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:04:58,635][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:05:07,319][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:05:26,551][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:05:32,650][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:05:37,760][root][INFO] - Processing question number 80
[2025-03-07 00:05:37,765][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:05:47,769][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:05:58,138][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:06:08,285][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:06:16,148][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:06:29,327][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:06:40,736][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:06:51,922][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:07:00,500][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:07:12,574][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:07:28,402][root][INFO] - Processing question number 90
[2025-03-07 00:07:28,407][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:07:44,975][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:07:58,779][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:08:17,551][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:08:28,728][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:08:39,131][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:08:53,217][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:09:02,883][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:09:09,563][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:09:14,945][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:09:22,289][root][INFO] - Inference complete
[2025-03-07 00:09:22,290][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:09:22,295][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:09:22,298][root][WARNING] - |Q. 21||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,299][root][WARNING] - |Q. 21||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,299][root][INFO] - |Q. 21||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,299][root][WARNING] - |Q. 71||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,300][root][WARNING] - |Q. 71||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,300][root][INFO] - |Q. 71||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,300][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,300][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,301][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,301][root][WARNING] - |Q. 48||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,302][root][WARNING] - |Q. 48||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,302][root][INFO] - |Q. 48||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,303][root][WARNING] - |Q. 10||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,303][root][WARNING] - |Q. 10||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,303][root][INFO] - |Q. 10||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,304][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,304][root][WARNING] - |Q. 38||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,304][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,304][root][WARNING] - |Q. 51||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,304][root][WARNING] - |Q. 51||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,305][root][INFO] - |Q. 51||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,305][root][WARNING] - |Q. 73||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,305][root][WARNING] - |Q. 73||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,305][root][INFO] - |Q. 73||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,305][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,306][root][WARNING] - |Q. 85||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,306][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,306][root][WARNING] - |Q. 90||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,306][root][WARNING] - |Q. 90||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,306][root][INFO] - |Q. 90||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,306][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,307][root][WARNING] - |Q. 98||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,307][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,307][root][WARNING] - |Q. 12||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,307][root][WARNING] - |Q. 12||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,307][root][INFO] - |Q. 12||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,308][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,308][root][WARNING] - |Q. 19||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,308][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,308][root][WARNING] - |Q. 26||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,309][root][WARNING] - |Q. 26||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:09:22,309][root][INFO] - |Q. 26||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,309][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:09:22,309][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,310][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,310][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,310][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,310][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,310][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,311][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,311][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,311][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,311][root][WARNING] - |Q. 9||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,312][root][WARNING] - |Q. 9||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,312][root][INFO] - |Q. 9||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,312][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,312][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,312][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,312][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,313][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,313][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,313][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,313][root][WARNING] - |Q. 53||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,313][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,314][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,315][root][WARNING] - |Q. 11||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,315][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,315][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,315][root][WARNING] - |Q. 32||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,315][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,316][root][WARNING] - |Q. 92||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:09:22,317][root][WARNING] - |Q. 92||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:09:22,317][root][INFO] - |Q. 92||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:09:22,318][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:09:22,323][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:09:22,323][root][INFO] - Saved parsed outputs
[2025-03-07 00:09:22,323][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:09:22,324][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:09:22,324][root][INFO] - Saved parsing metadata
[2025-03-07 00:09:22,325][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:09:22,328][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:09:22,329][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:09:22,357][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-07 00:09:22,357][root][INFO] - Summary of metrics : {'label_accuracy': 0.58, 'misclassification_rate': 0.42000000000000004, 'combined_accuracy': 0.49, 'malformed_label': 0, 'malformed_domain': 15, 'total_predictions': 100, 'correct_predictions': 58, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.6428571428571429, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.6428571428571429, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.4666666666666667, 'Torts_accuracy': 0.7142857142857143, 'Civil_Procedure_accuracy': 0.38461538461538464, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.1, 'Criminal_Law_confidence': 0.15, 'Evidence_confidence': 0.11, 'Real_Property_confidence': 0.14, 'Torts_confidence': 0.2, 'Civil_Procedure_confidence': 0.1, 'correct_domain_wrong_label': 36, 'correct_label_wrong_domain': 9, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '20', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 20 to status completed with exit code 0
Eval status update completed for job 20
Job 20 completed at Fri Mar  7 00:09:23 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n515
Job ID: 25358395
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 05:07:09
CPU Efficiency: 9.86% of 2-03:54:00 core-walltime
Job Wall-clock time: 05:11:24
Memory Utilized: 34.50 GB
Memory Efficiency: 95.83% of 36.00 GB
