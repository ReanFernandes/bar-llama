Starting job 19 at Thu Mar  6 18:58:33 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_10_samples prompt=json_answer_first_few_shot_unstructured train=json_answer_first_few_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '19', 'training']
Updating job 19 to status training with exit code None
Status update completed for job 19
[2025-03-06 18:59:01,960][root][INFO] - Global seed set to 314
[2025-03-06 18:59:01,962][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 18:59:01,962][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 18:59:01,962][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 18:59:01,962][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 18:59:01,962][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 18:59:02,019][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 18:59:02,053][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 18:59:02,091][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 18:59:02,113][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 18:59:02,771][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 18:59:19,318][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 18:59:53,952][root][INFO] - Model prepared for kbit training
[2025-03-06 18:59:53,952][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'up_proj', 'v_proj', 'k_proj', 'q_proj', 'o_proj', 'down_proj', 'gate_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 18:59:55,676][root][INFO] - Lora adapter added to model
[2025-03-06 18:59:55,678][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_answer_first_few_shot_unstructured
[2025-03-06 18:59:56,049][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.5316, 'grad_norm': 0.13407273590564728, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.5525, 'grad_norm': 0.14261417090892792, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.4532, 'grad_norm': 0.1447116583585739, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.3917, 'grad_norm': 0.17928965389728546, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.1757, 'grad_norm': 0.20572246611118317, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.9455, 'grad_norm': 0.29662537574768066, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.7674, 'grad_norm': 0.2503480017185211, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.5983, 'grad_norm': 0.203284353017807, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.5611, 'grad_norm': 0.15853139758110046, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.5416, 'grad_norm': 0.1292351931333542, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.5114, 'grad_norm': 0.10345014184713364, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.5101, 'grad_norm': 0.09127897769212723, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.4765, 'grad_norm': 0.09864455461502075, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.5179, 'grad_norm': 0.08193929493427277, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.4369, 'grad_norm': 0.08684678375720978, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.4678, 'grad_norm': 0.07751612365245819, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.4826, 'grad_norm': 0.07885853946208954, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.4331, 'grad_norm': 0.08198457956314087, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.4592, 'grad_norm': 0.0907072052359581, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.4539, 'grad_norm': 0.0886227935552597, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.4498, 'grad_norm': 0.08770131319761276, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.4139, 'grad_norm': 0.08977353572845459, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.4537, 'grad_norm': 0.09220974147319794, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.4036, 'grad_norm': 0.09294512867927551, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.4243, 'grad_norm': 0.0944322869181633, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.46, 'grad_norm': 0.09498912841081619, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.4402, 'grad_norm': 0.09935005754232407, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.4163, 'grad_norm': 0.09501811861991882, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.4392, 'grad_norm': 0.11435887217521667, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.3965, 'grad_norm': 0.13477425277233124, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.3911, 'grad_norm': 0.15406356751918793, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.3521, 'grad_norm': 0.24254672229290009, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.3416, 'grad_norm': 0.18536558747291565, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.2685, 'grad_norm': 0.1816164255142212, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.3006, 'grad_norm': 0.46590813994407654, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.2402, 'grad_norm': 0.20144808292388916, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.2823, 'grad_norm': 0.23563633859157562, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.1856, 'grad_norm': 0.390196830034256, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.2163, 'grad_norm': 0.2617710530757904, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.1626, 'grad_norm': 0.24596534669399261, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.1368, 'grad_norm': 0.24689826369285583, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.1284, 'grad_norm': 0.3644413650035858, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.1294, 'grad_norm': 0.309116393327713, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.0996, 'grad_norm': 0.20922574400901794, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.0963, 'grad_norm': 0.221750408411026, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.1022, 'grad_norm': 0.22149313986301422, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0838, 'grad_norm': 0.21864446997642517, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.0793, 'grad_norm': 0.21319352090358734, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0803, 'grad_norm': 0.22192329168319702, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.072, 'grad_norm': 0.20365607738494873, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 3763.3546, 'train_samples_per_second': 0.279, 'train_steps_per_second': 0.04, 'train_loss': 0.46629110872745516, 'epoch': 15.0}
[2025-03-06 20:02:42,583][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_answer_first_few_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '19', 'trained', '0']
Updating job 19 to status trained with exit code 0
Status update completed for job 19
Starting evaluations for job 19
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 20:02:51,824][root][INFO] - Setting global seed to 206
[2025-03-06 20:02:51,829][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:02:51,829][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:02:51,831][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:02:51,832][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:02:51,834][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:02:51,834][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:02:52,013][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:02:52,263][root][INFO] - Full model selected, loading model
[2025-03-06 20:03:04,575][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:04:11,251][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:04:11,252][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:04:37,534][root][INFO] - Peft model loaded successfully
[2025-03-06 20:04:43,874][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:04:43,875][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:04:43,875][root][INFO] - Starting inference
[2025-03-06 20:04:44,084][root][INFO] - Processing question number 0
[2025-03-06 20:04:44,086][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:04:52,869][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:05:02,242][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:05:13,484][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:05:20,571][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:05:26,005][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:05:55,574][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:06:09,664][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:06:32,762][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:06:40,758][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:06:52,090][root][INFO] - Processing question number 10
[2025-03-06 20:06:52,092][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:07:06,274][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:07:28,090][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:07:40,121][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:07:58,279][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:08:08,823][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:08:24,087][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:08:32,376][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:08:41,027][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:08:48,972][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:08:57,038][root][INFO] - Processing question number 20
[2025-03-06 20:08:57,041][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:09:08,871][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:09:20,752][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:09:33,486][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:09:43,357][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:10:00,629][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:10:09,333][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:10:22,024][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:10:39,357][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:10:50,961][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:10:56,389][root][INFO] - Processing question number 30
[2025-03-06 20:10:56,391][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:11:17,116][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:11:32,657][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:12:02,528][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:12:32,204][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:12:39,731][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:12:58,848][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:13:28,509][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:13:58,594][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:14:08,624][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:14:24,508][root][INFO] - Processing question number 40
[2025-03-06 20:14:24,511][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:14:41,656][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:14:46,275][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:15:03,108][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:15:17,841][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:15:27,517][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:15:34,270][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:15:55,954][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:16:08,055][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:16:27,206][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:16:35,264][root][INFO] - Processing question number 50
[2025-03-06 20:16:35,267][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:16:51,705][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:17:06,115][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:17:13,017][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:17:25,660][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:17:45,138][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:17:54,336][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:18:05,773][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:18:17,637][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:18:26,223][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:18:57,521][root][INFO] - Processing question number 60
[2025-03-06 20:18:57,524][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:19:10,556][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:19:31,509][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:19:40,263][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:19:50,434][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:20:06,302][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:20:14,364][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:20:23,563][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:20:38,740][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:20:47,538][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:21:18,047][root][INFO] - Processing question number 70
[2025-03-06 20:21:18,051][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:21:29,451][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:21:51,598][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:22:03,149][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:22:26,661][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:22:35,032][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:22:48,152][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:22:57,797][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:23:05,769][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:23:22,590][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:23:40,287][root][INFO] - Processing question number 80
[2025-03-06 20:23:40,292][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:23:46,622][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:23:56,398][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:24:04,306][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:24:23,489][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:24:37,685][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:24:46,601][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:25:06,612][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:25:16,861][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:25:27,486][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:25:42,845][root][INFO] - Processing question number 90
[2025-03-06 20:25:42,850][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:25:55,525][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:26:04,380][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:26:16,176][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:26:21,957][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:26:38,240][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:26:46,426][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:26:56,059][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:27:17,157][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:27:30,051][root][INFO] - Inference complete
[2025-03-06 20:27:30,051][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,057][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,058][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,059][root][WARNING] - |Q. 35||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,059][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,059][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,060][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,060][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,060][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,060][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,060][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,061][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,061][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,061][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,061][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,062][root][WARNING] - |Q. 84||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,062][root][WARNING] - |Q. 84||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,062][root][INFO] - |Q. 84||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,063][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,063][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,063][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,064][root][WARNING] - |Q. 65||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,064][root][WARNING] - |Q. 65||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,064][root][INFO] - |Q. 65||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,064][root][WARNING] - |Q. 87||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,064][root][WARNING] - |Q. 87||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,064][root][INFO] - |Q. 87||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,065][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,065][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,065][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,066][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,066][root][WARNING] - |Q. 16||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,066][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,066][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,066][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,067][root][WARNING] - |Q. 22||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,067][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,067][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,067][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,068][root][WARNING] - |Q. 46||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,068][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,068][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,068][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,068][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,068][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,068][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,070][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,071][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,071][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,071][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,072][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,072][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,072][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,073][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,073][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,074][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,074][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,074][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,074][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,075][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,075][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,075][root][WARNING] - |Q. 39||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,075][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,076][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,076][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,076][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,077][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,077][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,077][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,077][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,078][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,078][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,079][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,084][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,084][root][INFO] - Saved parsed outputs
[2025-03-06 20:27:30,084][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,085][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,085][root][INFO] - Saved parsing metadata
[2025-03-06 20:27:30,086][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,088][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,089][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:27:30,125][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:27:30,125][root][INFO] - Summary of metrics : {'label_accuracy': 0.37373737373737376, 'misclassification_rate': 0.6262626262626263, 'combined_accuracy': 0.3434343434343434, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 37, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 20:27:38,651][root][INFO] - Setting global seed to 206
[2025-03-06 20:27:38,659][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:27:38,659][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:27:38,661][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:27:38,663][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:27:38,665][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:27:38,665][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:27:38,823][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:27:39,959][root][INFO] - Full model selected, loading model
[2025-03-06 20:27:54,589][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:29:00,266][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:29:00,266][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:29:27,087][root][INFO] - Peft model loaded successfully
[2025-03-06 20:29:33,338][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:29:33,339][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:33,339][root][INFO] - Starting inference
[2025-03-06 20:29:33,528][root][INFO] - Processing question number 0
[2025-03-06 20:29:33,530][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:29:43,058][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:29:51,799][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:30:00,116][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:30:10,357][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:30:15,972][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:30:27,774][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:30:42,703][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:30:57,421][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:31:05,907][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:31:24,023][root][INFO] - Processing question number 10
[2025-03-06 20:31:24,025][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:31:37,841][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:31:58,863][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:32:13,070][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:32:23,280][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:32:36,459][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:32:54,484][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:33:01,475][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:33:09,614][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:33:19,630][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:33:26,249][root][INFO] - Processing question number 20
[2025-03-06 20:33:26,251][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:33:33,994][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:33:46,080][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:33:58,387][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:34:09,216][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:34:14,020][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:34:37,710][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:34:47,107][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:35:05,749][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:35:12,873][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:35:20,262][root][INFO] - Processing question number 30
[2025-03-06 20:35:20,264][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:35:47,028][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:35:57,345][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:36:05,171][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:36:21,906][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:36:30,800][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:36:39,219][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:36:46,158][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:36:56,904][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:37:16,883][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:37:30,149][root][INFO] - Processing question number 40
[2025-03-06 20:37:30,152][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:37:40,844][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:38:10,974][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:38:23,566][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:38:37,565][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:38:47,454][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:38:54,208][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:39:12,450][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:39:24,922][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:39:38,635][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:39:56,395][root][INFO] - Processing question number 50
[2025-03-06 20:39:56,398][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:40:09,978][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:40:20,078][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:40:26,783][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:40:34,971][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:40:58,541][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:41:06,778][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:41:22,082][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:41:40,121][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:41:49,772][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:42:21,253][root][INFO] - Processing question number 60
[2025-03-06 20:42:21,257][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:42:46,411][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:43:00,925][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:43:09,540][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:43:25,574][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:43:35,962][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:43:42,866][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:43:59,339][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:44:12,914][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:44:26,687][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:44:50,044][root][INFO] - Processing question number 70
[2025-03-06 20:44:50,048][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:45:08,264][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:45:37,153][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:45:43,610][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:46:00,157][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:46:17,861][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:46:30,441][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:47:00,953][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:47:28,129][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:47:44,193][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:47:56,541][root][INFO] - Processing question number 80
[2025-03-06 20:47:56,545][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:48:07,928][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:48:17,970][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:48:25,500][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:48:38,332][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:48:42,789][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:48:58,927][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:49:11,162][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:49:18,926][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:49:38,174][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:49:46,637][root][INFO] - Processing question number 90
[2025-03-06 20:49:46,643][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:49:58,243][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:50:09,012][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:50:25,925][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:50:31,862][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:50:57,344][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:51:06,597][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:51:16,163][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:51:26,438][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:51:37,525][root][INFO] - Inference complete
[2025-03-06 20:51:37,525][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,531][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,533][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,533][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,533][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,534][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,534][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,534][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,534][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,534][root][WARNING] - |Q. 91||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,535][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,535][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,535][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,535][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,536][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,536][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,536][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,537][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,537][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,537][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,538][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,538][root][WARNING] - |Q. 22||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,538][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,538][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,539][root][WARNING] - |Q. 46||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,539][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,539][root][WARNING] - |Q. 88||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,540][root][WARNING] - |Q. 88||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,540][root][INFO] - |Q. 88||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,542][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,542][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:51:37,542][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,543][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:51:37,545][root][WARNING] - |Q. 20||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,545][root][WARNING] - |Q. 20||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,545][root][INFO] - |Q. 20||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,545][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,545][root][WARNING] - |Q. 39||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:51:37,546][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,546][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:51:37,546][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,546][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,546][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,548][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,548][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,548][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,549][root][WARNING] - |Q. 92||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,549][root][WARNING] - |Q. 92||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,549][root][INFO] - |Q. 92||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,550][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,555][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,555][root][INFO] - Saved parsed outputs
[2025-03-06 20:51:37,555][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,556][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,556][root][INFO] - Saved parsing metadata
[2025-03-06 20:51:37,557][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,558][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,559][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:51:37,612][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:51:37,612][root][INFO] - Summary of metrics : {'label_accuracy': 0.35353535353535354, 'misclassification_rate': 0.6464646464646464, 'combined_accuracy': 0.32323232323232326, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 35, 'correct_label_and_domain': 32, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 56, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 20:51:46,225][root][INFO] - Setting global seed to 206
[2025-03-06 20:51:46,232][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:51:46,232][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:51:46,234][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:51:46,235][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:51:46,238][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:51:46,238][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:51:46,407][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:51:46,666][root][INFO] - Full model selected, loading model
[2025-03-06 20:52:03,395][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:53:10,149][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:53:10,149][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:53:35,975][root][INFO] - Peft model loaded successfully
[2025-03-06 20:53:42,082][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:53:42,085][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:42,085][root][INFO] - Starting inference
[2025-03-06 20:53:42,289][root][INFO] - Processing question number 0
[2025-03-06 20:53:42,291][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:53:49,743][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:54:01,412][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:54:08,864][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:54:15,993][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:54:24,363][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:54:34,830][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:54:57,260][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:55:16,293][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:55:25,061][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:55:39,076][root][INFO] - Processing question number 10
[2025-03-06 20:55:39,078][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:55:55,834][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:56:11,632][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:56:23,483][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:56:33,258][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:57:03,825][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:57:16,646][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:57:28,218][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:57:32,192][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:57:39,287][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:57:52,163][root][INFO] - Processing question number 20
[2025-03-06 20:57:52,166][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:58:05,811][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:58:16,883][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:58:26,264][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:58:33,211][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:58:40,505][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:59:00,741][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:59:21,444][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:59:27,323][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:59:38,238][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:59:43,888][root][INFO] - Processing question number 30
[2025-03-06 20:59:43,891][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:59:52,437][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:00:07,045][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:00:17,768][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:00:31,788][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:00:36,436][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:00:49,534][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:00:54,564][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:01:24,832][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:01:40,421][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:01:52,994][root][INFO] - Processing question number 40
[2025-03-06 21:01:52,998][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:02:08,521][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:02:20,841][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:02:35,055][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:02:51,023][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:02:59,121][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:03:05,722][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:03:28,120][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:03:37,084][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:03:53,313][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:04:08,532][root][INFO] - Processing question number 50
[2025-03-06 21:04:08,535][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:04:23,103][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:04:35,025][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:04:45,635][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:04:59,637][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:05:18,537][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:05:26,865][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:05:35,250][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:05:51,596][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:06:04,843][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:06:21,270][root][INFO] - Processing question number 60
[2025-03-06 21:06:21,274][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:06:44,418][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:06:53,250][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:07:04,131][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:07:09,955][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:07:40,131][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:07:46,647][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:07:59,508][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:08:26,013][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:08:43,506][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:09:14,404][root][INFO] - Processing question number 70
[2025-03-06 21:09:14,408][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:09:25,149][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:09:55,164][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:10:11,110][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:10:20,176][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:10:37,428][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:10:47,653][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:10:58,083][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:11:10,224][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:11:24,971][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:11:36,966][root][INFO] - Processing question number 80
[2025-03-06 21:11:36,971][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:11:46,568][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:12:03,059][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:12:11,287][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:12:31,680][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:12:37,529][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:12:47,831][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:13:05,007][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:13:12,536][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:13:23,553][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:13:36,366][root][INFO] - Processing question number 90
[2025-03-06 21:13:36,371][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:13:43,547][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:13:52,180][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:14:07,329][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:14:14,467][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:14:23,018][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:14:34,002][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:14:51,304][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:15:01,957][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:15:14,641][root][INFO] - Inference complete
[2025-03-06 21:15:14,641][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,647][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,649][root][WARNING] - |Q. 28||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,649][root][WARNING] - |Q. 28||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,649][root][INFO] - |Q. 28||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,649][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,650][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,650][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,650][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,650][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,650][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,651][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,652][root][WARNING] - |Q. 91||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:15:14,652][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,652][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:15:14,652][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,653][root][WARNING] - |Q. 2||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,653][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,653][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,654][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,654][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,654][root][WARNING] - |Q. 71||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,654][root][WARNING] - |Q. 71||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,654][root][INFO] - |Q. 71||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,655][root][WARNING] - |Q. 93||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,655][root][WARNING] - |Q. 93||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,655][root][INFO] - |Q. 93||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,656][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,656][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,656][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,656][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,656][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,657][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,657][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,657][root][WARNING] - |Q. 66||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,657][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,657][root][WARNING] - |Q. 94||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,658][root][WARNING] - |Q. 94||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,658][root][INFO] - |Q. 94||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,659][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,660][root][WARNING] - |Q. 12||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,660][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,660][root][WARNING] - |Q. 44||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,661][root][WARNING] - |Q. 44||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:15:14,661][root][INFO] - |Q. 44||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,661][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:15:14,661][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,662][root][WARNING] - |Q. 68||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,662][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,662][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,662][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:15:14,662][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,663][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:15:14,663][root][WARNING] - |Q. 96||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,663][root][WARNING] - |Q. 96||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:15:14,663][root][INFO] - |Q. 96||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,663][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:15:14,663][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,664][root][WARNING] - |Q. 6||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,664][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,664][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,664][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,664][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,665][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,665][root][WARNING] - |Q. 48||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,665][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,665][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,665][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,665][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,666][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,666][root][WARNING] - |Q. 89||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,666][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,669][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,674][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,674][root][INFO] - Saved parsed outputs
[2025-03-06 21:15:14,674][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,675][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,675][root][INFO] - Saved parsing metadata
[2025-03-06 21:15:14,676][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,677][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,678][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:15:14,706][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:15:14,706][root][INFO] - Summary of metrics : {'label_accuracy': 0.3838383838383838, 'misclassification_rate': 0.6161616161616161, 'combined_accuracy': 0.35353535353535354, 'malformed_label': 0, 'malformed_domain': 10, 'total_predictions': 99, 'correct_predictions': 38, 'correct_label_and_domain': 35, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.5625, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.18181818181818182, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 3, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 21:15:23,036][root][INFO] - Setting global seed to 989
[2025-03-06 21:15:23,070][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:15:23,070][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:15:23,072][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:15:23,073][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:15:23,076][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:15:23,076][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:15:23,252][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:15:23,527][root][INFO] - Full model selected, loading model
[2025-03-06 21:15:37,762][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:16:43,449][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:16:43,449][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:17:10,784][root][INFO] - Peft model loaded successfully
[2025-03-06 21:17:16,968][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:17:16,970][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:16,970][root][INFO] - Starting inference
[2025-03-06 21:17:17,180][root][INFO] - Processing question number 0
[2025-03-06 21:17:17,182][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:17:25,778][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:17:35,134][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:17:46,304][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:17:53,349][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:17:58,745][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:18:28,315][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:18:42,422][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:19:05,499][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:19:13,472][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:19:24,757][root][INFO] - Processing question number 10
[2025-03-06 21:19:24,759][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:19:38,755][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:20:00,487][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:20:12,458][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:20:30,534][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:20:41,077][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:20:56,265][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:21:04,513][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:21:13,117][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:21:21,013][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:21:29,076][root][INFO] - Processing question number 20
[2025-03-06 21:21:29,078][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:21:40,881][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:21:52,703][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:22:05,366][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:22:15,193][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:22:32,475][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:22:41,176][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:22:53,865][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:23:11,208][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:23:22,828][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:23:28,262][root][INFO] - Processing question number 30
[2025-03-06 21:23:28,265][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:23:49,008][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:24:04,562][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:24:34,472][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:25:04,173][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:25:11,707][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:25:30,838][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:26:00,514][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:26:30,611][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:26:40,647][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:26:56,543][root][INFO] - Processing question number 40
[2025-03-06 21:26:56,547][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:27:13,692][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:27:18,315][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:27:35,209][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:27:50,037][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:27:59,756][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:28:06,564][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:28:28,384][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:28:40,569][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:28:59,786][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:29:07,889][root][INFO] - Processing question number 50
[2025-03-06 21:29:07,892][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:29:24,436][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:29:38,903][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:29:45,808][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:29:58,490][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:30:18,088][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:30:27,340][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:30:38,799][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:30:50,666][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:30:59,258][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:31:30,552][root][INFO] - Processing question number 60
[2025-03-06 21:31:30,555][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:31:43,597][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:32:04,564][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:32:13,323][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:32:23,493][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:32:39,380][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:32:47,446][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:32:56,653][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:33:11,835][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:33:20,640][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:33:51,180][root][INFO] - Processing question number 70
[2025-03-06 21:33:51,185][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:34:02,589][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:34:24,733][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:34:36,287][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:34:59,841][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:35:08,202][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:35:21,330][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:35:30,965][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:35:38,934][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:35:55,757][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:36:13,462][root][INFO] - Processing question number 80
[2025-03-06 21:36:13,467][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:36:19,791][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:36:29,568][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:36:37,466][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:36:56,648][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:37:10,827][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:37:19,724][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:37:39,714][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:37:49,945][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:38:00,559][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:38:15,897][root][INFO] - Processing question number 90
[2025-03-06 21:38:15,902][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:38:28,562][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:38:37,410][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:38:49,194][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:38:54,967][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:39:11,238][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:39:19,395][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:39:28,979][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:39:49,958][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:40:02,713][root][INFO] - Inference complete
[2025-03-06 21:40:02,713][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,719][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,720][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,721][root][WARNING] - |Q. 35||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,721][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,721][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,721][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,721][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,721][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,722][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,722][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,722][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,722][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,722][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,723][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,723][root][WARNING] - |Q. 84||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,723][root][WARNING] - |Q. 84||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,723][root][INFO] - |Q. 84||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,724][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,725][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,725][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,725][root][WARNING] - |Q. 65||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,725][root][WARNING] - |Q. 65||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,725][root][INFO] - |Q. 65||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,726][root][WARNING] - |Q. 87||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,726][root][WARNING] - |Q. 87||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,726][root][INFO] - |Q. 87||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,726][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,726][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,726][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,727][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,727][root][WARNING] - |Q. 16||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,727][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,727][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,728][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,728][root][WARNING] - |Q. 22||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,728][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,728][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,728][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,729][root][WARNING] - |Q. 46||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,729][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,729][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,729][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,730][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,730][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,730][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,732][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,732][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,732][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,733][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,733][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,733][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,733][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,734][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,734][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,735][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,735][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,735][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,735][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,736][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,736][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,736][root][WARNING] - |Q. 39||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,736][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,737][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,737][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,737][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,738][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,738][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,738][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,738][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,738][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,739][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,740][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,745][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,745][root][INFO] - Saved parsed outputs
[2025-03-06 21:40:02,745][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,756][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,756][root][INFO] - Saved parsing metadata
[2025-03-06 21:40:02,756][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,758][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,759][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:40:02,786][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:40:02,786][root][INFO] - Summary of metrics : {'label_accuracy': 0.37373737373737376, 'misclassification_rate': 0.6262626262626263, 'combined_accuracy': 0.3434343434343434, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 37, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 21:40:09,322][root][INFO] - Setting global seed to 989
[2025-03-06 21:40:09,327][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:40:09,327][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:40:09,329][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:40:09,330][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:40:09,333][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:40:09,333][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:40:09,493][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:40:09,753][root][INFO] - Full model selected, loading model
[2025-03-06 21:40:24,924][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:41:29,006][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:41:29,007][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:41:54,704][root][INFO] - Peft model loaded successfully
[2025-03-06 21:42:00,831][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:42:00,832][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:42:00,832][root][INFO] - Starting inference
[2025-03-06 21:42:01,038][root][INFO] - Processing question number 0
[2025-03-06 21:42:01,040][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:42:11,017][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:42:22,047][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:42:34,508][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:42:45,594][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:42:53,953][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:43:09,867][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:43:26,312][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:43:39,270][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:43:47,887][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:43:59,226][root][INFO] - Processing question number 10
[2025-03-06 21:43:59,228][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:44:11,406][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:44:31,858][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:44:41,586][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:44:51,496][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:45:03,624][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:45:15,117][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:45:22,281][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:45:29,839][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:45:38,147][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:45:45,035][root][INFO] - Processing question number 20
[2025-03-06 21:45:45,037][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:45:54,937][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:46:04,894][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:46:13,898][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:46:22,211][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:46:28,394][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:46:47,685][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:47:00,993][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:47:17,388][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:47:29,371][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:47:43,845][root][INFO] - Processing question number 30
[2025-03-06 21:47:43,848][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:47:58,620][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:48:08,898][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:48:18,485][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:48:31,364][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:48:40,239][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:48:50,960][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:49:01,492][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:49:13,930][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:49:37,923][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:49:46,443][root][INFO] - Processing question number 40
[2025-03-06 21:49:46,446][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:49:55,671][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:50:07,927][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:50:18,704][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:50:32,242][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:50:44,288][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:50:58,362][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:51:29,724][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:51:39,512][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:51:52,532][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:52:00,724][root][INFO] - Processing question number 50
[2025-03-06 21:52:00,728][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:52:18,055][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:52:32,275][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:52:42,309][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:53:02,193][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:53:14,715][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:53:24,649][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:53:37,304][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:53:50,993][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:54:00,047][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:54:21,780][root][INFO] - Processing question number 60
[2025-03-06 21:54:21,784][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:54:51,352][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:55:02,682][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:55:13,400][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:55:19,837][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:55:37,808][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:55:44,449][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:56:03,207][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:56:15,392][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:56:25,434][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:56:52,402][root][INFO] - Processing question number 70
[2025-03-06 21:56:52,406][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:57:09,217][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:57:32,839][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:57:47,720][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:57:56,381][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:58:10,228][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:58:19,683][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:58:33,241][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:58:42,677][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:58:54,922][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:59:11,782][root][INFO] - Processing question number 80
[2025-03-06 21:59:11,786][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:59:19,512][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:59:35,601][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:59:49,142][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:00:08,489][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:00:16,482][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:00:46,846][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:01:07,896][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:01:17,489][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:01:34,092][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:01:44,456][root][INFO] - Processing question number 90
[2025-03-06 22:01:44,461][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:02:05,738][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:02:11,317][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:02:20,377][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:02:27,421][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:02:36,587][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:02:42,986][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:02:53,389][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:03:09,060][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:03:19,015][root][INFO] - Inference complete
[2025-03-06 22:03:19,015][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:03:19,022][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:03:19,023][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,024][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,024][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,024][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,025][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,025][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,026][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,026][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,026][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,026][root][WARNING] - |Q. 37||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,026][root][WARNING] - |Q. 37||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,026][root][INFO] - |Q. 37||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,027][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,027][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,027][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,028][root][WARNING] - |Q. 87||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,028][root][WARNING] - |Q. 87||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,028][root][INFO] - |Q. 87||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,028][root][WARNING] - |Q. 93||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,028][root][WARNING] - |Q. 93||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,028][root][INFO] - |Q. 93||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,029][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,030][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,030][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,031][root][WARNING] - |Q. 24||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,031][root][WARNING] - |Q. 24||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:03:19,031][root][INFO] - |Q. 24||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,032][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:03:19,033][root][WARNING] - |Q. 40||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,033][root][WARNING] - |Q. 40||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,034][root][INFO] - |Q. 40||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,035][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,035][root][WARNING] - |Q. 6||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,035][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,036][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,036][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,036][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,036][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,037][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,037][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,037][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,037][root][WARNING] - |Q. 89||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:03:19,037][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,038][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:03:19,038][root][WARNING] - |Q. 100||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:03:19,038][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:03:19,038][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:03:19,040][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:03:19,045][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:03:19,045][root][INFO] - Saved parsed outputs
[2025-03-06 22:03:19,045][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:03:19,047][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:03:19,047][root][INFO] - Saved parsing metadata
[2025-03-06 22:03:19,047][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:03:19,048][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:03:19,050][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:03:19,082][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 22:03:19,082][root][INFO] - Summary of metrics : {'label_accuracy': 0.36363636363636365, 'misclassification_rate': 0.6363636363636364, 'combined_accuracy': 0.3333333333333333, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 99, 'correct_predictions': 36, 'correct_label_and_domain': 33, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.16161616161616163, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 3, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 22:03:25,676][root][INFO] - Setting global seed to 989
[2025-03-06 22:03:25,681][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 22:03:25,681][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:03:25,682][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 22:03:25,684][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:03:25,687][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:03:25,687][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 22:03:25,853][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:03:26,125][root][INFO] - Full model selected, loading model
[2025-03-06 22:03:39,944][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:04:44,411][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:04:44,411][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:05:10,182][root][INFO] - Peft model loaded successfully
[2025-03-06 22:05:16,315][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:05:16,316][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:05:16,316][root][INFO] - Starting inference
[2025-03-06 22:05:16,522][root][INFO] - Processing question number 0
[2025-03-06 22:05:16,524][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 22:05:26,123][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 22:05:45,431][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 22:05:58,516][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 22:06:13,693][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 22:06:27,130][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 22:06:45,963][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 22:07:02,222][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 22:07:12,176][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 22:07:25,771][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 22:07:32,834][root][INFO] - Processing question number 10
[2025-03-06 22:07:32,836][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 22:07:48,361][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 22:07:57,694][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 22:08:13,378][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 22:08:24,556][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 22:08:30,184][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 22:08:42,178][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 22:08:48,197][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 22:08:58,481][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 22:09:16,809][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 22:09:35,355][root][INFO] - Processing question number 20
[2025-03-06 22:09:35,358][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 22:09:56,770][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 22:10:09,509][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 22:10:22,455][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 22:10:32,420][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 22:10:38,474][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 22:10:48,675][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 22:11:04,030][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 22:11:14,222][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 22:11:21,987][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 22:11:31,557][root][INFO] - Processing question number 30
[2025-03-06 22:11:31,560][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:11:37,957][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 22:11:44,456][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 22:11:53,254][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 22:12:07,023][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 22:12:16,036][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 22:12:33,357][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 22:12:45,336][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 22:13:07,132][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:13:17,209][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 22:13:28,042][root][INFO] - Processing question number 40
[2025-03-06 22:13:28,045][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:13:49,640][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 22:14:01,990][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 22:14:11,321][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 22:14:21,218][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 22:14:30,752][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:14:39,881][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 22:14:54,489][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:15:05,345][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 22:15:16,876][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 22:15:36,159][root][INFO] - Processing question number 50
[2025-03-06 22:15:36,163][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:15:55,365][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 22:16:25,532][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 22:16:42,353][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 22:16:55,642][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 22:17:07,632][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:17:16,822][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 22:17:30,224][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 22:17:45,976][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 22:18:01,718][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 22:18:29,795][root][INFO] - Processing question number 60
[2025-03-06 22:18:29,799][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:18:52,067][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:19:04,879][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 22:19:19,246][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 22:19:43,685][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 22:19:56,160][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 22:20:03,878][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 22:20:19,683][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 22:20:30,848][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:20:44,255][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 22:21:14,938][root][INFO] - Processing question number 70
[2025-03-06 22:21:14,942][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 22:21:22,151][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 22:21:39,031][root][INFO] - Domain : Property, Question : 6
[2025-03-06 22:21:47,950][root][INFO] - Domain : Property, Question : 13
[2025-03-06 22:22:01,817][root][INFO] - Domain : Property, Question : 20
[2025-03-06 22:22:12,852][root][INFO] - Domain : Property, Question : 33
[2025-03-06 22:22:24,791][root][INFO] - Domain : Property, Question : 39
[2025-03-06 22:22:31,366][root][INFO] - Domain : Property, Question : 48
[2025-03-06 22:22:50,800][root][INFO] - Domain : Property, Question : 54
[2025-03-06 22:23:02,507][root][INFO] - Domain : Property, Question : 61
[2025-03-06 22:23:11,542][root][INFO] - Processing question number 80
[2025-03-06 22:23:11,547][root][INFO] - Domain : Property, Question : 67
[2025-03-06 22:23:19,888][root][INFO] - Domain : Property, Question : 75
[2025-03-06 22:23:34,357][root][INFO] - Domain : Property, Question : 83
[2025-03-06 22:23:42,483][root][INFO] - Domain : Property, Question : 89
[2025-03-06 22:24:08,667][root][INFO] - Domain : Property, Question : 97
[2025-03-06 22:24:24,056][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:24:33,816][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 22:24:45,527][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:24:51,133][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 22:25:01,369][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 22:25:17,099][root][INFO] - Processing question number 90
[2025-03-06 22:25:17,104][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 22:25:31,519][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 22:25:41,619][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 22:25:51,432][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 22:26:00,864][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:26:17,433][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 22:26:34,518][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 22:26:47,353][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 22:27:03,570][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 22:27:34,340][root][INFO] - Inference complete
[2025-03-06 22:27:34,340][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:27:34,346][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:27:34,347][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,348][root][WARNING] - |Q. 21||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,348][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,348][root][WARNING] - |Q. 28||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,348][root][WARNING] - |Q. 28||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,348][root][INFO] - |Q. 28||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,349][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,349][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,349][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,349][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,349][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,349][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,350][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,350][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,351][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,352][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,352][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,352][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,354][root][WARNING] - |Q. 38||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,354][root][WARNING] - |Q. 38||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,354][root][INFO] - |Q. 38||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,354][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,355][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,355][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,356][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,357][root][WARNING] - |Q. 62||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:27:34,357][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,357][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:27:34,357][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,358][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,358][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,358][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,359][root][WARNING] - |Q. 18||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,359][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,360][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,360][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:27:34,361][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,361][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:27:34,361][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,361][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,361][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,362][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,362][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,362][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,363][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,363][root][WARNING] - |Q. 100||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:27:34,363][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,365][root][WARNING] - |Q. 92||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:27:34,365][root][WARNING] - |Q. 92||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:27:34,365][root][INFO] - |Q. 92||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:27:34,365][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:27:34,366][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:27:34,372][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:27:34,372][root][INFO] - Saved parsed outputs
[2025-03-06 22:27:34,372][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:27:34,373][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:27:34,373][root][INFO] - Saved parsing metadata
[2025-03-06 22:27:34,374][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:27:34,375][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 22:27:34,376][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 22:27:34,396][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 22:27:34,396][root][INFO] - Summary of metrics : {'label_accuracy': 0.3939393939393939, 'misclassification_rate': 0.6060606060606061, 'combined_accuracy': 0.36363636363636365, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 39, 'correct_label_and_domain': 36, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 52, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 22:27:42,205][root][INFO] - Setting global seed to 206
[2025-03-06 22:27:42,214][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:27:42,214][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:27:42,216][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:27:42,217][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:27:42,223][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:27:42,223][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:27:42,383][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:27:42,653][root][INFO] - Full model selected, loading model
[2025-03-06 22:28:00,074][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:29:05,461][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:29:05,462][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:29:31,363][root][INFO] - Peft model loaded successfully
[2025-03-06 22:29:37,468][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:29:37,469][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:29:37,469][root][INFO] - Starting inference
[2025-03-06 22:29:37,666][root][INFO] - Processing question number 0
[2025-03-06 22:29:37,681][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:29:48,133][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:30:03,106][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:30:15,231][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:30:24,023][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:30:37,634][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:30:46,339][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:30:53,117][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:31:02,430][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:31:12,672][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:31:18,970][root][INFO] - Processing question number 10
[2025-03-06 22:31:18,972][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:31:23,384][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:31:36,209][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:31:47,749][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:32:00,005][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:32:09,551][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:32:21,726][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:32:32,889][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:32:42,180][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:32:46,963][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:33:00,129][root][INFO] - Processing question number 20
[2025-03-06 22:33:00,131][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:33:06,772][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:33:16,998][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:33:35,952][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:33:50,367][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:34:05,718][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:34:12,714][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:34:25,611][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:34:41,121][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:34:52,965][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:35:23,335][root][INFO] - Processing question number 30
[2025-03-06 22:35:23,338][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 22:35:34,713][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 22:35:45,324][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 22:36:01,026][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 22:36:13,164][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 22:36:22,255][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 22:36:31,878][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 22:36:54,773][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 22:37:25,167][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 22:37:40,968][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 22:37:51,020][root][INFO] - Processing question number 40
[2025-03-06 22:37:51,023][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 22:38:08,698][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 22:38:19,974][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 22:38:38,103][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 22:39:02,628][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 22:39:12,490][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 22:39:23,332][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 22:39:33,787][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 22:39:45,633][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 22:40:06,382][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 22:40:19,382][root][INFO] - Processing question number 50
[2025-03-06 22:40:19,385][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 22:40:38,297][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 22:40:53,356][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 22:41:23,753][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 22:41:39,569][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 22:41:53,506][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 22:42:06,643][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 22:42:26,591][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 22:42:56,884][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 22:43:14,303][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 22:43:25,598][root][INFO] - Processing question number 60
[2025-03-06 22:43:25,602][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 22:43:34,154][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 22:43:45,867][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 22:43:58,904][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 22:44:19,213][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 22:44:31,788][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 22:44:45,471][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 22:44:57,975][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 22:45:08,379][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 22:45:19,296][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 22:45:30,237][root][INFO] - Processing question number 70
[2025-03-06 22:45:30,241][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 22:45:40,228][root][INFO] - Domain : Property, Question : 9
[2025-03-06 22:45:51,035][root][INFO] - Domain : Property, Question : 17
[2025-03-06 22:46:03,800][root][INFO] - Domain : Property, Question : 25
[2025-03-06 22:46:17,583][root][INFO] - Domain : Property, Question : 30
[2025-03-06 22:46:34,757][root][INFO] - Domain : Property, Question : 36
[2025-03-06 22:46:44,095][root][INFO] - Domain : Property, Question : 46
[2025-03-06 22:46:55,768][root][INFO] - Domain : Property, Question : 53
[2025-03-06 22:47:17,762][root][INFO] - Domain : Property, Question : 59
[2025-03-06 22:47:28,429][root][INFO] - Domain : Property, Question : 66
[2025-03-06 22:47:34,992][root][INFO] - Processing question number 80
[2025-03-06 22:47:34,996][root][INFO] - Domain : Property, Question : 69
[2025-03-06 22:47:47,241][root][INFO] - Domain : Property, Question : 81
[2025-03-06 22:47:55,170][root][INFO] - Domain : Property, Question : 88
[2025-03-06 22:48:09,338][root][INFO] - Domain : Property, Question : 91
[2025-03-06 22:48:16,872][root][INFO] - Domain : Property, Question : 94
[2025-03-06 22:48:23,738][root][INFO] - Domain : Property, Question : 100
[2025-03-06 22:48:32,172][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 22:48:54,159][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 22:49:10,317][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 22:49:19,568][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 22:49:30,844][root][INFO] - Processing question number 90
[2025-03-06 22:49:30,849][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 22:49:54,973][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 22:50:12,596][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 22:50:19,852][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 22:50:46,161][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 22:51:16,689][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 22:51:26,217][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 22:51:35,989][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 22:51:44,748][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 22:51:58,292][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 22:52:10,655][root][INFO] - Inference complete
[2025-03-06 22:52:10,655][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:52:10,662][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:52:10,665][root][WARNING] - |Q. 71||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,666][root][WARNING] - |Q. 71||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,666][root][INFO] - |Q. 71||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,666][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,667][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,667][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,667][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,667][root][WARNING] - |Q. 7||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:52:10,668][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,668][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:52:10,669][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,669][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,669][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,670][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,671][root][WARNING] - |Q. 31||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,671][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,671][root][WARNING] - |Q. 60||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,672][root][WARNING] - |Q. 60||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:52:10,672][root][INFO] - |Q. 60||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,672][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:52:10,673][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,673][root][WARNING] - |Q. 98||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:52:10,673][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,673][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:52:10,673][root][WARNING] - |Q. 12||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,674][root][WARNING] - |Q. 12||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,674][root][INFO] - |Q. 12||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,674][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,674][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,674][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,675][root][WARNING] - |Q. 47||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,675][root][WARNING] - |Q. 47||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,675][root][INFO] - |Q. 47||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,675][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,675][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,675][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,676][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,676][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,676][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,676][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,676][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,676][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,677][root][WARNING] - |Q. 9||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,677][root][WARNING] - |Q. 9||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,677][root][INFO] - |Q. 9||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,677][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,677][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,677][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,678][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,678][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,678][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,679][root][WARNING] - |Q. 69||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,679][root][WARNING] - |Q. 69||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,679][root][INFO] - |Q. 69||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,681][root][WARNING] - |Q. 63||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,681][root][WARNING] - |Q. 63||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 22:52:10,681][root][INFO] - |Q. 63||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,681][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 22:52:10,682][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 22:52:10,682][root][WARNING] - |Q. 95||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 22:52:10,682][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 22:52:10,683][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:52:10,690][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:52:10,690][root][INFO] - Saved parsed outputs
[2025-03-06 22:52:10,690][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:52:10,691][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:52:10,692][root][INFO] - Saved parsing metadata
[2025-03-06 22:52:10,692][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:52:10,694][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:52:10,696][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 22:52:10,724][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 22:52:10,724][root][INFO] - Summary of metrics : {'label_accuracy': 0.33, 'misclassification_rate': 0.6699999999999999, 'combined_accuracy': 0.27, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 33, 'correct_label_and_domain': 27, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.0, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.18, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.15, 'Civil_Procedure_confidence': 0.13, 'correct_domain_wrong_label': 61, 'correct_label_wrong_domain': 6, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 22:52:17,965][root][INFO] - Setting global seed to 206
[2025-03-06 22:52:17,972][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 22:52:17,972][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 22:52:17,974][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 22:52:17,975][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 22:52:17,978][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 22:52:17,978][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 22:52:18,131][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 22:52:18,380][root][INFO] - Full model selected, loading model
[2025-03-06 22:52:34,572][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 22:53:39,758][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 22:53:39,758][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 22:54:05,087][root][INFO] - Peft model loaded successfully
[2025-03-06 22:54:11,179][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 22:54:11,181][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 22:54:11,181][root][INFO] - Starting inference
[2025-03-06 22:54:11,390][root][INFO] - Processing question number 0
[2025-03-06 22:54:11,402][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 22:54:19,307][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 22:54:32,601][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 22:54:49,856][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 22:55:08,733][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 22:55:27,719][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 22:55:39,421][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 22:55:45,122][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 22:55:51,664][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 22:55:57,707][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 22:56:06,154][root][INFO] - Processing question number 10
[2025-03-06 22:56:06,156][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 22:56:10,051][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 22:56:18,967][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 22:56:29,433][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 22:56:38,256][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 22:56:52,981][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 22:56:57,774][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 22:57:07,764][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 22:57:12,489][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 22:57:28,376][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 22:57:45,204][root][INFO] - Processing question number 20
[2025-03-06 22:57:45,207][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 22:57:48,929][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 22:57:59,398][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 22:58:12,134][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 22:58:19,280][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 22:58:37,409][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 22:59:02,542][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 22:59:15,164][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 22:59:27,280][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 22:59:38,609][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 22:59:53,568][root][INFO] - Processing question number 30
[2025-03-06 22:59:53,571][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:00:03,482][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:00:14,776][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:00:27,344][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:00:44,661][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:00:57,807][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:01:11,457][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:01:19,238][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:01:29,200][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:01:44,556][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:01:57,306][root][INFO] - Processing question number 40
[2025-03-06 23:01:57,309][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:02:15,551][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:02:24,688][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:02:41,911][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:02:53,459][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:03:07,478][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:03:37,535][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:03:57,663][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:04:08,666][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:04:28,481][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:04:42,473][root][INFO] - Processing question number 50
[2025-03-06 23:04:42,476][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:04:53,264][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:05:05,969][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:05:21,810][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:05:37,865][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:05:53,948][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:06:07,309][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:06:30,575][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:07:01,039][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:07:23,690][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:07:35,212][root][INFO] - Processing question number 60
[2025-03-06 23:07:35,215][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:07:46,105][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:08:02,805][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:08:17,081][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:08:37,933][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:08:52,409][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:09:03,250][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:09:18,217][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:09:23,069][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:09:31,412][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:09:41,276][root][INFO] - Processing question number 70
[2025-03-06 23:09:41,280][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:09:54,389][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:10:07,145][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:10:16,181][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:10:26,116][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:10:38,598][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:10:45,612][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:10:54,538][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:11:18,221][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:11:34,615][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:11:39,208][root][INFO] - Processing question number 80
[2025-03-06 23:11:39,213][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:11:49,176][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:11:56,890][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:12:12,213][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:12:26,761][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:12:33,624][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:12:42,753][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:13:13,165][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:13:25,049][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:13:35,776][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:13:50,708][root][INFO] - Processing question number 90
[2025-03-06 23:13:50,713][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:14:04,672][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:14:23,140][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:14:34,022][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:14:52,499][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:15:15,497][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:15:31,338][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:15:41,070][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:15:57,689][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:16:13,577][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:16:25,675][root][INFO] - Inference complete
[2025-03-06 23:16:25,675][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:25,681][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:25,682][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,682][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,683][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,685][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,685][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,686][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,686][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,686][root][WARNING] - |Q. 7||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,686][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,688][root][WARNING] - |Q. 16||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,688][root][WARNING] - |Q. 16||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:16:25,689][root][INFO] - |Q. 16||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,689][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:16:25,689][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,689][root][WARNING] - |Q. 31||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,689][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,690][root][WARNING] - |Q. 50||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,690][root][WARNING] - |Q. 50||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,690][root][INFO] - |Q. 50||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,691][root][WARNING] - |Q. 85||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,691][root][WARNING] - |Q. 85||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,691][root][INFO] - |Q. 85||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,691][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,692][root][WARNING] - |Q. 98||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:16:25,692][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,692][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:16:25,692][root][WARNING] - |Q. 12||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,692][root][WARNING] - |Q. 12||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,692][root][INFO] - |Q. 12||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,693][root][WARNING] - |Q. 26||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,693][root][WARNING] - |Q. 26||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,693][root][INFO] - |Q. 26||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,693][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,693][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,693][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,694][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,694][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,694][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,694][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,695][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,695][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,695][root][WARNING] - |Q. 9||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,695][root][WARNING] - |Q. 9||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,695][root][INFO] - |Q. 9||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,696][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,696][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,696][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,697][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,697][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:16:25,698][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,698][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:16:25,699][root][WARNING] - |Q. 57||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:16:25,699][root][WARNING] - |Q. 57||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:16:25,699][root][INFO] - |Q. 57||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:16:25,700][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:25,705][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:25,706][root][INFO] - Saved parsed outputs
[2025-03-06 23:16:25,706][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:25,707][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:25,707][root][INFO] - Saved parsing metadata
[2025-03-06 23:16:25,707][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:25,709][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:16:25,710][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:16:25,740][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 23:16:25,741][root][INFO] - Summary of metrics : {'label_accuracy': 0.33, 'misclassification_rate': 0.6699999999999999, 'combined_accuracy': 0.28, 'malformed_label': 0, 'malformed_domain': 13, 'total_predictions': 100, 'correct_predictions': 33, 'correct_label_and_domain': 28, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.13333333333333333, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.18, 'Contracts_confidence': 0.18, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.1, 'Torts_confidence': 0.15, 'Civil_Procedure_confidence': 0.13, 'correct_domain_wrong_label': 59, 'correct_label_wrong_domain': 5, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 23:16:33,898][root][INFO] - Setting global seed to 206
[2025-03-06 23:16:33,906][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:16:33,906][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:16:33,907][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:16:33,909][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:16:33,911][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:16:33,912][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:16:34,063][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:16:34,340][root][INFO] - Full model selected, loading model
[2025-03-06 23:16:49,618][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:17:53,705][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:17:53,706][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:18:19,700][root][INFO] - Peft model loaded successfully
[2025-03-06 23:18:25,789][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:18:25,792][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:18:25,792][root][INFO] - Starting inference
[2025-03-06 23:18:25,979][root][INFO] - Processing question number 0
[2025-03-06 23:18:25,981][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:18:33,941][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:18:41,677][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:18:54,434][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:19:16,866][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:19:30,625][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:19:42,890][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:19:48,594][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:19:55,699][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:20:03,496][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:20:33,467][root][INFO] - Processing question number 10
[2025-03-06 23:20:33,469][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:20:43,231][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:20:54,420][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:21:04,650][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:21:14,354][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:21:29,973][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:21:40,789][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:21:49,506][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:21:58,618][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:22:06,341][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:22:24,059][root][INFO] - Processing question number 20
[2025-03-06 23:22:24,061][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:22:32,990][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:22:41,464][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:23:05,466][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:23:15,710][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:23:28,887][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:23:59,229][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:24:05,890][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:24:18,293][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:24:28,146][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:24:46,133][root][INFO] - Processing question number 30
[2025-03-06 23:24:46,136][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:24:59,017][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:25:10,265][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:25:31,990][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:25:48,473][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:25:57,001][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:26:08,966][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:26:21,504][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:26:52,068][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:27:07,867][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:27:18,603][root][INFO] - Processing question number 40
[2025-03-06 23:27:18,606][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:27:41,492][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:27:51,153][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:28:10,264][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:28:15,869][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:28:29,214][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:28:39,137][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:28:54,819][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:29:08,042][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:29:38,221][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:29:51,346][root][INFO] - Processing question number 50
[2025-03-06 23:29:51,352][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:30:09,594][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:30:16,271][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:30:27,476][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:30:41,490][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:30:54,966][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:31:04,054][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:31:19,063][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:31:47,171][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:32:03,332][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:32:16,315][root][INFO] - Processing question number 60
[2025-03-06 23:32:16,319][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:32:30,027][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:32:49,891][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:33:09,220][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:33:19,882][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:33:32,566][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:33:47,312][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:33:56,921][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:34:07,969][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:34:23,059][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:34:37,551][root][INFO] - Processing question number 70
[2025-03-06 23:34:37,555][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:34:55,742][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:35:13,040][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:35:26,079][root][INFO] - Domain : Property, Question : 25
[2025-03-06 23:35:36,657][root][INFO] - Domain : Property, Question : 30
[2025-03-06 23:35:48,706][root][INFO] - Domain : Property, Question : 36
[2025-03-06 23:35:58,203][root][INFO] - Domain : Property, Question : 46
[2025-03-06 23:36:05,425][root][INFO] - Domain : Property, Question : 53
[2025-03-06 23:36:14,880][root][INFO] - Domain : Property, Question : 59
[2025-03-06 23:36:27,156][root][INFO] - Domain : Property, Question : 66
[2025-03-06 23:36:46,347][root][INFO] - Processing question number 80
[2025-03-06 23:36:46,351][root][INFO] - Domain : Property, Question : 69
[2025-03-06 23:36:57,530][root][INFO] - Domain : Property, Question : 81
[2025-03-06 23:37:05,357][root][INFO] - Domain : Property, Question : 88
[2025-03-06 23:37:17,504][root][INFO] - Domain : Property, Question : 91
[2025-03-06 23:37:25,323][root][INFO] - Domain : Property, Question : 94
[2025-03-06 23:37:34,341][root][INFO] - Domain : Property, Question : 100
[2025-03-06 23:37:43,541][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 23:38:14,006][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 23:38:26,450][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 23:38:43,207][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 23:38:55,503][root][INFO] - Processing question number 90
[2025-03-06 23:38:55,508][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 23:39:09,435][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 23:39:22,489][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 23:39:30,131][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 23:39:51,305][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 23:40:02,922][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 23:40:22,884][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 23:40:34,653][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 23:40:43,663][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 23:40:57,309][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 23:41:13,555][root][INFO] - Inference complete
[2025-03-06 23:41:13,555][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:41:13,561][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:41:13,562][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,562][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,562][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,562][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,563][root][WARNING] - |Q. 20||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,563][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,564][root][WARNING] - |Q. 62||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,564][root][WARNING] - |Q. 62||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:41:13,564][root][INFO] - |Q. 62||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,564][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:41:13,566][root][WARNING] - |Q. 83||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,567][root][WARNING] - |Q. 83||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:41:13,567][root][INFO] - |Q. 83||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,567][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:41:13,567][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,567][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,567][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,568][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,569][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,569][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,569][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,569][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,569][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,571][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,571][root][WARNING] - |Q. 38||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:41:13,571][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,571][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:41:13,573][root][WARNING] - |Q. 47||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,573][root][WARNING] - |Q. 47||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,573][root][INFO] - |Q. 47||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,573][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,573][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,573][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,574][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,574][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,574][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,574][root][WARNING] - |Q. 68||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,574][root][WARNING] - |Q. 68||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,574][root][INFO] - |Q. 68||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,574][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,575][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,575][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,575][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,575][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,575][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,576][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,576][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,576][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,577][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,578][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 23:41:13,578][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,578][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 23:41:13,579][root][WARNING] - |Q. 74||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,579][root][WARNING] - |Q. 74||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,579][root][INFO] - |Q. 74||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,580][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 23:41:13,580][root][WARNING] - |Q. 95||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 23:41:13,580][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 23:41:13,581][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:41:13,588][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:41:13,588][root][INFO] - Saved parsed outputs
[2025-03-06 23:41:13,588][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:41:13,590][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:41:13,590][root][INFO] - Saved parsing metadata
[2025-03-06 23:41:13,590][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:41:13,592][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:41:13,594][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 23:41:13,637][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-06 23:41:13,637][root][INFO] - Summary of metrics : {'label_accuracy': 0.3, 'misclassification_rate': 0.7, 'combined_accuracy': 0.24, 'malformed_label': 0, 'malformed_domain': 10, 'total_predictions': 100, 'correct_predictions': 30, 'correct_label_and_domain': 24, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.12, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.1, 'Torts_confidence': 0.15, 'Civil_Procedure_confidence': 0.13, 'correct_domain_wrong_label': 66, 'correct_label_wrong_domain': 6, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 23:41:23,934][root][INFO] - Setting global seed to 989
[2025-03-06 23:41:23,942][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 23:41:23,943][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 23:41:23,944][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 23:41:23,945][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 23:41:23,950][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 23:41:23,950][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 23:41:24,143][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 23:41:24,509][root][INFO] - Full model selected, loading model
[2025-03-06 23:41:43,029][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 23:42:49,282][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 23:42:49,283][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 23:43:15,487][root][INFO] - Peft model loaded successfully
[2025-03-06 23:43:21,615][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 23:43:21,616][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-06 23:43:21,616][root][INFO] - Starting inference
[2025-03-06 23:43:21,839][root][INFO] - Processing question number 0
[2025-03-06 23:43:21,841][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 23:43:32,600][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 23:43:47,482][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 23:43:59,535][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 23:44:08,291][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 23:44:21,902][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 23:44:30,609][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 23:44:37,391][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 23:44:46,713][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 23:44:56,962][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 23:45:03,263][root][INFO] - Processing question number 10
[2025-03-06 23:45:03,266][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 23:45:07,679][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 23:45:20,506][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 23:45:32,055][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 23:45:44,321][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 23:45:53,897][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 23:46:06,111][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 23:46:17,285][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 23:46:26,581][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 23:46:31,367][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 23:46:44,543][root][INFO] - Processing question number 20
[2025-03-06 23:46:44,545][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 23:46:51,190][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 23:47:01,421][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 23:47:20,394][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 23:47:34,820][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 23:47:50,180][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 23:47:57,176][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 23:48:10,070][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 23:48:25,584][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 23:48:37,482][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 23:49:08,060][root][INFO] - Processing question number 30
[2025-03-06 23:49:08,062][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 23:49:19,502][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 23:49:30,175][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 23:49:45,948][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 23:49:58,102][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 23:50:07,242][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 23:50:16,916][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 23:50:39,921][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 23:51:10,430][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 23:51:26,320][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 23:51:36,399][root][INFO] - Processing question number 40
[2025-03-06 23:51:36,402][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 23:51:54,061][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 23:52:05,271][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 23:52:23,327][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 23:52:47,848][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 23:52:57,710][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 23:53:08,549][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 23:53:19,006][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 23:53:30,853][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 23:53:51,590][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 23:54:04,582][root][INFO] - Processing question number 50
[2025-03-06 23:54:04,585][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 23:54:23,503][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 23:54:38,560][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 23:55:08,957][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 23:55:24,770][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 23:55:38,706][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 23:55:51,844][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 23:56:11,797][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 23:56:42,090][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 23:56:59,507][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 23:57:10,800][root][INFO] - Processing question number 60
[2025-03-06 23:57:10,804][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 23:57:19,361][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 23:57:31,074][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 23:57:44,116][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 23:58:04,427][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 23:58:17,004][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 23:58:30,684][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 23:58:43,191][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 23:58:53,594][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 23:59:04,510][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 23:59:15,448][root][INFO] - Processing question number 70
[2025-03-06 23:59:15,453][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 23:59:25,442][root][INFO] - Domain : Property, Question : 9
[2025-03-06 23:59:36,251][root][INFO] - Domain : Property, Question : 17
[2025-03-06 23:59:49,012][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:00:02,796][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:00:19,965][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:00:29,305][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:00:40,978][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:01:02,971][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:01:13,631][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:01:20,165][root][INFO] - Processing question number 80
[2025-03-07 00:01:20,169][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:01:32,339][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:01:40,208][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:01:54,273][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:02:01,764][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:02:08,594][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:02:16,977][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:02:38,889][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:02:54,965][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:03:04,162][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:03:15,372][root][INFO] - Processing question number 90
[2025-03-07 00:03:15,378][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:03:39,432][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:03:56,968][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:04:04,181][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:04:30,440][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:05:00,965][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:05:10,498][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:05:20,278][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:05:29,036][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:05:42,584][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:05:54,951][root][INFO] - Inference complete
[2025-03-07 00:05:54,951][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:05:54,958][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:05:54,961][root][WARNING] - |Q. 71||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,961][root][WARNING] - |Q. 71||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,961][root][INFO] - |Q. 71||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,962][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,962][root][WARNING] - |Q. 96||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,962][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,963][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,963][root][WARNING] - |Q. 7||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:05:54,963][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,963][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:05:54,964][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,965][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,965][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,966][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,966][root][WARNING] - |Q. 31||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,966][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,967][root][WARNING] - |Q. 60||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,967][root][WARNING] - |Q. 60||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:05:54,967][root][INFO] - |Q. 60||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,968][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:05:54,968][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,968][root][WARNING] - |Q. 98||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:05:54,969][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,969][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:05:54,969][root][WARNING] - |Q. 12||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,969][root][WARNING] - |Q. 12||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,969][root][INFO] - |Q. 12||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,970][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,970][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,970][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,970][root][WARNING] - |Q. 47||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,970][root][WARNING] - |Q. 47||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,970][root][INFO] - |Q. 47||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,971][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,971][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,971][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,971][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,971][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,971][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,972][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,972][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,972][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,972][root][WARNING] - |Q. 9||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,972][root][WARNING] - |Q. 9||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,973][root][INFO] - |Q. 9||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,973][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,973][root][WARNING] - |Q. 17||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,973][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,974][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,974][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,974][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,974][root][WARNING] - |Q. 69||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,974][root][WARNING] - |Q. 69||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,974][root][INFO] - |Q. 69||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,976][root][WARNING] - |Q. 63||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,976][root][WARNING] - |Q. 63||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:05:54,977][root][INFO] - |Q. 63||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,977][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:05:54,977][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:05:54,977][root][WARNING] - |Q. 95||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:05:54,977][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:05:54,978][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:05:54,983][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:05:54,983][root][INFO] - Saved parsed outputs
[2025-03-07 00:05:54,983][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:05:54,984][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:05:54,984][root][INFO] - Saved parsing metadata
[2025-03-07 00:05:54,985][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:05:54,987][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:05:54,991][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:05:55,044][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-07 00:05:55,044][root][INFO] - Summary of metrics : {'label_accuracy': 0.33, 'misclassification_rate': 0.6699999999999999, 'combined_accuracy': 0.27, 'malformed_label': 0, 'malformed_domain': 12, 'total_predictions': 100, 'correct_predictions': 33, 'correct_label_and_domain': 27, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.0, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.18, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.11, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.15, 'Civil_Procedure_confidence': 0.13, 'correct_domain_wrong_label': 61, 'correct_label_wrong_domain': 6, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-07 00:06:05,293][root][INFO] - Setting global seed to 989
[2025-03-07 00:06:05,301][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:06:05,301][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-07 00:06:05,302][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:06:05,304][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:06:05,306][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:06:05,306][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:06:05,517][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 00:06:05,956][root][INFO] - Full model selected, loading model
[2025-03-07 00:06:24,199][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:07:29,828][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:07:29,828][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:07:53,923][root][INFO] - Peft model loaded successfully
[2025-03-07 00:08:00,038][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:08:00,040][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:08:00,040][root][INFO] - Starting inference
[2025-03-07 00:08:00,278][root][INFO] - Processing question number 0
[2025-03-07 00:08:00,280][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:08:10,046][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:08:21,678][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:08:31,800][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:08:40,475][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:08:53,798][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:09:03,407][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:09:10,420][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:09:17,815][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:09:25,203][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:09:35,363][root][INFO] - Processing question number 10
[2025-03-07 00:09:35,365][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:09:47,554][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:09:54,987][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:10:03,129][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:10:20,306][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:10:38,654][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:11:03,239][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:11:11,071][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:11:17,987][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:11:22,795][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:11:35,031][root][INFO] - Processing question number 20
[2025-03-07 00:11:35,034][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:11:40,666][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:12:02,898][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:12:20,616][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:12:27,685][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:12:40,119][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:13:10,526][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:13:25,364][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:13:36,310][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:13:44,911][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:13:57,980][root][INFO] - Processing question number 30
[2025-03-07 00:13:57,982][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:14:17,465][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:14:27,635][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:14:37,978][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:14:50,054][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:14:55,687][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:15:23,427][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:15:38,090][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:16:07,549][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:16:21,312][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:16:32,877][root][INFO] - Processing question number 40
[2025-03-07 00:16:32,879][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:16:51,894][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:17:07,867][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:17:22,344][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:17:29,036][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:17:41,451][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:17:52,373][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:18:07,031][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:18:20,895][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:18:42,220][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:18:51,400][root][INFO] - Processing question number 50
[2025-03-07 00:18:51,403][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:19:05,774][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:19:12,775][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:19:25,972][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:19:40,527][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:19:54,371][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:20:05,257][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:20:31,081][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:21:01,738][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:21:12,895][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:21:29,784][root][INFO] - Processing question number 60
[2025-03-07 00:21:29,788][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:21:40,925][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:21:54,023][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:22:07,663][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:22:15,646][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:22:29,899][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:22:42,760][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:22:53,414][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:22:59,892][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:23:17,667][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:23:32,605][root][INFO] - Processing question number 70
[2025-03-07 00:23:32,609][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:23:41,234][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:23:51,879][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:24:05,015][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:24:35,837][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:24:57,105][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:25:04,221][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:25:20,841][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:25:38,242][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:25:48,179][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:25:55,781][root][INFO] - Processing question number 80
[2025-03-07 00:25:55,786][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:26:06,832][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:26:14,608][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:26:29,461][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:26:38,620][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:27:09,824][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:27:21,487][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:27:51,948][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:28:12,474][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:28:20,641][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:28:37,412][root][INFO] - Processing question number 90
[2025-03-07 00:28:37,418][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:28:56,855][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:29:05,361][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:29:12,245][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:29:28,094][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:29:47,017][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:30:07,538][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:30:19,356][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:30:29,311][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:30:39,744][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:31:01,624][root][INFO] - Inference complete
[2025-03-07 00:31:01,624][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:31:01,630][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:31:01,632][root][WARNING] - |Q. 8||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,633][root][WARNING] - |Q. 8||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,633][root][INFO] - |Q. 8||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,634][root][WARNING] - |Q. 83||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,635][root][WARNING] - |Q. 83||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:31:01,635][root][INFO] - |Q. 83||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,635][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:31:01,635][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,636][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,636][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,637][root][WARNING] - |Q. 65||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,637][root][WARNING] - |Q. 65||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,637][root][INFO] - |Q. 65||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,638][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,639][root][WARNING] - |Q. 31||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,639][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,639][root][WARNING] - |Q. 50||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,639][root][WARNING] - |Q. 50||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,639][root][INFO] - |Q. 50||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,640][root][WARNING] - |Q. 98||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,640][root][WARNING] - |Q. 98||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:31:01,641][root][INFO] - |Q. 98||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,641][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:31:01,641][root][WARNING] - |Q. 12||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,641][root][WARNING] - |Q. 12||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,641][root][INFO] - |Q. 12||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,642][root][WARNING] - |Q. 47||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,642][root][WARNING] - |Q. 47||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,642][root][INFO] - |Q. 47||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,642][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,642][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,642][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,643][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,643][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,643][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,643][root][WARNING] - |Q. 68||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,643][root][WARNING] - |Q. 68||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,643][root][INFO] - |Q. 68||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,643][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,644][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,644][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,644][root][WARNING] - |Q. 82||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,644][root][WARNING] - |Q. 82||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,644][root][INFO] - |Q. 82||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,645][root][WARNING] - |Q. 9||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,645][root][WARNING] - |Q. 9||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,645][root][INFO] - |Q. 9||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,645][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,645][root][WARNING] - |Q. 25||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:31:01,646][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,646][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:31:01,646][root][WARNING] - |Q. 30||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,646][root][WARNING] - |Q. 30||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,646][root][INFO] - |Q. 30||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,647][root][WARNING] - |Q. 94||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,647][root][WARNING] - |Q. 94||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:31:01,648][root][INFO] - |Q. 94||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,648][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:31:01,648][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,648][root][WARNING] - |Q. 11||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-07 00:31:01,648][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,648][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-07 00:31:01,649][root][WARNING] - |Q. 45||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,649][root][WARNING] - |Q. 45||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,649][root][INFO] - |Q. 45||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,650][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:31:01,650][root][WARNING] - |Q. 95||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:31:01,651][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:31:01,651][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:31:01,656][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:31:01,656][root][INFO] - Saved parsed outputs
[2025-03-07 00:31:01,656][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:31:01,658][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:31:01,658][root][INFO] - Saved parsing metadata
[2025-03-07 00:31:01,659][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:31:01,660][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:31:01,662][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:31:01,712][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-07 00:31:01,712][root][INFO] - Summary of metrics : {'label_accuracy': 0.33, 'misclassification_rate': 0.6699999999999999, 'combined_accuracy': 0.28, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 33, 'correct_label_and_domain': 28, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.13333333333333333, 'Torts_accuracy': 0.07142857142857142, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.17, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.12, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.15, 'Civil_Procedure_confidence': 0.13, 'correct_domain_wrong_label': 61, 'correct_label_wrong_domain': 5, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-07 00:31:09,661][root][INFO] - Setting global seed to 989
[2025-03-07 00:31:09,680][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-07 00:31:09,680][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-07 00:31:09,682][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-07 00:31:09,684][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-07 00:31:09,686][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-07 00:31:09,686][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-07 00:31:09,921][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-07 00:31:10,187][root][INFO] - Full model selected, loading model
[2025-03-07 00:31:24,314][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-07 00:32:28,769][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-07 00:32:28,770][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-07 00:32:55,645][root][INFO] - Peft model loaded successfully
[2025-03-07 00:33:01,789][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-07 00:33:01,791][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:33:01,791][root][INFO] - Starting inference
[2025-03-07 00:33:02,007][root][INFO] - Processing question number 0
[2025-03-07 00:33:02,009][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-07 00:33:08,705][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-07 00:33:22,202][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-07 00:33:49,465][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-07 00:34:12,778][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-07 00:34:31,036][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-07 00:34:42,526][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-07 00:34:57,694][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-07 00:35:09,519][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-07 00:35:16,212][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-07 00:35:25,573][root][INFO] - Processing question number 10
[2025-03-07 00:35:25,576][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-07 00:35:34,359][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-07 00:35:49,979][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-07 00:36:04,981][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-07 00:36:22,207][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-07 00:36:35,783][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-07 00:36:43,813][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-07 00:36:56,160][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-07 00:37:04,428][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-07 00:37:15,801][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-07 00:37:36,340][root][INFO] - Processing question number 20
[2025-03-07 00:37:36,342][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-07 00:37:47,284][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-07 00:37:59,754][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-07 00:38:23,991][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-07 00:38:37,453][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-07 00:38:50,898][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-07 00:39:07,910][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-07 00:39:17,026][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-07 00:39:27,775][root][INFO] - Domain : Contracts, Question : 3
[2025-03-07 00:39:39,468][root][INFO] - Domain : Contracts, Question : 7
[2025-03-07 00:39:56,534][root][INFO] - Processing question number 30
[2025-03-07 00:39:56,537][root][INFO] - Domain : Contracts, Question : 14
[2025-03-07 00:40:06,122][root][INFO] - Domain : Contracts, Question : 24
[2025-03-07 00:40:16,427][root][INFO] - Domain : Contracts, Question : 28
[2025-03-07 00:40:30,927][root][INFO] - Domain : Contracts, Question : 34
[2025-03-07 00:40:39,911][root][INFO] - Domain : Contracts, Question : 42
[2025-03-07 00:40:47,132][root][INFO] - Domain : Contracts, Question : 48
[2025-03-07 00:41:00,126][root][INFO] - Domain : Contracts, Question : 58
[2025-03-07 00:41:07,407][root][INFO] - Domain : Contracts, Question : 65
[2025-03-07 00:41:21,034][root][INFO] - Domain : Contracts, Question : 72
[2025-03-07 00:41:32,104][root][INFO] - Domain : Contracts, Question : 77
[2025-03-07 00:41:44,919][root][INFO] - Processing question number 40
[2025-03-07 00:41:44,922][root][INFO] - Domain : Contracts, Question : 84
[2025-03-07 00:41:59,897][root][INFO] - Domain : Contracts, Question : 87
[2025-03-07 00:42:09,236][root][INFO] - Domain : Contracts, Question : 97
[2025-03-07 00:42:26,626][root][INFO] - Domain : Evidence, Question : 4
[2025-03-07 00:42:36,419][root][INFO] - Domain : Evidence, Question : 10
[2025-03-07 00:42:48,601][root][INFO] - Domain : Evidence, Question : 16
[2025-03-07 00:43:02,071][root][INFO] - Domain : Evidence, Question : 23
[2025-03-07 00:43:15,190][root][INFO] - Domain : Evidence, Question : 31
[2025-03-07 00:43:29,730][root][INFO] - Domain : Evidence, Question : 38
[2025-03-07 00:43:45,531][root][INFO] - Domain : Evidence, Question : 43
[2025-03-07 00:44:03,155][root][INFO] - Processing question number 50
[2025-03-07 00:44:03,159][root][INFO] - Domain : Evidence, Question : 50
[2025-03-07 00:44:16,004][root][INFO] - Domain : Evidence, Question : 51
[2025-03-07 00:44:26,699][root][INFO] - Domain : Evidence, Question : 60
[2025-03-07 00:44:37,258][root][INFO] - Domain : Evidence, Question : 73
[2025-03-07 00:44:51,905][root][INFO] - Domain : Evidence, Question : 80
[2025-03-07 00:45:05,083][root][INFO] - Domain : Evidence, Question : 85
[2025-03-07 00:45:17,359][root][INFO] - Domain : Evidence, Question : 90
[2025-03-07 00:45:45,007][root][INFO] - Domain : Evidence, Question : 98
[2025-03-07 00:46:13,919][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-07 00:46:28,790][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-07 00:46:36,999][root][INFO] - Processing question number 60
[2025-03-07 00:46:37,004][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-07 00:46:45,575][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-07 00:47:03,461][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-07 00:47:17,181][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-07 00:47:32,222][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-07 00:47:45,657][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-07 00:48:00,831][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-07 00:48:17,509][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-07 00:48:26,771][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-07 00:48:37,807][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-07 00:48:50,678][root][INFO] - Processing question number 70
[2025-03-07 00:48:50,682][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-07 00:49:10,125][root][INFO] - Domain : Property, Question : 9
[2025-03-07 00:49:19,764][root][INFO] - Domain : Property, Question : 17
[2025-03-07 00:49:26,375][root][INFO] - Domain : Property, Question : 25
[2025-03-07 00:49:34,727][root][INFO] - Domain : Property, Question : 30
[2025-03-07 00:49:42,218][root][INFO] - Domain : Property, Question : 36
[2025-03-07 00:49:55,817][root][INFO] - Domain : Property, Question : 46
[2025-03-07 00:50:13,932][root][INFO] - Domain : Property, Question : 53
[2025-03-07 00:50:33,185][root][INFO] - Domain : Property, Question : 59
[2025-03-07 00:50:42,063][root][INFO] - Domain : Property, Question : 66
[2025-03-07 00:50:52,546][root][INFO] - Processing question number 80
[2025-03-07 00:50:52,550][root][INFO] - Domain : Property, Question : 69
[2025-03-07 00:51:01,817][root][INFO] - Domain : Property, Question : 81
[2025-03-07 00:51:11,919][root][INFO] - Domain : Property, Question : 88
[2025-03-07 00:51:25,461][root][INFO] - Domain : Property, Question : 91
[2025-03-07 00:51:41,391][root][INFO] - Domain : Property, Question : 94
[2025-03-07 00:51:54,579][root][INFO] - Domain : Property, Question : 100
[2025-03-07 00:52:05,454][root][INFO] - Domain : Torts, Question : 11
[2025-03-07 00:52:26,558][root][INFO] - Domain : Torts, Question : 18
[2025-03-07 00:52:40,181][root][INFO] - Domain : Torts, Question : 22
[2025-03-07 00:52:49,114][root][INFO] - Domain : Torts, Question : 32
[2025-03-07 00:53:03,778][root][INFO] - Processing question number 90
[2025-03-07 00:53:03,783][root][INFO] - Domain : Torts, Question : 39
[2025-03-07 00:53:18,397][root][INFO] - Domain : Torts, Question : 45
[2025-03-07 00:53:36,658][root][INFO] - Domain : Torts, Question : 52
[2025-03-07 00:53:42,023][root][INFO] - Domain : Torts, Question : 57
[2025-03-07 00:54:00,705][root][INFO] - Domain : Torts, Question : 63
[2025-03-07 00:54:27,542][root][INFO] - Domain : Torts, Question : 67
[2025-03-07 00:54:35,888][root][INFO] - Domain : Torts, Question : 74
[2025-03-07 00:54:49,243][root][INFO] - Domain : Torts, Question : 79
[2025-03-07 00:55:02,258][root][INFO] - Domain : Torts, Question : 92
[2025-03-07 00:55:13,198][root][INFO] - Domain : Torts, Question : 95
[2025-03-07 00:55:19,071][root][INFO] - Inference complete
[2025-03-07 00:55:19,071][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:55:19,077][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:55:19,078][root][WARNING] - |Q. 13||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,079][root][WARNING] - |Q. 13||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,079][root][INFO] - |Q. 13||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,079][root][WARNING] - |Q. 20||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,080][root][WARNING] - |Q. 20||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,080][root][INFO] - |Q. 20||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,081][root][WARNING] - |Q. 78||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,081][root][WARNING] - |Q. 78||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,081][root][INFO] - |Q. 78||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,082][root][WARNING] - |Q. 37||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,082][root][WARNING] - |Q. 37||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,082][root][INFO] - |Q. 37||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,083][root][WARNING] - |Q. 64||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,083][root][WARNING] - |Q. 64||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,083][root][INFO] - |Q. 64||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,084][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,084][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,084][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,084][root][WARNING] - |Q. 7||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,085][root][WARNING] - |Q. 7||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,085][root][INFO] - |Q. 7||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,086][root][WARNING] - |Q. 72||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,086][root][WARNING] - |Q. 72||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,086][root][INFO] - |Q. 72||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,086][root][WARNING] - |Q. 77||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,086][root][WARNING] - |Q. 77||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,086][root][INFO] - |Q. 77||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,089][root][WARNING] - |Q. 26||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,089][root][WARNING] - |Q. 26||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,089][root][INFO] - |Q. 26||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,089][root][WARNING] - |Q. 33||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,090][root][WARNING] - |Q. 33||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,090][root][INFO] - |Q. 33||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,090][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,090][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,090][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,090][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,091][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,091][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,091][root][WARNING] - |Q. 61||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,091][root][WARNING] - |Q. 61||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,091][root][INFO] - |Q. 61||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,092][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,092][root][WARNING] - |Q. 75||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,092][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,092][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,093][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,093][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,093][root][WARNING] - |Q. 36||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,093][root][WARNING] - |Q. 36||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,093][root][INFO] - |Q. 36||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,094][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,094][root][WARNING] - |Q. 53||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,094][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,094][root][WARNING] - |Q. 59||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,094][root][WARNING] - |Q. 59||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,094][root][INFO] - |Q. 59||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,095][root][WARNING] - |Q. 81||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,095][root][WARNING] - |Q. 81||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,095][root][INFO] - |Q. 81||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,095][root][WARNING] - |Q. 91||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,095][root][WARNING] - |Q. 91||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,095][root][INFO] - |Q. 91||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,096][root][WARNING] - |Q. 11||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,096][root][WARNING] - |Q. 11||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,096][root][INFO] - |Q. 11||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,097][root][WARNING] - |Q. 57||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-07 00:55:19,097][root][WARNING] - |Q. 57||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-07 00:55:19,097][root][INFO] - |Q. 57||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-07 00:55:19,099][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:55:19,104][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:55:19,104][root][INFO] - Saved parsed outputs
[2025-03-07 00:55:19,104][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:55:19,105][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:55:19,105][root][INFO] - Saved parsing metadata
[2025-03-07 00:55:19,106][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:55:19,107][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
[2025-03-07 00:55:19,108][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-07 00:55:19,148][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_2
[2025-03-07 00:55:19,149][root][INFO] - Summary of metrics : {'label_accuracy': 0.32, 'misclassification_rate': 0.6799999999999999, 'combined_accuracy': 0.27, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 100, 'correct_predictions': 32, 'correct_label_and_domain': 27, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.42857142857142855, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.13333333333333333, 'Torts_accuracy': 0.07142857142857142, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.18, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.12, 'Evidence_confidence': 0.14, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.13, 'correct_domain_wrong_label': 62, 'correct_label_wrong_domain': 5, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Job 19 completed at Fri Mar  7 00:55:20 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n515
Job ID: 25358394
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 05:54:09
CPU Efficiency: 9.91% of 2-11:33:30 core-walltime
Job Wall-clock time: 05:57:21
Memory Utilized: 27.85 GB
Memory Efficiency: 77.37% of 36.00 GB
