Starting job 19 at Thu Mar  6 18:58:33 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_10_samples prompt=json_answer_first_few_shot_unstructured train=json_answer_first_few_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '19', 'training']
Updating job 19 to status training with exit code None
Status update completed for job 19
[2025-03-06 18:59:01,960][root][INFO] - Global seed set to 314
[2025-03-06 18:59:01,962][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 18:59:01,962][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 18:59:01,962][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 18:59:01,962][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 18:59:01,962][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 18:59:02,019][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 18:59:02,053][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 18:59:02,091][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 18:59:02,113][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 18:59:02,771][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 18:59:19,318][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-03-06 18:59:53,952][root][INFO] - Model prepared for kbit training
[2025-03-06 18:59:53,952][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'up_proj', 'v_proj', 'k_proj', 'q_proj', 'o_proj', 'down_proj', 'gate_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 18:59:55,676][root][INFO] - Lora adapter added to model
[2025-03-06 18:59:55,678][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_answer_first_few_shot_unstructured
[2025-03-06 18:59:56,049][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.5316, 'grad_norm': 0.13407273590564728, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.5525, 'grad_norm': 0.14261417090892792, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.4532, 'grad_norm': 0.1447116583585739, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.3917, 'grad_norm': 0.17928965389728546, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.1757, 'grad_norm': 0.20572246611118317, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.9455, 'grad_norm': 0.29662537574768066, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.7674, 'grad_norm': 0.2503480017185211, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.5983, 'grad_norm': 0.203284353017807, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.5611, 'grad_norm': 0.15853139758110046, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.5416, 'grad_norm': 0.1292351931333542, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.5114, 'grad_norm': 0.10345014184713364, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.5101, 'grad_norm': 0.09127897769212723, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.4765, 'grad_norm': 0.09864455461502075, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.5179, 'grad_norm': 0.08193929493427277, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.4369, 'grad_norm': 0.08684678375720978, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.4678, 'grad_norm': 0.07751612365245819, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.4826, 'grad_norm': 0.07885853946208954, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.4331, 'grad_norm': 0.08198457956314087, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.4592, 'grad_norm': 0.0907072052359581, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.4539, 'grad_norm': 0.0886227935552597, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.4498, 'grad_norm': 0.08770131319761276, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.4139, 'grad_norm': 0.08977353572845459, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.4537, 'grad_norm': 0.09220974147319794, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.4036, 'grad_norm': 0.09294512867927551, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.4243, 'grad_norm': 0.0944322869181633, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.46, 'grad_norm': 0.09498912841081619, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.4402, 'grad_norm': 0.09935005754232407, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.4163, 'grad_norm': 0.09501811861991882, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.4392, 'grad_norm': 0.11435887217521667, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.3965, 'grad_norm': 0.13477425277233124, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.3911, 'grad_norm': 0.15406356751918793, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.3521, 'grad_norm': 0.24254672229290009, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.3416, 'grad_norm': 0.18536558747291565, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.2685, 'grad_norm': 0.1816164255142212, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.3006, 'grad_norm': 0.46590813994407654, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.2402, 'grad_norm': 0.20144808292388916, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.2823, 'grad_norm': 0.23563633859157562, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.1856, 'grad_norm': 0.390196830034256, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.2163, 'grad_norm': 0.2617710530757904, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.1626, 'grad_norm': 0.24596534669399261, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.1368, 'grad_norm': 0.24689826369285583, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.1284, 'grad_norm': 0.3644413650035858, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.1294, 'grad_norm': 0.309116393327713, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.0996, 'grad_norm': 0.20922574400901794, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.0963, 'grad_norm': 0.221750408411026, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.1022, 'grad_norm': 0.22149313986301422, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0838, 'grad_norm': 0.21864446997642517, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.0793, 'grad_norm': 0.21319352090358734, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0803, 'grad_norm': 0.22192329168319702, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.072, 'grad_norm': 0.20365607738494873, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 3763.3546, 'train_samples_per_second': 0.279, 'train_steps_per_second': 0.04, 'train_loss': 0.46629110872745516, 'epoch': 15.0}
[2025-03-06 20:02:42,583][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_10_samples/llama2_json_answer_first_few_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '19', 'trained', '0']
Updating job 19 to status trained with exit code 0
Status update completed for job 19
Starting evaluations for job 19
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 20:02:51,824][root][INFO] - Setting global seed to 206
[2025-03-06 20:02:51,829][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:02:51,829][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:02:51,831][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:02:51,832][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:02:51,834][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:02:51,834][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:02:52,013][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:02:52,263][root][INFO] - Full model selected, loading model
[2025-03-06 20:03:04,575][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:04:11,251][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:04:11,252][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:04:37,534][root][INFO] - Peft model loaded successfully
[2025-03-06 20:04:43,874][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:04:43,875][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:04:43,875][root][INFO] - Starting inference
[2025-03-06 20:04:44,084][root][INFO] - Processing question number 0
[2025-03-06 20:04:44,086][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:04:52,869][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:05:02,242][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:05:13,484][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:05:20,571][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:05:26,005][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:05:55,574][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:06:09,664][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:06:32,762][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:06:40,758][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:06:52,090][root][INFO] - Processing question number 10
[2025-03-06 20:06:52,092][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:07:06,274][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:07:28,090][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:07:40,121][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:07:58,279][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:08:08,823][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:08:24,087][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:08:32,376][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:08:41,027][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:08:48,972][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:08:57,038][root][INFO] - Processing question number 20
[2025-03-06 20:08:57,041][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:09:08,871][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:09:20,752][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:09:33,486][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:09:43,357][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:10:00,629][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:10:09,333][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:10:22,024][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:10:39,357][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:10:50,961][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:10:56,389][root][INFO] - Processing question number 30
[2025-03-06 20:10:56,391][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:11:17,116][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:11:32,657][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:12:02,528][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:12:32,204][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:12:39,731][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:12:58,848][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:13:28,509][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:13:58,594][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:14:08,624][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:14:24,508][root][INFO] - Processing question number 40
[2025-03-06 20:14:24,511][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:14:41,656][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:14:46,275][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:15:03,108][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:15:17,841][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:15:27,517][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:15:34,270][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:15:55,954][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:16:08,055][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:16:27,206][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:16:35,264][root][INFO] - Processing question number 50
[2025-03-06 20:16:35,267][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:16:51,705][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:17:06,115][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:17:13,017][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:17:25,660][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:17:45,138][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:17:54,336][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:18:05,773][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:18:17,637][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:18:26,223][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:18:57,521][root][INFO] - Processing question number 60
[2025-03-06 20:18:57,524][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:19:10,556][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:19:31,509][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:19:40,263][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:19:50,434][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:20:06,302][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:20:14,364][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:20:23,563][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:20:38,740][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:20:47,538][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:21:18,047][root][INFO] - Processing question number 70
[2025-03-06 20:21:18,051][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:21:29,451][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:21:51,598][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:22:03,149][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:22:26,661][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:22:35,032][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:22:48,152][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:22:57,797][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:23:05,769][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:23:22,590][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:23:40,287][root][INFO] - Processing question number 80
[2025-03-06 20:23:40,292][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:23:46,622][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:23:56,398][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:24:04,306][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:24:23,489][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:24:37,685][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:24:46,601][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:25:06,612][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:25:16,861][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:25:27,486][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:25:42,845][root][INFO] - Processing question number 90
[2025-03-06 20:25:42,850][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:25:55,525][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:26:04,380][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:26:16,176][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:26:21,957][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:26:38,240][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:26:46,426][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:26:56,059][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:27:17,157][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:27:30,051][root][INFO] - Inference complete
[2025-03-06 20:27:30,051][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,057][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,058][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,059][root][WARNING] - |Q. 35||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,059][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,059][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,060][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,060][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,060][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,060][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,060][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,061][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,061][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,061][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,061][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,062][root][WARNING] - |Q. 84||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,062][root][WARNING] - |Q. 84||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,062][root][INFO] - |Q. 84||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,063][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,063][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,063][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,064][root][WARNING] - |Q. 65||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,064][root][WARNING] - |Q. 65||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,064][root][INFO] - |Q. 65||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,064][root][WARNING] - |Q. 87||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,064][root][WARNING] - |Q. 87||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,064][root][INFO] - |Q. 87||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,065][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,065][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,065][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,066][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,066][root][WARNING] - |Q. 16||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,066][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,066][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,066][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,067][root][WARNING] - |Q. 22||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,067][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,067][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,067][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,068][root][WARNING] - |Q. 46||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,068][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,068][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,068][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,068][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,068][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,068][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,070][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,071][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,071][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,071][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,072][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,072][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,072][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,073][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,073][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:27:30,074][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,074][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:27:30,074][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,074][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,075][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,075][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,075][root][WARNING] - |Q. 39||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,075][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,076][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,076][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,076][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,077][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,077][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,077][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,077][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:27:30,078][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:27:30,078][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:27:30,079][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,084][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,084][root][INFO] - Saved parsed outputs
[2025-03-06 20:27:30,084][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,085][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,085][root][INFO] - Saved parsing metadata
[2025-03-06 20:27:30,086][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,088][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:27:30,089][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:27:30,125][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:27:30,125][root][INFO] - Summary of metrics : {'label_accuracy': 0.37373737373737376, 'misclassification_rate': 0.6262626262626263, 'combined_accuracy': 0.3434343434343434, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 37, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 20:27:38,651][root][INFO] - Setting global seed to 206
[2025-03-06 20:27:38,659][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:27:38,659][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:27:38,661][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:27:38,663][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:27:38,665][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:27:38,665][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:27:38,823][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:27:39,959][root][INFO] - Full model selected, loading model
[2025-03-06 20:27:54,589][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:29:00,266][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:29:00,266][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:29:27,087][root][INFO] - Peft model loaded successfully
[2025-03-06 20:29:33,338][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:29:33,339][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:29:33,339][root][INFO] - Starting inference
[2025-03-06 20:29:33,528][root][INFO] - Processing question number 0
[2025-03-06 20:29:33,530][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:29:43,058][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:29:51,799][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:30:00,116][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:30:10,357][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:30:15,972][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:30:27,774][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:30:42,703][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:30:57,421][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:31:05,907][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:31:24,023][root][INFO] - Processing question number 10
[2025-03-06 20:31:24,025][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:31:37,841][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:31:58,863][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:32:13,070][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:32:23,280][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:32:36,459][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:32:54,484][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:33:01,475][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:33:09,614][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:33:19,630][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:33:26,249][root][INFO] - Processing question number 20
[2025-03-06 20:33:26,251][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:33:33,994][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:33:46,080][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:33:58,387][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:34:09,216][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:34:14,020][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:34:37,710][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:34:47,107][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:35:05,749][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:35:12,873][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:35:20,262][root][INFO] - Processing question number 30
[2025-03-06 20:35:20,264][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:35:47,028][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:35:57,345][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:36:05,171][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:36:21,906][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:36:30,800][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:36:39,219][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:36:46,158][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:36:56,904][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:37:16,883][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:37:30,149][root][INFO] - Processing question number 40
[2025-03-06 20:37:30,152][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:37:40,844][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:38:10,974][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:38:23,566][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:38:37,565][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:38:47,454][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:38:54,208][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:39:12,450][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:39:24,922][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:39:38,635][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:39:56,395][root][INFO] - Processing question number 50
[2025-03-06 20:39:56,398][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:40:09,978][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:40:20,078][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:40:26,783][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:40:34,971][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:40:58,541][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:41:06,778][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:41:22,082][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:41:40,121][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:41:49,772][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:42:21,253][root][INFO] - Processing question number 60
[2025-03-06 20:42:21,257][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:42:46,411][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:43:00,925][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:43:09,540][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:43:25,574][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:43:35,962][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:43:42,866][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:43:59,339][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:44:12,914][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:44:26,687][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:44:50,044][root][INFO] - Processing question number 70
[2025-03-06 20:44:50,048][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:45:08,264][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:45:37,153][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:45:43,610][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:46:00,157][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:46:17,861][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:46:30,441][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:47:00,953][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:47:28,129][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:47:44,193][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:47:56,541][root][INFO] - Processing question number 80
[2025-03-06 20:47:56,545][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:48:07,928][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:48:17,970][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:48:25,500][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:48:38,332][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:48:42,789][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:48:58,927][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:49:11,162][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:49:18,926][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:49:38,174][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:49:46,637][root][INFO] - Processing question number 90
[2025-03-06 20:49:46,643][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:49:58,243][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:50:09,012][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:50:25,925][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:50:31,862][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:50:57,344][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:51:06,597][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:51:16,163][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:51:26,438][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:51:37,525][root][INFO] - Inference complete
[2025-03-06 20:51:37,525][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,531][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,533][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,533][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,533][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,534][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,534][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,534][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,534][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,534][root][WARNING] - |Q. 91||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,535][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,535][root][WARNING] - |Q. 25||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,535][root][WARNING] - |Q. 25||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,535][root][INFO] - |Q. 25||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,536][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,536][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,536][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,537][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,537][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,537][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,538][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,538][root][WARNING] - |Q. 22||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,538][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,538][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,539][root][WARNING] - |Q. 46||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,539][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,539][root][WARNING] - |Q. 88||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,540][root][WARNING] - |Q. 88||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,540][root][INFO] - |Q. 88||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,542][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,542][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:51:37,542][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,543][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:51:37,545][root][WARNING] - |Q. 20||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,545][root][WARNING] - |Q. 20||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,545][root][INFO] - |Q. 20||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,545][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,545][root][WARNING] - |Q. 39||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:51:37,546][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,546][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:51:37,546][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,546][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,546][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,548][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,548][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,548][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,549][root][WARNING] - |Q. 92||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:51:37,549][root][WARNING] - |Q. 92||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:51:37,549][root][INFO] - |Q. 92||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:51:37,550][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,555][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,555][root][INFO] - Saved parsed outputs
[2025-03-06 20:51:37,555][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,556][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,556][root][INFO] - Saved parsing metadata
[2025-03-06 20:51:37,557][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,558][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:51:37,559][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:51:37,612][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:51:37,612][root][INFO] - Summary of metrics : {'label_accuracy': 0.35353535353535354, 'misclassification_rate': 0.6464646464646464, 'combined_accuracy': 0.32323232323232326, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 35, 'correct_label_and_domain': 32, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.5, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 56, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 20:51:46,225][root][INFO] - Setting global seed to 206
[2025-03-06 20:51:46,232][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:51:46,232][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:51:46,234][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:51:46,235][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:51:46,238][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:51:46,238][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:51:46,407][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 20:51:46,666][root][INFO] - Full model selected, loading model
[2025-03-06 20:52:03,395][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:53:10,149][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:53:10,149][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:53:35,975][root][INFO] - Peft model loaded successfully
[2025-03-06 20:53:42,082][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:53:42,085][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:53:42,085][root][INFO] - Starting inference
[2025-03-06 20:53:42,289][root][INFO] - Processing question number 0
[2025-03-06 20:53:42,291][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:53:49,743][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:54:01,412][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:54:08,864][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:54:15,993][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:54:24,363][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:54:34,830][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:54:57,260][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:55:16,293][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:55:25,061][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:55:39,076][root][INFO] - Processing question number 10
[2025-03-06 20:55:39,078][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:55:55,834][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:56:11,632][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:56:23,483][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:56:33,258][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:57:03,825][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:57:16,646][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:57:28,218][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:57:32,192][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:57:39,287][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:57:52,163][root][INFO] - Processing question number 20
[2025-03-06 20:57:52,166][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:58:05,811][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:58:16,883][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:58:26,264][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:58:33,211][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:58:40,505][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:59:00,741][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:59:21,444][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:59:27,323][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:59:38,238][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:59:43,888][root][INFO] - Processing question number 30
[2025-03-06 20:59:43,891][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:59:52,437][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:00:07,045][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:00:17,768][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:00:31,788][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:00:36,436][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:00:49,534][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:00:54,564][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:01:24,832][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:01:40,421][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:01:52,994][root][INFO] - Processing question number 40
[2025-03-06 21:01:52,998][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:02:08,521][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:02:20,841][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:02:35,055][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:02:51,023][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:02:59,121][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:03:05,722][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:03:28,120][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:03:37,084][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:03:53,313][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:04:08,532][root][INFO] - Processing question number 50
[2025-03-06 21:04:08,535][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:04:23,103][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:04:35,025][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:04:45,635][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:04:59,637][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:05:18,537][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:05:26,865][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:05:35,250][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:05:51,596][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:06:04,843][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:06:21,270][root][INFO] - Processing question number 60
[2025-03-06 21:06:21,274][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:06:44,418][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:06:53,250][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:07:04,131][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:07:09,955][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:07:40,131][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:07:46,647][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:07:59,508][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:08:26,013][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:08:43,506][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:09:14,404][root][INFO] - Processing question number 70
[2025-03-06 21:09:14,408][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:09:25,149][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:09:55,164][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:10:11,110][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:10:20,176][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:10:37,428][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:10:47,653][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:10:58,083][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:11:10,224][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:11:24,971][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:11:36,966][root][INFO] - Processing question number 80
[2025-03-06 21:11:36,971][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:11:46,568][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:12:03,059][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:12:11,287][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:12:31,680][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:12:37,529][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:12:47,831][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:13:05,007][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:13:12,536][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:13:23,553][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:13:36,366][root][INFO] - Processing question number 90
[2025-03-06 21:13:36,371][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:13:43,547][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:13:52,180][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:14:07,329][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:14:14,467][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:14:23,018][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:14:34,002][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:14:51,304][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:15:01,957][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:15:14,641][root][INFO] - Inference complete
[2025-03-06 21:15:14,641][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,647][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,649][root][WARNING] - |Q. 28||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,649][root][WARNING] - |Q. 28||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,649][root][INFO] - |Q. 28||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,649][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,650][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,650][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,650][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,650][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,650][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,651][root][WARNING] - |Q. 91||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,652][root][WARNING] - |Q. 91||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:15:14,652][root][INFO] - |Q. 91||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,652][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:15:14,652][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,653][root][WARNING] - |Q. 2||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,653][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,653][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,654][root][WARNING] - |Q. 55||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,654][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,654][root][WARNING] - |Q. 71||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,654][root][WARNING] - |Q. 71||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,654][root][INFO] - |Q. 71||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,655][root][WARNING] - |Q. 93||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,655][root][WARNING] - |Q. 93||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,655][root][INFO] - |Q. 93||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,656][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,656][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,656][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,656][root][WARNING] - |Q. 58||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,656][root][WARNING] - |Q. 58||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,657][root][INFO] - |Q. 58||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,657][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,657][root][WARNING] - |Q. 66||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,657][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,657][root][WARNING] - |Q. 94||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,658][root][WARNING] - |Q. 94||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,658][root][INFO] - |Q. 94||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,659][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,660][root][WARNING] - |Q. 12||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,660][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,660][root][WARNING] - |Q. 44||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,661][root][WARNING] - |Q. 44||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:15:14,661][root][INFO] - |Q. 44||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,661][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:15:14,661][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,662][root][WARNING] - |Q. 68||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,662][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,662][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,662][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:15:14,662][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,663][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:15:14,663][root][WARNING] - |Q. 96||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,663][root][WARNING] - |Q. 96||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:15:14,663][root][INFO] - |Q. 96||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,663][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:15:14,663][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,664][root][WARNING] - |Q. 6||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,664][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,664][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,664][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,664][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,665][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,665][root][WARNING] - |Q. 48||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,665][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,665][root][WARNING] - |Q. 61||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,665][root][WARNING] - |Q. 61||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,665][root][INFO] - |Q. 61||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,666][root][WARNING] - |Q. 89||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:15:14,666][root][WARNING] - |Q. 89||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:15:14,666][root][INFO] - |Q. 89||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:15:14,669][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,674][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,674][root][INFO] - Saved parsed outputs
[2025-03-06 21:15:14,674][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,675][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,675][root][INFO] - Saved parsing metadata
[2025-03-06 21:15:14,676][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,677][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:15:14,678][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:15:14,706][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:15:14,706][root][INFO] - Summary of metrics : {'label_accuracy': 0.3838383838383838, 'misclassification_rate': 0.6161616161616161, 'combined_accuracy': 0.35353535353535354, 'malformed_label': 0, 'malformed_domain': 10, 'total_predictions': 99, 'correct_predictions': 38, 'correct_label_and_domain': 35, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.5625, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.18181818181818182, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 3, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 21:15:23,036][root][INFO] - Setting global seed to 989
[2025-03-06 21:15:23,070][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:15:23,070][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:15:23,072][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:15:23,073][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:15:23,076][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:15:23,076][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:15:23,252][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:15:23,527][root][INFO] - Full model selected, loading model
[2025-03-06 21:15:37,762][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:16:43,449][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:16:43,449][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:17:10,784][root][INFO] - Peft model loaded successfully
[2025-03-06 21:17:16,968][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:17:16,970][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:16,970][root][INFO] - Starting inference
[2025-03-06 21:17:17,180][root][INFO] - Processing question number 0
[2025-03-06 21:17:17,182][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:17:25,778][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:17:35,134][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:17:46,304][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:17:53,349][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:17:58,745][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:18:28,315][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:18:42,422][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:19:05,499][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:19:13,472][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:19:24,757][root][INFO] - Processing question number 10
[2025-03-06 21:19:24,759][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:19:38,755][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:20:00,487][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:20:12,458][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:20:30,534][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:20:41,077][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:20:56,265][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:21:04,513][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:21:13,117][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:21:21,013][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:21:29,076][root][INFO] - Processing question number 20
[2025-03-06 21:21:29,078][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:21:40,881][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:21:52,703][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:22:05,366][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:22:15,193][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:22:32,475][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:22:41,176][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:22:53,865][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:23:11,208][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:23:22,828][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:23:28,262][root][INFO] - Processing question number 30
[2025-03-06 21:23:28,265][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:23:49,008][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:24:04,562][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:24:34,472][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:25:04,173][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:25:11,707][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:25:30,838][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:26:00,514][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:26:30,611][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:26:40,647][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:26:56,543][root][INFO] - Processing question number 40
[2025-03-06 21:26:56,547][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:27:13,692][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:27:18,315][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:27:35,209][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:27:50,037][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:27:59,756][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:28:06,564][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:28:28,384][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:28:40,569][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:28:59,786][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:29:07,889][root][INFO] - Processing question number 50
[2025-03-06 21:29:07,892][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:29:24,436][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:29:38,903][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:29:45,808][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:29:58,490][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:30:18,088][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:30:27,340][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:30:38,799][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:30:50,666][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:30:59,258][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:31:30,552][root][INFO] - Processing question number 60
[2025-03-06 21:31:30,555][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:31:43,597][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:32:04,564][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:32:13,323][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:32:23,493][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:32:39,380][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:32:47,446][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:32:56,653][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:33:11,835][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:33:20,640][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:33:51,180][root][INFO] - Processing question number 70
[2025-03-06 21:33:51,185][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:34:02,589][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:34:24,733][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:34:36,287][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:34:59,841][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:35:08,202][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:35:21,330][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:35:30,965][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:35:38,934][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:35:55,757][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:36:13,462][root][INFO] - Processing question number 80
[2025-03-06 21:36:13,467][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:36:19,791][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:36:29,568][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:36:37,466][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:36:56,648][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:37:10,827][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:37:19,724][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:37:39,714][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:37:49,945][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:38:00,559][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:38:15,897][root][INFO] - Processing question number 90
[2025-03-06 21:38:15,902][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:38:28,562][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:38:37,410][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:38:49,194][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:38:54,967][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:39:11,238][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:39:19,395][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:39:28,979][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:39:49,958][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:40:02,713][root][INFO] - Inference complete
[2025-03-06 21:40:02,713][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,719][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,720][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,721][root][WARNING] - |Q. 35||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,721][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,721][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,721][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,721][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,721][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,722][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,722][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,722][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,722][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,722][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,723][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,723][root][WARNING] - |Q. 84||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,723][root][WARNING] - |Q. 84||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,723][root][INFO] - |Q. 84||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,724][root][WARNING] - |Q. 43||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,725][root][WARNING] - |Q. 43||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,725][root][INFO] - |Q. 43||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,725][root][WARNING] - |Q. 65||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,725][root][WARNING] - |Q. 65||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,725][root][INFO] - |Q. 65||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,726][root][WARNING] - |Q. 87||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,726][root][WARNING] - |Q. 87||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,726][root][INFO] - |Q. 87||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,726][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,726][root][WARNING] - |Q. 3||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,726][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,727][root][WARNING] - |Q. 16||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,727][root][WARNING] - |Q. 16||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,727][root][INFO] - |Q. 16||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,727][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,728][root][WARNING] - |Q. 22||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,728][root][WARNING] - |Q. 22||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,728][root][INFO] - |Q. 22||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,728][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,728][root][WARNING] - |Q. 46||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,729][root][WARNING] - |Q. 46||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,729][root][INFO] - |Q. 46||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,729][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,729][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,730][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,730][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,730][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,732][root][WARNING] - |Q. 90||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,732][root][WARNING] - |Q. 90||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,732][root][INFO] - |Q. 90||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,733][root][WARNING] - |Q. 18||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,733][root][WARNING] - |Q. 18||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,733][root][INFO] - |Q. 18||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,733][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,734][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,734][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:40:02,735][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,735][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:40:02,735][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,735][root][WARNING] - |Q. 13||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,736][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,736][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,736][root][WARNING] - |Q. 39||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,736][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,737][root][WARNING] - |Q. 75||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,737][root][WARNING] - |Q. 75||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,737][root][INFO] - |Q. 75||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,738][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,738][root][WARNING] - |Q. 36||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,738][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,738][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:40:02,738][root][WARNING] - |Q. 45||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:40:02,739][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:40:02,740][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,745][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,745][root][INFO] - Saved parsed outputs
[2025-03-06 21:40:02,745][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,756][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,756][root][INFO] - Saved parsing metadata
[2025-03-06 21:40:02,756][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,758][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:40:02,759][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_10_samples/trained_full_model/greedy/json_answer_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:40:02,786][root][INFO] - Evaluation completed for json_answer_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:40:02,786][root][INFO] - Summary of metrics : {'label_accuracy': 0.37373737373737376, 'misclassification_rate': 0.6262626262626263, 'combined_accuracy': 0.3434343434343434, 'malformed_label': 0, 'malformed_domain': 11, 'total_predictions': 99, 'correct_predictions': 37, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.15151515151515152, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.13131313131313133, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.1717171717171717, 'correct_domain_wrong_label': 54, 'correct_label_wrong_domain': 3, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 19 to status completed with exit code 0
Eval status update completed for job 19
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '19', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_answer_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 19 to status running with exit code None
Eval status update completed for job 19
[2025-03-06 21:40:09,322][root][INFO] - Setting global seed to 989
[2025-03-06 21:40:09,327][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:40:09,327][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : answer_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:40:09,329][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:40:09,330][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:40:09,333][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:40:09,333][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:40:09,493][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-03-06 21:40:09,753][root][INFO] - Full model selected, loading model
[2025-03-06 21:40:24,924][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:41:29,006][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:41:29,007][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:41:54,704][root][INFO] - Peft model loaded successfully
[2025-03-06 21:42:00,831][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'answer_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:42:00,832][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_answer_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:42:00,832][root][INFO] - Starting inference
[2025-03-06 21:42:01,038][root][INFO] - Processing question number 0
[2025-03-06 21:42:01,040][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:42:11,017][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:42:22,047][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:42:34,508][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:42:45,594][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:42:53,953][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:43:09,867][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:43:26,312][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:43:39,270][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:43:47,887][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:43:59,226][root][INFO] - Processing question number 10
[2025-03-06 21:43:59,228][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:44:11,406][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:44:31,858][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:44:41,586][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:44:51,496][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:45:03,624][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:45:15,117][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:45:22,281][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:45:29,839][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:45:38,147][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:45:45,035][root][INFO] - Processing question number 20
[2025-03-06 21:45:45,037][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:45:54,937][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:46:04,894][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:46:13,898][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:46:22,211][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:46:28,394][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:46:47,685][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:47:00,993][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:47:17,388][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:47:29,371][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:47:43,845][root][INFO] - Processing question number 30
[2025-03-06 21:47:43,848][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:47:58,620][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:48:08,898][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:48:18,485][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:48:31,364][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:48:40,239][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:48:50,960][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:49:01,492][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:49:13,930][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:49:37,923][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:49:46,443][root][INFO] - Processing question number 40
[2025-03-06 21:49:46,446][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:49:55,671][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:50:07,927][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:50:18,704][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:50:32,242][root][INFO] - Domain : Torts, Question : 4
