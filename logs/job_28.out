Starting job 28 at Thu Mar  6 19:02:59 CET 2025
Configuration: model=llama3 tokenizer=llama3 dataset=all_domains_10_samples prompt=json_fact_first_few_shot_unstructured train=json_fact_first_few_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '28', 'training']
Updating job 28 to status training with exit code None
Status update completed for job 28
[2025-03-06 19:03:09,320][root][INFO] - Global seed set to 314
[2025-03-06 19:03:09,321][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 19:03:09,321][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 19:03:09,321][root][INFO] - Running Fine-tuning on the all_domains_10_samples dataset
[2025-03-06 19:03:09,321][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 19:03:09,321][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 19:03:09,338][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 19:03:09,343][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 19:03:09,343][root][INFO] - Questions selected, dataset contains 70 questions with 10.0 questions per domain
[2025-03-06 19:03:09,348][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 19:03:10,135][root][INFO] - Tokenizer meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 19:03:38,018][root][INFO] - Quantised model meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 19:04:06,438][root][INFO] - Model prepared for kbit training
[2025-03-06 19:04:06,439][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'v_proj', 'down_proj', 'gate_proj', 'up_proj', 'o_proj', 'q_proj', 'k_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 19:04:08,173][root][INFO] - Lora adapter added to model
[2025-03-06 19:04:08,176][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_fact_first_few_shot_unstructured
[2025-03-06 19:04:08,479][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.8364, 'grad_norm': 0.451797217130661, 'learning_rate': 2e-05, 'epoch': 0.3}
{'loss': 1.8262, 'grad_norm': 0.43043506145477295, 'learning_rate': 4e-05, 'epoch': 0.6}
{'loss': 1.6219, 'grad_norm': 0.3158795237541199, 'learning_rate': 6e-05, 'epoch': 0.9}
{'loss': 1.4769, 'grad_norm': 0.4185749292373657, 'learning_rate': 8e-05, 'epoch': 1.2}
{'loss': 1.1697, 'grad_norm': 0.4249076247215271, 'learning_rate': 0.0001, 'epoch': 1.5}
{'loss': 0.8277, 'grad_norm': 0.5246704816818237, 'learning_rate': 9.951340343707852e-05, 'epoch': 1.8}
{'loss': 0.696, 'grad_norm': 0.2547391653060913, 'learning_rate': 9.806308479691595e-05, 'epoch': 2.1}
{'loss': 0.5875, 'grad_norm': 0.23864534497261047, 'learning_rate': 9.567727288213005e-05, 'epoch': 2.4}
{'loss': 0.6685, 'grad_norm': 0.2143723964691162, 'learning_rate': 9.24024048078213e-05, 'epoch': 2.7}
{'loss': 0.5862, 'grad_norm': 0.1871003806591034, 'learning_rate': 8.83022221559489e-05, 'epoch': 3.0}
{'loss': 0.5639, 'grad_norm': 0.19416676461696625, 'learning_rate': 8.345653031794292e-05, 'epoch': 3.3}
{'loss': 0.5718, 'grad_norm': 0.21442286670207977, 'learning_rate': 7.795964517353735e-05, 'epoch': 3.6}
{'loss': 0.5466, 'grad_norm': 0.19325825572013855, 'learning_rate': 7.191855733945387e-05, 'epoch': 3.9}
{'loss': 0.5382, 'grad_norm': 0.2469528764486313, 'learning_rate': 6.545084971874738e-05, 'epoch': 4.2}
{'loss': 0.4739, 'grad_norm': 0.22450460493564606, 'learning_rate': 5.868240888334653e-05, 'epoch': 4.5}
{'loss': 0.471, 'grad_norm': 0.21011370420455933, 'learning_rate': 5.174497483512506e-05, 'epoch': 4.8}
{'loss': 0.4894, 'grad_norm': 0.20618930459022522, 'learning_rate': 4.477357683661734e-05, 'epoch': 5.1}
{'loss': 0.4159, 'grad_norm': 0.22583633661270142, 'learning_rate': 3.790390522001662e-05, 'epoch': 5.4}
{'loss': 0.4546, 'grad_norm': 0.29923713207244873, 'learning_rate': 3.12696703292044e-05, 'epoch': 5.7}
{'loss': 0.4321, 'grad_norm': 0.2508891522884369, 'learning_rate': 2.500000000000001e-05, 'epoch': 6.0}
{'loss': 0.4346, 'grad_norm': 0.24514201283454895, 'learning_rate': 1.9216926233717085e-05, 'epoch': 6.3}
{'loss': 0.3427, 'grad_norm': 0.25573667883872986, 'learning_rate': 1.4033009983067452e-05, 'epoch': 6.6}
{'loss': 0.4214, 'grad_norm': 0.3068918287754059, 'learning_rate': 9.549150281252633e-06, 'epoch': 6.9}
{'loss': 0.3411, 'grad_norm': 0.2672986686229706, 'learning_rate': 5.852620357053651e-06, 'epoch': 7.2}
{'loss': 0.3882, 'grad_norm': 0.26800262928009033, 'learning_rate': 3.0153689607045845e-06, 'epoch': 7.5}
{'loss': 0.406, 'grad_norm': 0.29387709498405457, 'learning_rate': 1.0926199633097157e-06, 'epoch': 7.8}
{'loss': 0.3924, 'grad_norm': 0.28487512469291687, 'learning_rate': 1.2179748700879012e-07, 'epoch': 8.1}
{'loss': 0.3585, 'grad_norm': 0.2756684422492981, 'learning_rate': 9.987820251299122e-05, 'epoch': 8.4}
{'loss': 0.3575, 'grad_norm': 0.38731685280799866, 'learning_rate': 9.890738003669029e-05, 'epoch': 8.7}
{'loss': 0.2928, 'grad_norm': 0.5522831678390503, 'learning_rate': 9.698463103929542e-05, 'epoch': 9.0}
{'loss': 0.2651, 'grad_norm': 1.4327198266983032, 'learning_rate': 9.414737964294636e-05, 'epoch': 9.3}
{'loss': 0.2314, 'grad_norm': 0.5908089876174927, 'learning_rate': 9.045084971874738e-05, 'epoch': 9.6}
{'loss': 0.2423, 'grad_norm': 0.7412182688713074, 'learning_rate': 8.596699001693255e-05, 'epoch': 9.9}
{'loss': 0.1329, 'grad_norm': 0.35125088691711426, 'learning_rate': 8.07830737662829e-05, 'epoch': 10.2}
{'loss': 0.1608, 'grad_norm': 0.7047476172447205, 'learning_rate': 7.500000000000002e-05, 'epoch': 10.5}
{'loss': 0.1271, 'grad_norm': 0.5019229650497437, 'learning_rate': 6.873032967079561e-05, 'epoch': 10.8}
{'loss': 0.1759, 'grad_norm': 0.5928239226341248, 'learning_rate': 6.209609477998338e-05, 'epoch': 11.1}
{'loss': 0.0651, 'grad_norm': 0.6963244080543518, 'learning_rate': 5.52264231633827e-05, 'epoch': 11.4}
{'loss': 0.1017, 'grad_norm': 0.5311123728752136, 'learning_rate': 4.825502516487497e-05, 'epoch': 11.7}
{'loss': 0.0628, 'grad_norm': 0.3244158923625946, 'learning_rate': 4.131759111665349e-05, 'epoch': 12.0}
{'loss': 0.0535, 'grad_norm': 0.44100311398506165, 'learning_rate': 3.454915028125262e-05, 'epoch': 12.3}
{'loss': 0.033, 'grad_norm': 0.4216790497303009, 'learning_rate': 2.8081442660546142e-05, 'epoch': 12.6}
{'loss': 0.0434, 'grad_norm': 0.391203373670578, 'learning_rate': 2.2040354826462668e-05, 'epoch': 12.9}
{'loss': 0.0241, 'grad_norm': 0.13736695051193237, 'learning_rate': 1.654346968205709e-05, 'epoch': 13.2}
{'loss': 0.027, 'grad_norm': 0.2961745858192444, 'learning_rate': 1.1697777844051105e-05, 'epoch': 13.5}
{'loss': 0.0243, 'grad_norm': 0.1837124079465866, 'learning_rate': 7.597595192178702e-06, 'epoch': 13.8}
{'loss': 0.0207, 'grad_norm': 0.20025932788848877, 'learning_rate': 4.322727117869951e-06, 'epoch': 14.1}
{'loss': 0.0181, 'grad_norm': 0.12715044617652893, 'learning_rate': 1.93691520308405e-06, 'epoch': 14.4}
{'loss': 0.0186, 'grad_norm': 0.16153782606124878, 'learning_rate': 4.865965629214875e-07, 'epoch': 14.7}
{'loss': 0.0164, 'grad_norm': 0.14962536096572876, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 3987.3926, 'train_samples_per_second': 0.263, 'train_steps_per_second': 0.038, 'train_loss': 0.43667626996835074, 'epoch': 15.0}
[2025-03-06 20:10:43,451][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_10_samples/llama3_json_fact_first_few_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '28', 'trained', '0']
Updating job 28 to status trained with exit code 0
Status update completed for job 28
Starting evaluations for job 28
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '28', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 28 to status running with exit code None
Eval status update completed for job 28
[2025-03-06 20:10:51,828][root][INFO] - Setting global seed to 206
[2025-03-06 20:10:51,834][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:10:51,834][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:10:51,835][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:10:51,838][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:10:51,839][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:10:51,840][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:10:52,005][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:10:52,653][root][INFO] - Full model selected, loading model
[2025-03-06 20:11:18,071][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:12:58,576][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:12:58,577][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:13:31,531][root][INFO] - Peft model loaded successfully
[2025-03-06 20:13:39,002][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:13:39,004][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:13:39,004][root][INFO] - Starting inference
[2025-03-06 20:13:39,200][root][INFO] - Processing question number 0
[2025-03-06 20:13:39,202][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:13:44,985][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:13:54,842][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:14:17,464][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:14:32,872][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:14:51,536][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:14:57,692][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:15:17,301][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:15:44,581][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:15:58,509][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:16:23,718][root][INFO] - Processing question number 10
[2025-03-06 20:16:23,719][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:16:44,592][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:16:55,135][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:17:12,242][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:17:35,869][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:17:48,085][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:18:00,949][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:18:09,935][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:18:16,418][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:18:25,820][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:18:35,761][root][INFO] - Processing question number 20
[2025-03-06 20:18:35,763][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:18:47,550][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:18:55,500][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:19:02,296][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:19:07,316][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:19:20,276][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:19:25,138][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:19:31,609][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:19:52,350][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:20:13,407][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:20:24,335][root][INFO] - Processing question number 30
[2025-03-06 20:20:24,338][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:20:31,154][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:20:38,978][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:20:47,451][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:20:58,234][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:21:02,733][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:21:10,500][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:21:23,493][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:21:29,134][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:21:40,832][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:21:49,467][root][INFO] - Processing question number 40
[2025-03-06 20:21:49,470][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:21:58,960][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:22:14,257][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:22:23,345][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:22:30,505][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:22:43,961][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:22:58,473][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:23:29,234][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:23:33,571][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:23:38,932][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:23:56,820][root][INFO] - Processing question number 50
[2025-03-06 20:23:56,825][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:24:13,642][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:24:32,966][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:24:47,570][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:25:01,752][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:25:19,386][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:25:29,562][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:25:37,541][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:25:46,434][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:26:02,499][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:26:08,784][root][INFO] - Processing question number 60
[2025-03-06 20:26:08,788][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:26:18,902][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:26:22,180][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:26:30,489][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:26:39,571][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:26:47,908][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:26:54,040][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:27:00,719][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:27:14,892][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:27:31,889][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:27:40,521][root][INFO] - Processing question number 70
[2025-03-06 20:27:40,525][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:27:51,713][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:27:57,247][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:28:04,718][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:28:11,285][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:28:18,240][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:28:25,389][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:28:35,962][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:28:49,433][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:29:09,290][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:29:20,952][root][INFO] - Processing question number 80
[2025-03-06 20:29:20,957][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:29:26,256][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:29:33,393][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:29:37,601][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:29:44,439][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:29:49,132][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:29:59,737][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:30:09,300][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:30:19,109][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:30:37,121][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:30:50,384][root][INFO] - Processing question number 90
[2025-03-06 20:30:50,389][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:31:10,687][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:31:17,709][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:31:31,865][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:31:38,056][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:31:50,177][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:31:58,571][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:32:08,911][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:32:19,408][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:32:32,101][root][INFO] - Inference complete
[2025-03-06 20:32:32,101][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:32:32,111][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:32:32,113][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,113][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:32:32,113][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,114][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,114][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:32:32,114][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,114][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,114][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:32:32,114][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,116][root][WARNING] - |Q. 9||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,116][root][WARNING] - |Q. 9||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:32:32,116][root][INFO] - |Q. 9||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,116][root][WARNING] - |Q. 29||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,117][root][WARNING] - |Q. 29||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:32:32,117][root][INFO] - |Q. 29||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,117][root][WARNING] - |Q. 79||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,118][root][WARNING] - |Q. 79||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:32:32,118][root][INFO] - |Q. 79||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,118][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:32:32,120][root][WARNING] - |Q. 94||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,120][root][WARNING] - |Q. 94||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:32:32,120][root][INFO] - |Q. 94||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,121][root][WARNING] - |Q. 24||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,121][root][WARNING] - |Q. 24||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:32:32,121][root][INFO] - |Q. 24||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,122][root][WARNING] - |Q. 52||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,122][root][WARNING] - |Q. 52||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:32:32,122][root][INFO] - |Q. 52||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,122][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:32:32,122][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,123][root][WARNING] - |Q. 82||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:32:32,123][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,123][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,124][root][WARNING] - |Q. 12||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:32:32,124][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,124][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:32:32,124][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,124][root][WARNING] - |Q. 31||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:32:32,124][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,124][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:32:32,126][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:32:32,126][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:32:32,126][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:32:32,129][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:32:32,134][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:32:32,135][root][INFO] - Saved parsed outputs
[2025-03-06 20:32:32,135][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:32:32,136][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:32:32,136][root][INFO] - Saved parsing metadata
[2025-03-06 20:32:32,137][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:32:32,138][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:32:32,139][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:32:32,152][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:32:32,152][root][INFO] - Summary of metrics : {'label_accuracy': 0.5252525252525253, 'misclassification_rate': 0.4747474747474747, 'combined_accuracy': 0.5050505050505051, 'malformed_label': 6, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 52, 'correct_label_and_domain': 50, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.7692307692307693, 'Evidence_accuracy': 0.6, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.15151515151515152, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 2, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '28', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 28 to status completed with exit code 0
Eval status update completed for job 28
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '28', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 28 to status running with exit code None
Eval status update completed for job 28
[2025-03-06 20:32:38,486][root][INFO] - Setting global seed to 206
[2025-03-06 20:32:38,491][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:32:38,491][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:32:38,493][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:32:38,494][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:32:38,496][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:32:38,496][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:32:38,687][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:32:39,297][root][INFO] - Full model selected, loading model
[2025-03-06 20:33:05,457][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:34:47,219][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:34:47,220][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:35:21,606][root][INFO] - Peft model loaded successfully
[2025-03-06 20:35:28,983][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:35:28,984][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:35:28,985][root][INFO] - Starting inference
[2025-03-06 20:35:29,202][root][INFO] - Processing question number 0
[2025-03-06 20:35:29,204][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:35:35,264][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:35:45,373][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:35:58,893][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:36:15,957][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:36:30,970][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:36:41,068][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:37:01,168][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:37:31,592][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 20:37:53,585][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 20:38:11,917][root][INFO] - Processing question number 10
[2025-03-06 20:38:11,919][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 20:38:29,986][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 20:38:40,320][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 20:39:03,871][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 20:39:17,627][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 20:39:39,882][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 20:39:52,718][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 20:40:03,605][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 20:40:12,356][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 20:40:22,786][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 20:40:33,708][root][INFO] - Processing question number 20
[2025-03-06 20:40:33,710][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 20:40:45,656][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 20:40:52,847][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 20:40:59,900][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 20:41:07,832][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 20:41:19,021][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 20:41:25,946][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 20:41:35,034][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 20:41:48,930][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 20:42:00,463][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 20:42:06,029][root][INFO] - Processing question number 30
[2025-03-06 20:42:06,032][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 20:42:12,327][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 20:42:19,119][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 20:42:32,307][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 20:42:43,917][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 20:42:48,527][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 20:42:57,494][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 20:43:08,967][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 20:43:18,621][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 20:43:26,689][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 20:43:42,199][root][INFO] - Processing question number 40
[2025-03-06 20:43:42,202][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 20:43:49,450][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 20:44:00,522][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 20:44:07,048][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 20:44:38,564][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 20:44:48,561][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 20:44:59,547][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 20:45:19,111][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 20:45:33,775][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 20:45:40,165][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 20:45:57,037][root][INFO] - Processing question number 50
[2025-03-06 20:45:57,040][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 20:46:17,330][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 20:46:28,661][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 20:46:36,057][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 20:46:46,018][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 20:47:01,875][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 20:47:20,019][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 20:47:33,453][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 20:47:43,073][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 20:47:53,260][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 20:47:58,495][root][INFO] - Processing question number 60
[2025-03-06 20:47:58,498][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 20:48:10,585][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 20:48:37,995][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 20:48:46,921][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 20:48:56,182][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 20:49:12,348][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 20:49:18,531][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 20:49:23,551][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 20:49:33,186][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 20:49:40,280][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 20:49:54,922][root][INFO] - Processing question number 70
[2025-03-06 20:49:54,926][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 20:50:07,630][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 20:50:12,992][root][INFO] - Domain : Property, Question : 6
[2025-03-06 20:50:20,486][root][INFO] - Domain : Property, Question : 13
[2025-03-06 20:50:32,497][root][INFO] - Domain : Property, Question : 20
[2025-03-06 20:50:38,623][root][INFO] - Domain : Property, Question : 33
[2025-03-06 20:50:48,132][root][INFO] - Domain : Property, Question : 39
[2025-03-06 20:50:58,043][root][INFO] - Domain : Property, Question : 48
[2025-03-06 20:51:05,364][root][INFO] - Domain : Property, Question : 54
[2025-03-06 20:51:15,427][root][INFO] - Domain : Property, Question : 61
[2025-03-06 20:51:21,469][root][INFO] - Processing question number 80
[2025-03-06 20:51:21,473][root][INFO] - Domain : Property, Question : 67
[2025-03-06 20:51:44,291][root][INFO] - Domain : Property, Question : 75
[2025-03-06 20:51:52,625][root][INFO] - Domain : Property, Question : 83
[2025-03-06 20:51:59,773][root][INFO] - Domain : Property, Question : 89
[2025-03-06 20:52:11,009][root][INFO] - Domain : Property, Question : 97
[2025-03-06 20:52:18,686][root][INFO] - Domain : Property, Question : 100
[2025-03-06 20:52:30,522][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 20:52:37,808][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 20:52:47,672][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 20:52:58,983][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 20:53:12,677][root][INFO] - Processing question number 90
[2025-03-06 20:53:12,682][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 20:53:25,258][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 20:53:33,233][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 20:53:39,417][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 20:53:44,066][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 20:53:53,085][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 20:54:04,885][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 20:54:12,277][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 20:54:20,841][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 20:54:43,150][root][INFO] - Inference complete
[2025-03-06 20:54:43,150][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:54:43,158][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:54:43,159][root][WARNING] - |Q. 14||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,160][root][WARNING] - |Q. 14||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:54:43,160][root][INFO] - |Q. 14||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,160][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:54:43,161][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,161][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,161][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,162][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,162][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,162][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,162][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,163][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,163][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,163][root][WARNING] - |Q. 77||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,164][root][WARNING] - |Q. 77||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,164][root][INFO] - |Q. 77||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,164][root][WARNING] - |Q. 84||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,164][root][WARNING] - |Q. 84||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:54:43,164][root][INFO] - |Q. 84||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,164][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:54:43,165][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,165][root][WARNING] - |Q. 17||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,165][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,166][root][WARNING] - |Q. 29||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,166][root][WARNING] - |Q. 29||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,166][root][INFO] - |Q. 29||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,167][root][WARNING] - |Q. 79||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,167][root][WARNING] - |Q. 79||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:54:43,167][root][INFO] - |Q. 79||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,167][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:54:43,168][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,168][root][WARNING] - |Q. 51||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,168][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,168][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,169][root][WARNING] - |Q. 66||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,169][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,169][root][WARNING] - |Q. 94||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,170][root][WARNING] - |Q. 94||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:54:43,170][root][INFO] - |Q. 94||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,170][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:54:43,171][root][WARNING] - |Q. 52||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,171][root][WARNING] - |Q. 52||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 20:54:43,171][root][INFO] - |Q. 52||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,171][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 20:54:43,171][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,172][root][WARNING] - |Q. 82||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,172][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,172][root][WARNING] - |Q. 99||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,172][root][WARNING] - |Q. 99||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,172][root][INFO] - |Q. 99||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,173][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,173][root][WARNING] - |Q. 31||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,173][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,174][root][WARNING] - |Q. 44||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,174][root][WARNING] - |Q. 44||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,174][root][INFO] - |Q. 44||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,175][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,176][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,176][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,176][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,176][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,176][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,177][root][WARNING] - |Q. 67||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 20:54:43,177][root][WARNING] - |Q. 67||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 20:54:43,177][root][INFO] - |Q. 67||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 20:54:43,180][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:54:43,185][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:54:43,185][root][INFO] - Saved parsed outputs
[2025-03-06 20:54:43,185][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:54:43,187][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:54:43,187][root][INFO] - Saved parsing metadata
[2025-03-06 20:54:43,187][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:54:43,189][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:54:43,190][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 20:54:43,198][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 20:54:43,198][root][INFO] - Summary of metrics : {'label_accuracy': 0.47474747474747475, 'misclassification_rate': 0.5252525252525253, 'combined_accuracy': 0.4444444444444444, 'malformed_label': 5, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 47, 'correct_label_and_domain': 44, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.5333333333333333, 'Real_Property_accuracy': 0.42857142857142855, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.4375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.15151515151515152, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 49, 'correct_label_wrong_domain': 3, 'both_wrong': 3}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '28', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 28 to status completed with exit code 0
Eval status update completed for job 28
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '28', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 28 to status running with exit code None
Eval status update completed for job 28
[2025-03-06 20:54:50,181][root][INFO] - Setting global seed to 206
[2025-03-06 20:54:50,187][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 20:54:50,187][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 20:54:50,189][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 20:54:50,190][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 20:54:50,192][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 20:54:50,193][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 20:54:50,341][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 20:54:50,968][root][INFO] - Full model selected, loading model
[2025-03-06 20:55:16,238][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 20:56:59,879][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 20:56:59,879][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 20:57:34,592][root][INFO] - Peft model loaded successfully
[2025-03-06 20:57:41,928][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 20:57:41,929][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 20:57:41,929][root][INFO] - Starting inference
[2025-03-06 20:57:42,114][root][INFO] - Processing question number 0
[2025-03-06 20:57:42,123][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 20:57:53,460][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 20:58:07,940][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 20:58:23,922][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 20:58:41,489][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 20:58:54,837][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 20:59:09,304][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 20:59:30,517][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 20:59:53,385][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:00:05,217][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:00:25,631][root][INFO] - Processing question number 10
[2025-03-06 21:00:25,633][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:00:31,901][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:00:44,196][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:00:54,376][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:01:13,939][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:01:27,291][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:01:57,994][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:02:06,858][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:02:15,220][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:02:21,245][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:02:34,776][root][INFO] - Processing question number 20
[2025-03-06 21:02:34,778][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:02:44,435][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:02:49,951][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:02:56,905][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:03:02,833][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:03:11,316][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:03:18,473][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:03:27,852][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:03:34,484][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:03:48,365][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:03:55,375][root][INFO] - Processing question number 30
[2025-03-06 21:03:55,377][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:04:06,057][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:04:15,583][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:04:24,857][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:04:43,008][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:04:48,686][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:04:56,580][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:05:05,681][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:05:12,552][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:05:21,138][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:05:34,303][root][INFO] - Processing question number 40
[2025-03-06 21:05:34,311][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:05:44,261][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:05:54,910][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:06:05,965][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:06:15,202][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:06:26,279][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:06:37,404][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:06:59,973][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:07:04,426][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:07:09,141][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:07:28,114][root][INFO] - Processing question number 50
[2025-03-06 21:07:28,118][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:07:39,961][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:08:01,171][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:08:15,398][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:08:26,267][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:08:38,535][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:08:48,457][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:08:59,352][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:09:11,331][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:09:29,385][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:09:35,264][root][INFO] - Processing question number 60
[2025-03-06 21:09:35,267][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:09:51,796][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:10:00,404][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:10:32,054][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:10:41,745][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:10:51,301][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:11:10,365][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:11:23,835][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:11:51,169][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:11:57,072][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:12:07,015][root][INFO] - Processing question number 70
[2025-03-06 21:12:07,020][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:12:23,371][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:12:31,022][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:12:42,412][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:12:48,443][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:12:56,917][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:13:04,089][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:13:28,825][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:13:47,124][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:13:59,654][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:14:05,055][root][INFO] - Processing question number 80
[2025-03-06 21:14:05,060][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:14:12,131][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:14:21,826][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:14:30,462][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:14:35,598][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:14:40,732][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:14:49,838][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:14:58,645][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:15:13,677][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:15:24,685][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:15:31,988][root][INFO] - Processing question number 90
[2025-03-06 21:15:31,993][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:15:51,242][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:15:59,032][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:16:06,620][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:16:12,632][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:16:25,439][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:16:33,984][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:16:45,529][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:16:56,127][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:17:07,802][root][INFO] - Inference complete
[2025-03-06 21:17:07,802][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:07,809][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:07,810][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,810][root][WARNING] - |Q. 7||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,810][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,811][root][WARNING] - |Q. 14||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,811][root][WARNING] - |Q. 14||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:17:07,811][root][INFO] - |Q. 14||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,811][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:17:07,812][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,813][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,813][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,813][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,813][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,813][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,814][root][WARNING] - |Q. 63||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,814][root][WARNING] - |Q. 63||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,814][root][INFO] - |Q. 63||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,815][root][WARNING] - |Q. 98||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,816][root][WARNING] - |Q. 98||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:17:07,816][root][INFO] - |Q. 98||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,816][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:17:07,816][root][WARNING] - |Q. 29||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,816][root][WARNING] - |Q. 29||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,817][root][INFO] - |Q. 29||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,819][root][WARNING] - |Q. 66||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,819][root][WARNING] - |Q. 66||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:17:07,819][root][INFO] - |Q. 66||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,819][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:17:07,820][root][WARNING] - |Q. 52||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,821][root][WARNING] - |Q. 52||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:17:07,821][root][INFO] - |Q. 52||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,821][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:17:07,821][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,821][root][WARNING] - |Q. 82||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,821][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,822][root][WARNING] - |Q. 99||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,822][root][WARNING] - |Q. 99||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,822][root][INFO] - |Q. 99||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,822][root][WARNING] - |Q. 5||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,822][root][WARNING] - |Q. 5||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,823][root][INFO] - |Q. 5||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,823][root][WARNING] - |Q. 34||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,824][root][WARNING] - |Q. 34||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:17:07,824][root][INFO] - |Q. 34||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,824][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:17:07,825][root][WARNING] - |Q. 6||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,825][root][WARNING] - |Q. 6||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,825][root][INFO] - |Q. 6||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,826][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,826][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,826][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,826][root][WARNING] - |Q. 48||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,827][root][WARNING] - |Q. 48||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:17:07,827][root][INFO] - |Q. 48||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,828][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:17:07,828][root][WARNING] - |Q. 36||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:17:07,828][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:17:07,828][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:17:07,830][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:07,836][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:07,836][root][INFO] - Saved parsed outputs
[2025-03-06 21:17:07,836][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:07,837][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:07,837][root][INFO] - Saved parsing metadata
[2025-03-06 21:17:07,838][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:07,840][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:17:07,841][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_10_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:17:07,851][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:17:07,851][root][INFO] - Summary of metrics : {'label_accuracy': 0.5353535353535354, 'misclassification_rate': 0.46464646464646464, 'combined_accuracy': 0.494949494949495, 'malformed_label': 6, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 53, 'correct_label_and_domain': 49, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.8461538461538461, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.15151515151515152, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 44, 'correct_label_wrong_domain': 4, 'both_wrong': 2}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '28', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 28 to status completed with exit code 0
Eval status update completed for job 28
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '28', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 28 to status running with exit code None
Eval status update completed for job 28
[2025-03-06 21:17:15,037][root][INFO] - Setting global seed to 989
[2025-03-06 21:17:15,043][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:17:15,043][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:17:15,044][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:17:15,046][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:17:15,048][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:17:15,049][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:17:15,211][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:17:15,959][root][INFO] - Full model selected, loading model
[2025-03-06 21:17:44,878][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:19:35,973][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:19:35,973][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:20:10,092][root][INFO] - Peft model loaded successfully
[2025-03-06 21:20:17,930][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:20:17,932][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:20:17,932][root][INFO] - Starting inference
[2025-03-06 21:20:18,105][root][INFO] - Processing question number 0
[2025-03-06 21:20:18,107][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:20:23,664][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:20:33,536][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:20:56,187][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:21:11,592][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:21:30,232][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:21:36,395][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:21:56,016][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:22:23,315][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:22:37,245][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:23:02,456][root][INFO] - Processing question number 10
[2025-03-06 21:23:02,458][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:23:23,326][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:23:33,871][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:23:50,980][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:24:14,633][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:24:26,863][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:24:39,739][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:24:48,732][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:24:55,220][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:25:04,631][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:25:14,591][root][INFO] - Processing question number 20
[2025-03-06 21:25:14,594][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:25:26,452][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:25:34,477][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:25:41,317][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:25:46,357][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:25:59,330][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:26:04,202][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:26:10,677][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:26:31,436][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:26:52,522][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:27:03,473][root][INFO] - Processing question number 30
[2025-03-06 21:27:03,476][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:27:10,300][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:27:18,115][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:27:26,528][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:27:37,243][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:27:41,725][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:27:49,480][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:28:02,494][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:28:08,142][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:28:19,849][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:28:28,498][root][INFO] - Processing question number 40
[2025-03-06 21:28:28,501][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 21:28:38,004][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 21:28:53,323][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 21:29:02,419][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 21:29:09,586][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 21:29:23,057][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 21:29:37,584][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 21:30:08,374][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 21:30:12,720][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 21:30:18,090][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 21:30:36,004][root][INFO] - Processing question number 50
[2025-03-06 21:30:36,007][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 21:30:52,847][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 21:31:12,197][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 21:31:26,812][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 21:31:41,013][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 21:31:58,662][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 21:32:08,847][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 21:32:16,834][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 21:32:25,735][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 21:32:41,814][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 21:32:48,102][root][INFO] - Processing question number 60
[2025-03-06 21:32:48,106][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 21:32:58,236][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 21:33:01,517][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 21:33:09,830][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 21:33:18,922][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 21:33:27,259][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 21:33:33,400][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 21:33:40,085][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 21:33:54,270][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 21:34:11,290][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 21:34:19,939][root][INFO] - Processing question number 70
[2025-03-06 21:34:19,943][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 21:34:31,150][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 21:34:36,691][root][INFO] - Domain : Property, Question : 6
[2025-03-06 21:34:44,175][root][INFO] - Domain : Property, Question : 13
[2025-03-06 21:34:50,753][root][INFO] - Domain : Property, Question : 20
[2025-03-06 21:34:57,716][root][INFO] - Domain : Property, Question : 33
[2025-03-06 21:35:04,879][root][INFO] - Domain : Property, Question : 39
[2025-03-06 21:35:15,480][root][INFO] - Domain : Property, Question : 48
[2025-03-06 21:35:28,994][root][INFO] - Domain : Property, Question : 54
[2025-03-06 21:35:48,905][root][INFO] - Domain : Property, Question : 61
[2025-03-06 21:36:00,586][root][INFO] - Processing question number 80
[2025-03-06 21:36:00,591][root][INFO] - Domain : Property, Question : 67
[2025-03-06 21:36:05,892][root][INFO] - Domain : Property, Question : 75
[2025-03-06 21:36:13,010][root][INFO] - Domain : Property, Question : 83
[2025-03-06 21:36:17,196][root][INFO] - Domain : Property, Question : 89
[2025-03-06 21:36:24,000][root][INFO] - Domain : Property, Question : 97
[2025-03-06 21:36:28,673][root][INFO] - Domain : Property, Question : 100
[2025-03-06 21:36:39,220][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 21:36:48,778][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 21:36:58,558][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 21:37:16,491][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 21:37:29,736][root][INFO] - Processing question number 90
[2025-03-06 21:37:29,741][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 21:37:49,916][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 21:37:56,903][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 21:38:11,074][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 21:38:17,281][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 21:38:29,424][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 21:38:37,833][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 21:38:48,190][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 21:38:58,700][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 21:39:11,410][root][INFO] - Inference complete
[2025-03-06 21:39:11,410][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:11,417][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:11,419][root][WARNING] - |Q. 42||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,419][root][WARNING] - |Q. 42||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:11,419][root][INFO] - |Q. 42||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,420][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,420][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:11,420][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,420][root][WARNING] - |Q. 56||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,420][root][WARNING] - |Q. 56||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:11,420][root][INFO] - |Q. 56||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,422][root][WARNING] - |Q. 9||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,422][root][WARNING] - |Q. 9||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:11,422][root][INFO] - |Q. 9||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,422][root][WARNING] - |Q. 29||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,423][root][WARNING] - |Q. 29||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:11,423][root][INFO] - |Q. 29||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,423][root][WARNING] - |Q. 79||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,424][root][WARNING] - |Q. 79||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:39:11,424][root][INFO] - |Q. 79||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,424][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:39:11,426][root][WARNING] - |Q. 94||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,426][root][WARNING] - |Q. 94||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:11,426][root][INFO] - |Q. 94||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,427][root][WARNING] - |Q. 24||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,427][root][WARNING] - |Q. 24||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:11,427][root][INFO] - |Q. 24||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,428][root][WARNING] - |Q. 52||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,428][root][WARNING] - |Q. 52||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:39:11,428][root][INFO] - |Q. 52||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,428][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:39:11,428][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,429][root][WARNING] - |Q. 82||D: Torts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:11,429][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,429][root][WARNING] - |Q. 12||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,430][root][WARNING] - |Q. 12||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:39:11,430][root][INFO] - |Q. 12||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,430][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:39:11,430][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,430][root][WARNING] - |Q. 31||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 21:39:11,430][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,430][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 21:39:11,432][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 21:39:11,432][root][WARNING] - |Q. 33||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 21:39:11,432][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 21:39:11,435][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:11,440][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:11,440][root][INFO] - Saved parsed outputs
[2025-03-06 21:39:11,441][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:11,442][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:11,442][root][INFO] - Saved parsing metadata
[2025-03-06 21:39:11,443][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:11,444][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:39:11,446][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_10_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 21:39:11,476][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 21:39:11,476][root][INFO] - Summary of metrics : {'label_accuracy': 0.5252525252525253, 'misclassification_rate': 0.4747474747474747, 'combined_accuracy': 0.5050505050505051, 'malformed_label': 6, 'malformed_domain': 6, 'total_predictions': 99, 'correct_predictions': 52, 'correct_label_and_domain': 50, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.42857142857142855, 'Criminal_Law_accuracy': 0.7692307692307693, 'Evidence_accuracy': 0.6, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.15151515151515152, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.12121212121212122, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.16161616161616163, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 2, 'both_wrong': 4}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '28', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 28 to status completed with exit code 0
Eval status update completed for job 28
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '28', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_10_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 28 to status running with exit code None
Eval status update completed for job 28
[2025-03-06 21:39:36,716][root][INFO] - Setting global seed to 989
[2025-03-06 21:39:36,790][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 21:39:36,790][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 21:39:36,792][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 21:39:36,794][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 21:39:36,797][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 21:39:36,797][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 21:39:36,972][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 21:39:37,544][root][INFO] - Full model selected, loading model
[2025-03-06 21:40:02,468][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 21:41:47,313][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 21:41:47,314][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 21:42:24,731][root][INFO] - Peft model loaded successfully
[2025-03-06 21:42:32,572][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 21:42:32,573][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_10_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 21:42:32,573][root][INFO] - Starting inference
[2025-03-06 21:42:32,771][root][INFO] - Processing question number 0
[2025-03-06 21:42:32,774][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 21:42:40,528][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 21:42:50,622][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 21:43:04,882][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 21:43:21,621][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 21:43:46,758][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 21:43:58,767][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 21:44:19,317][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 21:44:36,314][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 21:44:50,603][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 21:45:08,719][root][INFO] - Processing question number 10
[2025-03-06 21:45:08,721][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 21:45:22,551][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 21:45:35,553][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 21:45:59,894][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 21:46:23,061][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 21:46:35,540][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 21:46:56,883][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 21:47:06,495][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 21:47:15,443][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 21:47:20,903][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 21:47:30,395][root][INFO] - Processing question number 20
[2025-03-06 21:47:30,397][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 21:47:37,894][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 21:47:43,015][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 21:47:50,857][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 21:47:58,249][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 21:48:06,467][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 21:48:12,109][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 21:48:21,241][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 21:48:35,220][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 21:48:47,353][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 21:48:52,915][root][INFO] - Processing question number 30
[2025-03-06 21:48:52,917][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 21:48:58,862][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 21:49:10,695][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 21:49:19,572][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 21:49:29,198][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 21:49:33,711][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 21:49:41,775][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 21:49:55,400][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 21:50:07,361][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 21:50:15,535][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 21:50:34,019][root][INFO] - Processing question number 40
[2025-03-06 21:50:34,022][root][INFO] - Domain : Contracts, Question : 72
