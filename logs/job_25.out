Starting job 25 at Thu Feb 20 23:37:31 CET 2025
Configuration: model=llama2 tokenizer=llama2 dataset=all_domains_1_samples prompt=markdown_fact_first_few_shot_structured train=markdown_fact_first_few_shot_structured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '25', 'training']
Updating job 25 to status training with exit code None
Status update completed for job 25
[2025-02-20 23:37:47,716][root][INFO] - Global seed set to 314
[2025-02-20 23:37:47,717][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-02-20 23:37:47,718][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-02-20 23:37:47,718][root][INFO] - Running Fine-tuning on the all_domains_1_samples dataset
[2025-02-20 23:37:47,718][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-20 23:37:47,718][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/distilled_dataset.json
[2025-02-20 23:37:47,733][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-20 23:37:47,737][root][INFO] - Indexing complete, sampling of questions set to True
[2025-02-20 23:37:47,738][root][INFO] - Questions selected, dataset contains 7 questions with 1.0 questions per domain
[2025-02-20 23:37:47,761][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-02-20 23:37:48,178][root][INFO] - Tokenizer meta-llama/Llama-2-7b-hf loaded successfully
[2025-02-20 23:38:02,041][root][INFO] - Quantised model meta-llama/Llama-2-7b-hf loaded successfully
[2025-02-20 23:38:30,503][root][INFO] - Model prepared for kbit training
[2025-02-20 23:38:30,504][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'v_proj', 'down_proj', 'o_proj', 'gate_proj', 'up_proj', 'k_proj', 'q_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-02-20 23:38:32,196][root][INFO] - Lora adapter added to model
[2025-02-20 23:38:32,198][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_1_samples/llama2_markdown_fact_first_few_shot_structured
[2025-02-20 23:38:32,297][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.4802, 'grad_norm': 0.16316446661949158, 'learning_rate': 9.42728012826605e-05, 'epoch': 3.0}
{'loss': 1.3173, 'grad_norm': 0.1910172551870346, 'learning_rate': 3.226975564787322e-05, 'epoch': 6.0}
{'loss': 1.189, 'grad_norm': 0.1943253129720688, 'learning_rate': 9.85470908713026e-05, 'epoch': 9.0}
{'loss': 1.0827, 'grad_norm': 0.253012090921402, 'learning_rate': 4.397316598723383e-05, 'epoch': 12.0}
{'loss': 0.8893, 'grad_norm': 0.23555314540863037, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 360.6212, 'train_samples_per_second': 0.291, 'train_steps_per_second': 0.042, 'train_loss': 1.1917234897613525, 'epoch': 15.0}
[2025-02-20 23:44:36,242][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama2/all_domains_1_samples/llama2_markdown_fact_first_few_shot_structured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '25', 'trained', '0']
Updating job 25 to status trained with exit code 0
Status update completed for job 25
Starting evaluations for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-20 23:44:44,955][root][INFO] - Setting global seed to 206
[2025-02-20 23:44:44,960][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-02-20 23:44:44,960][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-20 23:44:44,962][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-20 23:44:44,963][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-20 23:44:44,965][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-20 23:44:44,966][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-20 23:44:45,108][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-20 23:44:45,381][root][INFO] - Full model selected, loading model
[2025-02-20 23:45:06,868][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-20 23:46:08,343][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-20 23:46:08,344][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-20 23:46:34,893][root][INFO] - Peft model loaded successfully
[2025-02-20 23:46:41,118][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-20 23:46:41,120][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-20 23:46:41,120][root][INFO] - Starting inference
[2025-02-20 23:46:41,315][root][INFO] - Processing question number 0
[2025-02-20 23:46:41,347][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-20 23:47:14,067][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-20 23:47:45,358][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-20 23:48:16,201][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-20 23:48:47,538][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-20 23:49:18,296][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-20 23:49:49,007][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-20 23:50:20,484][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-20 23:50:51,453][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-20 23:51:22,108][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-20 23:51:53,433][root][INFO] - Processing question number 10
[2025-02-20 23:51:53,435][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-20 23:52:26,081][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-20 23:52:56,485][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-20 23:53:27,436][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-20 23:53:58,965][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-20 23:54:30,462][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-20 23:55:00,936][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-20 23:55:31,334][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-20 23:56:02,239][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-20 23:56:33,120][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-20 23:57:03,730][root][INFO] - Processing question number 20
[2025-02-20 23:57:03,733][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-20 23:57:34,590][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-20 23:58:05,622][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-20 23:58:36,106][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-20 23:59:06,511][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-20 23:59:37,719][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 00:00:08,638][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 00:00:40,341][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 00:01:11,220][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 00:01:42,217][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 00:02:12,542][root][INFO] - Processing question number 30
[2025-02-21 00:02:12,545][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 00:02:43,913][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 00:03:15,597][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 00:03:46,589][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 00:04:17,432][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 00:04:48,170][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 00:05:19,619][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 00:05:50,431][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 00:06:21,672][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 00:06:52,656][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 00:07:24,388][root][INFO] - Processing question number 40
[2025-02-21 00:07:24,393][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 00:07:56,707][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 00:08:27,751][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 00:08:59,278][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 00:09:30,740][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 00:10:01,489][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 00:10:32,486][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 00:11:04,757][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 00:11:34,835][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 00:12:05,736][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 00:12:37,324][root][INFO] - Processing question number 50
[2025-02-21 00:12:37,328][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 00:13:09,081][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 00:13:40,283][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 00:14:10,639][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 00:14:42,728][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 00:15:13,889][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 00:15:44,010][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 00:16:15,736][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 00:16:46,244][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 00:17:17,822][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 00:17:50,173][root][INFO] - Processing question number 60
[2025-02-21 00:17:50,179][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 00:18:20,673][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 00:18:51,532][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 00:19:23,021][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 00:19:53,489][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 00:20:24,451][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 00:20:55,478][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 00:21:26,516][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 00:21:57,904][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 00:22:29,257][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 00:23:01,113][root][INFO] - Processing question number 70
[2025-02-21 00:23:01,118][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 00:23:32,075][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 00:24:03,099][root][INFO] - Domain : Property, Question : 6
[2025-02-21 00:24:34,019][root][INFO] - Domain : Property, Question : 13
[2025-02-21 00:25:05,432][root][INFO] - Domain : Property, Question : 20
[2025-02-21 00:25:36,743][root][INFO] - Domain : Property, Question : 33
[2025-02-21 00:26:07,303][root][INFO] - Domain : Property, Question : 39
[2025-02-21 00:26:38,721][root][INFO] - Domain : Property, Question : 48
[2025-02-21 00:27:09,970][root][INFO] - Domain : Property, Question : 54
[2025-02-21 00:27:41,388][root][INFO] - Domain : Property, Question : 61
[2025-02-21 00:28:12,211][root][INFO] - Processing question number 80
[2025-02-21 00:28:12,217][root][INFO] - Domain : Property, Question : 67
[2025-02-21 00:28:43,514][root][INFO] - Domain : Property, Question : 75
[2025-02-21 00:29:14,842][root][INFO] - Domain : Property, Question : 83
[2025-02-21 00:29:45,604][root][INFO] - Domain : Property, Question : 89
[2025-02-21 00:30:16,404][root][INFO] - Domain : Property, Question : 97
[2025-02-21 00:30:47,978][root][INFO] - Domain : Property, Question : 100
[2025-02-21 00:31:24,602][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 00:31:56,014][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 00:32:26,759][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 00:32:58,558][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 00:33:29,015][root][INFO] - Processing question number 90
[2025-02-21 00:33:29,021][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 00:34:00,939][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 00:34:30,917][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 00:35:01,794][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 00:35:31,923][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 00:36:03,348][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 00:36:33,809][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 00:37:04,615][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 00:37:35,758][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 00:38:07,327][root][INFO] - Inference complete
[2025-02-21 00:38:07,327][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 00:38:07,335][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 00:38:07,342][root][ERROR] - |Q. 6||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 00:38:07,346][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 00:38:07,379][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 00:38:07,379][root][INFO] - Saved parsed outputs
[2025-02-21 00:38:07,379][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 00:38:07,409][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 00:38:07,409][root][INFO] - Saved parsing metadata
[2025-02-21 00:38:07,410][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 00:38:07,412][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 00:38:07,432][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 00:38:07,472][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 00:38:07,472][root][INFO] - Summary of metrics : {'label_accuracy': 0.32323232323232326, 'misclassification_rate': 0.6767676767676767, 'combined_accuracy': 0.2222222222222222, 'malformed_label': 2, 'malformed_domain': 31, 'total_predictions': 99, 'correct_predictions': 32, 'correct_label_and_domain': 22, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.12121212121212122, 'Contracts_confidence': 0.2222222222222222, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.0707070707070707, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.09090909090909091, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 10, 'both_wrong': 21}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 00:38:22,066][root][INFO] - Setting global seed to 206
[2025-02-21 00:38:22,073][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-02-21 00:38:22,073][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 00:38:22,075][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 00:38:22,077][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 00:38:22,082][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 00:38:22,082][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 00:38:22,229][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 00:38:22,478][root][INFO] - Full model selected, loading model
[2025-02-21 00:38:39,943][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 00:38:39,944][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 00:38:46,502][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 00:38:46,504][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 00:38:46,504][root][INFO] - Starting inference
[2025-02-21 00:38:46,624][root][INFO] - Processing question number 0
[2025-02-21 00:38:46,626][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 00:39:16,745][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 00:39:48,185][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 00:40:18,867][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 00:40:50,055][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 00:41:20,597][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 00:41:51,095][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 00:42:22,429][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 00:42:53,264][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 00:43:23,715][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 00:43:54,908][root][INFO] - Processing question number 10
[2025-02-21 00:43:54,910][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 00:44:27,363][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 00:44:57,627][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 00:45:28,417][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 00:45:59,800][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 00:46:31,155][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 00:47:01,480][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 00:47:31,727][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 00:48:02,480][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 00:48:33,208][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 00:49:03,659][root][INFO] - Processing question number 20
[2025-02-21 00:49:03,661][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 00:49:34,364][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 00:50:05,258][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 00:50:35,587][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 00:51:05,849][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 00:51:36,817][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 00:52:07,584][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 00:52:39,135][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 00:53:09,867][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 00:53:40,726][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 00:54:10,916][root][INFO] - Processing question number 30
[2025-02-21 00:54:10,919][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 00:54:42,058][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 00:55:13,428][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 00:55:44,279][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 00:56:14,968][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 00:56:45,493][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 00:57:16,805][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 00:57:47,472][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 00:58:18,601][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 00:58:49,436][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 00:59:21,020][root][INFO] - Processing question number 40
[2025-02-21 00:59:21,023][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 00:59:52,043][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 01:00:23,134][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 01:00:54,651][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 01:01:26,174][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 01:01:56,879][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 01:02:27,880][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 01:03:00,134][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 01:03:30,236][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 01:04:01,015][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 01:04:32,453][root][INFO] - Processing question number 50
[2025-02-21 01:04:32,457][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 01:05:04,082][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 01:05:35,059][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 01:06:05,277][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 01:06:37,198][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 01:07:08,136][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 01:07:38,111][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 01:08:09,698][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 01:08:40,063][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 01:09:11,489][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 01:09:43,716][root][INFO] - Processing question number 60
[2025-02-21 01:09:43,721][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 01:10:14,110][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 01:10:44,853][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 01:11:16,225][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 01:11:46,561][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 01:12:17,396][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 01:12:48,286][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 01:13:19,199][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 01:13:50,457][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 01:14:21,439][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 01:14:52,976][root][INFO] - Processing question number 70
[2025-02-21 01:14:52,981][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 01:15:23,666][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 01:15:54,404][root][INFO] - Domain : Property, Question : 6
[2025-02-21 01:16:24,948][root][INFO] - Domain : Property, Question : 13
[2025-02-21 01:16:56,180][root][INFO] - Domain : Property, Question : 20
[2025-02-21 01:17:28,725][root][INFO] - Domain : Property, Question : 33
[2025-02-21 01:17:59,230][root][INFO] - Domain : Property, Question : 39
[2025-02-21 01:18:30,684][root][INFO] - Domain : Property, Question : 48
[2025-02-21 01:19:01,815][root][INFO] - Domain : Property, Question : 54
[2025-02-21 01:19:33,098][root][INFO] - Domain : Property, Question : 61
[2025-02-21 01:20:03,783][root][INFO] - Processing question number 80
[2025-02-21 01:20:03,793][root][INFO] - Domain : Property, Question : 67
[2025-02-21 01:20:34,949][root][INFO] - Domain : Property, Question : 75
[2025-02-21 01:21:06,094][root][INFO] - Domain : Property, Question : 83
[2025-02-21 01:21:36,651][root][INFO] - Domain : Property, Question : 89
[2025-02-21 01:22:07,308][root][INFO] - Domain : Property, Question : 97
[2025-02-21 01:22:38,715][root][INFO] - Domain : Property, Question : 100
[2025-02-21 01:23:09,949][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 01:23:41,238][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 01:24:11,794][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 01:24:42,802][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 01:25:13,127][root][INFO] - Processing question number 90
[2025-02-21 01:25:13,135][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 01:25:44,909][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 01:26:14,752][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 01:26:45,479][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 01:27:15,476][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 01:27:46,763][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 01:28:17,079][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 01:28:47,739][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 01:29:18,675][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 01:29:50,085][root][INFO] - Inference complete
[2025-02-21 01:29:50,085][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 01:29:50,093][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 01:29:50,098][root][ERROR] - |Q. 22||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 01:29:50,101][root][ERROR] - |Q. 82||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 01:29:50,101][root][ERROR] - |Q. 12||D: Evidence| Failed to extract Legal_conclusion: 
[2025-02-21 01:29:50,101][root][ERROR] - |Q. 12||D: Evidence| Failed to extract chosen option: 
[2025-02-21 01:29:50,103][root][ERROR] - |Q. 13||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 01:29:50,104][root][ERROR] - |Q. 39||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 01:29:50,105][root][ERROR] - |Q. 100||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 01:29:50,107][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 01:29:50,114][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 01:29:50,114][root][INFO] - Saved parsed outputs
[2025-02-21 01:29:50,114][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 01:29:50,115][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 01:29:50,116][root][INFO] - Saved parsing metadata
[2025-02-21 01:29:50,116][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 01:29:50,119][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 01:29:50,121][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 01:29:50,136][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 01:29:50,136][root][INFO] - Summary of metrics : {'label_accuracy': 0.35353535353535354, 'misclassification_rate': 0.6464646464646464, 'combined_accuracy': 0.2222222222222222, 'malformed_label': 1, 'malformed_domain': 31, 'total_predictions': 99, 'correct_predictions': 35, 'correct_label_and_domain': 22, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.2222222222222222, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.06060606060606061, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.08080808080808081, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 13, 'both_wrong': 18}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 01:29:57,865][root][INFO] - Setting global seed to 206
[2025-02-21 01:29:57,873][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-02-21 01:29:57,873][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 01:29:57,875][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 01:29:57,877][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 01:29:57,878][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 01:29:57,879][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 01:29:58,037][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 01:29:58,306][root][INFO] - Full model selected, loading model
[2025-02-21 01:30:15,700][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 01:31:16,954][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 01:31:16,954][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 01:31:43,364][root][INFO] - Peft model loaded successfully
[2025-02-21 01:31:49,679][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 01:31:49,681][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 01:31:49,681][root][INFO] - Starting inference
[2025-02-21 01:31:49,852][root][INFO] - Processing question number 0
[2025-02-21 01:31:49,854][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 01:32:20,520][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 01:32:52,003][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 01:33:23,011][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 01:33:54,497][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 01:34:25,418][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 01:34:56,291][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 01:35:27,944][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 01:35:59,082][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 01:36:29,911][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 01:37:01,419][root][INFO] - Processing question number 10
[2025-02-21 01:37:01,421][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 01:37:34,284][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 01:38:04,854][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 01:38:35,970][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 01:39:10,626][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 01:39:42,311][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 01:40:12,944][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 01:40:43,594][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 01:41:14,846][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 01:41:46,045][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 01:42:16,980][root][INFO] - Processing question number 20
[2025-02-21 01:42:16,983][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 01:42:48,130][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 01:43:19,511][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 01:43:50,137][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 01:44:20,700][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 01:44:52,070][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 01:45:23,145][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 01:45:55,007][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 01:46:26,041][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 01:46:57,207][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 01:47:27,696][root][INFO] - Processing question number 30
[2025-02-21 01:47:27,699][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 01:47:59,123][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 01:48:30,797][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 01:49:01,948][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 01:49:32,944][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 01:50:03,840][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 01:50:35,453][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 01:51:06,417][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 01:51:37,832][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 01:52:08,976][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 01:52:40,870][root][INFO] - Processing question number 40
[2025-02-21 01:52:40,873][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 01:53:12,066][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 01:53:43,243][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 01:54:14,935][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 01:54:46,565][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 01:55:17,477][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 01:55:48,626][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 01:56:21,068][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 01:56:51,315][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 01:57:22,362][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 01:57:54,097][root][INFO] - Processing question number 50
[2025-02-21 01:57:54,101][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 01:58:26,019][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 01:58:57,530][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 01:59:28,114][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 02:00:00,405][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 02:00:31,732][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 02:01:02,024][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 02:01:33,904][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 02:02:04,560][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 02:02:36,291][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 02:03:08,790][root][INFO] - Processing question number 60
[2025-02-21 02:03:08,795][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 02:03:39,433][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 02:04:10,445][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 02:04:42,074][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 02:05:12,690][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 02:05:43,818][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 02:06:14,997][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 02:06:46,214][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 02:07:17,914][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 02:07:49,398][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 02:08:21,353][root][INFO] - Processing question number 70
[2025-02-21 02:08:21,358][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 02:08:52,482][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 02:09:23,498][root][INFO] - Domain : Property, Question : 6
[2025-02-21 02:09:54,394][root][INFO] - Domain : Property, Question : 13
[2025-02-21 02:10:25,903][root][INFO] - Domain : Property, Question : 20
[2025-02-21 02:10:57,366][root][INFO] - Domain : Property, Question : 33
[2025-02-21 02:11:28,079][root][INFO] - Domain : Property, Question : 39
[2025-02-21 02:11:59,648][root][INFO] - Domain : Property, Question : 48
[2025-02-21 02:12:31,080][root][INFO] - Domain : Property, Question : 54
[2025-02-21 02:13:02,661][root][INFO] - Domain : Property, Question : 61
[2025-02-21 02:13:33,649][root][INFO] - Processing question number 80
[2025-02-21 02:13:33,655][root][INFO] - Domain : Property, Question : 67
[2025-02-21 02:14:05,112][root][INFO] - Domain : Property, Question : 75
[2025-02-21 02:14:36,555][root][INFO] - Domain : Property, Question : 83
[2025-02-21 02:15:07,478][root][INFO] - Domain : Property, Question : 89
[2025-02-21 02:15:38,427][root][INFO] - Domain : Property, Question : 97
[2025-02-21 02:16:10,146][root][INFO] - Domain : Property, Question : 100
[2025-02-21 02:16:41,669][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 02:17:13,259][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 02:17:44,177][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 02:18:15,622][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 02:18:46,408][root][INFO] - Processing question number 90
[2025-02-21 02:18:46,414][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 02:19:18,619][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 02:19:48,943][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 02:20:20,081][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 02:20:50,555][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 02:21:22,142][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 02:21:52,750][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 02:22:23,712][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 02:22:55,027][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 02:23:26,767][root][INFO] - Inference complete
[2025-02-21 02:23:26,767][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 02:23:26,775][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 02:23:26,776][root][ERROR] - Failed to extract domain:  for response: 6
[2025-02-21 02:23:26,776][root][ERROR] - |Q. 35||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 02:23:26,777][root][ERROR] - |Q. 35||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 02:23:26,777][root][ERROR] - |Q. 35||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 02:23:26,777][root][ERROR] - |Q. 77||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 02:23:26,779][root][ERROR] - Failed to extract domain:  for response: 35
[2025-02-21 02:23:26,779][root][ERROR] - |Q. 27||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 02:23:26,780][root][ERROR] - |Q. 27||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 02:23:26,780][root][ERROR] - |Q. 27||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 02:23:26,781][root][ERROR] - |Q. 52||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 02:23:26,782][root][ERROR] - Failed to extract domain:  for response: 62
[2025-02-21 02:23:26,782][root][ERROR] - |Q. 31||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 02:23:26,782][root][ERROR] - |Q. 31||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 02:23:26,782][root][ERROR] - |Q. 31||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 02:23:26,783][root][ERROR] - Failed to extract domain:  for response: 69
[2025-02-21 02:23:26,783][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 02:23:26,783][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 02:23:26,783][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 02:23:26,785][root][ERROR] - |Q. 10||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 02:23:26,786][root][ERROR] - Failed to extract domain:  for response: 93
[2025-02-21 02:23:26,786][root][ERROR] - |Q. 50||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 02:23:26,786][root][ERROR] - |Q. 50||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 02:23:26,786][root][ERROR] - |Q. 50||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 02:23:26,786][root][ERROR] - |Q. 74||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 02:23:26,786][root][ERROR] - |Q. 74||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 02:23:26,786][root][ERROR] - |Q. 80||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 02:23:26,788][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 02:23:26,793][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 02:23:26,793][root][INFO] - Saved parsed outputs
[2025-02-21 02:23:26,793][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 02:23:26,795][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 02:23:26,795][root][INFO] - Saved parsing metadata
[2025-02-21 02:23:26,797][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 02:23:26,798][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 02:23:26,799][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 02:23:26,817][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 02:23:26,817][root][INFO] - Summary of metrics : {'label_accuracy': 0.2828282828282828, 'misclassification_rate': 0.7171717171717171, 'combined_accuracy': 0.1414141414141414, 'malformed_label': 6, 'malformed_domain': 42, 'total_predictions': 99, 'correct_predictions': 28, 'correct_label_and_domain': 14, 'Constitutional_Law_accuracy': 0.0, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.0, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.10101010101010101, 'Contracts_confidence': 0.16161616161616163, 'Criminal_Law_confidence': 0.1919191919191919, 'Evidence_confidence': 0.050505050505050504, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.0707070707070707, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 14, 'both_wrong': 28}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 02:23:34,706][root][INFO] - Setting global seed to 206
[2025-02-21 02:23:34,714][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-02-21 02:23:34,715][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 02:23:34,716][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 02:23:34,718][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 02:23:34,720][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 02:23:34,720][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 02:23:34,948][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 02:23:35,294][root][INFO] - Full model selected, loading model
[2025-02-21 02:23:52,952][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 02:23:52,953][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 02:23:59,391][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 02:23:59,392][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 02:23:59,392][root][INFO] - Starting inference
[2025-02-21 02:23:59,548][root][INFO] - Processing question number 0
[2025-02-21 02:23:59,550][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 02:24:29,930][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 02:25:01,294][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 02:25:32,165][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 02:26:03,529][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 02:26:34,257][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 02:27:04,956][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 02:27:36,575][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 02:28:07,584][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 02:28:38,217][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 02:29:09,580][root][INFO] - Processing question number 10
[2025-02-21 02:29:09,583][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 02:29:42,204][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 02:30:12,639][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 02:30:43,618][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 02:31:15,174][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 02:31:46,703][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 02:32:17,201][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 02:32:47,633][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 02:33:18,562][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 02:33:49,461][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 02:34:20,089][root][INFO] - Processing question number 20
[2025-02-21 02:34:20,091][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 02:34:50,980][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 02:35:22,043][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 02:35:52,539][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 02:36:23,058][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 02:36:54,313][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 02:37:25,257][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 02:37:57,034][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 02:38:27,937][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 02:38:58,988][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 02:39:29,505][root][INFO] - Processing question number 30
[2025-02-21 02:39:29,508][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 02:40:00,800][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 02:40:32,343][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 02:41:03,366][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 02:41:34,226][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 02:42:04,921][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 02:42:36,396][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 02:43:07,216][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 02:43:38,492][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 02:44:09,488][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 02:44:41,210][root][INFO] - Processing question number 40
[2025-02-21 02:44:41,214][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 02:45:12,262][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 02:45:43,306][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 02:46:14,839][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 02:46:46,322][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 02:47:17,040][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 02:47:48,134][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 02:48:20,432][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 02:48:50,527][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 02:49:21,420][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 02:49:52,993][root][INFO] - Processing question number 50
[2025-02-21 02:49:52,996][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 02:50:24,754][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 02:50:55,873][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 02:51:26,225][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 02:51:58,274][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 02:52:29,353][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 02:52:59,470][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 02:53:31,195][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 02:54:01,703][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 02:54:33,272][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 02:55:05,624][root][INFO] - Processing question number 60
[2025-02-21 02:55:05,629][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 02:55:36,113][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 02:56:06,971][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 02:56:38,448][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 02:57:08,915][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 02:57:39,911][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 02:58:11,143][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 02:58:42,368][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 02:59:13,909][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 02:59:45,163][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 03:00:17,008][root][INFO] - Processing question number 70
[2025-02-21 03:00:17,013][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 03:00:47,873][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 03:01:18,771][root][INFO] - Domain : Property, Question : 6
[2025-02-21 03:01:49,493][root][INFO] - Domain : Property, Question : 13
[2025-02-21 03:02:20,875][root][INFO] - Domain : Property, Question : 20
[2025-02-21 03:02:52,216][root][INFO] - Domain : Property, Question : 33
[2025-02-21 03:03:22,798][root][INFO] - Domain : Property, Question : 39
[2025-02-21 03:03:54,236][root][INFO] - Domain : Property, Question : 48
[2025-02-21 03:04:25,514][root][INFO] - Domain : Property, Question : 54
[2025-02-21 03:04:56,939][root][INFO] - Domain : Property, Question : 61
[2025-02-21 03:05:27,773][root][INFO] - Processing question number 80
[2025-02-21 03:05:27,778][root][INFO] - Domain : Property, Question : 67
[2025-02-21 03:05:59,077][root][INFO] - Domain : Property, Question : 75
[2025-02-21 03:06:30,373][root][INFO] - Domain : Property, Question : 83
[2025-02-21 03:07:01,079][root][INFO] - Domain : Property, Question : 89
[2025-02-21 03:07:31,883][root][INFO] - Domain : Property, Question : 97
[2025-02-21 03:08:03,445][root][INFO] - Domain : Property, Question : 100
[2025-02-21 03:08:34,832][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 03:09:06,269][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 03:09:36,976][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 03:10:08,133][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 03:10:38,608][root][INFO] - Processing question number 90
[2025-02-21 03:10:38,613][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 03:11:10,530][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 03:11:40,525][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 03:12:11,407][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 03:12:41,560][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 03:13:12,995][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 03:13:43,466][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 03:14:14,304][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 03:14:45,406][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 03:15:16,981][root][INFO] - Inference complete
[2025-02-21 03:15:16,982][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 03:15:16,988][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 03:15:16,989][root][ERROR] - |Q. 7||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 03:15:16,998][root][ERROR] - |Q. 13||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 03:15:16,998][root][ERROR] - |Q. 61||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 03:15:16,999][root][ERROR] - |Q. 100||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 03:15:17,002][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 03:15:17,008][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 03:15:17,008][root][INFO] - Saved parsed outputs
[2025-02-21 03:15:17,008][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 03:15:17,009][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 03:15:17,009][root][INFO] - Saved parsing metadata
[2025-02-21 03:15:17,010][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 03:15:17,011][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 03:15:17,012][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 03:15:17,048][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 03:15:17,048][root][INFO] - Summary of metrics : {'label_accuracy': 0.42424242424242425, 'misclassification_rate': 0.5757575757575757, 'combined_accuracy': 0.32323232323232326, 'malformed_label': 1, 'malformed_domain': 30, 'total_predictions': 99, 'correct_predictions': 42, 'correct_label_and_domain': 32, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.6153846153846154, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.21212121212121213, 'Criminal_Law_confidence': 0.16161616161616163, 'Evidence_confidence': 0.08080808080808081, 'Real_Property_confidence': 0.04040404040404041, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.09090909090909091, 'correct_domain_wrong_label': 37, 'correct_label_wrong_domain': 10, 'both_wrong': 20}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 03:15:23,925][root][INFO] - Setting global seed to 206
[2025-02-21 03:15:23,932][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-02-21 03:15:23,932][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 03:15:23,933][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 03:15:23,934][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 03:15:23,937][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 03:15:23,938][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 03:15:24,091][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 03:15:24,482][root][INFO] - Full model selected, loading model
[2025-02-21 03:15:39,534][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 03:16:41,175][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 03:16:41,176][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 03:17:07,982][root][INFO] - Peft model loaded successfully
[2025-02-21 03:17:14,329][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 03:17:14,331][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 03:17:14,331][root][INFO] - Starting inference
[2025-02-21 03:17:14,467][root][INFO] - Processing question number 0
[2025-02-21 03:17:14,469][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 03:17:45,174][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 03:18:16,735][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 03:18:47,877][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 03:19:19,354][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 03:19:50,246][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 03:20:21,091][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 03:20:52,722][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 03:21:23,848][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 03:21:54,646][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 03:22:26,116][root][INFO] - Processing question number 10
[2025-02-21 03:22:26,118][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 03:22:58,924][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 03:23:29,468][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 03:24:00,549][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 03:24:32,230][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 03:25:03,880][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 03:25:34,487][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 03:26:05,017][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 03:26:36,064][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 03:27:07,112][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 03:27:37,842][root][INFO] - Processing question number 20
[2025-02-21 03:27:37,844][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 03:28:08,825][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 03:28:39,984][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 03:29:10,579][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 03:29:41,115][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 03:30:12,449][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 03:30:43,493][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 03:31:15,325][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 03:31:46,331][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 03:32:17,456][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 03:32:47,921][root][INFO] - Processing question number 30
[2025-02-21 03:32:47,923][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 03:33:19,328][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 03:33:50,977][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 03:34:22,093][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 03:34:53,061][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 03:35:23,927][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 03:35:55,514][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 03:36:26,452][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 03:36:57,886][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 03:37:29,233][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 03:38:01,256][root][INFO] - Processing question number 40
[2025-02-21 03:38:01,261][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 03:38:32,544][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 03:39:03,854][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 03:39:35,650][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 03:40:07,335][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 03:40:38,218][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 03:41:09,345][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 03:41:41,753][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 03:42:11,976][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 03:42:43,002][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 03:43:14,718][root][INFO] - Processing question number 50
[2025-02-21 03:43:14,724][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 03:43:46,612][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 03:44:17,942][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 03:44:48,423][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 03:45:20,674][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 03:45:51,979][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 03:46:22,230][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 03:46:54,095][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 03:47:24,733][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 03:47:56,444][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 03:48:28,929][root][INFO] - Processing question number 60
[2025-02-21 03:48:28,934][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 03:48:59,548][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 03:49:30,541][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 03:50:02,149][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 03:50:32,749][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 03:51:03,891][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 03:51:35,059][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 03:52:06,239][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 03:52:37,764][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 03:53:09,118][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 03:53:40,923][root][INFO] - Processing question number 70
[2025-02-21 03:53:40,928][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 03:54:11,871][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 03:54:42,864][root][INFO] - Domain : Property, Question : 6
[2025-02-21 03:55:13,725][root][INFO] - Domain : Property, Question : 13
[2025-02-21 03:55:45,202][root][INFO] - Domain : Property, Question : 20
[2025-02-21 03:56:16,635][root][INFO] - Domain : Property, Question : 33
[2025-02-21 03:56:47,321][root][INFO] - Domain : Property, Question : 39
[2025-02-21 03:57:18,857][root][INFO] - Domain : Property, Question : 48
[2025-02-21 03:57:50,240][root][INFO] - Domain : Property, Question : 54
[2025-02-21 03:58:21,918][root][INFO] - Domain : Property, Question : 61
[2025-02-21 03:58:52,877][root][INFO] - Processing question number 80
[2025-02-21 03:58:52,882][root][INFO] - Domain : Property, Question : 67
[2025-02-21 03:59:24,289][root][INFO] - Domain : Property, Question : 75
[2025-02-21 03:59:55,685][root][INFO] - Domain : Property, Question : 83
[2025-02-21 04:00:26,556][root][INFO] - Domain : Property, Question : 89
[2025-02-21 04:00:57,467][root][INFO] - Domain : Property, Question : 97
[2025-02-21 04:01:29,154][root][INFO] - Domain : Property, Question : 100
[2025-02-21 04:02:00,640][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 04:02:32,187][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 04:03:03,047][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 04:03:34,400][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 04:04:04,982][root][INFO] - Processing question number 90
[2025-02-21 04:04:04,988][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 04:04:37,016][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 04:05:07,128][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 04:05:38,120][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 04:06:08,383][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 04:06:39,925][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 04:07:10,503][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 04:07:41,418][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 04:08:12,697][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 04:08:44,399][root][INFO] - Inference complete
[2025-02-21 04:08:44,399][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 04:08:44,406][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 04:08:44,407][root][ERROR] - Failed to extract domain:  for response: 6
[2025-02-21 04:08:44,408][root][ERROR] - |Q. 35||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,408][root][ERROR] - |Q. 35||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,408][root][ERROR] - |Q. 35||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 04:08:44,408][root][ERROR] - Failed to extract domain:  for response: 13
[2025-02-21 04:08:44,408][root][ERROR] - |Q. 77||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,408][root][ERROR] - |Q. 77||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,409][root][ERROR] - |Q. 77||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 04:08:44,409][root][ERROR] - Failed to extract domain:  for response: 15
[2025-02-21 04:08:44,409][root][ERROR] - |Q. 91||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,409][root][ERROR] - |Q. 91||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,409][root][ERROR] - |Q. 91||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 04:08:44,410][root][ERROR] - Failed to extract domain:  for response: 22
[2025-02-21 04:08:44,410][root][ERROR] - |Q. 37||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,410][root][ERROR] - |Q. 37||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,410][root][ERROR] - |Q. 37||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 04:08:44,411][root][ERROR] - Failed to extract domain:  for response: 30
[2025-02-21 04:08:44,411][root][ERROR] - |Q. 93||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,411][root][ERROR] - |Q. 93||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,411][root][ERROR] - |Q. 93||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 04:08:44,411][root][ERROR] - Failed to extract domain:  for response: 35
[2025-02-21 04:08:44,411][root][ERROR] - |Q. 27||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 04:08:44,412][root][ERROR] - Failed to extract domain:  for response: 39
[2025-02-21 04:08:44,412][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,412][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,412][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 04:08:44,412][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 04:08:44,412][root][ERROR] - |Q. 58||D: Contracts| Failed to extract chosen option: 
[2025-02-21 04:08:44,412][root][ERROR] - Failed to extract domain:  for response: 43
[2025-02-21 04:08:44,413][root][ERROR] - Failed to extract domain:  for response: 45
[2025-02-21 04:08:44,413][root][ERROR] - |Q. 4||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,413][root][ERROR] - |Q. 4||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,413][root][ERROR] - |Q. 4||D: Torts| Failed to extract Rule_application: 
[2025-02-21 04:08:44,413][root][ERROR] - Failed to extract domain:  for response: 50
[2025-02-21 04:08:44,413][root][ERROR] - |Q. 47||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,413][root][ERROR] - |Q. 47||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,413][root][ERROR] - |Q. 47||D: Torts| Failed to extract Rule_application: 
[2025-02-21 04:08:44,414][root][ERROR] - Failed to extract domain:  for response: 51
[2025-02-21 04:08:44,414][root][ERROR] - |Q. 12||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,414][root][ERROR] - |Q. 12||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 04:08:44,415][root][ERROR] - Failed to extract domain:  for response: 62
[2025-02-21 04:08:44,415][root][ERROR] - |Q. 31||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,415][root][ERROR] - |Q. 31||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,415][root][ERROR] - |Q. 31||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 04:08:44,416][root][ERROR] - Failed to extract domain:  for response: 69
[2025-02-21 04:08:44,416][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,416][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,416][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 04:08:44,416][root][ERROR] - Failed to extract domain:  for response: 71
[2025-02-21 04:08:44,416][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,416][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,416][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 04:08:44,416][root][ERROR] - Failed to extract domain:  for response: 73
[2025-02-21 04:08:44,416][root][ERROR] - |Q. 6||D: Property| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,416][root][ERROR] - |Q. 6||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,417][root][ERROR] - |Q. 6||D: Property| Failed to extract Rule_application: 
[2025-02-21 04:08:44,417][root][ERROR] - Failed to extract domain:  for response: 74
[2025-02-21 04:08:44,417][root][ERROR] - |Q. 13||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,417][root][ERROR] - |Q. 13||D: Property| Failed to extract Rule_application: 
[2025-02-21 04:08:44,417][root][ERROR] - Failed to extract domain:  for response: 80
[2025-02-21 04:08:44,417][root][ERROR] - |Q. 61||D: Property| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,417][root][ERROR] - |Q. 61||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 61||D: Property| Failed to extract Rule_application: 
[2025-02-21 04:08:44,418][root][ERROR] - Failed to extract domain:  for response: 81
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 67||D: Property| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 67||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 67||D: Property| Failed to extract Rule_application: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 67||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 67||D: Property| Failed to extract chosen option: 
[2025-02-21 04:08:44,418][root][ERROR] - Failed to extract domain:  for response: 82
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 75||D: Property| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 75||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 75||D: Property| Failed to extract Rule_application: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 75||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 75||D: Property| Failed to extract chosen option: 
[2025-02-21 04:08:44,418][root][ERROR] - |Q. 83||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 04:08:44,419][root][ERROR] - Failed to extract domain:  for response: 86
[2025-02-21 04:08:44,419][root][ERROR] - |Q. 100||D: Property| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,419][root][ERROR] - |Q. 100||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,419][root][ERROR] - |Q. 100||D: Property| Failed to extract Rule_application: 
[2025-02-21 04:08:44,419][root][ERROR] - |Q. 26||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 04:08:44,419][root][ERROR] - Failed to extract domain:  for response: 91
[2025-02-21 04:08:44,419][root][ERROR] - |Q. 36||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,419][root][ERROR] - |Q. 36||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,419][root][ERROR] - |Q. 36||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 04:08:44,420][root][ERROR] - Failed to extract domain:  for response: 92
[2025-02-21 04:08:44,420][root][ERROR] - |Q. 45||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 04:08:44,420][root][ERROR] - |Q. 45||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,420][root][ERROR] - |Q. 45||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 04:08:44,420][root][ERROR] - |Q. 74||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 04:08:44,420][root][ERROR] - |Q. 74||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 04:08:44,421][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 04:08:44,444][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 04:08:44,444][root][INFO] - Saved parsed outputs
[2025-02-21 04:08:44,444][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 04:08:44,446][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 04:08:44,446][root][INFO] - Saved parsing metadata
[2025-02-21 04:08:44,446][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 04:08:44,448][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 04:08:44,450][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 04:08:44,476][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 04:08:44,477][root][INFO] - Summary of metrics : {'label_accuracy': 0.29292929292929293, 'misclassification_rate': 0.7070707070707071, 'combined_accuracy': 0.18181818181818182, 'malformed_label': 27, 'malformed_domain': 57, 'total_predictions': 99, 'correct_predictions': 29, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.07142857142857142, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.0, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.10101010101010101, 'Contracts_confidence': 0.10101010101010101, 'Criminal_Law_confidence': 0.16161616161616163, 'Evidence_confidence': 0.04040404040404041, 'Real_Property_confidence': 0.020202020202020204, 'Torts_confidence': 0.10101010101010101, 'Civil_Procedure_confidence': 0.06060606060606061, 'correct_domain_wrong_label': 24, 'correct_label_wrong_domain': 11, 'both_wrong': 46}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 04:08:51,344][root][INFO] - Setting global seed to 206
[2025-02-21 04:08:51,351][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-02-21 04:08:51,351][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 04:08:51,352][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 04:08:51,354][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 04:08:51,356][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 04:08:51,356][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 04:08:51,508][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 04:08:51,761][root][INFO] - Full model selected, loading model
[2025-02-21 04:09:04,719][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 04:09:04,719][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 04:09:11,298][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 04:09:11,300][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 04:09:11,300][root][INFO] - Starting inference
[2025-02-21 04:09:11,440][root][INFO] - Processing question number 0
[2025-02-21 04:09:11,445][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 04:09:41,776][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 04:10:13,098][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 04:10:43,947][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 04:11:15,298][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 04:11:46,012][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 04:12:16,678][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 04:12:48,179][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 04:13:19,187][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 04:13:49,810][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 04:14:21,167][root][INFO] - Processing question number 10
[2025-02-21 04:14:21,169][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 04:14:53,791][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 04:15:24,221][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 04:15:55,185][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 04:16:26,781][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 04:16:58,337][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 04:17:28,846][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 04:17:59,292][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 04:18:30,236][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 04:19:01,180][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 04:19:31,966][root][INFO] - Processing question number 20
[2025-02-21 04:19:31,969][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 04:20:03,002][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 04:20:34,200][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 04:21:04,811][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 04:21:35,412][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 04:22:06,575][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 04:22:37,506][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 04:23:09,221][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 04:23:40,116][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 04:24:11,143][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 04:24:41,504][root][INFO] - Processing question number 30
[2025-02-21 04:24:41,507][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 04:25:12,801][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 04:25:44,335][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 04:26:15,355][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 04:26:46,210][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 04:27:16,990][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 04:27:48,618][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 04:28:19,560][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 04:28:50,995][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 04:29:22,055][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 04:29:53,787][root][INFO] - Processing question number 40
[2025-02-21 04:29:53,790][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 04:30:24,853][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 04:30:55,906][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 04:31:27,448][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 04:31:58,942][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 04:32:29,659][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 04:33:00,680][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 04:33:32,984][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 04:34:03,098][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 04:34:34,008][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 04:35:05,598][root][INFO] - Processing question number 50
[2025-02-21 04:35:05,602][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 04:35:37,375][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 04:36:08,502][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 04:36:38,877][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 04:37:10,941][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 04:37:42,053][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 04:38:12,380][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 04:38:44,147][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 04:39:14,702][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 04:39:46,295][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 04:40:18,668][root][INFO] - Processing question number 60
[2025-02-21 04:40:18,673][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 04:40:49,205][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 04:41:20,106][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 04:41:51,600][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 04:42:22,068][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 04:42:53,046][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 04:43:24,077][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 04:43:55,135][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 04:44:26,524][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 04:44:57,652][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 04:45:29,321][root][INFO] - Processing question number 70
[2025-02-21 04:45:29,325][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 04:46:00,147][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 04:46:31,009][root][INFO] - Domain : Property, Question : 6
[2025-02-21 04:47:01,695][root][INFO] - Domain : Property, Question : 13
[2025-02-21 04:47:33,057][root][INFO] - Domain : Property, Question : 20
[2025-02-21 04:48:04,523][root][INFO] - Domain : Property, Question : 33
[2025-02-21 04:48:35,094][root][INFO] - Domain : Property, Question : 39
[2025-02-21 04:49:06,508][root][INFO] - Domain : Property, Question : 48
[2025-02-21 04:49:37,776][root][INFO] - Domain : Property, Question : 54
[2025-02-21 04:50:09,190][root][INFO] - Domain : Property, Question : 61
[2025-02-21 04:50:40,013][root][INFO] - Processing question number 80
[2025-02-21 04:50:40,018][root][INFO] - Domain : Property, Question : 67
[2025-02-21 04:51:11,310][root][INFO] - Domain : Property, Question : 75
[2025-02-21 04:51:42,591][root][INFO] - Domain : Property, Question : 83
[2025-02-21 04:52:13,289][root][INFO] - Domain : Property, Question : 89
[2025-02-21 04:52:44,081][root][INFO] - Domain : Property, Question : 97
[2025-02-21 04:53:15,633][root][INFO] - Domain : Property, Question : 100
[2025-02-21 04:53:47,003][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 04:54:18,430][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 04:54:49,123][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 04:55:20,272][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 04:55:50,737][root][INFO] - Processing question number 90
[2025-02-21 04:55:50,742][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 04:56:22,648][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 04:56:52,638][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 04:57:23,508][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 04:57:53,657][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 04:58:25,082][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 04:58:55,542][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 04:59:26,355][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 04:59:57,560][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 05:00:29,115][root][INFO] - Inference complete
[2025-02-21 05:00:29,115][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:00:29,122][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:00:29,123][root][ERROR] - |Q. 7||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,123][root][ERROR] - |Q. 7||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,123][root][ERROR] - |Q. 7||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 05:00:29,124][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,124][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,124][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 05:00:29,125][root][ERROR] - |Q. 91||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,125][root][ERROR] - |Q. 91||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,125][root][ERROR] - |Q. 91||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 05:00:29,126][root][ERROR] - |Q. 60||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,127][root][ERROR] - |Q. 60||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 05:00:29,127][root][ERROR] - |Q. 8||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 05:00:29,128][root][ERROR] - |Q. 66||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 05:00:29,129][root][ERROR] - |Q. 66||D: Contracts| Failed to extract chosen option: 
[2025-02-21 05:00:29,129][root][ERROR] - |Q. 24||D: Torts| Failed to extract chosen option: 
[2025-02-21 05:00:29,131][root][ERROR] - |Q. 31||D: Evidence| Failed to extract Legal_conclusion: 
[2025-02-21 05:00:29,132][root][ERROR] - |Q. 59||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,132][root][ERROR] - |Q. 59||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,132][root][ERROR] - |Q. 59||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 05:00:29,132][root][ERROR] - |Q. 68||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,132][root][ERROR] - |Q. 68||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,132][root][ERROR] - |Q. 68||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 05:00:29,132][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,132][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,132][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 05:00:29,133][root][ERROR] - |Q. 13||D: Property| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,133][root][ERROR] - |Q. 13||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,133][root][ERROR] - |Q. 13||D: Property| Failed to extract Rule_application: 
[2025-02-21 05:00:29,133][root][ERROR] - |Q. 13||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 05:00:29,134][root][ERROR] - |Q. 83||D: Property| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,134][root][ERROR] - |Q. 83||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,134][root][ERROR] - |Q. 83||D: Property| Failed to extract Rule_application: 
[2025-02-21 05:00:29,134][root][ERROR] - |Q. 89||D: Property| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,134][root][ERROR] - |Q. 89||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,134][root][ERROR] - |Q. 89||D: Property| Failed to extract Rule_application: 
[2025-02-21 05:00:29,135][root][ERROR] - |Q. 100||D: Property| Failed to extract Legal_concept: 
[2025-02-21 05:00:29,135][root][ERROR] - |Q. 100||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 05:00:29,135][root][ERROR] - |Q. 100||D: Property| Failed to extract Rule_application: 
[2025-02-21 05:00:29,135][root][ERROR] - |Q. 100||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 05:00:29,135][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract chosen option: 
[2025-02-21 05:00:29,137][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:00:29,143][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:00:29,143][root][INFO] - Saved parsed outputs
[2025-02-21 05:00:29,143][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:00:29,145][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:00:29,145][root][INFO] - Saved parsing metadata
[2025-02-21 05:00:29,146][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:00:29,148][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:00:29,149][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 05:00:29,176][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 05:00:29,176][root][INFO] - Summary of metrics : {'label_accuracy': 0.3333333333333333, 'misclassification_rate': 0.6666666666666667, 'combined_accuracy': 0.26262626262626265, 'malformed_label': 3, 'malformed_domain': 38, 'total_predictions': 99, 'correct_predictions': 33, 'correct_label_and_domain': 26, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.14285714285714285, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.13131313131313133, 'Criminal_Law_confidence': 0.1717171717171717, 'Evidence_confidence': 0.0707070707070707, 'Real_Property_confidence': 0.04040404040404041, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.08080808080808081, 'correct_domain_wrong_label': 35, 'correct_label_wrong_domain': 7, 'both_wrong': 31}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 05:00:36,816][root][INFO] - Setting global seed to 989
[2025-02-21 05:00:36,824][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-02-21 05:00:36,824][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 05:00:36,825][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 05:00:36,827][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 05:00:36,829][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 05:00:36,830][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 05:00:36,992][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 05:00:37,366][root][INFO] - Full model selected, loading model
[2025-02-21 05:00:52,889][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 05:01:53,351][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 05:01:53,351][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 05:02:18,832][root][INFO] - Peft model loaded successfully
[2025-02-21 05:02:25,075][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 05:02:25,076][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:02:25,077][root][INFO] - Starting inference
[2025-02-21 05:02:25,217][root][INFO] - Processing question number 0
[2025-02-21 05:02:25,219][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 05:02:55,533][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 05:03:26,824][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 05:03:57,655][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 05:04:28,961][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 05:04:59,744][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 05:05:30,452][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 05:06:01,939][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 05:06:32,936][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 05:07:03,601][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 05:07:34,925][root][INFO] - Processing question number 10
[2025-02-21 05:07:34,927][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 05:08:07,571][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 05:08:37,961][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 05:09:08,898][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 05:09:40,413][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 05:10:11,906][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 05:10:42,374][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 05:11:12,759][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 05:11:43,668][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 05:12:14,540][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 05:12:45,128][root][INFO] - Processing question number 20
[2025-02-21 05:12:45,130][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 05:13:15,970][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 05:13:46,974][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 05:14:17,440][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 05:14:47,839][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 05:15:19,035][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 05:15:49,944][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 05:16:21,637][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 05:16:52,495][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 05:17:23,483][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 05:17:53,815][root][INFO] - Processing question number 30
[2025-02-21 05:17:53,818][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 05:18:25,220][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 05:18:56,802][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 05:19:27,797][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 05:19:58,624][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 05:20:29,354][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 05:21:00,800][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 05:21:31,604][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 05:22:02,845][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 05:22:33,813][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 05:23:05,567][root][INFO] - Processing question number 40
[2025-02-21 05:23:05,571][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 05:23:36,583][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 05:24:07,587][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 05:24:39,103][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 05:25:10,571][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 05:25:41,323][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 05:26:12,304][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 05:26:44,568][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 05:27:14,637][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 05:27:45,520][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 05:28:17,088][root][INFO] - Processing question number 50
[2025-02-21 05:28:17,092][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 05:28:48,842][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 05:29:20,031][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 05:29:50,376][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 05:30:22,468][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 05:30:53,672][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 05:31:23,778][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 05:31:55,499][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 05:32:25,997][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 05:32:57,568][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 05:33:29,908][root][INFO] - Processing question number 60
[2025-02-21 05:33:29,912][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 05:34:00,388][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 05:34:31,238][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 05:35:02,705][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 05:35:33,155][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 05:36:04,117][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 05:36:35,131][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 05:37:06,166][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 05:37:37,541][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 05:38:08,896][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 05:38:40,687][root][INFO] - Processing question number 70
[2025-02-21 05:38:40,693][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 05:39:11,630][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 05:39:42,663][root][INFO] - Domain : Property, Question : 6
[2025-02-21 05:40:13,405][root][INFO] - Domain : Property, Question : 13
[2025-02-21 05:40:44,905][root][INFO] - Domain : Property, Question : 20
[2025-02-21 05:41:16,364][root][INFO] - Domain : Property, Question : 33
[2025-02-21 05:41:47,041][root][INFO] - Domain : Property, Question : 39
[2025-02-21 05:42:18,567][root][INFO] - Domain : Property, Question : 48
[2025-02-21 05:42:49,981][root][INFO] - Domain : Property, Question : 54
[2025-02-21 05:43:21,413][root][INFO] - Domain : Property, Question : 61
[2025-02-21 05:43:52,232][root][INFO] - Processing question number 80
[2025-02-21 05:43:52,239][root][INFO] - Domain : Property, Question : 67
[2025-02-21 05:44:23,524][root][INFO] - Domain : Property, Question : 75
[2025-02-21 05:44:54,794][root][INFO] - Domain : Property, Question : 83
[2025-02-21 05:45:25,538][root][INFO] - Domain : Property, Question : 89
[2025-02-21 05:45:56,322][root][INFO] - Domain : Property, Question : 97
[2025-02-21 05:46:27,872][root][INFO] - Domain : Property, Question : 100
[2025-02-21 05:46:59,234][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 05:47:30,643][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 05:48:01,378][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 05:48:32,592][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 05:49:03,040][root][INFO] - Processing question number 90
[2025-02-21 05:49:03,046][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 05:49:34,955][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 05:50:04,921][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 05:50:35,783][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 05:51:05,899][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 05:51:37,314][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 05:52:07,760][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 05:52:38,550][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 05:53:09,688][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 05:53:41,265][root][INFO] - Inference complete
[2025-02-21 05:53:41,265][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:53:41,271][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:53:41,279][root][ERROR] - |Q. 6||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 05:53:41,283][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:53:41,289][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:53:41,289][root][INFO] - Saved parsed outputs
[2025-02-21 05:53:41,289][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:53:41,290][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:53:41,291][root][INFO] - Saved parsing metadata
[2025-02-21 05:53:41,291][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:53:41,292][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:53:41,304][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 05:53:41,311][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 05:53:41,311][root][INFO] - Summary of metrics : {'label_accuracy': 0.32323232323232326, 'misclassification_rate': 0.6767676767676767, 'combined_accuracy': 0.2222222222222222, 'malformed_label': 2, 'malformed_domain': 31, 'total_predictions': 99, 'correct_predictions': 32, 'correct_label_and_domain': 22, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.12121212121212122, 'Contracts_confidence': 0.2222222222222222, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.0707070707070707, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.15151515151515152, 'Civil_Procedure_confidence': 0.09090909090909091, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 10, 'both_wrong': 21}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 05:53:47,472][root][INFO] - Setting global seed to 989
[2025-02-21 05:53:47,477][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-02-21 05:53:47,478][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 05:53:47,479][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 05:53:47,480][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 05:53:47,482][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 05:53:47,482][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 05:53:47,623][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 05:53:47,863][root][INFO] - Full model selected, loading model
[2025-02-21 05:53:59,440][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 05:53:59,440][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 05:54:05,879][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 05:54:05,881][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 05:54:05,881][root][INFO] - Starting inference
[2025-02-21 05:54:06,035][root][INFO] - Processing question number 0
[2025-02-21 05:54:06,045][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 05:54:36,153][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 05:55:07,333][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 05:55:38,060][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 05:56:09,254][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 05:56:39,801][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 05:57:10,303][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 05:57:41,652][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 05:58:12,546][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 05:58:43,091][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 05:59:14,272][root][INFO] - Processing question number 10
[2025-02-21 05:59:14,274][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 05:59:46,718][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 06:00:16,971][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 06:00:47,753][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 06:01:19,258][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 06:01:50,696][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 06:02:21,009][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 06:02:51,250][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 06:03:21,991][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 06:03:52,710][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 06:04:23,140][root][INFO] - Processing question number 20
[2025-02-21 06:04:23,142][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 06:04:53,834][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 06:05:24,714][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 06:05:55,024][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 06:06:25,270][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 06:06:56,231][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 06:07:26,987][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 06:07:58,532][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 06:08:29,248][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 06:09:00,093][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 06:09:30,271][root][INFO] - Processing question number 30
[2025-02-21 06:09:30,275][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 06:10:01,392][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 06:10:32,752][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 06:11:03,598][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 06:11:34,273][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 06:12:04,788][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 06:12:36,084][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 06:13:06,734][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 06:13:37,848][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 06:14:08,677][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 06:14:40,244][root][INFO] - Processing question number 40
[2025-02-21 06:14:40,247][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 06:15:11,135][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 06:15:42,017][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 06:16:13,386][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 06:16:44,706][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 06:17:15,247][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 06:17:46,095][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 06:18:18,237][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 06:18:48,177][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 06:19:18,911][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 06:19:50,326][root][INFO] - Processing question number 50
[2025-02-21 06:19:50,330][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 06:20:21,941][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 06:20:52,900][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 06:21:23,099][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 06:21:55,004][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 06:22:25,937][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 06:22:55,922][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 06:23:27,497][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 06:23:57,853][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 06:24:29,271][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 06:25:01,470][root][INFO] - Processing question number 60
[2025-02-21 06:25:01,474][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 06:25:31,807][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 06:26:02,507][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 06:26:33,833][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 06:27:04,138][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 06:27:34,958][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 06:28:05,827][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 06:28:36,727][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 06:29:07,968][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 06:29:38,934][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 06:30:10,459][root][INFO] - Processing question number 70
[2025-02-21 06:30:10,465][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 06:30:41,131][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 06:31:11,840][root][INFO] - Domain : Property, Question : 6
[2025-02-21 06:31:42,371][root][INFO] - Domain : Property, Question : 13
[2025-02-21 06:32:13,583][root][INFO] - Domain : Property, Question : 20
[2025-02-21 06:32:44,757][root][INFO] - Domain : Property, Question : 33
[2025-02-21 06:33:15,156][root][INFO] - Domain : Property, Question : 39
[2025-02-21 06:33:46,463][root][INFO] - Domain : Property, Question : 48
[2025-02-21 06:34:17,683][root][INFO] - Domain : Property, Question : 54
[2025-02-21 06:34:49,038][root][INFO] - Domain : Property, Question : 61
[2025-02-21 06:35:19,819][root][INFO] - Processing question number 80
[2025-02-21 06:35:19,824][root][INFO] - Domain : Property, Question : 67
[2025-02-21 06:35:51,042][root][INFO] - Domain : Property, Question : 75
[2025-02-21 06:36:22,285][root][INFO] - Domain : Property, Question : 83
[2025-02-21 06:36:52,825][root][INFO] - Domain : Property, Question : 89
[2025-02-21 06:37:23,462][root][INFO] - Domain : Property, Question : 97
[2025-02-21 06:37:54,856][root][INFO] - Domain : Property, Question : 100
[2025-02-21 06:38:26,076][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 06:38:57,352][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 06:39:27,900][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 06:39:58,897][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 06:40:29,202][root][INFO] - Processing question number 90
[2025-02-21 06:40:29,208][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 06:41:00,974][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 06:41:30,808][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 06:42:01,525][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 06:42:31,506][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 06:43:02,778][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 06:43:33,077][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 06:44:03,726][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 06:44:34,650][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 06:45:06,050][root][INFO] - Inference complete
[2025-02-21 06:45:06,051][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 06:45:06,057][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 06:45:06,062][root][ERROR] - |Q. 22||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 06:45:06,065][root][ERROR] - |Q. 82||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 06:45:06,066][root][ERROR] - |Q. 12||D: Evidence| Failed to extract Legal_conclusion: 
[2025-02-21 06:45:06,066][root][ERROR] - |Q. 12||D: Evidence| Failed to extract chosen option: 
[2025-02-21 06:45:06,067][root][ERROR] - |Q. 13||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 06:45:06,068][root][ERROR] - |Q. 39||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 06:45:06,069][root][ERROR] - |Q. 100||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 06:45:06,072][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 06:45:06,078][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 06:45:06,078][root][INFO] - Saved parsed outputs
[2025-02-21 06:45:06,078][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 06:45:06,079][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 06:45:06,079][root][INFO] - Saved parsing metadata
[2025-02-21 06:45:06,080][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 06:45:06,082][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 06:45:06,083][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 06:45:06,111][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 06:45:06,111][root][INFO] - Summary of metrics : {'label_accuracy': 0.35353535353535354, 'misclassification_rate': 0.6464646464646464, 'combined_accuracy': 0.2222222222222222, 'malformed_label': 1, 'malformed_domain': 31, 'total_predictions': 99, 'correct_predictions': 35, 'correct_label_and_domain': 22, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.2222222222222222, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.06060606060606061, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.08080808080808081, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 13, 'both_wrong': 18}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 06:45:12,455][root][INFO] - Setting global seed to 989
[2025-02-21 06:45:12,460][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-02-21 06:45:12,460][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 06:45:12,461][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 06:45:12,464][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 06:45:12,466][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 06:45:12,466][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 06:45:12,642][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 06:45:12,892][root][INFO] - Full model selected, loading model
[2025-02-21 06:45:31,074][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 06:46:31,623][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 06:46:31,624][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 06:46:57,962][root][INFO] - Peft model loaded successfully
[2025-02-21 06:47:04,170][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 06:47:04,173][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 06:47:04,173][root][INFO] - Starting inference
[2025-02-21 06:47:04,338][root][INFO] - Processing question number 0
[2025-02-21 06:47:04,341][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 06:47:34,987][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 06:48:06,583][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 06:48:37,717][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 06:49:09,338][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 06:49:40,448][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 06:50:11,322][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 06:50:42,974][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 06:51:14,115][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 06:51:44,943][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 06:52:16,438][root][INFO] - Processing question number 10
[2025-02-21 06:52:16,441][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 06:52:49,287][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 06:53:19,862][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 06:53:50,980][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 06:54:22,699][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 06:54:54,387][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 06:55:25,036][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 06:55:55,607][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 06:56:26,688][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 06:56:57,737][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 06:57:28,515][root][INFO] - Processing question number 20
[2025-02-21 06:57:28,518][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 06:57:59,547][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 06:58:30,748][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 06:59:01,388][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 06:59:31,968][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 07:00:03,343][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 07:00:34,430][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 07:01:06,304][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 07:01:37,350][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 07:02:08,520][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 07:02:39,135][root][INFO] - Processing question number 30
[2025-02-21 07:02:39,139][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 07:03:10,747][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 07:03:42,551][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 07:04:13,855][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 07:04:45,011][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 07:05:15,992][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 07:05:47,617][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 07:06:18,596][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 07:06:50,022][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 07:07:21,150][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 07:07:53,083][root][INFO] - Processing question number 40
[2025-02-21 07:07:53,087][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 07:08:24,382][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 07:08:55,563][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 07:09:27,242][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 07:09:58,870][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 07:10:29,804][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 07:11:00,958][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 07:11:33,386][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 07:12:03,623][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 07:12:34,673][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 07:13:06,405][root][INFO] - Processing question number 50
[2025-02-21 07:13:06,409][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 07:13:38,319][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 07:14:09,666][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 07:14:40,160][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 07:15:12,425][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 07:15:43,737][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 07:16:13,999][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 07:16:45,872][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 07:17:16,523][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 07:17:48,246][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 07:18:20,740][root][INFO] - Processing question number 60
[2025-02-21 07:18:20,744][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 07:18:51,376][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 07:19:22,385][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 07:19:54,027][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 07:20:24,741][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 07:20:55,871][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 07:21:27,042][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 07:21:58,243][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 07:22:29,783][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 07:23:01,145][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 07:23:32,970][root][INFO] - Processing question number 70
[2025-02-21 07:23:32,974][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 07:24:03,952][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 07:24:34,973][root][INFO] - Domain : Property, Question : 6
[2025-02-21 07:25:05,865][root][INFO] - Domain : Property, Question : 13
[2025-02-21 07:25:37,379][root][INFO] - Domain : Property, Question : 20
[2025-02-21 07:26:08,840][root][INFO] - Domain : Property, Question : 33
[2025-02-21 07:26:39,556][root][INFO] - Domain : Property, Question : 39
[2025-02-21 07:27:11,126][root][INFO] - Domain : Property, Question : 48
[2025-02-21 07:27:42,543][root][INFO] - Domain : Property, Question : 54
[2025-02-21 07:28:14,108][root][INFO] - Domain : Property, Question : 61
[2025-02-21 07:28:45,089][root][INFO] - Processing question number 80
[2025-02-21 07:28:45,095][root][INFO] - Domain : Property, Question : 67
[2025-02-21 07:29:16,541][root][INFO] - Domain : Property, Question : 75
[2025-02-21 07:29:47,977][root][INFO] - Domain : Property, Question : 83
[2025-02-21 07:30:18,907][root][INFO] - Domain : Property, Question : 89
[2025-02-21 07:30:49,895][root][INFO] - Domain : Property, Question : 97
[2025-02-21 07:31:21,615][root][INFO] - Domain : Property, Question : 100
[2025-02-21 07:31:53,134][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 07:32:24,720][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 07:32:55,625][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 07:33:27,011][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 07:33:57,622][root][INFO] - Processing question number 90
[2025-02-21 07:33:57,628][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 07:34:29,693][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 07:34:59,872][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 07:35:30,918][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 07:36:01,232][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 07:36:32,831][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 07:37:03,450][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 07:37:34,419][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 07:38:05,734][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 07:38:37,491][root][INFO] - Inference complete
[2025-02-21 07:38:37,491][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 07:38:37,498][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 07:38:37,500][root][ERROR] - Failed to extract domain:  for response: 5
[2025-02-21 07:38:37,500][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 07:38:37,500][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 07:38:37,500][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 07:38:37,500][root][ERROR] - Failed to extract domain:  for response: 9
[2025-02-21 07:38:37,500][root][ERROR] - |Q. 56||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 07:38:37,500][root][ERROR] - |Q. 56||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 07:38:37,500][root][ERROR] - |Q. 56||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 07:38:37,503][root][ERROR] - |Q. 8||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 07:38:37,503][root][ERROR] - Failed to extract domain:  for response: 35
[2025-02-21 07:38:37,503][root][ERROR] - |Q. 27||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 07:38:37,504][root][ERROR] - |Q. 88||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 07:38:37,506][root][ERROR] - Failed to extract domain:  for response: 72
[2025-02-21 07:38:37,507][root][ERROR] - |Q. 96||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 07:38:37,507][root][ERROR] - |Q. 96||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 07:38:37,507][root][ERROR] - |Q. 96||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 07:38:37,508][root][ERROR] - |Q. 75||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 07:38:37,508][root][ERROR] - Failed to extract domain:  for response: 83
[2025-02-21 07:38:37,508][root][ERROR] - |Q. 83||D: Property| Failed to extract Legal_concept: 
[2025-02-21 07:38:37,508][root][ERROR] - |Q. 83||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 07:38:37,508][root][ERROR] - |Q. 83||D: Property| Failed to extract Rule_application: 
[2025-02-21 07:38:37,509][root][ERROR] - |Q. 74||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 07:38:37,510][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 07:38:37,516][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 07:38:37,516][root][INFO] - Saved parsed outputs
[2025-02-21 07:38:37,516][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 07:38:37,522][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 07:38:37,522][root][INFO] - Saved parsing metadata
[2025-02-21 07:38:37,523][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 07:38:37,524][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 07:38:37,530][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 07:38:37,546][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 07:38:37,546][root][INFO] - Summary of metrics : {'label_accuracy': 0.30303030303030304, 'misclassification_rate': 0.696969696969697, 'combined_accuracy': 0.18181818181818182, 'malformed_label': 8, 'malformed_domain': 40, 'total_predictions': 99, 'correct_predictions': 30, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.23076923076923078, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.12121212121212122, 'Contracts_confidence': 0.20202020202020202, 'Criminal_Law_confidence': 0.1919191919191919, 'Evidence_confidence': 0.050505050505050504, 'Real_Property_confidence': 0.04040404040404041, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.0707070707070707, 'correct_domain_wrong_label': 41, 'correct_label_wrong_domain': 12, 'both_wrong': 28}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 07:38:44,103][root][INFO] - Setting global seed to 989
[2025-02-21 07:38:44,109][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-02-21 07:38:44,110][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 07:38:44,111][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 07:38:44,112][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 07:38:44,114][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 07:38:44,114][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 07:38:44,267][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 07:38:44,581][root][INFO] - Full model selected, loading model
[2025-02-21 07:39:02,149][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 07:39:02,149][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 07:39:08,613][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 07:39:08,614][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 07:39:08,614][root][INFO] - Starting inference
[2025-02-21 07:39:08,760][root][INFO] - Processing question number 0
[2025-02-21 07:39:08,762][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 07:39:39,245][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 07:40:10,594][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 07:40:41,472][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 07:41:12,852][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 07:41:43,597][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 07:42:14,292][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 07:42:45,815][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 07:43:16,840][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 07:43:47,485][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 07:44:18,858][root][INFO] - Processing question number 10
[2025-02-21 07:44:18,860][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 07:44:51,499][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 07:45:21,947][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 07:45:52,930][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 07:46:24,499][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 07:46:56,050][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 07:47:26,566][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 07:47:57,012][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 07:48:27,951][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 07:48:58,869][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 07:49:29,499][root][INFO] - Processing question number 20
[2025-02-21 07:49:29,502][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 07:50:00,397][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 07:50:31,476][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 07:51:01,992][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 07:51:32,442][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 07:52:03,600][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 07:52:34,549][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 07:53:06,287][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 07:53:37,203][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 07:54:08,249][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 07:54:38,623][root][INFO] - Processing question number 30
[2025-02-21 07:54:38,626][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 07:55:09,941][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 07:55:41,494][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 07:56:12,533][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 07:56:43,406][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 07:57:14,128][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 07:57:45,620][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 07:58:16,620][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 07:58:48,037][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 07:59:19,182][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 07:59:51,131][root][INFO] - Processing question number 40
[2025-02-21 07:59:51,135][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 08:00:22,296][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 08:00:53,369][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 08:01:24,934][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 08:01:56,443][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 08:02:27,188][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 08:02:58,227][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 08:03:30,551][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 08:04:00,679][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 08:04:31,612][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 08:05:03,218][root][INFO] - Processing question number 50
[2025-02-21 08:05:03,222][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 08:05:35,017][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 08:06:06,165][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 08:06:36,562][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 08:07:08,642][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 08:07:39,761][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 08:08:09,912][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 08:08:41,672][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 08:09:12,211][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 08:09:43,808][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 08:10:16,184][root][INFO] - Processing question number 60
[2025-02-21 08:10:16,188][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 08:10:46,706][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 08:11:17,591][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 08:11:49,125][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 08:12:19,656][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 08:12:50,676][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 08:13:21,753][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 08:13:52,839][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 08:14:24,250][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 08:14:55,398][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 08:15:27,087][root][INFO] - Processing question number 70
[2025-02-21 08:15:27,092][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 08:15:57,938][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 08:16:28,822][root][INFO] - Domain : Property, Question : 6
[2025-02-21 08:16:59,535][root][INFO] - Domain : Property, Question : 13
[2025-02-21 08:17:31,033][root][INFO] - Domain : Property, Question : 20
[2025-02-21 08:18:02,372][root][INFO] - Domain : Property, Question : 33
[2025-02-21 08:18:32,957][root][INFO] - Domain : Property, Question : 39
[2025-02-21 08:19:04,396][root][INFO] - Domain : Property, Question : 48
[2025-02-21 08:19:35,683][root][INFO] - Domain : Property, Question : 54
[2025-02-21 08:20:07,122][root][INFO] - Domain : Property, Question : 61
[2025-02-21 08:20:37,964][root][INFO] - Processing question number 80
[2025-02-21 08:20:37,969][root][INFO] - Domain : Property, Question : 67
[2025-02-21 08:21:09,286][root][INFO] - Domain : Property, Question : 75
[2025-02-21 08:21:40,587][root][INFO] - Domain : Property, Question : 83
[2025-02-21 08:22:11,312][root][INFO] - Domain : Property, Question : 89
[2025-02-21 08:22:42,126][root][INFO] - Domain : Property, Question : 97
[2025-02-21 08:23:13,704][root][INFO] - Domain : Property, Question : 100
[2025-02-21 08:23:45,097][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 08:24:16,589][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 08:24:47,342][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 08:25:18,534][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 08:25:49,052][root][INFO] - Processing question number 90
[2025-02-21 08:25:49,057][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 08:26:21,017][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 08:26:51,039][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 08:27:21,936][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 08:27:52,098][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 08:28:23,548][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 08:28:54,026][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 08:29:24,853][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 08:29:55,954][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 08:30:27,533][root][INFO] - Inference complete
[2025-02-21 08:30:27,533][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 08:30:27,540][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 08:30:27,541][root][ERROR] - |Q. 7||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 08:30:27,544][root][ERROR] - |Q. 22||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 08:30:27,548][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Legal_conclusion: 
[2025-02-21 08:30:27,549][root][ERROR] - |Q. 13||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 08:30:27,550][root][ERROR] - |Q. 61||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 08:30:27,551][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 08:30:27,551][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract chosen option: 
[2025-02-21 08:30:27,551][root][ERROR] - |Q. 36||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 08:30:27,553][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 08:30:27,559][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 08:30:27,560][root][INFO] - Saved parsed outputs
[2025-02-21 08:30:27,560][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 08:30:27,581][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 08:30:27,581][root][INFO] - Saved parsing metadata
[2025-02-21 08:30:27,582][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 08:30:27,583][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 08:30:27,598][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 08:30:27,609][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 08:30:27,609][root][INFO] - Summary of metrics : {'label_accuracy': 0.37373737373737376, 'misclassification_rate': 0.6262626262626263, 'combined_accuracy': 0.24242424242424243, 'malformed_label': 1, 'malformed_domain': 29, 'total_predictions': 99, 'correct_predictions': 37, 'correct_label_and_domain': 24, 'Constitutional_Law_accuracy': 0.07142857142857142, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.38461538461538464, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.21212121212121213, 'Criminal_Law_confidence': 0.1717171717171717, 'Evidence_confidence': 0.0707070707070707, 'Real_Property_confidence': 0.04040404040404041, 'Torts_confidence': 0.13131313131313133, 'Civil_Procedure_confidence': 0.08080808080808081, 'correct_domain_wrong_label': 46, 'correct_label_wrong_domain': 13, 'both_wrong': 16}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 08:30:33,712][root][INFO] - Setting global seed to 989
[2025-02-21 08:30:33,717][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-02-21 08:30:33,717][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 08:30:33,719][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 08:30:33,720][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 08:30:33,722][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 08:30:33,722][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 08:30:33,900][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 08:30:34,137][root][INFO] - Full model selected, loading model
[2025-02-21 08:30:51,560][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 08:31:51,496][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 08:31:51,497][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 08:32:17,415][root][INFO] - Peft model loaded successfully
[2025-02-21 08:32:23,615][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 08:32:23,616][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 08:32:23,616][root][INFO] - Starting inference
[2025-02-21 08:32:23,795][root][INFO] - Processing question number 0
[2025-02-21 08:32:23,805][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 08:32:54,410][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 08:33:25,836][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 08:33:56,803][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 08:34:28,254][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 08:34:59,126][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 08:35:29,956][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 08:36:01,568][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 08:36:32,672][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 08:37:03,455][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 08:37:34,916][root][INFO] - Processing question number 10
[2025-02-21 08:37:34,918][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 08:38:07,715][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 08:38:38,238][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 08:39:09,299][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 08:39:40,962][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 08:40:12,594][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 08:40:43,188][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 08:41:13,699][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 08:41:44,728][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 08:42:15,727][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 08:42:46,444][root][INFO] - Processing question number 20
[2025-02-21 08:42:46,447][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 08:43:17,422][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 08:43:48,574][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 08:44:19,163][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 08:44:49,692][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 08:45:21,013][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 08:45:52,048][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 08:46:23,870][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 08:46:54,863][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 08:47:25,980][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 08:47:56,437][root][INFO] - Processing question number 30
[2025-02-21 08:47:56,440][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 08:48:27,826][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 08:48:59,478][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 08:49:30,624][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 08:50:01,582][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 08:50:32,433][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 08:51:04,007][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 08:51:34,933][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 08:52:06,307][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 08:52:37,398][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 08:53:09,233][root][INFO] - Processing question number 40
[2025-02-21 08:53:09,237][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 08:53:40,387][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 08:54:11,529][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 08:54:43,174][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 08:55:14,769][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 08:55:45,634][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 08:56:16,778][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 08:56:49,186][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 08:57:19,395][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 08:57:50,414][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 08:58:22,116][root][INFO] - Processing question number 50
[2025-02-21 08:58:22,120][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 08:58:53,996][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 08:59:25,311][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 08:59:55,777][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 09:00:28,012][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 09:00:59,297][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 09:01:29,537][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 09:02:01,381][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 09:02:32,004][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 09:03:03,702][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 09:03:36,169][root][INFO] - Processing question number 60
[2025-02-21 09:03:36,196][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 09:04:06,791][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 09:04:37,773][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 09:05:09,367][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 09:05:39,953][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 09:06:11,043][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 09:06:42,184][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 09:07:13,364][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 09:07:45,048][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 09:08:16,491][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 09:08:48,426][root][INFO] - Processing question number 70
[2025-02-21 09:08:48,431][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 09:09:19,429][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 09:09:50,409][root][INFO] - Domain : Property, Question : 6
[2025-02-21 09:10:21,258][root][INFO] - Domain : Property, Question : 13
[2025-02-21 09:10:52,723][root][INFO] - Domain : Property, Question : 20
[2025-02-21 09:11:24,140][root][INFO] - Domain : Property, Question : 33
[2025-02-21 09:11:54,810][root][INFO] - Domain : Property, Question : 39
[2025-02-21 09:12:26,335][root][INFO] - Domain : Property, Question : 48
[2025-02-21 09:12:57,708][root][INFO] - Domain : Property, Question : 54
[2025-02-21 09:13:29,224][root][INFO] - Domain : Property, Question : 61
[2025-02-21 09:14:00,185][root][INFO] - Processing question number 80
[2025-02-21 09:14:00,190][root][INFO] - Domain : Property, Question : 67
[2025-02-21 09:14:31,638][root][INFO] - Domain : Property, Question : 75
[2025-02-21 09:15:03,053][root][INFO] - Domain : Property, Question : 83
[2025-02-21 09:15:33,946][root][INFO] - Domain : Property, Question : 89
[2025-02-21 09:16:04,872][root][INFO] - Domain : Property, Question : 97
[2025-02-21 09:16:36,568][root][INFO] - Domain : Property, Question : 100
[2025-02-21 09:17:08,048][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 09:17:39,586][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 09:18:10,444][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 09:18:41,782][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 09:19:12,358][root][INFO] - Processing question number 90
[2025-02-21 09:19:12,364][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 09:19:44,387][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 09:20:14,490][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 09:20:45,471][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 09:21:15,723][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 09:21:47,261][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 09:22:17,828][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 09:22:48,739][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 09:23:20,006][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 09:23:51,705][root][INFO] - Inference complete
[2025-02-21 09:23:51,705][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 09:23:51,712][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 09:23:51,714][root][ERROR] - Failed to extract domain:  for response: 4
[2025-02-21 09:23:51,714][root][ERROR] - |Q. 21||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,714][root][ERROR] - |Q. 21||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,714][root][ERROR] - |Q. 21||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 09:23:51,714][root][ERROR] - |Q. 21||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 09:23:51,714][root][ERROR] - |Q. 21||D: Civil_procedure| Failed to extract chosen option: 
[2025-02-21 09:23:51,714][root][ERROR] - Failed to extract domain:  for response: 5
[2025-02-21 09:23:51,714][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,714][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,714][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 09:23:51,714][root][ERROR] - Failed to extract domain:  for response: 7
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 42||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 42||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 42||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 09:23:51,715][root][ERROR] - Failed to extract domain:  for response: 8
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 49||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 49||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 49||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 09:23:51,715][root][ERROR] - Failed to extract domain:  for response: 9
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 56||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 56||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 56||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 09:23:51,715][root][ERROR] - Failed to extract domain:  for response: 10
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 63||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 63||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 63||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 09:23:51,715][root][ERROR] - |Q. 63||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 09:23:51,716][root][ERROR] - |Q. 63||D: Civil_procedure| Failed to extract chosen option: 
[2025-02-21 09:23:51,716][root][ERROR] - Failed to extract domain:  for response: 13
[2025-02-21 09:23:51,716][root][ERROR] - |Q. 77||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,716][root][ERROR] - |Q. 77||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,716][root][ERROR] - |Q. 77||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 09:23:51,716][root][ERROR] - |Q. 77||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 09:23:51,716][root][ERROR] - |Q. 77||D: Civil_procedure| Failed to extract chosen option: 
[2025-02-21 09:23:51,716][root][ERROR] - Failed to extract domain:  for response: 17
[2025-02-21 09:23:51,717][root][ERROR] - |Q. 2||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,717][root][ERROR] - |Q. 2||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,717][root][ERROR] - |Q. 2||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 09:23:51,718][root][ERROR] - Failed to extract domain:  for response: 26
[2025-02-21 09:23:51,718][root][ERROR] - |Q. 65||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,718][root][ERROR] - |Q. 65||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,718][root][ERROR] - |Q. 65||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 09:23:51,718][root][ERROR] - Failed to extract domain:  for response: 29
[2025-02-21 09:23:51,718][root][ERROR] - |Q. 87||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,718][root][ERROR] - |Q. 87||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,718][root][ERROR] - |Q. 87||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 09:23:51,718][root][ERROR] - |Q. 87||D: Constitutional_law| Failed to extract Legal_conclusion: 
[2025-02-21 09:23:51,718][root][ERROR] - |Q. 87||D: Constitutional_law| Failed to extract chosen option: 
[2025-02-21 09:23:51,719][root][ERROR] - Failed to extract domain:  for response: 35
[2025-02-21 09:23:51,719][root][ERROR] - Failed to extract domain:  for response: 37
[2025-02-21 09:23:51,719][root][ERROR] - |Q. 46||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,719][root][ERROR] - |Q. 46||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,719][root][ERROR] - |Q. 46||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 09:23:51,719][root][ERROR] - |Q. 46||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 09:23:51,719][root][ERROR] - |Q. 46||D: Contracts| Failed to extract chosen option: 
[2025-02-21 09:23:51,720][root][ERROR] - Failed to extract domain:  for response: 42
[2025-02-21 09:23:51,720][root][ERROR] - |Q. 81||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,720][root][ERROR] - |Q. 81||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,720][root][ERROR] - |Q. 81||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 09:23:51,721][root][ERROR] - |Q. 32||D: Torts| Failed to extract Rule_application: 
[2025-02-21 09:23:51,721][root][ERROR] - |Q. 90||D: Torts| Failed to extract Rule_application: 
[2025-02-21 09:23:51,722][root][ERROR] - Failed to extract domain:  for response: 59
[2025-02-21 09:23:51,722][root][ERROR] - |Q. 12||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,722][root][ERROR] - |Q. 12||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,722][root][ERROR] - |Q. 12||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 09:23:51,722][root][ERROR] - Failed to extract domain:  for response: 61
[2025-02-21 09:23:51,722][root][ERROR] - Failed to extract domain:  for response: 62
[2025-02-21 09:23:51,722][root][ERROR] - |Q. 31||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,722][root][ERROR] - |Q. 31||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 09:23:51,723][root][ERROR] - Failed to extract domain:  for response: 66
[2025-02-21 09:23:51,723][root][ERROR] - |Q. 53||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 09:23:51,723][root][ERROR] - Failed to extract domain:  for response: 67
[2025-02-21 09:23:51,723][root][ERROR] - |Q. 59||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,723][root][ERROR] - |Q. 59||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,723][root][ERROR] - |Q. 59||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 09:23:51,723][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,723][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,723][root][ERROR] - |Q. 73||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 09:23:51,724][root][ERROR] - Failed to extract domain:  for response: 71
[2025-02-21 09:23:51,724][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 09:23:51,724][root][ERROR] - Failed to extract domain:  for response: 72
[2025-02-21 09:23:51,724][root][ERROR] - |Q. 96||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,724][root][ERROR] - |Q. 96||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,724][root][ERROR] - |Q. 96||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 09:23:51,724][root][ERROR] - Failed to extract domain:  for response: 73
[2025-02-21 09:23:51,724][root][ERROR] - |Q. 6||D: Property| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,724][root][ERROR] - |Q. 6||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,724][root][ERROR] - |Q. 6||D: Property| Failed to extract Rule_application: 
[2025-02-21 09:23:51,724][root][ERROR] - |Q. 6||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 09:23:51,724][root][ERROR] - |Q. 6||D: Property| Failed to extract chosen option: 
[2025-02-21 09:23:51,725][root][ERROR] - Failed to extract domain:  for response: 83
[2025-02-21 09:23:51,725][root][ERROR] - |Q. 83||D: Property| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,725][root][ERROR] - |Q. 83||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,725][root][ERROR] - |Q. 83||D: Property| Failed to extract Rule_application: 
[2025-02-21 09:23:51,726][root][ERROR] - |Q. 45||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 09:23:51,726][root][ERROR] - Failed to extract domain:  for response: 95
[2025-02-21 09:23:51,727][root][ERROR] - |Q. 64||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 09:23:51,727][root][ERROR] - |Q. 64||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 09:23:51,727][root][ERROR] - |Q. 64||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 09:23:51,728][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 09:23:51,734][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 09:23:51,734][root][INFO] - Saved parsed outputs
[2025-02-21 09:23:51,734][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 09:23:51,736][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 09:23:51,736][root][INFO] - Saved parsing metadata
[2025-02-21 09:23:51,736][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 09:23:51,738][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 09:23:51,739][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 09:23:51,758][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 09:23:51,758][root][INFO] - Summary of metrics : {'label_accuracy': 0.26262626262626265, 'misclassification_rate': 0.7373737373737373, 'combined_accuracy': 0.09090909090909091, 'malformed_label': 26, 'malformed_domain': 57, 'total_predictions': 99, 'correct_predictions': 26, 'correct_label_and_domain': 9, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.15384615384615385, 'Evidence_accuracy': 0.0, 'Real_Property_accuracy': 0.0, 'Torts_accuracy': 0.15384615384615385, 'Civil_Procedure_accuracy': 0.0625, 'Constitutional_Law_confidence': 0.10101010101010101, 'Contracts_confidence': 0.13131313131313133, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.020202020202020204, 'Real_Property_confidence': 0.010101010101010102, 'Torts_confidence': 0.12121212121212122, 'Civil_Procedure_confidence': 0.020202020202020204, 'correct_domain_wrong_label': 33, 'correct_label_wrong_domain': 17, 'both_wrong': 40}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 09:23:59,258][root][INFO] - Setting global seed to 989
[2025-02-21 09:23:59,265][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-02-21 09:23:59,265][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 09:23:59,267][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-02-21 09:23:59,280][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 09:23:59,283][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 09:23:59,283][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-02-21 09:23:59,434][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 09:23:59,680][root][INFO] - Full model selected, loading model
[2025-02-21 09:24:16,616][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 09:24:16,616][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 09:24:23,077][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 09:24:23,078][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 09:24:23,079][root][INFO] - Starting inference
[2025-02-21 09:24:23,210][root][INFO] - Processing question number 0
[2025-02-21 09:24:23,212][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-02-21 09:24:53,645][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-02-21 09:25:24,957][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-02-21 09:25:55,794][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-02-21 09:26:27,136][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-02-21 09:26:57,836][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-02-21 09:27:28,639][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-02-21 09:28:00,127][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-02-21 09:28:31,122][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-02-21 09:29:01,734][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-02-21 09:29:33,088][root][INFO] - Processing question number 10
[2025-02-21 09:29:33,091][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-02-21 09:30:05,697][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-02-21 09:30:36,116][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-02-21 09:31:07,078][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-02-21 09:31:38,637][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-02-21 09:32:10,175][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-02-21 09:32:40,672][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-02-21 09:33:11,109][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-02-21 09:33:42,061][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-02-21 09:34:12,977][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-02-21 09:34:43,613][root][INFO] - Processing question number 20
[2025-02-21 09:34:43,615][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-02-21 09:35:14,495][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-02-21 09:35:45,556][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-02-21 09:36:16,050][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-02-21 09:36:46,479][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-02-21 09:37:17,618][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-02-21 09:37:48,555][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-02-21 09:38:20,276][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-02-21 09:38:51,199][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-02-21 09:39:22,270][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-02-21 09:39:52,628][root][INFO] - Processing question number 30
[2025-02-21 09:39:52,631][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 09:40:23,921][root][INFO] - Domain : Contracts, Question : 8
[2025-02-21 09:40:55,452][root][INFO] - Domain : Contracts, Question : 16
[2025-02-21 09:41:26,471][root][INFO] - Domain : Contracts, Question : 22
[2025-02-21 09:41:57,326][root][INFO] - Domain : Contracts, Question : 27
[2025-02-21 09:42:28,018][root][INFO] - Domain : Contracts, Question : 38
[2025-02-21 09:42:59,489][root][INFO] - Domain : Contracts, Question : 46
[2025-02-21 09:43:30,315][root][INFO] - Domain : Contracts, Question : 51
[2025-02-21 09:44:01,590][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 09:44:32,587][root][INFO] - Domain : Contracts, Question : 66
[2025-02-21 09:45:04,308][root][INFO] - Processing question number 40
[2025-02-21 09:45:04,311][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 09:45:35,365][root][INFO] - Domain : Contracts, Question : 81
[2025-02-21 09:46:06,406][root][INFO] - Domain : Contracts, Question : 88
[2025-02-21 09:46:37,929][root][INFO] - Domain : Contracts, Question : 94
[2025-02-21 09:47:09,403][root][INFO] - Domain : Torts, Question : 4
[2025-02-21 09:47:40,099][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 09:48:11,102][root][INFO] - Domain : Torts, Question : 24
[2025-02-21 09:48:43,389][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 09:49:13,479][root][INFO] - Domain : Torts, Question : 41
[2025-02-21 09:49:44,368][root][INFO] - Domain : Torts, Question : 47
[2025-02-21 09:50:15,933][root][INFO] - Processing question number 50
[2025-02-21 09:50:15,950][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 09:50:47,703][root][INFO] - Domain : Torts, Question : 62
[2025-02-21 09:51:18,809][root][INFO] - Domain : Torts, Question : 76
[2025-02-21 09:51:49,160][root][INFO] - Domain : Torts, Question : 82
[2025-02-21 09:52:21,201][root][INFO] - Domain : Torts, Question : 90
[2025-02-21 09:52:52,279][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 09:53:22,390][root][INFO] - Domain : Torts, Question : 99
[2025-02-21 09:53:54,108][root][INFO] - Domain : Evidence, Question : 5
[2025-02-21 09:54:24,614][root][INFO] - Domain : Evidence, Question : 12
[2025-02-21 09:54:56,176][root][INFO] - Domain : Evidence, Question : 18
[2025-02-21 09:55:28,526][root][INFO] - Processing question number 60
[2025-02-21 09:55:28,530][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 09:55:59,015][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 09:56:29,868][root][INFO] - Domain : Evidence, Question : 34
[2025-02-21 09:57:01,341][root][INFO] - Domain : Evidence, Question : 40
[2025-02-21 09:57:31,805][root][INFO] - Domain : Evidence, Question : 44
[2025-02-21 09:58:02,778][root][INFO] - Domain : Evidence, Question : 53
[2025-02-21 09:58:33,801][root][INFO] - Domain : Evidence, Question : 59
[2025-02-21 09:59:04,857][root][INFO] - Domain : Evidence, Question : 68
[2025-02-21 09:59:36,245][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 10:00:07,369][root][INFO] - Domain : Evidence, Question : 78
[2025-02-21 10:00:39,038][root][INFO] - Processing question number 70
[2025-02-21 10:00:39,042][root][INFO] - Domain : Evidence, Question : 86
[2025-02-21 10:01:09,860][root][INFO] - Domain : Evidence, Question : 96
[2025-02-21 10:01:40,720][root][INFO] - Domain : Property, Question : 6
[2025-02-21 10:02:11,402][root][INFO] - Domain : Property, Question : 13
[2025-02-21 10:02:42,760][root][INFO] - Domain : Property, Question : 20
[2025-02-21 10:03:14,096][root][INFO] - Domain : Property, Question : 33
[2025-02-21 10:03:44,687][root][INFO] - Domain : Property, Question : 39
[2025-02-21 10:04:16,129][root][INFO] - Domain : Property, Question : 48
[2025-02-21 10:04:47,422][root][INFO] - Domain : Property, Question : 54
[2025-02-21 10:05:18,855][root][INFO] - Domain : Property, Question : 61
[2025-02-21 10:05:49,699][root][INFO] - Processing question number 80
[2025-02-21 10:05:49,704][root][INFO] - Domain : Property, Question : 67
[2025-02-21 10:06:20,994][root][INFO] - Domain : Property, Question : 75
[2025-02-21 10:06:52,279][root][INFO] - Domain : Property, Question : 83
[2025-02-21 10:07:22,977][root][INFO] - Domain : Property, Question : 89
[2025-02-21 10:07:53,769][root][INFO] - Domain : Property, Question : 97
[2025-02-21 10:08:25,322][root][INFO] - Domain : Property, Question : 100
[2025-02-21 10:08:56,694][root][INFO] - Domain : Criminal_law, Question : 10
[2025-02-21 10:09:28,117][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 10:09:58,813][root][INFO] - Domain : Criminal_law, Question : 26
[2025-02-21 10:10:29,960][root][INFO] - Domain : Criminal_law, Question : 30
[2025-02-21 10:11:00,438][root][INFO] - Processing question number 90
[2025-02-21 10:11:00,444][root][INFO] - Domain : Criminal_law, Question : 36
[2025-02-21 10:11:32,366][root][INFO] - Domain : Criminal_law, Question : 45
[2025-02-21 10:12:02,354][root][INFO] - Domain : Criminal_law, Question : 50
[2025-02-21 10:12:33,225][root][INFO] - Domain : Criminal_law, Question : 57
[2025-02-21 10:13:03,365][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 10:13:34,790][root][INFO] - Domain : Criminal_law, Question : 74
[2025-02-21 10:14:05,246][root][INFO] - Domain : Criminal_law, Question : 80
[2025-02-21 10:14:36,047][root][INFO] - Domain : Criminal_law, Question : 85
[2025-02-21 10:15:07,123][root][INFO] - Domain : Criminal_law, Question : 92
[2025-02-21 10:15:38,674][root][INFO] - Inference complete
[2025-02-21 10:15:38,674][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 10:15:38,681][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 10:15:38,682][root][ERROR] - |Q. 14||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,682][root][ERROR] - |Q. 14||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,682][root][ERROR] - |Q. 14||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 10:15:38,682][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,682][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,682][root][ERROR] - |Q. 28||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 10:15:38,683][root][ERROR] - |Q. 42||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,683][root][ERROR] - |Q. 42||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,683][root][ERROR] - |Q. 42||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 10:15:38,683][root][ERROR] - |Q. 49||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,683][root][ERROR] - |Q. 49||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,683][root][ERROR] - |Q. 49||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 10:15:38,684][root][ERROR] - |Q. 2||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,684][root][ERROR] - |Q. 2||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,684][root][ERROR] - |Q. 2||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 10:15:38,686][root][ERROR] - |Q. 3||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,686][root][ERROR] - |Q. 3||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,686][root][ERROR] - |Q. 3||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 10:15:38,686][root][ERROR] - |Q. 22||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,687][root][ERROR] - |Q. 22||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,687][root][ERROR] - |Q. 22||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 10:15:38,687][root][ERROR] - |Q. 72||D: Contracts| Failed to extract chosen option: 
[2025-02-21 10:15:38,688][root][ERROR] - |Q. 24||D: Torts| Failed to extract chosen option: 
[2025-02-21 10:15:38,690][root][ERROR] - |Q. 12||D: Evidence| Failed to extract Legal_conclusion: 
[2025-02-21 10:15:38,690][root][ERROR] - |Q. 12||D: Evidence| Failed to extract chosen option: 
[2025-02-21 10:15:38,691][root][ERROR] - |Q. 59||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,691][root][ERROR] - |Q. 59||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,691][root][ERROR] - |Q. 59||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 10:15:38,691][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,691][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,691][root][ERROR] - |Q. 86||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 10:15:38,692][root][ERROR] - |Q. 13||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 10:15:38,693][root][ERROR] - |Q. 83||D: Property| Failed to extract Legal_concept: 
[2025-02-21 10:15:38,693][root][ERROR] - |Q. 83||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 10:15:38,693][root][ERROR] - |Q. 83||D: Property| Failed to extract Rule_application: 
[2025-02-21 10:15:38,693][root][ERROR] - |Q. 97||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 10:15:38,693][root][ERROR] - |Q. 97||D: Property| Failed to extract chosen option: 
[2025-02-21 10:15:38,694][root][ERROR] - |Q. 100||D: Property| Failed to extract Rule_application: 
[2025-02-21 10:15:38,694][root][ERROR] - |Q. 100||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 10:15:38,694][root][ERROR] - |Q. 100||D: Property| Failed to extract chosen option: 
[2025-02-21 10:15:38,694][root][ERROR] - |Q. 10||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 10:15:38,694][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 10:15:38,695][root][ERROR] - |Q. 92||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 10:15:38,695][root][ERROR] - |Q. 92||D: Criminal_law| Failed to extract chosen option: 
[2025-02-21 10:15:38,696][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 10:15:38,702][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 10:15:38,702][root][INFO] - Saved parsed outputs
[2025-02-21 10:15:38,702][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 10:15:38,709][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 10:15:38,709][root][INFO] - Saved parsing metadata
[2025-02-21 10:15:38,710][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 10:15:38,711][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
[2025-02-21 10:15:38,713][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-02-21 10:15:38,739][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_1
[2025-02-21 10:15:38,739][root][INFO] - Summary of metrics : {'label_accuracy': 0.35353535353535354, 'misclassification_rate': 0.6464646464646464, 'combined_accuracy': 0.21212121212121213, 'malformed_label': 8, 'malformed_domain': 39, 'total_predictions': 99, 'correct_predictions': 35, 'correct_label_and_domain': 21, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.21428571428571427, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.125, 'Constitutional_Law_confidence': 0.12121212121212122, 'Contracts_confidence': 0.1111111111111111, 'Criminal_Law_confidence': 0.18181818181818182, 'Evidence_confidence': 0.050505050505050504, 'Real_Property_confidence': 0.050505050505050504, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.0707070707070707, 'correct_domain_wrong_label': 39, 'correct_label_wrong_domain': 14, 'both_wrong': 25}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 10:15:45,184][root][INFO] - Setting global seed to 206
[2025-02-21 10:15:45,190][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-02-21 10:15:45,190][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 10:15:45,191][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 10:15:45,192][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 10:15:45,195][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 10:15:45,195][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 10:15:45,332][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 10:15:45,575][root][INFO] - Full model selected, loading model
[2025-02-21 10:15:57,753][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 10:16:59,045][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 10:16:59,045][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 10:17:25,762][root][INFO] - Peft model loaded successfully
[2025-02-21 10:17:32,161][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 10:17:32,162][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 10:17:32,163][root][INFO] - Starting inference
[2025-02-21 10:17:32,325][root][INFO] - Processing question number 0
[2025-02-21 10:17:32,333][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 10:18:03,710][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 10:18:35,540][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 10:19:07,536][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 10:19:38,980][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 10:20:09,740][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 10:20:39,956][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 10:21:10,709][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 10:21:41,692][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 10:22:11,986][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 10:22:42,876][root][INFO] - Processing question number 10
[2025-02-21 10:22:42,880][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 10:23:12,969][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 10:23:43,685][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 10:24:14,509][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 10:24:44,827][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 10:25:16,117][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 10:25:46,991][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 10:26:17,822][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 10:26:48,539][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 10:27:19,798][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 10:27:51,154][root][INFO] - Processing question number 20
[2025-02-21 10:27:51,157][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 10:28:21,358][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 10:28:52,374][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 10:29:22,882][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 10:29:53,602][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 10:30:24,396][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 10:30:55,738][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 10:31:26,617][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 10:31:57,641][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 10:32:28,503][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 10:32:59,990][root][INFO] - Processing question number 30
[2025-02-21 10:32:59,994][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 10:33:30,895][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 10:34:01,646][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 10:34:32,352][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 10:35:03,779][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 10:35:34,605][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 10:36:05,499][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 10:36:36,346][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 10:37:07,887][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 10:37:38,892][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 10:38:10,055][root][INFO] - Processing question number 40
[2025-02-21 10:38:10,059][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 10:38:41,123][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 10:39:11,957][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 10:39:43,295][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 10:40:13,501][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 10:40:45,056][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 10:41:16,028][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 10:41:46,861][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 10:42:17,858][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 10:42:48,764][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 10:43:20,053][root][INFO] - Processing question number 50
[2025-02-21 10:43:20,057][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 10:43:51,587][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 10:44:22,020][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 10:44:53,565][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 10:45:24,764][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 10:45:55,248][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 10:46:26,023][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 10:46:57,694][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 10:47:29,117][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 10:48:00,530][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 10:48:31,770][root][INFO] - Processing question number 60
[2025-02-21 10:48:31,775][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 10:49:02,724][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 10:49:33,733][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 10:50:05,455][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 10:50:36,747][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 10:51:07,938][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 10:51:38,630][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 10:52:09,083][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 10:52:39,430][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 10:53:10,140][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 10:53:40,727][root][INFO] - Processing question number 70
[2025-02-21 10:53:40,732][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 10:54:11,953][root][INFO] - Domain : Property, Question : 9
[2025-02-21 10:54:43,071][root][INFO] - Domain : Property, Question : 17
[2025-02-21 10:55:14,383][root][INFO] - Domain : Property, Question : 25
[2025-02-21 10:55:46,148][root][INFO] - Domain : Property, Question : 30
[2025-02-21 10:56:16,677][root][INFO] - Domain : Property, Question : 36
[2025-02-21 10:56:47,897][root][INFO] - Domain : Property, Question : 46
[2025-02-21 10:57:20,087][root][INFO] - Domain : Property, Question : 53
[2025-02-21 10:57:51,347][root][INFO] - Domain : Property, Question : 59
[2025-02-21 10:58:21,577][root][INFO] - Domain : Property, Question : 66
[2025-02-21 10:58:52,223][root][INFO] - Processing question number 80
[2025-02-21 10:58:52,229][root][INFO] - Domain : Property, Question : 69
[2025-02-21 10:59:23,765][root][INFO] - Domain : Property, Question : 81
[2025-02-21 10:59:55,351][root][INFO] - Domain : Property, Question : 88
[2025-02-21 11:00:26,847][root][INFO] - Domain : Property, Question : 91
[2025-02-21 11:00:58,067][root][INFO] - Domain : Property, Question : 94
[2025-02-21 11:01:30,204][root][INFO] - Domain : Property, Question : 100
[2025-02-21 11:02:01,007][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 11:02:32,370][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 11:03:04,233][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 11:03:35,344][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 11:04:06,471][root][INFO] - Processing question number 90
[2025-02-21 11:04:06,476][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 11:04:37,609][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 11:05:09,043][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 11:05:40,289][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 11:06:11,243][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 11:06:42,896][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 11:07:14,433][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 11:07:45,685][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 11:08:16,480][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 11:08:46,836][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 11:09:18,427][root][INFO] - Inference complete
[2025-02-21 11:09:18,428][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 11:09:18,435][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 11:09:18,442][root][ERROR] - |Q. 9||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 11:09:18,443][root][ERROR] - Failed to extract domain:  for response: 80
[2025-02-21 11:09:18,443][root][ERROR] - |Q. 66||D: Property| Failed to extract Legal_concept: 
[2025-02-21 11:09:18,443][root][ERROR] - |Q. 66||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 11:09:18,443][root][ERROR] - |Q. 66||D: Property| Failed to extract Rule_application: 
[2025-02-21 11:09:18,445][root][ERROR] - |Q. 67||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 11:09:18,445][root][ERROR] - |Q. 67||D: Torts| Failed to extract chosen option: 
[2025-02-21 11:09:18,446][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 11:09:18,452][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 11:09:18,452][root][INFO] - Saved parsed outputs
[2025-02-21 11:09:18,452][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 11:09:18,454][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 11:09:18,454][root][INFO] - Saved parsing metadata
[2025-02-21 11:09:18,454][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 11:09:18,456][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 11:09:18,457][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 11:09:18,473][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 11:09:18,473][root][INFO] - Summary of metrics : {'label_accuracy': 0.32, 'misclassification_rate': 0.6799999999999999, 'combined_accuracy': 0.22, 'malformed_label': 2, 'malformed_domain': 37, 'total_predictions': 100, 'correct_predictions': 32, 'correct_label_and_domain': 22, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.12, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.22, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.02, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.07, 'correct_domain_wrong_label': 41, 'correct_label_wrong_domain': 10, 'both_wrong': 27}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 11:09:26,093][root][INFO] - Setting global seed to 206
[2025-02-21 11:09:26,099][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-02-21 11:09:26,099][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 11:09:26,100][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 11:09:26,101][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 11:09:26,104][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 11:09:26,104][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 11:09:26,258][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 11:09:26,526][root][INFO] - Full model selected, loading model
[2025-02-21 11:09:43,025][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 11:09:43,025][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 11:09:49,585][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 11:09:49,587][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 11:09:49,587][root][INFO] - Starting inference
[2025-02-21 11:09:49,714][root][INFO] - Processing question number 0
[2025-02-21 11:09:49,716][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 11:10:20,722][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 11:10:52,346][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 11:11:24,098][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 11:11:55,374][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 11:12:26,045][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 11:12:56,134][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 11:13:26,770][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 11:13:57,662][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 11:14:27,875][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 11:14:58,724][root][INFO] - Processing question number 10
[2025-02-21 11:14:58,726][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 11:15:28,738][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 11:15:59,307][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 11:16:30,040][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 11:17:00,271][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 11:17:31,474][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 11:18:02,285][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 11:18:33,028][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 11:19:03,590][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 11:19:34,763][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 11:20:06,029][root][INFO] - Processing question number 20
[2025-02-21 11:20:06,031][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 11:20:36,104][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 11:21:07,018][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 11:21:37,459][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 11:22:08,089][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 11:22:38,793][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 11:23:10,041][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 11:23:40,802][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 11:24:11,727][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 11:24:42,480][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 11:25:13,846][root][INFO] - Processing question number 30
[2025-02-21 11:25:13,849][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 11:25:44,653][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 11:26:15,307][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 11:26:45,866][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 11:27:17,200][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 11:27:47,926][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 11:28:18,729][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 11:28:49,553][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 11:29:21,105][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 11:29:52,145][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 11:30:23,278][root][INFO] - Processing question number 40
[2025-02-21 11:30:23,281][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 11:30:54,204][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 11:31:24,924][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 11:31:56,170][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 11:32:26,249][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 11:32:57,688][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 11:33:28,576][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 11:33:59,305][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 11:34:30,201][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 11:35:01,001][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 11:35:32,195][root][INFO] - Processing question number 50
[2025-02-21 11:35:32,199][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 11:36:03,621][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 11:36:33,941][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 11:37:05,375][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 11:37:36,390][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 11:38:06,762][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 11:38:37,426][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 11:39:08,989][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 11:39:40,302][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 11:40:11,622][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 11:40:42,758][root][INFO] - Processing question number 60
[2025-02-21 11:40:42,762][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 11:41:13,609][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 11:41:44,516][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 11:42:16,129][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 11:42:47,320][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 11:43:18,363][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 11:43:48,886][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 11:44:19,242][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 11:44:49,485][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 11:45:20,067][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 11:45:50,538][root][INFO] - Processing question number 70
[2025-02-21 11:45:50,543][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 11:46:21,663][root][INFO] - Domain : Property, Question : 9
[2025-02-21 11:46:52,610][root][INFO] - Domain : Property, Question : 17
[2025-02-21 11:47:23,830][root][INFO] - Domain : Property, Question : 25
[2025-02-21 11:47:55,474][root][INFO] - Domain : Property, Question : 30
[2025-02-21 11:48:25,903][root][INFO] - Domain : Property, Question : 36
[2025-02-21 11:48:57,060][root][INFO] - Domain : Property, Question : 46
[2025-02-21 11:49:29,167][root][INFO] - Domain : Property, Question : 53
[2025-02-21 11:50:00,437][root][INFO] - Domain : Property, Question : 59
[2025-02-21 11:50:30,649][root][INFO] - Domain : Property, Question : 66
[2025-02-21 11:51:01,274][root][INFO] - Processing question number 80
[2025-02-21 11:51:01,279][root][INFO] - Domain : Property, Question : 69
[2025-02-21 11:51:32,879][root][INFO] - Domain : Property, Question : 81
[2025-02-21 11:52:04,466][root][INFO] - Domain : Property, Question : 88
[2025-02-21 11:52:36,024][root][INFO] - Domain : Property, Question : 91
[2025-02-21 11:53:07,316][root][INFO] - Domain : Property, Question : 94
[2025-02-21 11:53:39,451][root][INFO] - Domain : Property, Question : 100
[2025-02-21 11:54:10,144][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 11:54:41,426][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 11:55:13,241][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 11:55:44,196][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 11:56:15,168][root][INFO] - Processing question number 90
[2025-02-21 11:56:15,174][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 11:56:46,143][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 11:57:17,488][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 11:57:48,669][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 11:58:19,551][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 11:58:51,119][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 11:59:22,557][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 11:59:53,738][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 12:00:24,450][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 12:00:54,718][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 12:01:26,178][root][INFO] - Inference complete
[2025-02-21 12:01:26,178][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:01:26,188][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:01:26,191][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 12:01:26,196][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 12:01:26,196][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 12:01:26,196][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 12:01:26,197][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract chosen option: 
[2025-02-21 12:01:26,197][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 12:01:26,197][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract chosen option: 
[2025-02-21 12:01:26,202][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:01:26,208][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:01:26,208][root][INFO] - Saved parsed outputs
[2025-02-21 12:01:26,208][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:01:26,209][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:01:26,209][root][INFO] - Saved parsing metadata
[2025-02-21 12:01:26,210][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:01:26,212][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:01:26,213][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 12:01:26,225][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 12:01:26,225][root][INFO] - Summary of metrics : {'label_accuracy': 0.36, 'misclassification_rate': 0.64, 'combined_accuracy': 0.25, 'malformed_label': 2, 'malformed_domain': 33, 'total_predictions': 100, 'correct_predictions': 36, 'correct_label_and_domain': 25, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.12, 'Contracts_confidence': 0.22, 'Criminal_Law_confidence': 0.22, 'Evidence_confidence': 0.05, 'Real_Property_confidence': 0.03, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.07, 'correct_domain_wrong_label': 42, 'correct_label_wrong_domain': 11, 'both_wrong': 22}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 12:01:32,265][root][INFO] - Setting global seed to 206
[2025-02-21 12:01:32,270][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-02-21 12:01:32,270][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 12:01:32,272][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 12:01:32,273][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 12:01:32,275][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 12:01:32,275][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 12:01:33,347][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 12:01:33,596][root][INFO] - Full model selected, loading model
[2025-02-21 12:01:45,407][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 12:02:46,328][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 12:02:46,329][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 12:03:10,765][root][INFO] - Peft model loaded successfully
[2025-02-21 12:03:16,983][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 12:03:16,985][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:03:16,985][root][INFO] - Starting inference
[2025-02-21 12:03:17,108][root][INFO] - Processing question number 0
[2025-02-21 12:03:17,110][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 12:03:48,571][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 12:04:20,461][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 12:04:52,493][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 12:05:24,044][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 12:05:55,001][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 12:06:25,401][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 12:06:56,324][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 12:07:27,484][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 12:07:57,969][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 12:08:29,106][root][INFO] - Processing question number 10
[2025-02-21 12:08:29,109][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 12:08:59,396][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 12:09:30,300][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 12:10:01,313][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 12:10:31,811][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 12:11:03,290][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 12:11:34,359][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 12:12:05,364][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 12:12:36,262][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 12:13:07,825][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 12:13:39,378][root][INFO] - Processing question number 20
[2025-02-21 12:13:39,380][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 12:14:09,753][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 12:14:40,931][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 12:15:11,633][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 12:15:42,540][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 12:16:13,513][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 12:16:45,036][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 12:17:16,074][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 12:17:47,270][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 12:18:18,306][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 12:18:49,955][root][INFO] - Processing question number 30
[2025-02-21 12:18:49,959][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 12:19:21,043][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 12:19:51,981][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 12:20:22,907][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 12:20:54,532][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 12:21:25,556][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 12:21:56,652][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 12:22:27,693][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 12:22:59,416][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 12:23:30,605][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 12:24:01,903][root][INFO] - Processing question number 40
[2025-02-21 12:24:01,907][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 12:24:33,084][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 12:25:04,080][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 12:25:35,624][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 12:26:06,060][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 12:26:37,815][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 12:27:08,991][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 12:27:40,022][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 12:28:11,224][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 12:28:42,312][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 12:29:13,785][root][INFO] - Processing question number 50
[2025-02-21 12:29:13,792][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 12:29:45,513][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 12:30:16,119][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 12:30:47,850][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 12:31:19,222][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 12:31:49,883][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 12:32:20,843][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 12:32:52,697][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 12:33:24,300][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 12:33:55,909][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 12:34:27,329][root][INFO] - Processing question number 60
[2025-02-21 12:34:27,333][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 12:34:58,462][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 12:35:29,645][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 12:36:01,581][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 12:36:33,200][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 12:37:04,745][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 12:37:35,742][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 12:38:06,495][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 12:38:37,184][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 12:39:08,067][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 12:39:38,820][root][INFO] - Processing question number 70
[2025-02-21 12:39:38,827][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 12:40:10,216][root][INFO] - Domain : Property, Question : 9
[2025-02-21 12:40:41,586][root][INFO] - Domain : Property, Question : 17
[2025-02-21 12:41:13,177][root][INFO] - Domain : Property, Question : 25
[2025-02-21 12:41:45,221][root][INFO] - Domain : Property, Question : 30
[2025-02-21 12:42:16,108][root][INFO] - Domain : Property, Question : 36
[2025-02-21 12:42:47,537][root][INFO] - Domain : Property, Question : 46
[2025-02-21 12:43:19,929][root][INFO] - Domain : Property, Question : 53
[2025-02-21 12:43:51,364][root][INFO] - Domain : Property, Question : 59
[2025-02-21 12:44:21,773][root][INFO] - Domain : Property, Question : 66
[2025-02-21 12:44:52,598][root][INFO] - Processing question number 80
[2025-02-21 12:44:52,605][root][INFO] - Domain : Property, Question : 69
[2025-02-21 12:45:24,327][root][INFO] - Domain : Property, Question : 81
[2025-02-21 12:45:56,088][root][INFO] - Domain : Property, Question : 88
[2025-02-21 12:46:27,775][root][INFO] - Domain : Property, Question : 91
[2025-02-21 12:46:59,189][root][INFO] - Domain : Property, Question : 94
[2025-02-21 12:47:31,524][root][INFO] - Domain : Property, Question : 100
[2025-02-21 12:48:02,495][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 12:48:34,042][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 12:49:06,099][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 12:49:37,409][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 12:50:08,734][root][INFO] - Processing question number 90
[2025-02-21 12:50:08,740][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 12:50:40,055][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 12:51:11,666][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 12:51:43,098][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 12:52:14,233][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 12:52:46,073][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 12:53:17,807][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 12:53:49,267][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 12:54:20,256][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 12:54:50,786][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 12:55:22,559][root][INFO] - Inference complete
[2025-02-21 12:55:22,559][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:55:22,568][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:55:22,571][root][ERROR] - Failed to extract domain:  for response: 13
[2025-02-21 12:55:22,571][root][ERROR] - |Q. 86||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 12:55:22,571][root][ERROR] - |Q. 86||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 12:55:22,571][root][ERROR] - |Q. 86||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 12:55:22,576][root][ERROR] - Failed to extract domain:  for response: 69
[2025-02-21 12:55:22,576][root][ERROR] - |Q. 75||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 12:55:22,576][root][ERROR] - |Q. 75||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 12:55:22,576][root][ERROR] - |Q. 75||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 12:55:22,577][root][ERROR] - |Q. 66||D: Property| Failed to extract Legal_concept: 
[2025-02-21 12:55:22,577][root][ERROR] - |Q. 66||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 12:55:22,577][root][ERROR] - |Q. 66||D: Property| Failed to extract Rule_application: 
[2025-02-21 12:55:22,577][root][ERROR] - |Q. 81||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 12:55:22,577][root][ERROR] - |Q. 88||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 12:55:22,579][root][ERROR] - |Q. 67||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 12:55:22,579][root][ERROR] - |Q. 67||D: Torts| Failed to extract chosen option: 
[2025-02-21 12:55:22,580][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:55:22,587][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:55:22,587][root][INFO] - Saved parsed outputs
[2025-02-21 12:55:22,587][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:55:22,588][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:55:22,588][root][INFO] - Saved parsing metadata
[2025-02-21 12:55:22,589][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:55:22,590][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:55:22,592][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 12:55:22,605][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 12:55:22,606][root][INFO] - Summary of metrics : {'label_accuracy': 0.31, 'misclassification_rate': 0.69, 'combined_accuracy': 0.21, 'malformed_label': 4, 'malformed_domain': 36, 'total_predictions': 100, 'correct_predictions': 31, 'correct_label_and_domain': 21, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.0, 'Torts_accuracy': 0.07142857142857142, 'Civil_Procedure_accuracy': 0.0, 'Constitutional_Law_confidence': 0.1, 'Contracts_confidence': 0.18, 'Criminal_Law_confidence': 0.22, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.04, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.07, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 10, 'both_wrong': 26}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 12:55:28,727][root][INFO] - Setting global seed to 206
[2025-02-21 12:55:28,732][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-02-21 12:55:28,732][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 12:55:28,733][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 12:55:28,737][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 12:55:28,738][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 12:55:28,739][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 12:55:28,888][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 12:55:29,138][root][INFO] - Full model selected, loading model
[2025-02-21 12:55:45,776][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 12:55:45,776][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 12:55:52,235][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 12:55:52,237][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 12:55:52,237][root][INFO] - Starting inference
[2025-02-21 12:55:52,379][root][INFO] - Processing question number 0
[2025-02-21 12:55:52,383][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 12:56:23,779][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 12:56:55,577][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 12:57:27,524][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 12:57:58,975][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 12:58:29,872][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 12:59:00,301][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 12:59:31,125][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 13:00:02,193][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 13:00:32,638][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 13:01:03,729][root][INFO] - Processing question number 10
[2025-02-21 13:01:03,732][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 13:01:33,964][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 13:02:04,712][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 13:02:35,628][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 13:03:06,030][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 13:03:37,416][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 13:04:08,384][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 13:04:39,296][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 13:05:10,039][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 13:05:41,391][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 13:06:12,828][root][INFO] - Processing question number 20
[2025-02-21 13:06:12,832][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 13:06:43,103][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 13:07:14,210][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 13:07:44,831][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 13:08:15,680][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 13:08:46,578][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 13:09:18,027][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 13:09:48,967][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 13:10:20,074][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 13:10:51,016][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 13:11:22,569][root][INFO] - Processing question number 30
[2025-02-21 13:11:22,580][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 13:11:53,565][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 13:12:24,399][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 13:12:55,139][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 13:13:26,658][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 13:13:57,600][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 13:14:28,595][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 13:14:59,552][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 13:15:31,171][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 13:16:02,282][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 13:16:33,405][root][INFO] - Processing question number 40
[2025-02-21 13:16:33,410][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 13:17:04,508][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 13:17:35,428][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 13:18:06,872][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 13:18:37,144][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 13:19:08,798][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 13:19:39,877][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 13:20:10,806][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 13:20:41,890][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 13:21:12,893][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 13:21:44,270][root][INFO] - Processing question number 50
[2025-02-21 13:21:44,274][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 13:22:15,925][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 13:22:46,590][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 13:23:18,358][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 13:23:49,694][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 13:24:20,396][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 13:24:51,421][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 13:25:23,199][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 13:25:54,707][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 13:26:26,220][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 13:26:57,558][root][INFO] - Processing question number 60
[2025-02-21 13:26:57,563][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 13:27:28,605][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 13:27:59,703][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 13:28:31,519][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 13:29:02,895][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 13:29:34,106][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 13:30:04,869][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 13:30:35,430][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 13:31:05,864][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 13:31:36,569][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 13:32:07,199][root][INFO] - Processing question number 70
[2025-02-21 13:32:07,210][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 13:32:38,514][root][INFO] - Domain : Property, Question : 9
[2025-02-21 13:33:09,628][root][INFO] - Domain : Property, Question : 17
[2025-02-21 13:33:41,020][root][INFO] - Domain : Property, Question : 25
[2025-02-21 13:34:12,849][root][INFO] - Domain : Property, Question : 30
[2025-02-21 13:34:43,469][root][INFO] - Domain : Property, Question : 36
[2025-02-21 13:35:14,807][root][INFO] - Domain : Property, Question : 46
[2025-02-21 13:35:47,110][root][INFO] - Domain : Property, Question : 53
[2025-02-21 13:36:18,459][root][INFO] - Domain : Property, Question : 59
[2025-02-21 13:36:48,740][root][INFO] - Domain : Property, Question : 66
[2025-02-21 13:37:19,412][root][INFO] - Processing question number 80
[2025-02-21 13:37:19,417][root][INFO] - Domain : Property, Question : 69
[2025-02-21 13:37:51,030][root][INFO] - Domain : Property, Question : 81
[2025-02-21 13:38:22,679][root][INFO] - Domain : Property, Question : 88
[2025-02-21 13:38:54,252][root][INFO] - Domain : Property, Question : 91
[2025-02-21 13:39:25,570][root][INFO] - Domain : Property, Question : 94
[2025-02-21 13:39:57,810][root][INFO] - Domain : Property, Question : 100
[2025-02-21 13:40:28,699][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 13:41:00,160][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 13:41:32,110][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 13:42:03,225][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 13:42:34,347][root][INFO] - Processing question number 90
[2025-02-21 13:42:34,353][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 13:43:05,484][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 13:43:36,997][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 13:44:08,344][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 13:44:39,404][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 13:45:11,265][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 13:45:42,914][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 13:46:14,271][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 13:46:45,205][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 13:47:15,665][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 13:47:47,317][root][INFO] - Inference complete
[2025-02-21 13:47:47,317][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 13:47:47,328][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 13:47:47,330][root][ERROR] - |Q. 62||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 13:47:47,330][root][ERROR] - |Q. 62||D: Constitutional_law| Failed to extract Legal_conclusion: 
[2025-02-21 13:47:47,330][root][ERROR] - |Q. 62||D: Constitutional_law| Failed to extract chosen option: 
[2025-02-21 13:47:47,331][root][ERROR] - |Q. 29||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 13:47:47,331][root][ERROR] - |Q. 37||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 13:47:47,331][root][ERROR] - |Q. 37||D: Criminal_law| Failed to extract chosen option: 
[2025-02-21 13:47:47,333][root][ERROR] - |Q. 34||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 13:47:47,333][root][ERROR] - |Q. 34||D: Contracts| Failed to extract chosen option: 
[2025-02-21 13:47:47,333][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 13:47:47,339][root][ERROR] - |Q. 94||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 13:47:47,339][root][ERROR] - |Q. 94||D: Property| Failed to extract chosen option: 
[2025-02-21 13:47:47,339][root][ERROR] - |Q. 18||D: Torts| Failed to extract chosen option: 
[2025-02-21 13:47:47,340][root][ERROR] - |Q. 39||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 13:47:47,342][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 13:47:47,352][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 13:47:47,352][root][INFO] - Saved parsed outputs
[2025-02-21 13:47:47,352][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 13:47:47,354][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 13:47:47,354][root][INFO] - Saved parsing metadata
[2025-02-21 13:47:47,355][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 13:47:47,357][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 13:47:47,358][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 13:47:47,376][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 13:47:47,376][root][INFO] - Summary of metrics : {'label_accuracy': 0.34, 'misclassification_rate': 0.6599999999999999, 'combined_accuracy': 0.21, 'malformed_label': 5, 'malformed_domain': 37, 'total_predictions': 100, 'correct_predictions': 34, 'correct_label_and_domain': 21, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.13, 'Contracts_confidence': 0.17, 'Criminal_Law_confidence': 0.21, 'Evidence_confidence': 0.05, 'Real_Property_confidence': 0.03, 'Torts_confidence': 0.15, 'Civil_Procedure_confidence': 0.05, 'correct_domain_wrong_label': 42, 'correct_label_wrong_domain': 13, 'both_wrong': 24}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 13:47:55,085][root][INFO] - Setting global seed to 206
[2025-02-21 13:47:55,091][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-02-21 13:47:55,092][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 13:47:55,093][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 13:47:55,094][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 13:47:55,096][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 13:47:55,096][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 13:47:55,269][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 13:47:55,547][root][INFO] - Full model selected, loading model
[2025-02-21 13:48:12,602][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 13:49:12,361][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 13:49:12,363][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 13:49:44,305][root][INFO] - Peft model loaded successfully
[2025-02-21 13:49:50,561][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 13:49:50,564][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 13:49:50,564][root][INFO] - Starting inference
[2025-02-21 13:49:50,795][root][INFO] - Processing question number 0
[2025-02-21 13:49:50,797][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 13:50:22,292][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 13:50:54,207][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 13:51:26,263][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 13:51:57,838][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 13:52:28,819][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 13:52:59,255][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 13:53:30,197][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 13:54:01,519][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 13:54:32,067][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 13:55:03,218][root][INFO] - Processing question number 10
[2025-02-21 13:55:03,224][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 13:55:33,577][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 13:56:04,493][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 13:56:35,520][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 13:57:06,031][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 13:57:37,520][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 13:58:08,603][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 13:58:39,637][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 13:59:10,549][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 13:59:42,003][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 14:00:13,548][root][INFO] - Processing question number 20
[2025-02-21 14:00:13,554][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 14:00:43,936][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 14:01:15,125][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 14:01:45,839][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 14:02:16,765][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 14:02:47,758][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 14:03:19,298][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 14:03:50,350][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 14:04:21,561][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 14:04:52,621][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 14:05:24,286][root][INFO] - Processing question number 30
[2025-02-21 14:05:24,289][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 14:05:55,392][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 14:06:26,347][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 14:06:57,308][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 14:07:28,966][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 14:08:00,043][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 14:08:31,159][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 14:09:02,210][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 14:09:33,999][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 14:10:05,223][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 14:10:36,539][root][INFO] - Processing question number 40
[2025-02-21 14:10:36,543][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 14:11:07,742][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 14:11:38,774][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 14:12:10,336][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 14:12:40,755][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 14:13:12,514][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 14:13:43,693][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 14:14:14,732][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 14:14:45,931][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 14:15:17,102][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 14:15:48,596][root][INFO] - Processing question number 50
[2025-02-21 14:15:48,604][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 14:16:20,344][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 14:16:50,963][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 14:17:22,712][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 14:17:54,113][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 14:18:24,791][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 14:18:55,768][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 14:19:27,631][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 14:19:59,257][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 14:20:30,881][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 14:21:02,324][root][INFO] - Processing question number 60
[2025-02-21 14:21:02,329][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 14:21:33,474][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 14:22:04,683][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 14:22:36,662][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 14:23:08,141][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 14:23:39,531][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 14:24:10,466][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 14:24:41,157][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 14:25:11,691][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 14:25:42,557][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 14:26:13,312][root][INFO] - Processing question number 70
[2025-02-21 14:26:13,317][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 14:26:44,855][root][INFO] - Domain : Property, Question : 9
[2025-02-21 14:27:16,239][root][INFO] - Domain : Property, Question : 17
[2025-02-21 14:27:47,828][root][INFO] - Domain : Property, Question : 25
[2025-02-21 14:28:19,901][root][INFO] - Domain : Property, Question : 30
[2025-02-21 14:28:50,842][root][INFO] - Domain : Property, Question : 36
[2025-02-21 14:29:22,336][root][INFO] - Domain : Property, Question : 46
[2025-02-21 14:29:54,735][root][INFO] - Domain : Property, Question : 53
[2025-02-21 14:30:26,190][root][INFO] - Domain : Property, Question : 59
[2025-02-21 14:30:56,640][root][INFO] - Domain : Property, Question : 66
[2025-02-21 14:31:27,487][root][INFO] - Processing question number 80
[2025-02-21 14:31:27,493][root][INFO] - Domain : Property, Question : 69
[2025-02-21 14:31:59,252][root][INFO] - Domain : Property, Question : 81
[2025-02-21 14:32:31,081][root][INFO] - Domain : Property, Question : 88
[2025-02-21 14:33:02,793][root][INFO] - Domain : Property, Question : 91
[2025-02-21 14:33:34,227][root][INFO] - Domain : Property, Question : 94
[2025-02-21 14:34:06,601][root][INFO] - Domain : Property, Question : 100
[2025-02-21 14:34:37,625][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 14:35:09,194][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 14:35:41,272][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 14:36:12,591][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 14:36:43,920][root][INFO] - Processing question number 90
[2025-02-21 14:36:43,926][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 14:37:15,264][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 14:37:46,892][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 14:38:18,350][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 14:38:49,511][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 14:39:21,375][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 14:39:53,125][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 14:40:24,590][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 14:40:55,602][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 14:41:26,156][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 14:41:57,949][root][INFO] - Inference complete
[2025-02-21 14:41:57,950][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 14:41:57,956][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 14:41:57,957][root][ERROR] - Failed to extract domain:  for response: 1
[2025-02-21 14:41:57,958][root][ERROR] - |Q. 1||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,958][root][ERROR] - |Q. 1||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,958][root][ERROR] - |Q. 1||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 14:41:57,959][root][ERROR] - Failed to extract domain:  for response: 11
[2025-02-21 14:41:57,959][root][ERROR] - |Q. 70||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,959][root][ERROR] - |Q. 70||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,959][root][ERROR] - |Q. 70||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 14:41:57,960][root][ERROR] - Failed to extract domain:  for response: 13
[2025-02-21 14:41:57,960][root][ERROR] - |Q. 86||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 14:41:57,960][root][ERROR] - |Q. 2||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 14:41:57,961][root][ERROR] - |Q. 37||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,961][root][ERROR] - |Q. 37||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,961][root][ERROR] - |Q. 37||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 14:41:57,961][root][ERROR] - Failed to extract domain:  for response: 22
[2025-02-21 14:41:57,961][root][ERROR] - |Q. 55||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,961][root][ERROR] - |Q. 55||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,961][root][ERROR] - |Q. 55||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 14:41:57,961][root][ERROR] - Failed to extract domain:  for response: 23
[2025-02-21 14:41:57,961][root][ERROR] - |Q. 64||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,961][root][ERROR] - |Q. 64||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,961][root][ERROR] - |Q. 64||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 14:41:57,962][root][ERROR] - Failed to extract domain:  for response: 30
[2025-02-21 14:41:57,962][root][ERROR] - |Q. 7||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,962][root][ERROR] - |Q. 7||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,962][root][ERROR] - |Q. 7||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 14:41:57,962][root][ERROR] - Failed to extract domain:  for response: 31
[2025-02-21 14:41:57,962][root][ERROR] - |Q. 14||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,962][root][ERROR] - |Q. 14||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,962][root][ERROR] - |Q. 14||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 14:41:57,963][root][ERROR] - Failed to extract domain:  for response: 35
[2025-02-21 14:41:57,963][root][ERROR] - |Q. 42||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,963][root][ERROR] - |Q. 42||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,963][root][ERROR] - |Q. 42||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 14:41:57,963][root][ERROR] - Failed to extract domain:  for response: 39
[2025-02-21 14:41:57,963][root][ERROR] - |Q. 72||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,963][root][ERROR] - |Q. 72||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,964][root][ERROR] - |Q. 72||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 14:41:57,964][root][ERROR] - |Q. 72||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 14:41:57,964][root][ERROR] - |Q. 72||D: Contracts| Failed to extract chosen option: 
[2025-02-21 14:41:57,964][root][ERROR] - Failed to extract domain:  for response: 42
[2025-02-21 14:41:57,964][root][ERROR] - |Q. 87||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 14:41:57,964][root][ERROR] - |Q. 10||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,964][root][ERROR] - |Q. 10||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,964][root][ERROR] - |Q. 10||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 14:41:57,965][root][ERROR] - Failed to extract domain:  for response: 50
[2025-02-21 14:41:57,965][root][ERROR] - |Q. 43||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,965][root][ERROR] - |Q. 43||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,965][root][ERROR] - |Q. 43||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 14:41:57,965][root][ERROR] - |Q. 50||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,965][root][ERROR] - |Q. 50||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 14:41:57,966][root][ERROR] - Failed to extract domain:  for response: 59
[2025-02-21 14:41:57,966][root][ERROR] - |Q. 5||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,966][root][ERROR] - |Q. 5||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,966][root][ERROR] - |Q. 5||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 14:41:57,967][root][ERROR] - Failed to extract domain:  for response: 62
[2025-02-21 14:41:57,967][root][ERROR] - |Q. 26||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,967][root][ERROR] - |Q. 26||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,967][root][ERROR] - |Q. 26||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 14:41:57,967][root][ERROR] - Failed to extract domain:  for response: 69
[2025-02-21 14:41:57,968][root][ERROR] - |Q. 75||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,968][root][ERROR] - |Q. 75||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,968][root][ERROR] - |Q. 75||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 14:41:57,968][root][ERROR] - |Q. 9||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 14:41:57,968][root][ERROR] - Failed to extract domain:  for response: 73
[2025-02-21 14:41:57,968][root][ERROR] - |Q. 17||D: Property| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,968][root][ERROR] - |Q. 17||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,968][root][ERROR] - |Q. 17||D: Property| Failed to extract Rule_application: 
[2025-02-21 14:41:57,968][root][ERROR] - Failed to extract domain:  for response: 74
[2025-02-21 14:41:57,968][root][ERROR] - |Q. 25||D: Property| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,968][root][ERROR] - |Q. 25||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,969][root][ERROR] - |Q. 25||D: Property| Failed to extract Rule_application: 
[2025-02-21 14:41:57,969][root][ERROR] - Failed to extract domain:  for response: 79
[2025-02-21 14:41:57,969][root][ERROR] - |Q. 59||D: Property| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,969][root][ERROR] - |Q. 59||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,969][root][ERROR] - |Q. 59||D: Property| Failed to extract Rule_application: 
[2025-02-21 14:41:57,969][root][ERROR] - |Q. 59||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 14:41:57,969][root][ERROR] - |Q. 59||D: Property| Failed to extract chosen option: 
[2025-02-21 14:41:57,969][root][ERROR] - |Q. 66||D: Property| Failed to extract Rule_application: 
[2025-02-21 14:41:57,970][root][ERROR] - Failed to extract domain:  for response: 90
[2025-02-21 14:41:57,970][root][ERROR] - |Q. 32||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,970][root][ERROR] - |Q. 32||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,971][root][ERROR] - |Q. 32||D: Torts| Failed to extract Rule_application: 
[2025-02-21 14:41:57,971][root][ERROR] - Failed to extract domain:  for response: 91
[2025-02-21 14:41:57,971][root][ERROR] - |Q. 39||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,971][root][ERROR] - |Q. 39||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,971][root][ERROR] - |Q. 39||D: Torts| Failed to extract Rule_application: 
[2025-02-21 14:41:57,971][root][ERROR] - Failed to extract domain:  for response: 92
[2025-02-21 14:41:57,971][root][ERROR] - |Q. 45||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,971][root][ERROR] - |Q. 45||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,971][root][ERROR] - |Q. 45||D: Torts| Failed to extract Rule_application: 
[2025-02-21 14:41:57,972][root][ERROR] - Failed to extract domain:  for response: 96
[2025-02-21 14:41:57,972][root][ERROR] - |Q. 67||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 14:41:57,972][root][ERROR] - |Q. 67||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 14:41:57,972][root][ERROR] - |Q. 67||D: Torts| Failed to extract Rule_application: 
[2025-02-21 14:41:57,973][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 14:41:57,979][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 14:41:57,979][root][INFO] - Saved parsed outputs
[2025-02-21 14:41:57,979][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 14:41:57,981][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 14:41:57,981][root][INFO] - Saved parsing metadata
[2025-02-21 14:41:57,982][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 14:41:57,983][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 14:41:58,013][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 14:41:58,047][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 14:41:58,047][root][INFO] - Summary of metrics : {'label_accuracy': 0.16, 'misclassification_rate': 0.84, 'combined_accuracy': 0.09, 'malformed_label': 27, 'malformed_domain': 59, 'total_predictions': 100, 'correct_predictions': 16, 'correct_label_and_domain': 9, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.13333333333333333, 'Criminal_Law_accuracy': 0.07142857142857142, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.0, 'Torts_accuracy': 0.0, 'Civil_Procedure_accuracy': 0.0, 'Constitutional_Law_confidence': 0.06, 'Contracts_confidence': 0.07, 'Criminal_Law_confidence': 0.22, 'Evidence_confidence': 0.04, 'Real_Property_confidence': 0.01, 'Torts_confidence': 0.1, 'Civil_Procedure_confidence': 0.07, 'correct_domain_wrong_label': 32, 'correct_label_wrong_domain': 7, 'both_wrong': 52}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 14:42:05,671][root][INFO] - Setting global seed to 206
[2025-02-21 14:42:05,678][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-02-21 14:42:05,678][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 14:42:05,679][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 14:42:05,680][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 14:42:05,683][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 14:42:05,683][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 14:42:05,846][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 14:42:06,102][root][INFO] - Full model selected, loading model
[2025-02-21 14:42:23,877][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 14:42:23,877][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 14:42:30,311][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 14:42:30,313][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 14:42:30,313][root][INFO] - Starting inference
[2025-02-21 14:42:30,448][root][INFO] - Processing question number 0
[2025-02-21 14:42:30,450][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 14:43:01,759][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 14:43:33,552][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 14:44:05,488][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 14:44:36,940][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 14:45:07,785][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 14:45:38,048][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 14:46:08,863][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 14:46:39,925][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 14:47:10,311][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 14:47:41,285][root][INFO] - Processing question number 10
[2025-02-21 14:47:41,287][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 14:48:11,527][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 14:48:42,282][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 14:49:13,189][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 14:49:43,590][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 14:50:14,968][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 14:50:45,932][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 14:51:16,834][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 14:51:47,581][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 14:52:18,953][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 14:52:50,390][root][INFO] - Processing question number 20
[2025-02-21 14:52:50,393][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 14:53:20,615][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 14:53:51,688][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 14:54:22,282][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 14:54:53,085][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 14:55:24,065][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 14:55:55,650][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 14:56:26,696][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 14:56:57,957][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 14:57:29,007][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 14:58:00,643][root][INFO] - Processing question number 30
[2025-02-21 14:58:00,646][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 14:58:31,624][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 14:59:02,452][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 14:59:33,183][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 15:00:04,693][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 15:00:35,594][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 15:01:06,566][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 15:01:37,494][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 15:02:09,110][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 15:02:40,412][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 15:03:11,646][root][INFO] - Processing question number 40
[2025-02-21 15:03:11,650][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 15:03:42,854][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 15:04:13,865][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 15:04:45,298][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 15:05:15,564][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 15:05:47,194][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 15:06:18,324][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 15:06:49,298][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 15:07:20,423][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 15:07:51,442][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 15:08:22,857][root][INFO] - Processing question number 50
[2025-02-21 15:08:22,861][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 15:08:54,497][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 15:09:25,035][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 15:09:56,658][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 15:10:27,859][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 15:10:58,432][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 15:11:29,294][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 15:12:01,044][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 15:12:32,565][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 15:13:04,267][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 15:13:35,593][root][INFO] - Processing question number 60
[2025-02-21 15:13:35,598][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 15:14:06,651][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 15:14:37,768][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 15:15:09,592][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 15:15:40,952][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 15:16:12,140][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 15:16:42,851][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 15:17:13,400][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 15:17:43,949][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 15:18:14,640][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 15:18:45,257][root][INFO] - Processing question number 70
[2025-02-21 15:18:45,262][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 15:19:16,554][root][INFO] - Domain : Property, Question : 9
[2025-02-21 15:19:47,655][root][INFO] - Domain : Property, Question : 17
[2025-02-21 15:20:19,024][root][INFO] - Domain : Property, Question : 25
[2025-02-21 15:20:50,836][root][INFO] - Domain : Property, Question : 30
[2025-02-21 15:21:21,441][root][INFO] - Domain : Property, Question : 36
[2025-02-21 15:21:52,760][root][INFO] - Domain : Property, Question : 46
[2025-02-21 15:22:25,166][root][INFO] - Domain : Property, Question : 53
[2025-02-21 15:22:56,512][root][INFO] - Domain : Property, Question : 59
[2025-02-21 15:23:26,776][root][INFO] - Domain : Property, Question : 66
[2025-02-21 15:23:57,442][root][INFO] - Processing question number 80
[2025-02-21 15:23:57,447][root][INFO] - Domain : Property, Question : 69
[2025-02-21 15:24:29,054][root][INFO] - Domain : Property, Question : 81
[2025-02-21 15:25:00,688][root][INFO] - Domain : Property, Question : 88
[2025-02-21 15:25:32,247][root][INFO] - Domain : Property, Question : 91
[2025-02-21 15:26:03,556][root][INFO] - Domain : Property, Question : 94
[2025-02-21 15:26:35,783][root][INFO] - Domain : Property, Question : 100
[2025-02-21 15:27:06,648][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 15:27:38,092][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 15:28:10,035][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 15:28:41,136][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 15:29:12,254][root][INFO] - Processing question number 90
[2025-02-21 15:29:12,260][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 15:29:43,429][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 15:30:14,959][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 15:30:46,298][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 15:31:17,357][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 15:31:49,098][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 15:32:20,705][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 15:32:52,047][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 15:33:22,931][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 15:33:53,369][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 15:34:24,999][root][INFO] - Inference complete
[2025-02-21 15:34:25,000][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 15:34:25,007][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 15:34:25,008][root][ERROR] - |Q. 6||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,008][root][ERROR] - |Q. 6||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,008][root][ERROR] - |Q. 6||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 15:34:25,008][root][ERROR] - |Q. 13||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,008][root][ERROR] - |Q. 13||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,008][root][ERROR] - |Q. 13||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 15:34:25,009][root][ERROR] - |Q. 27||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,009][root][ERROR] - |Q. 27||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,009][root][ERROR] - |Q. 27||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 15:34:25,009][root][ERROR] - |Q. 56||D: Constitutional_law| Failed to extract Legal_conclusion: 
[2025-02-21 15:34:25,011][root][ERROR] - |Q. 83||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,012][root][ERROR] - |Q. 83||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,012][root][ERROR] - |Q. 83||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 15:34:25,012][root][ERROR] - |Q. 24||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,012][root][ERROR] - |Q. 24||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,012][root][ERROR] - |Q. 24||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 15:34:25,013][root][ERROR] - |Q. 48||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 15:34:25,015][root][ERROR] - |Q. 80||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,015][root][ERROR] - |Q. 80||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,015][root][ERROR] - |Q. 80||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 15:34:25,016][root][ERROR] - |Q. 26||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,016][root][ERROR] - |Q. 26||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,016][root][ERROR] - |Q. 26||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 15:34:25,017][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,017][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,017][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 15:34:25,017][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,017][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,018][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 15:34:25,018][root][ERROR] - |Q. 9||D: Property| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,018][root][ERROR] - |Q. 9||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,018][root][ERROR] - |Q. 9||D: Property| Failed to extract Rule_application: 
[2025-02-21 15:34:25,018][root][ERROR] - |Q. 30||D: Property| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,018][root][ERROR] - |Q. 30||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,018][root][ERROR] - |Q. 30||D: Property| Failed to extract Rule_application: 
[2025-02-21 15:34:25,019][root][ERROR] - |Q. 53||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 15:34:25,019][root][ERROR] - |Q. 53||D: Property| Failed to extract chosen option: 
[2025-02-21 15:34:25,019][root][ERROR] - |Q. 81||D: Property| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,019][root][ERROR] - |Q. 81||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,019][root][ERROR] - |Q. 81||D: Property| Failed to extract Rule_application: 
[2025-02-21 15:34:25,020][root][ERROR] - |Q. 91||D: Property| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,020][root][ERROR] - |Q. 91||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,020][root][ERROR] - |Q. 91||D: Property| Failed to extract Rule_application: 
[2025-02-21 15:34:25,020][root][ERROR] - |Q. 100||D: Property| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,020][root][ERROR] - |Q. 100||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,020][root][ERROR] - |Q. 100||D: Property| Failed to extract Rule_application: 
[2025-02-21 15:34:25,020][root][ERROR] - |Q. 11||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,020][root][ERROR] - |Q. 11||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 15:34:25,020][root][ERROR] - |Q. 11||D: Torts| Failed to extract Rule_application: 
[2025-02-21 15:34:25,021][root][ERROR] - |Q. 32||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 15:34:25,021][root][ERROR] - |Q. 57||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 15:34:25,023][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 15:34:25,030][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 15:34:25,030][root][INFO] - Saved parsed outputs
[2025-02-21 15:34:25,030][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 15:34:25,032][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 15:34:25,032][root][INFO] - Saved parsing metadata
[2025-02-21 15:34:25,033][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 15:34:25,034][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 15:34:25,037][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_206/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 15:34:25,044][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 15:34:25,044][root][INFO] - Summary of metrics : {'label_accuracy': 0.25, 'misclassification_rate': 0.75, 'combined_accuracy': 0.13, 'malformed_label': 1, 'malformed_domain': 42, 'total_predictions': 100, 'correct_predictions': 25, 'correct_label_and_domain': 13, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.13333333333333333, 'Criminal_Law_accuracy': 0.07142857142857142, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.0, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.13, 'Criminal_Law_confidence': 0.2, 'Evidence_confidence': 0.04, 'Real_Property_confidence': 0.03, 'Torts_confidence': 0.14, 'Civil_Procedure_confidence': 0.04, 'correct_domain_wrong_label': 45, 'correct_label_wrong_domain': 12, 'both_wrong': 30}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_206 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 15:34:31,133][root][INFO] - Setting global seed to 989
[2025-02-21 15:34:31,139][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-02-21 15:34:31,139][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 15:34:31,140][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 15:34:31,141][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 15:34:31,143][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 15:34:31,143][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 15:34:31,292][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 15:34:31,549][root][INFO] - Full model selected, loading model
[2025-02-21 15:34:49,132][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 15:35:51,777][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 15:35:51,777][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 15:36:22,502][root][INFO] - Peft model loaded successfully
[2025-02-21 15:36:26,937][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 15:36:26,940][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 15:36:26,940][root][INFO] - Starting inference
[2025-02-21 15:36:27,093][root][INFO] - Processing question number 0
[2025-02-21 15:36:27,105][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 15:36:58,267][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 15:37:29,979][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 15:38:01,845][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 15:38:33,220][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 15:39:03,984][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 15:39:34,208][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 15:40:04,958][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 15:40:35,934][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 15:41:06,247][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 15:41:37,152][root][INFO] - Processing question number 10
[2025-02-21 15:41:37,154][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 15:42:07,261][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 15:42:37,987][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 15:43:08,825][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 15:43:39,151][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 15:44:10,462][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 15:44:41,348][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 15:45:12,188][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 15:45:42,908][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 15:46:14,182][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 15:46:45,541][root][INFO] - Processing question number 20
[2025-02-21 15:46:45,546][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 15:47:15,726][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 15:47:46,721][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 15:48:17,246][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 15:48:47,984][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 15:49:18,790][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 15:49:50,134][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 15:50:20,996][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 15:50:52,001][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 15:51:22,857][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 15:51:54,319][root][INFO] - Processing question number 30
[2025-02-21 15:51:54,322][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 15:52:25,228][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 15:52:55,984][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 15:53:26,703][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 15:53:58,137][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 15:54:28,974][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 15:54:59,875][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 15:55:30,741][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 15:56:02,289][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 15:56:33,310][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 15:57:04,434][root][INFO] - Processing question number 40
[2025-02-21 15:57:04,437][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 15:57:35,440][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 15:58:06,274][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 15:58:37,632][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 15:59:07,868][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 15:59:39,441][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 16:00:10,429][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 16:00:41,284][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 16:01:12,289][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 16:01:43,206][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 16:02:14,509][root][INFO] - Processing question number 50
[2025-02-21 16:02:14,513][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 16:02:46,068][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 16:03:16,518][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 16:03:48,079][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 16:04:19,289][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 16:04:49,785][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 16:05:20,578][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 16:05:52,259][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 16:06:23,690][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 16:06:55,117][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 16:07:26,368][root][INFO] - Processing question number 60
[2025-02-21 16:07:26,373][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 16:07:57,333][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 16:08:28,358][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 16:09:00,101][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 16:09:31,404][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 16:10:02,610][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 16:10:33,302][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 16:11:03,768][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 16:11:34,121][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 16:12:04,800][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 16:12:35,358][root][INFO] - Processing question number 70
[2025-02-21 16:12:35,366][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 16:13:06,669][root][INFO] - Domain : Property, Question : 9
[2025-02-21 16:13:37,787][root][INFO] - Domain : Property, Question : 17
[2025-02-21 16:14:09,146][root][INFO] - Domain : Property, Question : 25
[2025-02-21 16:14:40,945][root][INFO] - Domain : Property, Question : 30
[2025-02-21 16:15:11,493][root][INFO] - Domain : Property, Question : 36
[2025-02-21 16:15:42,834][root][INFO] - Domain : Property, Question : 46
[2025-02-21 16:16:15,121][root][INFO] - Domain : Property, Question : 53
[2025-02-21 16:16:46,470][root][INFO] - Domain : Property, Question : 59
[2025-02-21 16:17:16,821][root][INFO] - Domain : Property, Question : 66
[2025-02-21 16:17:47,482][root][INFO] - Processing question number 80
[2025-02-21 16:17:47,488][root][INFO] - Domain : Property, Question : 69
[2025-02-21 16:18:19,046][root][INFO] - Domain : Property, Question : 81
[2025-02-21 16:18:50,671][root][INFO] - Domain : Property, Question : 88
[2025-02-21 16:19:22,248][root][INFO] - Domain : Property, Question : 91
[2025-02-21 16:19:53,489][root][INFO] - Domain : Property, Question : 94
[2025-02-21 16:20:25,715][root][INFO] - Domain : Property, Question : 100
[2025-02-21 16:20:56,601][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 16:21:28,023][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 16:21:59,915][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 16:22:31,044][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 16:23:02,193][root][INFO] - Processing question number 90
[2025-02-21 16:23:02,201][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 16:23:33,356][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 16:24:04,806][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 16:24:36,075][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 16:25:07,041][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 16:25:38,736][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 16:26:10,355][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 16:26:41,720][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 16:27:12,614][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 16:27:43,054][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 16:28:14,810][root][INFO] - Inference complete
[2025-02-21 16:28:14,810][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 16:28:14,817][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 16:28:14,826][root][ERROR] - |Q. 9||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 16:28:14,827][root][ERROR] - Failed to extract domain:  for response: 80
[2025-02-21 16:28:14,827][root][ERROR] - |Q. 66||D: Property| Failed to extract Legal_concept: 
[2025-02-21 16:28:14,827][root][ERROR] - |Q. 66||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 16:28:14,827][root][ERROR] - |Q. 66||D: Property| Failed to extract Rule_application: 
[2025-02-21 16:28:14,829][root][ERROR] - |Q. 67||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 16:28:14,829][root][ERROR] - |Q. 67||D: Torts| Failed to extract chosen option: 
[2025-02-21 16:28:14,830][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 16:28:14,837][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 16:28:14,837][root][INFO] - Saved parsed outputs
[2025-02-21 16:28:14,837][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 16:28:14,839][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 16:28:14,839][root][INFO] - Saved parsing metadata
[2025-02-21 16:28:14,840][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 16:28:14,841][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 16:28:14,843][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 16:28:14,868][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 16:28:14,868][root][INFO] - Summary of metrics : {'label_accuracy': 0.32, 'misclassification_rate': 0.6799999999999999, 'combined_accuracy': 0.22, 'malformed_label': 2, 'malformed_domain': 37, 'total_predictions': 100, 'correct_predictions': 32, 'correct_label_and_domain': 22, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.12, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.22, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.02, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.07, 'correct_domain_wrong_label': 41, 'correct_label_wrong_domain': 10, 'both_wrong': 27}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 16:28:22,048][root][INFO] - Setting global seed to 989
[2025-02-21 16:28:22,055][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-02-21 16:28:22,056][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 16:28:22,057][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 16:28:22,059][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 16:28:22,061][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 16:28:22,061][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 16:28:22,210][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 16:28:22,467][root][INFO] - Full model selected, loading model
[2025-02-21 16:28:38,510][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 16:28:38,510][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 16:28:45,296][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 16:28:45,297][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 16:28:45,297][root][INFO] - Starting inference
[2025-02-21 16:28:45,427][root][INFO] - Processing question number 0
[2025-02-21 16:28:45,429][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 16:29:16,711][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 16:29:48,433][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 16:30:20,361][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 16:30:51,651][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 16:31:22,306][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 16:31:52,380][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 16:32:23,002][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 16:32:53,879][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 16:33:24,071][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 16:33:54,860][root][INFO] - Processing question number 10
[2025-02-21 16:33:54,862][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 16:34:24,848][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 16:34:55,408][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 16:35:26,126][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 16:35:56,345][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 16:36:27,537][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 16:36:58,315][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 16:37:29,031][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 16:37:59,584][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 16:38:30,742][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 16:39:02,000][root][INFO] - Processing question number 20
[2025-02-21 16:39:02,002][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 16:39:32,027][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 16:40:02,913][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 16:40:33,311][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 16:41:03,927][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 16:41:34,602][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 16:42:05,839][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 16:42:36,573][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 16:43:07,472][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 16:43:38,195][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 16:44:09,542][root][INFO] - Processing question number 30
[2025-02-21 16:44:09,545][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 16:44:40,321][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 16:45:10,949][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 16:45:41,607][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 16:46:13,067][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 16:46:43,821][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 16:47:14,656][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 16:47:45,443][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 16:48:16,888][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 16:48:47,809][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 16:49:18,743][root][INFO] - Processing question number 40
[2025-02-21 16:49:18,747][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 16:49:49,676][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 16:50:20,523][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 16:50:51,764][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 16:51:21,836][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 16:51:53,274][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 16:52:24,164][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 16:52:54,891][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 16:53:25,794][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 16:53:56,597][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 16:54:27,804][root][INFO] - Processing question number 50
[2025-02-21 16:54:27,808][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 16:54:59,233][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 16:55:29,604][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 16:56:01,038][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 16:56:32,068][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 16:57:02,446][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 16:57:33,117][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 16:58:04,683][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 16:58:36,004][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 16:59:07,320][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 16:59:38,461][root][INFO] - Processing question number 60
[2025-02-21 16:59:38,466][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 17:00:09,298][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 17:00:40,201][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 17:01:11,809][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 17:01:42,994][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 17:02:13,999][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 17:02:44,512][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 17:03:14,859][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 17:03:45,093][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 17:04:15,587][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 17:04:46,040][root][INFO] - Processing question number 70
[2025-02-21 17:04:46,045][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 17:05:17,178][root][INFO] - Domain : Property, Question : 9
[2025-02-21 17:05:48,114][root][INFO] - Domain : Property, Question : 17
[2025-02-21 17:06:19,329][root][INFO] - Domain : Property, Question : 25
[2025-02-21 17:06:50,988][root][INFO] - Domain : Property, Question : 30
[2025-02-21 17:07:21,432][root][INFO] - Domain : Property, Question : 36
[2025-02-21 17:07:52,620][root][INFO] - Domain : Property, Question : 46
[2025-02-21 17:08:24,722][root][INFO] - Domain : Property, Question : 53
[2025-02-21 17:08:55,878][root][INFO] - Domain : Property, Question : 59
[2025-02-21 17:09:25,951][root][INFO] - Domain : Property, Question : 66
[2025-02-21 17:09:56,430][root][INFO] - Processing question number 80
[2025-02-21 17:09:56,435][root][INFO] - Domain : Property, Question : 69
[2025-02-21 17:10:27,854][root][INFO] - Domain : Property, Question : 81
[2025-02-21 17:10:59,321][root][INFO] - Domain : Property, Question : 88
[2025-02-21 17:11:30,701][root][INFO] - Domain : Property, Question : 91
[2025-02-21 17:12:01,839][root][INFO] - Domain : Property, Question : 94
[2025-02-21 17:12:33,886][root][INFO] - Domain : Property, Question : 100
[2025-02-21 17:13:04,565][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 17:13:35,825][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 17:14:07,593][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 17:14:38,612][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 17:15:09,696][root][INFO] - Processing question number 90
[2025-02-21 17:15:09,702][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 17:15:40,743][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 17:16:12,209][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 17:16:43,495][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 17:17:14,448][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 17:17:46,002][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 17:18:17,432][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 17:18:48,629][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 17:19:19,333][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 17:19:49,581][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 17:20:21,031][root][INFO] - Inference complete
[2025-02-21 17:20:21,031][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 17:20:21,038][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 17:20:21,041][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 17:20:21,047][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 17:20:21,047][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 17:20:21,047][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 17:20:21,047][root][ERROR] - |Q. 61||D: Civil_procedure| Failed to extract chosen option: 
[2025-02-21 17:20:21,048][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Legal_conclusion: 
[2025-02-21 17:20:21,048][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract chosen option: 
[2025-02-21 17:20:21,052][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 17:20:21,058][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 17:20:21,058][root][INFO] - Saved parsed outputs
[2025-02-21 17:20:21,058][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 17:20:21,059][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 17:20:21,059][root][INFO] - Saved parsing metadata
[2025-02-21 17:20:21,060][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 17:20:21,061][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 17:20:21,062][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/greedy/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 17:20:21,089][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 17:20:21,089][root][INFO] - Summary of metrics : {'label_accuracy': 0.36, 'misclassification_rate': 0.64, 'combined_accuracy': 0.25, 'malformed_label': 2, 'malformed_domain': 33, 'total_predictions': 100, 'correct_predictions': 36, 'correct_label_and_domain': 25, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.12, 'Contracts_confidence': 0.22, 'Criminal_Law_confidence': 0.22, 'Evidence_confidence': 0.05, 'Real_Property_confidence': 0.03, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.07, 'correct_domain_wrong_label': 42, 'correct_label_wrong_domain': 11, 'both_wrong': 22}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 17:20:27,920][root][INFO] - Setting global seed to 989
[2025-02-21 17:20:27,927][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-02-21 17:20:27,927][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 17:20:27,928][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 17:20:27,929][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 17:20:27,932][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 17:20:27,932][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 17:20:28,233][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 17:20:28,490][root][INFO] - Full model selected, loading model
[2025-02-21 17:20:41,976][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 17:21:43,581][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 17:21:43,581][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 17:22:10,262][root][INFO] - Peft model loaded successfully
[2025-02-21 17:22:16,447][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 17:22:16,448][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 17:22:16,448][root][INFO] - Starting inference
[2025-02-21 17:22:16,597][root][INFO] - Processing question number 0
[2025-02-21 17:22:16,599][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 17:22:48,031][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 17:23:19,932][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 17:23:51,979][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 17:24:23,533][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 17:24:54,506][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 17:25:24,922][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 17:25:55,858][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 17:26:27,023][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 17:26:57,521][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 17:27:28,640][root][INFO] - Processing question number 10
[2025-02-21 17:27:28,642][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 17:27:58,941][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 17:28:29,844][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 17:29:00,864][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 17:29:31,367][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 17:30:02,856][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 17:30:33,934][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 17:31:04,947][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 17:31:35,853][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 17:32:07,328][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 17:32:39,033][root][INFO] - Processing question number 20
[2025-02-21 17:32:39,036][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 17:33:09,426][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 17:33:40,619][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 17:34:11,336][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 17:34:42,266][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 17:35:13,246][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 17:35:44,771][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 17:36:15,822][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 17:36:47,072][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 17:37:18,204][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 17:37:49,865][root][INFO] - Processing question number 30
[2025-02-21 17:37:49,868][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 17:38:20,957][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 17:38:51,899][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 17:39:22,806][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 17:39:54,435][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 17:40:25,452][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 17:40:56,546][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 17:41:27,589][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 17:41:59,320][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 17:42:30,525][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 17:43:01,839][root][INFO] - Processing question number 40
[2025-02-21 17:43:01,843][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 17:43:33,024][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 17:44:04,049][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 17:44:35,619][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 17:45:06,059][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 17:45:37,830][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 17:46:09,032][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 17:46:40,106][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 17:47:11,294][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 17:47:42,382][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 17:48:13,861][root][INFO] - Processing question number 50
[2025-02-21 17:48:13,865][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 17:48:45,588][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 17:49:16,192][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 17:49:47,928][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 17:50:19,299][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 17:50:49,954][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 17:51:20,909][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 17:51:52,765][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 17:52:24,372][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 17:52:55,984][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 17:53:27,404][root][INFO] - Processing question number 60
[2025-02-21 17:53:27,409][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 17:53:58,576][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 17:54:29,768][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 17:55:01,681][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 17:55:33,166][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 17:56:04,571][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 17:56:35,465][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 17:57:06,133][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 17:57:36,668][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 17:58:07,516][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 17:58:38,249][root][INFO] - Processing question number 70
[2025-02-21 17:58:38,254][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 17:59:09,648][root][INFO] - Domain : Property, Question : 9
[2025-02-21 17:59:40,945][root][INFO] - Domain : Property, Question : 17
[2025-02-21 18:00:12,426][root][INFO] - Domain : Property, Question : 25
[2025-02-21 18:00:44,407][root][INFO] - Domain : Property, Question : 30
[2025-02-21 18:01:15,285][root][INFO] - Domain : Property, Question : 36
[2025-02-21 18:01:46,859][root][INFO] - Domain : Property, Question : 46
[2025-02-21 18:02:19,386][root][INFO] - Domain : Property, Question : 53
[2025-02-21 18:02:50,948][root][INFO] - Domain : Property, Question : 59
[2025-02-21 18:03:21,549][root][INFO] - Domain : Property, Question : 66
[2025-02-21 18:03:52,396][root][INFO] - Processing question number 80
[2025-02-21 18:03:52,402][root][INFO] - Domain : Property, Question : 69
[2025-02-21 18:04:24,144][root][INFO] - Domain : Property, Question : 81
[2025-02-21 18:04:55,937][root][INFO] - Domain : Property, Question : 88
[2025-02-21 18:05:27,686][root][INFO] - Domain : Property, Question : 91
[2025-02-21 18:05:59,121][root][INFO] - Domain : Property, Question : 94
[2025-02-21 18:06:31,483][root][INFO] - Domain : Property, Question : 100
[2025-02-21 18:07:02,518][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 18:07:34,086][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 18:08:06,166][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 18:08:37,482][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 18:09:08,812][root][INFO] - Processing question number 90
[2025-02-21 18:09:08,818][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 18:09:40,150][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 18:10:11,786][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 18:10:43,246][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 18:11:14,412][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 18:11:46,279][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 18:12:18,033][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 18:12:49,499][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 18:13:20,507][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 18:13:51,057][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 18:14:22,838][root][INFO] - Inference complete
[2025-02-21 18:14:22,838][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 18:14:22,845][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 18:14:22,847][root][ERROR] - Failed to extract domain:  for response: 12
[2025-02-21 18:14:22,847][root][ERROR] - |Q. 78||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 18:14:22,848][root][ERROR] - |Q. 78||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 18:14:22,848][root][ERROR] - |Q. 78||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 18:14:22,848][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 18:14:22,849][root][ERROR] - Failed to extract domain:  for response: 27
[2025-02-21 18:14:22,849][root][ERROR] - |Q. 89||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 18:14:22,849][root][ERROR] - |Q. 89||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 18:14:22,849][root][ERROR] - |Q. 89||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 18:14:22,851][root][ERROR] - Failed to extract domain:  for response: 42
[2025-02-21 18:14:22,851][root][ERROR] - |Q. 87||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 18:14:22,851][root][ERROR] - |Q. 87||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 18:14:22,851][root][ERROR] - |Q. 87||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 18:14:22,852][root][ERROR] - Failed to extract domain:  for response: 55
[2025-02-21 18:14:22,852][root][ERROR] - |Q. 80||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 18:14:22,852][root][ERROR] - |Q. 80||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 18:14:22,852][root][ERROR] - |Q. 80||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 18:14:22,854][root][ERROR] - |Q. 9||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 18:14:22,857][root][ERROR] - Failed to extract domain:  for response: 100
[2025-02-21 18:14:22,857][root][ERROR] - |Q. 95||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 18:14:22,857][root][ERROR] - |Q. 95||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 18:14:22,857][root][ERROR] - |Q. 95||D: Torts| Failed to extract Rule_application: 
[2025-02-21 18:14:22,858][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 18:14:22,864][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 18:14:22,864][root][INFO] - Saved parsed outputs
[2025-02-21 18:14:22,864][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 18:14:22,865][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 18:14:22,865][root][INFO] - Saved parsing metadata
[2025-02-21 18:14:22,866][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 18:14:22,867][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 18:14:22,869][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 18:14:22,882][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 18:14:22,882][root][INFO] - Summary of metrics : {'label_accuracy': 0.27, 'misclassification_rate': 0.73, 'combined_accuracy': 0.16, 'malformed_label': 7, 'malformed_domain': 43, 'total_predictions': 100, 'correct_predictions': 27, 'correct_label_and_domain': 16, 'Constitutional_Law_accuracy': 0.21428571428571427, 'Contracts_accuracy': 0.4666666666666667, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.0, 'Torts_accuracy': 0.07142857142857142, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.08, 'Contracts_confidence': 0.17, 'Criminal_Law_confidence': 0.23, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.05, 'Torts_confidence': 0.12, 'Civil_Procedure_confidence': 0.05, 'correct_domain_wrong_label': 41, 'correct_label_wrong_domain': 11, 'both_wrong': 32}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 18:14:29,450][root][INFO] - Setting global seed to 989
[2025-02-21 18:14:29,455][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-02-21 18:14:29,455][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 18:14:29,456][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 18:14:29,457][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 18:14:29,459][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 18:14:29,459][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 18:14:29,634][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 18:14:29,955][root][INFO] - Full model selected, loading model
[2025-02-21 18:14:47,695][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 18:14:47,695][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 18:14:54,119][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 18:14:54,120][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 18:14:54,120][root][INFO] - Starting inference
[2025-02-21 18:14:54,279][root][INFO] - Processing question number 0
[2025-02-21 18:14:54,281][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 18:15:25,676][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 18:15:57,482][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 18:16:29,424][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 18:17:00,899][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 18:17:31,769][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 18:18:02,053][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 18:18:32,917][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 18:19:04,056][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 18:19:34,507][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 18:20:05,547][root][INFO] - Processing question number 10
[2025-02-21 18:20:05,549][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 18:20:35,767][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 18:21:06,558][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 18:21:37,487][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 18:22:07,913][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 18:22:39,315][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 18:23:10,381][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 18:23:41,422][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 18:24:12,269][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 18:24:43,659][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 18:25:15,143][root][INFO] - Processing question number 20
[2025-02-21 18:25:15,145][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 18:25:45,418][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 18:26:16,554][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 18:26:47,180][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 18:27:18,014][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 18:27:48,916][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 18:28:20,370][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 18:28:51,318][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 18:29:22,439][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 18:29:53,387][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 18:30:24,955][root][INFO] - Processing question number 30
[2025-02-21 18:30:24,958][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 18:30:55,956][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 18:31:26,812][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 18:31:57,569][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 18:32:29,101][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 18:33:00,023][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 18:33:31,020][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 18:34:01,963][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 18:34:33,583][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 18:35:04,694][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 18:35:35,829][root][INFO] - Processing question number 40
[2025-02-21 18:35:35,832][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 18:36:06,930][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 18:36:37,935][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 18:37:09,365][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 18:37:39,633][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 18:38:11,263][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 18:38:42,349][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 18:39:13,276][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 18:39:44,378][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 18:40:15,371][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 18:40:46,793][root][INFO] - Processing question number 50
[2025-02-21 18:40:46,797][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 18:41:18,408][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 18:41:48,931][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 18:42:20,548][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 18:42:51,756][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 18:43:22,330][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 18:43:53,197][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 18:44:24,950][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 18:44:56,466][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 18:45:27,977][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 18:45:59,343][root][INFO] - Processing question number 60
[2025-02-21 18:45:59,348][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 18:46:30,406][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 18:47:01,514][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 18:47:33,321][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 18:48:04,826][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 18:48:36,167][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 18:49:07,004][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 18:49:37,653][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 18:50:08,235][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 18:50:38,968][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 18:51:09,609][root][INFO] - Processing question number 70
[2025-02-21 18:51:09,614][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 18:51:40,910][root][INFO] - Domain : Property, Question : 9
[2025-02-21 18:52:12,028][root][INFO] - Domain : Property, Question : 17
[2025-02-21 18:52:43,416][root][INFO] - Domain : Property, Question : 25
[2025-02-21 18:53:15,247][root][INFO] - Domain : Property, Question : 30
[2025-02-21 18:53:45,926][root][INFO] - Domain : Property, Question : 36
[2025-02-21 18:54:17,285][root][INFO] - Domain : Property, Question : 46
[2025-02-21 18:54:49,592][root][INFO] - Domain : Property, Question : 53
[2025-02-21 18:55:20,975][root][INFO] - Domain : Property, Question : 59
[2025-02-21 18:55:51,262][root][INFO] - Domain : Property, Question : 66
[2025-02-21 18:56:21,955][root][INFO] - Processing question number 80
[2025-02-21 18:56:21,960][root][INFO] - Domain : Property, Question : 69
[2025-02-21 18:56:53,577][root][INFO] - Domain : Property, Question : 81
[2025-02-21 18:57:25,237][root][INFO] - Domain : Property, Question : 88
[2025-02-21 18:57:56,822][root][INFO] - Domain : Property, Question : 91
[2025-02-21 18:58:28,159][root][INFO] - Domain : Property, Question : 94
[2025-02-21 18:59:00,401][root][INFO] - Domain : Property, Question : 100
[2025-02-21 18:59:31,286][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 19:00:02,746][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 19:00:34,701][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 19:01:05,824][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 19:01:36,958][root][INFO] - Processing question number 90
[2025-02-21 19:01:36,963][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 19:02:08,102][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 19:02:39,645][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 19:03:11,027][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 19:03:42,116][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 19:04:13,884][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 19:04:45,538][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 19:05:16,967][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 19:05:47,916][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 19:06:18,399][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 19:06:50,077][root][INFO] - Inference complete
[2025-02-21 19:06:50,077][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 19:06:50,084][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 19:06:50,086][root][ERROR] - |Q. 62||D: Constitutional_law| Failed to extract Legal_conclusion: 
[2025-02-21 19:06:50,089][root][ERROR] - |Q. 24||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 19:06:50,089][root][ERROR] - |Q. 65||D: Contracts| Failed to extract chosen option: 
[2025-02-21 19:06:50,090][root][ERROR] - |Q. 77||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 19:06:50,090][root][ERROR] - |Q. 77||D: Contracts| Failed to extract chosen option: 
[2025-02-21 19:06:50,090][root][ERROR] - |Q. 87||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 19:06:50,090][root][ERROR] - |Q. 87||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 19:06:50,090][root][ERROR] - |Q. 87||D: Contracts| Failed to extract chosen option: 
[2025-02-21 19:06:50,094][root][ERROR] - |Q. 36||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 19:06:50,097][root][ERROR] - |Q. 67||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 19:06:50,098][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 19:06:50,104][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 19:06:50,104][root][INFO] - Saved parsed outputs
[2025-02-21 19:06:50,104][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 19:06:50,105][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 19:06:50,105][root][INFO] - Saved parsing metadata
[2025-02-21 19:06:50,106][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 19:06:50,107][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 19:06:50,108][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_025/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 19:06:50,114][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 19:06:50,114][root][INFO] - Summary of metrics : {'label_accuracy': 0.3, 'misclassification_rate': 0.7, 'combined_accuracy': 0.19, 'malformed_label': 3, 'malformed_domain': 34, 'total_predictions': 100, 'correct_predictions': 30, 'correct_label_and_domain': 19, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.4, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.0, 'Real_Property_accuracy': 0.13333333333333333, 'Torts_accuracy': 0.14285714285714285, 'Civil_Procedure_accuracy': 0.0, 'Constitutional_Law_confidence': 0.13, 'Contracts_confidence': 0.19, 'Criminal_Law_confidence': 0.22, 'Evidence_confidence': 0.05, 'Real_Property_confidence': 0.04, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.05, 'correct_domain_wrong_label': 47, 'correct_label_wrong_domain': 11, 'both_wrong': 23}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 19:06:58,177][root][INFO] - Setting global seed to 989
[2025-02-21 19:06:58,182][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-02-21 19:06:58,182][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 19:06:58,184][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 19:06:58,185][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 19:06:58,187][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 19:06:58,187][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 19:06:58,334][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 19:06:58,581][root][INFO] - Full model selected, loading model
[2025-02-21 19:07:15,487][root][INFO] - Tokenizer special tokens: {'bos_token': '<s>', 'eos_token': '</s>', 'unk_token': '<unk>', 'pad_token': '[PAD]'} have been added
[2025-02-21 19:08:16,638][root][INFO] - Fine-tuned model selected, loading adapter
[2025-02-21 19:08:16,639][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-02-21 19:08:42,897][root][INFO] - Peft model loaded successfully
[2025-02-21 19:08:49,090][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 19:08:49,092][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 19:08:49,092][root][INFO] - Starting inference
[2025-02-21 19:08:49,239][root][INFO] - Processing question number 0
[2025-02-21 19:08:49,241][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 19:09:20,722][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 19:09:52,730][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 19:10:24,951][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 19:10:56,507][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 19:11:27,474][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 19:11:57,892][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 19:12:28,826][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 19:12:59,994][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 19:13:30,484][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 19:14:01,573][root][INFO] - Processing question number 10
[2025-02-21 19:14:01,576][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 19:14:31,871][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 19:15:02,785][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 19:15:33,809][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 19:16:04,315][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 19:16:35,805][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 19:17:06,889][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 19:17:37,965][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 19:18:08,872][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 19:18:40,325][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 19:19:11,867][root][INFO] - Processing question number 20
[2025-02-21 19:19:11,870][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 19:19:42,245][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 19:20:13,428][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 19:20:44,139][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 19:21:15,061][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 19:21:46,048][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 19:22:17,579][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 19:22:48,627][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 19:23:19,825][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 19:23:50,871][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 19:24:22,528][root][INFO] - Processing question number 30
[2025-02-21 19:24:22,531][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 19:24:53,623][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 19:25:24,630][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 19:25:55,557][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 19:26:27,179][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 19:26:58,226][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 19:27:29,322][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 19:28:00,361][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 19:28:32,095][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 19:29:03,297][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 19:29:34,639][root][INFO] - Processing question number 40
[2025-02-21 19:29:34,643][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 19:30:05,833][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 19:30:36,843][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 19:31:08,380][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 19:31:38,790][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 19:32:10,540][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 19:32:41,718][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 19:33:12,750][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 19:33:43,931][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 19:34:15,064][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 19:34:46,679][root][INFO] - Processing question number 50
[2025-02-21 19:34:46,683][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 19:35:18,514][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 19:35:49,269][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 19:36:21,102][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 19:36:52,593][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 19:37:23,255][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 19:37:54,215][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 19:38:26,071][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 19:38:57,675][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 19:39:29,288][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 19:40:00,717][root][INFO] - Processing question number 60
[2025-02-21 19:40:00,722][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 19:40:31,856][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 19:41:03,045][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 19:41:34,955][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 19:42:06,424][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 19:42:37,804][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 19:43:08,714][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 19:43:39,363][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 19:44:09,888][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 19:44:40,748][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 19:45:11,510][root][INFO] - Processing question number 70
[2025-02-21 19:45:11,515][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 19:45:42,917][root][INFO] - Domain : Property, Question : 9
[2025-02-21 19:46:14,223][root][INFO] - Domain : Property, Question : 17
[2025-02-21 19:46:45,717][root][INFO] - Domain : Property, Question : 25
[2025-02-21 19:47:17,656][root][INFO] - Domain : Property, Question : 30
[2025-02-21 19:47:48,366][root][INFO] - Domain : Property, Question : 36
[2025-02-21 19:48:19,812][root][INFO] - Domain : Property, Question : 46
[2025-02-21 19:48:52,221][root][INFO] - Domain : Property, Question : 53
[2025-02-21 19:49:23,657][root][INFO] - Domain : Property, Question : 59
[2025-02-21 19:49:54,077][root][INFO] - Domain : Property, Question : 66
[2025-02-21 19:50:24,904][root][INFO] - Processing question number 80
[2025-02-21 19:50:24,909][root][INFO] - Domain : Property, Question : 69
[2025-02-21 19:50:56,649][root][INFO] - Domain : Property, Question : 81
[2025-02-21 19:51:28,452][root][INFO] - Domain : Property, Question : 88
[2025-02-21 19:52:00,168][root][INFO] - Domain : Property, Question : 91
[2025-02-21 19:52:31,607][root][INFO] - Domain : Property, Question : 94
[2025-02-21 19:53:03,964][root][INFO] - Domain : Property, Question : 100
[2025-02-21 19:53:34,978][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 19:54:06,529][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 19:54:38,595][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 19:55:09,901][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 19:55:41,221][root][INFO] - Processing question number 90
[2025-02-21 19:55:41,226][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 19:56:12,565][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 19:56:44,308][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 19:57:15,769][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 19:57:46,918][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 19:58:18,766][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 19:58:50,505][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 19:59:21,956][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 19:59:52,953][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 20:00:23,500][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 20:00:55,276][root][INFO] - Inference complete
[2025-02-21 20:00:55,277][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:00:55,284][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:00:55,285][root][ERROR] - Failed to extract domain:  for response: 4
[2025-02-21 20:00:55,285][root][ERROR] - |Q. 20||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,285][root][ERROR] - |Q. 20||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,285][root][ERROR] - |Q. 20||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 20:00:55,285][root][ERROR] - |Q. 20||D: Constitutional_law| Failed to extract Legal_conclusion: 
[2025-02-21 20:00:55,285][root][ERROR] - |Q. 20||D: Constitutional_law| Failed to extract chosen option: 
[2025-02-21 20:00:55,286][root][ERROR] - Failed to extract domain:  for response: 5
[2025-02-21 20:00:55,286][root][ERROR] - |Q. 27||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,286][root][ERROR] - |Q. 27||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,286][root][ERROR] - |Q. 27||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 20:00:55,286][root][ERROR] - Failed to extract domain:  for response: 8
[2025-02-21 20:00:55,286][root][ERROR] - |Q. 49||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,286][root][ERROR] - |Q. 49||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,286][root][ERROR] - |Q. 49||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 20:00:55,286][root][ERROR] - Failed to extract domain:  for response: 10
[2025-02-21 20:00:55,287][root][ERROR] - |Q. 62||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,287][root][ERROR] - |Q. 62||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,287][root][ERROR] - |Q. 62||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 20:00:55,287][root][ERROR] - |Q. 62||D: Constitutional_law| Failed to extract Legal_conclusion: 
[2025-02-21 20:00:55,287][root][ERROR] - |Q. 62||D: Constitutional_law| Failed to extract chosen option: 
[2025-02-21 20:00:55,287][root][ERROR] - Failed to extract domain:  for response: 12
[2025-02-21 20:00:55,287][root][ERROR] - |Q. 78||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,287][root][ERROR] - |Q. 78||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,287][root][ERROR] - |Q. 78||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 20:00:55,288][root][ERROR] - Failed to extract domain:  for response: 17
[2025-02-21 20:00:55,288][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,288][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,288][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 20:00:55,289][root][ERROR] - Failed to extract domain:  for response: 26
[2025-02-21 20:00:55,289][root][ERROR] - |Q. 83||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,289][root][ERROR] - |Q. 83||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 20:00:55,289][root][ERROR] - Failed to extract domain:  for response: 27
[2025-02-21 20:00:55,289][root][ERROR] - |Q. 89||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,289][root][ERROR] - |Q. 89||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,289][root][ERROR] - |Q. 89||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 20:00:55,289][root][ERROR] - Failed to extract domain:  for response: 31
[2025-02-21 20:00:55,289][root][ERROR] - |Q. 14||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,290][root][ERROR] - |Q. 14||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,290][root][ERROR] - |Q. 14||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 20:00:55,290][root][ERROR] - Failed to extract domain:  for response: 32
[2025-02-21 20:00:55,290][root][ERROR] - |Q. 24||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,290][root][ERROR] - |Q. 24||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,290][root][ERROR] - |Q. 24||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 20:00:55,290][root][ERROR] - |Q. 24||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 20:00:55,290][root][ERROR] - |Q. 24||D: Contracts| Failed to extract chosen option: 
[2025-02-21 20:00:55,290][root][ERROR] - Failed to extract domain:  for response: 37
[2025-02-21 20:00:55,291][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,291][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,291][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 20:00:55,291][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 20:00:55,291][root][ERROR] - |Q. 58||D: Contracts| Failed to extract chosen option: 
[2025-02-21 20:00:55,291][root][ERROR] - Failed to extract domain:  for response: 42
[2025-02-21 20:00:55,291][root][ERROR] - |Q. 87||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,291][root][ERROR] - |Q. 87||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,291][root][ERROR] - |Q. 87||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 20:00:55,292][root][ERROR] - Failed to extract domain:  for response: 43
[2025-02-21 20:00:55,292][root][ERROR] - |Q. 97||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,292][root][ERROR] - |Q. 97||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,292][root][ERROR] - |Q. 97||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 20:00:55,293][root][ERROR] - Failed to extract domain:  for response: 55
[2025-02-21 20:00:55,293][root][ERROR] - |Q. 80||D: Evidence| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,293][root][ERROR] - |Q. 80||D: Evidence| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,293][root][ERROR] - |Q. 80||D: Evidence| Failed to extract Rule_application: 
[2025-02-21 20:00:55,293][root][ERROR] - Failed to extract domain:  for response: 59
[2025-02-21 20:00:55,293][root][ERROR] - |Q. 5||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,293][root][ERROR] - |Q. 5||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,294][root][ERROR] - |Q. 5||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 20:00:55,294][root][ERROR] - Failed to extract domain:  for response: 60
[2025-02-21 20:00:55,294][root][ERROR] - |Q. 12||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,294][root][ERROR] - |Q. 12||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,294][root][ERROR] - |Q. 12||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 20:00:55,294][root][ERROR] - Failed to extract domain:  for response: 61
[2025-02-21 20:00:55,294][root][ERROR] - |Q. 19||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,294][root][ERROR] - |Q. 19||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,294][root][ERROR] - |Q. 19||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 20:00:55,295][root][ERROR] - Failed to extract domain:  for response: 66
[2025-02-21 20:00:55,295][root][ERROR] - |Q. 54||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,295][root][ERROR] - |Q. 54||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,295][root][ERROR] - |Q. 54||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 20:00:55,295][root][ERROR] - Failed to extract domain:  for response: 69
[2025-02-21 20:00:55,295][root][ERROR] - |Q. 75||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,295][root][ERROR] - |Q. 75||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 20:00:55,295][root][ERROR] - Failed to extract domain:  for response: 71
[2025-02-21 20:00:55,296][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,296][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,296][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 20:00:55,296][root][ERROR] - Failed to extract domain:  for response: 73
[2025-02-21 20:00:55,296][root][ERROR] - |Q. 17||D: Property| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,296][root][ERROR] - |Q. 17||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,296][root][ERROR] - |Q. 17||D: Property| Failed to extract Rule_application: 
[2025-02-21 20:00:55,296][root][ERROR] - |Q. 17||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 20:00:55,296][root][ERROR] - |Q. 17||D: Property| Failed to extract chosen option: 
[2025-02-21 20:00:55,297][root][ERROR] - |Q. 94||D: Property| Failed to extract Rule_application: 
[2025-02-21 20:00:55,297][root][ERROR] - |Q. 94||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 20:00:55,298][root][ERROR] - Failed to extract domain:  for response: 93
[2025-02-21 20:00:55,298][root][ERROR] - |Q. 52||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,298][root][ERROR] - |Q. 52||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,298][root][ERROR] - |Q. 52||D: Torts| Failed to extract Rule_application: 
[2025-02-21 20:00:55,299][root][ERROR] - Failed to extract domain:  for response: 95
[2025-02-21 20:00:55,299][root][ERROR] - |Q. 63||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 20:00:55,299][root][ERROR] - |Q. 63||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 20:00:55,299][root][ERROR] - |Q. 63||D: Torts| Failed to extract Rule_application: 
[2025-02-21 20:00:55,300][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:00:55,306][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:00:55,306][root][INFO] - Saved parsed outputs
[2025-02-21 20:00:55,307][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:00:55,308][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:00:55,308][root][INFO] - Saved parsing metadata
[2025-02-21 20:00:55,309][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:00:55,310][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:00:55,311][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/trained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 20:00:55,323][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 20:00:55,323][root][INFO] - Summary of metrics : {'label_accuracy': 0.24, 'misclassification_rate': 0.76, 'combined_accuracy': 0.13, 'malformed_label': 29, 'malformed_domain': 60, 'total_predictions': 100, 'correct_predictions': 24, 'correct_label_and_domain': 13, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.14285714285714285, 'Evidence_accuracy': 0.06666666666666667, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.21428571428571427, 'Civil_Procedure_accuracy': 0.0, 'Constitutional_Law_confidence': 0.04, 'Contracts_confidence': 0.08, 'Criminal_Law_confidence': 0.2, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.04, 'Torts_confidence': 0.1, 'Civil_Procedure_confidence': 0.03, 'correct_domain_wrong_label': 27, 'correct_label_wrong_domain': 11, 'both_wrong': 49}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Running evaluation with config: seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 25 to status running with exit code None
Eval status update completed for job 25
[2025-02-21 20:01:01,471][root][INFO] - Setting global seed to 989
[2025-02-21 20:01:01,476][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-02-21 20:01:01,476][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : structured 
 Response Format : markdown 
[2025-02-21 20:01:01,477][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-02-21 20:01:01,478][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-02-21 20:01:01,480][root][INFO] - Indexing complete, sampling of questions set to False
[2025-02-21 20:01:01,480][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-02-21 20:01:01,629][root][INFO] - Loading model : meta-llama/Llama-2-7b-hf
[2025-02-21 20:01:01,881][root][INFO] - Full model selected, loading model
[2025-02-21 20:01:19,826][root][INFO] - Baseline model selected, no adapter needed
[2025-02-21 20:01:19,826][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-02-21 20:01:26,257][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/structured_example.json', 'explanation_type': 'structured', 'response_type': 'fact_first', 'response_format': 'markdown', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-02-21 20:01:26,258][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:01:26,258][root][INFO] - Starting inference
[2025-02-21 20:01:26,427][root][INFO] - Processing question number 0
[2025-02-21 20:01:26,428][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-02-21 20:01:57,706][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-02-21 20:02:29,475][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-02-21 20:03:01,393][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-02-21 20:03:32,829][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-02-21 20:04:03,665][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-02-21 20:04:33,911][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-02-21 20:05:04,712][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-02-21 20:05:35,764][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-02-21 20:06:06,137][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-02-21 20:06:37,097][root][INFO] - Processing question number 10
[2025-02-21 20:06:37,099][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-02-21 20:07:07,265][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-02-21 20:07:37,998][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-02-21 20:08:08,903][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-02-21 20:08:39,339][root][INFO] - Domain : Criminal_law, Question : 2
[2025-02-21 20:09:10,709][root][INFO] - Domain : Criminal_law, Question : 8
[2025-02-21 20:09:41,675][root][INFO] - Domain : Criminal_law, Question : 15
[2025-02-21 20:10:12,588][root][INFO] - Domain : Criminal_law, Question : 21
[2025-02-21 20:10:43,313][root][INFO] - Domain : Criminal_law, Question : 29
[2025-02-21 20:11:14,642][root][INFO] - Domain : Criminal_law, Question : 37
[2025-02-21 20:11:46,060][root][INFO] - Processing question number 20
[2025-02-21 20:11:46,063][root][INFO] - Domain : Criminal_law, Question : 44
[2025-02-21 20:12:16,273][root][INFO] - Domain : Criminal_law, Question : 55
[2025-02-21 20:12:47,349][root][INFO] - Domain : Criminal_law, Question : 64
[2025-02-21 20:13:17,950][root][INFO] - Domain : Criminal_law, Question : 71
[2025-02-21 20:13:48,741][root][INFO] - Domain : Criminal_law, Question : 76
[2025-02-21 20:14:19,600][root][INFO] - Domain : Criminal_law, Question : 83
[2025-02-21 20:14:51,013][root][INFO] - Domain : Criminal_law, Question : 89
[2025-02-21 20:15:21,928][root][INFO] - Domain : Criminal_law, Question : 96
[2025-02-21 20:15:53,013][root][INFO] - Domain : Contracts, Question : 3
[2025-02-21 20:16:23,927][root][INFO] - Domain : Contracts, Question : 7
[2025-02-21 20:16:55,456][root][INFO] - Processing question number 30
[2025-02-21 20:16:55,459][root][INFO] - Domain : Contracts, Question : 14
[2025-02-21 20:17:26,426][root][INFO] - Domain : Contracts, Question : 24
[2025-02-21 20:17:57,242][root][INFO] - Domain : Contracts, Question : 28
[2025-02-21 20:18:27,965][root][INFO] - Domain : Contracts, Question : 34
[2025-02-21 20:18:59,466][root][INFO] - Domain : Contracts, Question : 42
[2025-02-21 20:19:30,357][root][INFO] - Domain : Contracts, Question : 48
[2025-02-21 20:20:01,318][root][INFO] - Domain : Contracts, Question : 58
[2025-02-21 20:20:32,236][root][INFO] - Domain : Contracts, Question : 65
[2025-02-21 20:21:03,936][root][INFO] - Domain : Contracts, Question : 72
[2025-02-21 20:21:35,215][root][INFO] - Domain : Contracts, Question : 77
[2025-02-21 20:22:06,434][root][INFO] - Processing question number 40
[2025-02-21 20:22:06,438][root][INFO] - Domain : Contracts, Question : 84
[2025-02-21 20:22:37,642][root][INFO] - Domain : Contracts, Question : 87
[2025-02-21 20:23:08,540][root][INFO] - Domain : Contracts, Question : 97
[2025-02-21 20:23:39,950][root][INFO] - Domain : Evidence, Question : 4
[2025-02-21 20:24:10,186][root][INFO] - Domain : Evidence, Question : 10
[2025-02-21 20:24:41,784][root][INFO] - Domain : Evidence, Question : 16
[2025-02-21 20:25:12,828][root][INFO] - Domain : Evidence, Question : 23
[2025-02-21 20:25:43,719][root][INFO] - Domain : Evidence, Question : 31
[2025-02-21 20:26:14,782][root][INFO] - Domain : Evidence, Question : 38
[2025-02-21 20:26:45,744][root][INFO] - Domain : Evidence, Question : 43
[2025-02-21 20:27:17,101][root][INFO] - Processing question number 50
[2025-02-21 20:27:17,105][root][INFO] - Domain : Evidence, Question : 50
[2025-02-21 20:27:48,693][root][INFO] - Domain : Evidence, Question : 51
[2025-02-21 20:28:19,185][root][INFO] - Domain : Evidence, Question : 60
[2025-02-21 20:28:50,807][root][INFO] - Domain : Evidence, Question : 73
[2025-02-21 20:29:22,009][root][INFO] - Domain : Evidence, Question : 80
[2025-02-21 20:29:52,571][root][INFO] - Domain : Evidence, Question : 85
[2025-02-21 20:30:23,425][root][INFO] - Domain : Evidence, Question : 90
[2025-02-21 20:30:55,178][root][INFO] - Domain : Evidence, Question : 98
[2025-02-21 20:31:26,667][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-02-21 20:31:58,154][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-02-21 20:32:29,460][root][INFO] - Processing question number 60
[2025-02-21 20:32:29,465][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-02-21 20:33:00,477][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-02-21 20:33:31,552][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-02-21 20:34:03,334][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-02-21 20:34:34,687][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-02-21 20:35:05,862][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-02-21 20:35:36,558][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-02-21 20:36:07,082][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-02-21 20:36:37,488][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-02-21 20:37:08,178][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-02-21 20:37:38,812][root][INFO] - Processing question number 70
[2025-02-21 20:37:38,817][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-02-21 20:38:10,113][root][INFO] - Domain : Property, Question : 9
[2025-02-21 20:38:41,223][root][INFO] - Domain : Property, Question : 17
[2025-02-21 20:39:12,606][root][INFO] - Domain : Property, Question : 25
[2025-02-21 20:39:44,441][root][INFO] - Domain : Property, Question : 30
[2025-02-21 20:40:15,034][root][INFO] - Domain : Property, Question : 36
[2025-02-21 20:40:46,354][root][INFO] - Domain : Property, Question : 46
[2025-02-21 20:41:18,623][root][INFO] - Domain : Property, Question : 53
[2025-02-21 20:41:49,951][root][INFO] - Domain : Property, Question : 59
[2025-02-21 20:42:20,207][root][INFO] - Domain : Property, Question : 66
[2025-02-21 20:42:50,879][root][INFO] - Processing question number 80
[2025-02-21 20:42:50,884][root][INFO] - Domain : Property, Question : 69
[2025-02-21 20:43:22,613][root][INFO] - Domain : Property, Question : 81
[2025-02-21 20:43:54,299][root][INFO] - Domain : Property, Question : 88
[2025-02-21 20:44:25,865][root][INFO] - Domain : Property, Question : 91
[2025-02-21 20:44:57,179][root][INFO] - Domain : Property, Question : 94
[2025-02-21 20:45:29,437][root][INFO] - Domain : Property, Question : 100
[2025-02-21 20:46:00,325][root][INFO] - Domain : Torts, Question : 11
[2025-02-21 20:46:31,792][root][INFO] - Domain : Torts, Question : 18
[2025-02-21 20:47:03,766][root][INFO] - Domain : Torts, Question : 22
[2025-02-21 20:47:34,876][root][INFO] - Domain : Torts, Question : 32
[2025-02-21 20:48:05,994][root][INFO] - Processing question number 90
[2025-02-21 20:48:06,000][root][INFO] - Domain : Torts, Question : 39
[2025-02-21 20:48:37,122][root][INFO] - Domain : Torts, Question : 45
[2025-02-21 20:49:08,632][root][INFO] - Domain : Torts, Question : 52
[2025-02-21 20:49:39,972][root][INFO] - Domain : Torts, Question : 57
[2025-02-21 20:50:11,047][root][INFO] - Domain : Torts, Question : 63
[2025-02-21 20:50:42,806][root][INFO] - Domain : Torts, Question : 67
[2025-02-21 20:51:14,417][root][INFO] - Domain : Torts, Question : 74
[2025-02-21 20:51:45,767][root][INFO] - Domain : Torts, Question : 79
[2025-02-21 20:52:16,656][root][INFO] - Domain : Torts, Question : 92
[2025-02-21 20:52:47,094][root][INFO] - Domain : Torts, Question : 95
[2025-02-21 20:53:18,724][root][INFO] - Inference complete
[2025-02-21 20:53:18,724][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:53:18,732][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:53:18,734][root][ERROR] - |Q. 56||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,734][root][ERROR] - |Q. 56||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,735][root][ERROR] - |Q. 56||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 20:53:18,735][root][ERROR] - |Q. 70||D: Constitutional_law| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,735][root][ERROR] - |Q. 70||D: Constitutional_law| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,735][root][ERROR] - |Q. 70||D: Constitutional_law| Failed to extract Rule_application: 
[2025-02-21 20:53:18,736][root][ERROR] - |Q. 15||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 20:53:18,736][root][ERROR] - |Q. 29||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,736][root][ERROR] - |Q. 29||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,736][root][ERROR] - |Q. 29||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 20:53:18,737][root][ERROR] - |Q. 96||D: Criminal_law| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,737][root][ERROR] - |Q. 96||D: Criminal_law| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,737][root][ERROR] - |Q. 96||D: Criminal_law| Failed to extract Rule_application: 
[2025-02-21 20:53:18,737][root][ERROR] - |Q. 96||D: Criminal_law| Failed to extract Legal_conclusion: 
[2025-02-21 20:53:18,737][root][ERROR] - |Q. 3||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,738][root][ERROR] - |Q. 3||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,738][root][ERROR] - |Q. 3||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 20:53:18,738][root][ERROR] - |Q. 14||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 20:53:18,738][root][ERROR] - |Q. 34||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,738][root][ERROR] - |Q. 34||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,738][root][ERROR] - |Q. 34||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 20:53:18,739][root][ERROR] - |Q. 58||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 20:53:18,739][root][ERROR] - |Q. 65||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,739][root][ERROR] - |Q. 65||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,739][root][ERROR] - |Q. 65||D: Contracts| Failed to extract Rule_application: 
[2025-02-21 20:53:18,739][root][ERROR] - |Q. 72||D: Contracts| Failed to extract Legal_conclusion: 
[2025-02-21 20:53:18,739][root][ERROR] - |Q. 77||D: Contracts| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,739][root][ERROR] - |Q. 77||D: Contracts| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,743][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,743][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,743][root][ERROR] - |Q. 93||D: Civil_procedure| Failed to extract Rule_application: 
[2025-02-21 20:53:18,744][root][ERROR] - |Q. 36||D: Property| Failed to extract Legal_conclusion: 
[2025-02-21 20:53:18,744][root][ERROR] - |Q. 81||D: Property| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,745][root][ERROR] - |Q. 81||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,745][root][ERROR] - |Q. 81||D: Property| Failed to extract Rule_application: 
[2025-02-21 20:53:18,745][root][ERROR] - |Q. 88||D: Property| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,745][root][ERROR] - |Q. 88||D: Property| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,745][root][ERROR] - |Q. 88||D: Property| Failed to extract Rule_application: 
[2025-02-21 20:53:18,746][root][ERROR] - |Q. 22||D: Torts| Failed to extract chosen option: 
[2025-02-21 20:53:18,746][root][ERROR] - |Q. 39||D: Torts| Failed to extract Legal_conclusion: 
[2025-02-21 20:53:18,747][root][ERROR] - |Q. 92||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,747][root][ERROR] - |Q. 92||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,747][root][ERROR] - |Q. 92||D: Torts| Failed to extract Rule_application: 
[2025-02-21 20:53:18,747][root][ERROR] - |Q. 95||D: Torts| Failed to extract Legal_concept: 
[2025-02-21 20:53:18,747][root][ERROR] - |Q. 95||D: Torts| Failed to extract Fact_analysis: 
[2025-02-21 20:53:18,747][root][ERROR] - |Q. 95||D: Torts| Failed to extract Rule_application: 
[2025-02-21 20:53:18,748][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:53:18,754][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:53:18,754][root][INFO] - Saved parsed outputs
[2025-02-21 20:53:18,754][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:53:18,756][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:53:18,756][root][INFO] - Saved parsing metadata
[2025-02-21 20:53:18,757][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:53:18,758][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
[2025-02-21 20:53:18,759][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama2/seed_989/all_domains_1_samples/untrained_full_model/temp_06/markdown_fact_first_few_shot_structured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-02-21 20:53:18,775][root][INFO] - Evaluation completed for markdown_fact_first_few_shot_structured, on test_set_2
[2025-02-21 20:53:18,775][root][INFO] - Summary of metrics : {'label_accuracy': 0.33, 'misclassification_rate': 0.6699999999999999, 'combined_accuracy': 0.2, 'malformed_label': 2, 'malformed_domain': 42, 'total_predictions': 100, 'correct_predictions': 33, 'correct_label_and_domain': 20, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.0, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.2857142857142857, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.11, 'Contracts_confidence': 0.15, 'Criminal_Law_confidence': 0.21, 'Evidence_confidence': 0.05, 'Real_Property_confidence': 0.04, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.05, 'correct_domain_wrong_label': 38, 'correct_label_wrong_domain': 13, 'both_wrong': 29}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '25', 'seeds=seed_989 model=llama2 tokenizer=llama2 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=markdown_fact_first_few_shot_structured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 25 to status completed with exit code 0
Eval status update completed for job 25
Job 25 completed at Fri Feb 21 20:53:19 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n514
Job ID: 25309360
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 21:09:49
CPU Efficiency: 9.95% of 8-20:43:40 core-walltime
Job Wall-clock time: 21:16:22
Memory Utilized: 28.05 GB
Memory Efficiency: 77.92% of 36.00 GB
