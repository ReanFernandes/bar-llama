Starting job 12 at Thu Mar  6 10:02:18 CET 2025
Configuration: model=llama3 tokenizer=llama3 dataset=all_domains_1_samples prompt=json_fact_first_few_shot_unstructured train=json_fact_first_few_shot_unstructured ++train.training_args.per_device_train_batch_size=7 ++train.training_args.gradient_accumulation_steps=1
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '12', 'training']
Updating job 12 to status training with exit code None
Status update completed for job 12
[2025-03-06 10:02:35,866][root][INFO] - Global seed set to 314
[2025-03-06 10:02:35,868][root][WARNING] - Quantisation will be done on loaded model, THIS IS A QLORA FINE-TUNING RUN
[2025-03-06 10:02:35,868][root][WARNING] - Following flags are set for the run : 
 Use Quantisation before fine-tuning : True 
 Perform Validation on epoch end : False
[2025-03-06 10:02:35,868][root][INFO] - Running Fine-tuning on the all_domains_1_samples dataset
[2025-03-06 10:02:35,868][root][INFO] - Current training config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 10:02:35,868][root][INFO] - Loading dataset from /home/fr/fr_fr/fr_rf1031/bar-llama/dataset/seed_dataset/raw_dataset.json
[2025-03-06 10:02:35,884][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:02:35,900][root][INFO] - Indexing complete, sampling of questions set to True
[2025-03-06 10:02:35,902][root][INFO] - Questions selected, dataset contains 7 questions with 1.0 questions per domain
[2025-03-06 10:02:35,908][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${train.prompt.response_format}_${train.prompt.response_type}_${train.prompt.explanation_type}.txt', 'include_system_prompt': True}
[2025-03-06 10:02:36,670][root][INFO] - Tokenizer meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 10:03:00,412][root][INFO] - Quantised model meta-llama/Llama-3.1-8B-Instruct loaded successfully
[2025-03-06 10:03:29,665][root][INFO] - Model prepared for kbit training
[2025-03-06 10:03:29,666][root][INFO] - Lora config loaded, following are the details : 
 LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=64, target_modules={'v_proj', 'o_proj', 'gate_proj', 'down_proj', 'up_proj', 'q_proj', 'k_proj'}, lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False, layer_replication=None, runtime_config=LoraRuntimeConfig(ephemeral_gpu_offload=False))
[2025-03-06 10:03:31,424][root][INFO] - Lora adapter added to model
[2025-03-06 10:03:31,427][root][INFO] - Model adapter will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_1_samples/llama3_json_fact_first_few_shot_unstructured
[2025-03-06 10:03:31,696][accelerate.utils.other][WARNING] - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
{'loss': 1.8237, 'grad_norm': 0.3740471601486206, 'learning_rate': 9.42728012826605e-05, 'epoch': 3.0}
{'loss': 1.5187, 'grad_norm': 0.3377459943294525, 'learning_rate': 3.226975564787322e-05, 'epoch': 6.0}
{'loss': 1.3103, 'grad_norm': 0.3581077754497528, 'learning_rate': 9.85470908713026e-05, 'epoch': 9.0}
{'loss': 1.1387, 'grad_norm': 0.450582891702652, 'learning_rate': 4.397316598723383e-05, 'epoch': 12.0}
{'loss': 0.8541, 'grad_norm': 0.4763888120651245, 'learning_rate': 0.0, 'epoch': 15.0}
{'train_runtime': 417.3265, 'train_samples_per_second': 0.252, 'train_steps_per_second': 0.036, 'train_loss': 1.3290831089019775, 'epoch': 15.0}
[2025-03-06 10:10:36,347][root][INFO] - Finetuning complete, model saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/sft_adapters/llama3/all_domains_1_samples/llama3_json_fact_first_few_shot_unstructured
Starting update_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_status.py', '12', 'trained', '0']
Updating job 12 to status trained with exit code 0
Status update completed for job 12
Starting evaluations for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 10:10:46,353][root][INFO] - Setting global seed to 206
[2025-03-06 10:10:46,360][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 10:10:46,360][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 10:10:46,361][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 10:10:46,384][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:10:46,389][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 10:10:46,389][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 10:10:46,533][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 10:10:47,065][root][INFO] - Full model selected, loading model
[2025-03-06 10:11:08,611][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 10:12:54,844][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 10:12:54,870][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 10:13:29,105][root][INFO] - Peft model loaded successfully
[2025-03-06 10:13:36,739][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 10:13:36,741][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:13:36,741][root][INFO] - Starting inference
[2025-03-06 10:13:36,964][root][INFO] - Processing question number 0
[2025-03-06 10:13:36,966][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 10:13:45,449][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 10:13:55,706][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 10:14:08,452][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 10:14:18,987][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 10:14:30,255][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 10:14:46,972][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 10:14:56,164][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 10:15:10,995][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 10:15:22,789][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 10:15:31,111][root][INFO] - Processing question number 10
[2025-03-06 10:15:31,113][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 10:15:40,429][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 10:15:53,866][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 10:16:03,079][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 10:16:34,351][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 10:16:41,718][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 10:16:48,603][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 10:17:18,964][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 10:17:24,915][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 10:17:32,225][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 10:17:46,426][root][INFO] - Processing question number 20
[2025-03-06 10:17:46,428][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 10:17:58,125][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 10:18:09,639][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 10:18:19,648][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 10:18:30,241][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 10:18:42,077][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 10:18:50,154][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 10:18:58,618][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 10:19:11,237][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 10:19:21,827][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 10:19:29,701][root][INFO] - Processing question number 30
[2025-03-06 10:19:29,704][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 10:20:00,622][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 10:20:08,787][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 10:20:20,519][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 10:20:32,179][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 10:20:39,565][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 10:20:49,006][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 10:20:59,247][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 10:21:30,323][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 10:21:42,531][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 10:21:52,175][root][INFO] - Processing question number 40
[2025-03-06 10:21:52,178][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 10:22:00,442][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 10:22:11,366][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 10:22:31,357][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 10:22:47,495][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 10:22:55,168][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 10:23:07,308][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 10:23:17,301][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 10:23:26,575][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 10:23:32,818][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 10:23:42,273][root][INFO] - Processing question number 50
[2025-03-06 10:23:42,277][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 10:24:13,757][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 10:24:44,780][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 10:25:15,135][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 10:25:46,830][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 10:25:56,846][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 10:26:08,839][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 10:26:18,162][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 10:26:32,613][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 10:26:45,312][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 10:26:56,703][root][INFO] - Processing question number 60
[2025-03-06 10:26:56,707][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 10:27:03,668][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 10:27:12,177][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 10:27:22,566][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 10:27:30,149][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 10:27:44,886][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 10:28:15,792][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 10:28:24,583][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 10:28:55,612][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 10:29:05,298][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 10:29:17,413][root][INFO] - Processing question number 70
[2025-03-06 10:29:17,417][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 10:29:38,715][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 10:29:50,313][root][INFO] - Domain : Property, Question : 6
[2025-03-06 10:29:58,619][root][INFO] - Domain : Property, Question : 13
[2025-03-06 10:30:09,639][root][INFO] - Domain : Property, Question : 20
[2025-03-06 10:30:23,250][root][INFO] - Domain : Property, Question : 33
[2025-03-06 10:30:53,847][root][INFO] - Domain : Property, Question : 39
[2025-03-06 10:31:25,133][root][INFO] - Domain : Property, Question : 48
[2025-03-06 10:31:34,840][root][INFO] - Domain : Property, Question : 54
[2025-03-06 10:31:43,353][root][INFO] - Domain : Property, Question : 61
[2025-03-06 10:32:02,343][root][INFO] - Processing question number 80
[2025-03-06 10:32:02,347][root][INFO] - Domain : Property, Question : 67
[2025-03-06 10:32:13,450][root][INFO] - Domain : Property, Question : 75
[2025-03-06 10:32:24,965][root][INFO] - Domain : Property, Question : 83
[2025-03-06 10:32:36,146][root][INFO] - Domain : Property, Question : 89
[2025-03-06 10:32:46,949][root][INFO] - Domain : Property, Question : 97
[2025-03-06 10:33:18,245][root][INFO] - Domain : Property, Question : 100
[2025-03-06 10:33:30,945][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 10:33:39,459][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 10:33:49,187][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 10:34:20,163][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 10:34:31,678][root][INFO] - Processing question number 90
[2025-03-06 10:34:31,683][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 10:35:03,158][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 10:35:11,578][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 10:35:42,399][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 10:35:56,962][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 10:36:07,858][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 10:36:20,404][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 10:36:28,808][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 10:36:40,405][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 10:37:10,816][root][INFO] - Inference complete
[2025-03-06 10:37:10,816][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:37:10,823][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:37:10,824][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,825][root][WARNING] - |Q. 7||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 10:37:10,825][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,826][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,826][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 10:37:10,826][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,827][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,827][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 10:37:10,827][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,827][root][WARNING] - |Q. 84||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,828][root][WARNING] - |Q. 84||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,828][root][INFO] - |Q. 84||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,828][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,829][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,829][root][WARNING] - |Q. 2||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,829][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,829][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,831][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,831][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,831][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,831][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,832][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,832][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,832][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,833][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,834][root][WARNING] - |Q. 52||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,835][root][WARNING] - |Q. 52||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,835][root][INFO] - |Q. 52||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,835][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,835][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,835][root][WARNING] - |Q. 62||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,835][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,836][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,836][root][WARNING] - |Q. 76||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,836][root][WARNING] - |Q. 76||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,836][root][INFO] - |Q. 76||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,836][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,837][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,837][root][WARNING] - |Q. 82||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,837][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,837][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,838][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,839][root][WARNING] - |Q. 53||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,839][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,839][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,839][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,840][root][WARNING] - |Q. 68||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,840][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,840][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,841][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,841][root][WARNING] - |Q. 33||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,842][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,842][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,842][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,842][root][WARNING] - |Q. 39||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,842][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,842][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,843][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,844][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,844][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,844][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,844][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,845][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,845][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,845][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,845][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,846][root][WARNING] - |Q. 36||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,846][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,846][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,846][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 10:37:10,846][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 10:37:10,846][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 10:37:10,846][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 10:37:10,848][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:37:10,853][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:37:10,853][root][INFO] - Saved parsed outputs
[2025-03-06 10:37:10,853][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:37:10,855][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:37:10,855][root][INFO] - Saved parsing metadata
[2025-03-06 10:37:10,855][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:37:10,857][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:37:10,859][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 10:37:10,891][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 10:37:10,891][root][INFO] - Summary of metrics : {'label_accuracy': 0.45454545454545453, 'misclassification_rate': 0.5454545454545454, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 16, 'malformed_domain': 14, 'total_predictions': 99, 'correct_predictions': 45, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 47, 'correct_label_wrong_domain': 7, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 10:37:17,424][root][INFO] - Setting global seed to 206
[2025-03-06 10:37:17,430][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 10:37:17,430][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 10:37:17,431][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 10:37:17,433][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:37:17,436][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 10:37:17,436][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 10:37:17,584][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 10:37:18,117][root][INFO] - Full model selected, loading model
[2025-03-06 10:37:38,142][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 10:37:38,142][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 10:37:45,895][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 10:37:45,897][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:37:45,897][root][INFO] - Starting inference
[2025-03-06 10:37:46,107][root][INFO] - Processing question number 0
[2025-03-06 10:37:46,109][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 10:37:52,235][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 10:38:01,019][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 10:38:12,749][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 10:38:19,454][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 10:38:27,211][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 10:38:35,955][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 10:38:43,659][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 10:38:53,788][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 10:39:01,048][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 10:39:16,141][root][INFO] - Processing question number 10
[2025-03-06 10:39:16,143][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 10:39:23,778][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 10:39:31,023][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 10:39:38,039][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 10:39:44,707][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 10:39:51,413][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 10:39:57,679][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 10:40:06,466][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 10:40:14,597][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 10:40:20,112][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 10:40:26,412][root][INFO] - Processing question number 20
[2025-03-06 10:40:26,414][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 10:40:39,848][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 10:40:47,709][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 10:40:55,138][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 10:41:14,461][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 10:41:23,565][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 10:41:35,680][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 10:41:41,849][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 10:41:51,261][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 10:41:59,832][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 10:42:08,636][root][INFO] - Processing question number 30
[2025-03-06 10:42:08,639][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 10:42:17,462][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 10:42:24,435][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 10:42:35,270][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 10:42:44,423][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 10:42:51,222][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 10:42:58,077][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 10:43:05,867][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 10:43:14,750][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 10:43:22,215][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 10:43:31,950][root][INFO] - Processing question number 40
[2025-03-06 10:43:31,954][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 10:43:39,773][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 10:43:47,340][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 10:43:59,521][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 10:44:07,522][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 10:44:18,960][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 10:44:28,920][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 10:44:37,702][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 10:44:46,838][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 10:44:54,150][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 10:45:02,206][root][INFO] - Processing question number 50
[2025-03-06 10:45:02,209][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 10:45:11,659][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 10:45:21,806][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 10:45:29,675][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 10:45:37,100][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 10:45:48,197][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 10:45:55,053][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 10:46:04,520][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 10:46:09,927][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 10:46:15,950][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 10:46:24,168][root][INFO] - Processing question number 60
[2025-03-06 10:46:24,171][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 10:46:30,643][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 10:46:39,837][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 10:46:51,722][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 10:46:57,079][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 10:47:04,338][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 10:47:13,991][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 10:47:21,110][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 10:47:29,768][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 10:47:37,041][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 10:47:46,475][root][INFO] - Processing question number 70
[2025-03-06 10:47:46,478][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 10:47:53,679][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 10:48:00,527][root][INFO] - Domain : Property, Question : 6
[2025-03-06 10:48:07,470][root][INFO] - Domain : Property, Question : 13
[2025-03-06 10:48:23,823][root][INFO] - Domain : Property, Question : 20
[2025-03-06 10:48:31,667][root][INFO] - Domain : Property, Question : 33
[2025-03-06 10:48:40,823][root][INFO] - Domain : Property, Question : 39
[2025-03-06 10:48:51,566][root][INFO] - Domain : Property, Question : 48
[2025-03-06 10:49:02,069][root][INFO] - Domain : Property, Question : 54
[2025-03-06 10:49:10,235][root][INFO] - Domain : Property, Question : 61
[2025-03-06 10:49:20,679][root][INFO] - Processing question number 80
[2025-03-06 10:49:20,684][root][INFO] - Domain : Property, Question : 67
[2025-03-06 10:49:29,758][root][INFO] - Domain : Property, Question : 75
[2025-03-06 10:49:41,532][root][INFO] - Domain : Property, Question : 83
[2025-03-06 10:49:52,327][root][INFO] - Domain : Property, Question : 89
[2025-03-06 10:49:59,516][root][INFO] - Domain : Property, Question : 97
[2025-03-06 10:50:08,016][root][INFO] - Domain : Property, Question : 100
[2025-03-06 10:50:18,370][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 10:50:28,325][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 10:50:36,934][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 10:50:45,144][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 10:50:54,762][root][INFO] - Processing question number 90
[2025-03-06 10:50:54,767][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 10:51:03,725][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 10:51:10,764][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 10:51:21,269][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 10:51:28,536][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 10:51:37,083][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 10:51:43,259][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 10:51:53,377][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 10:52:01,770][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 10:52:11,633][root][INFO] - Inference complete
[2025-03-06 10:52:11,633][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:52:11,639][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:52:11,649][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:52:11,654][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:52:11,654][root][INFO] - Saved parsed outputs
[2025-03-06 10:52:11,655][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:52:11,656][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:52:11,656][root][INFO] - Saved parsing metadata
[2025-03-06 10:52:11,656][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:52:11,658][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:52:11,659][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 10:52:11,709][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 10:52:11,710][root][INFO] - Summary of metrics : {'label_accuracy': 0.6060606060606061, 'misclassification_rate': 0.3939393939393939, 'combined_accuracy': 0.35353535353535354, 'malformed_label': 0, 'malformed_domain': 46, 'total_predictions': 99, 'correct_predictions': 60, 'correct_label_and_domain': 35, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.5384615384615384, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.050505050505050504, 'Contracts_confidence': 0.050505050505050504, 'Criminal_Law_confidence': 0.08080808080808081, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.09090909090909091, 'Torts_confidence': 0.10101010101010101, 'Civil_Procedure_confidence': 0.06060606060606061, 'correct_domain_wrong_label': 18, 'correct_label_wrong_domain': 25, 'both_wrong': 21}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 10:52:18,212][root][INFO] - Setting global seed to 206
[2025-03-06 10:52:18,217][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 10:52:18,218][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 10:52:18,219][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 10:52:18,220][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 10:52:18,223][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 10:52:18,224][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 10:52:18,399][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 10:52:19,095][root][INFO] - Full model selected, loading model
[2025-03-06 10:52:40,623][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 10:54:25,100][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 10:54:25,101][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 10:54:59,659][root][INFO] - Peft model loaded successfully
[2025-03-06 10:55:07,100][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 10:55:07,102][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 10:55:07,102][root][INFO] - Starting inference
[2025-03-06 10:55:07,292][root][INFO] - Processing question number 0
[2025-03-06 10:55:07,294][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 10:55:17,888][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 10:55:49,286][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 10:56:06,962][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 10:56:19,027][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 10:56:27,199][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 10:56:36,317][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 10:56:53,445][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 10:57:10,267][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 10:57:18,031][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 10:57:25,928][root][INFO] - Processing question number 10
[2025-03-06 10:57:25,930][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 10:57:40,033][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 10:57:52,497][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 10:58:03,926][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 10:58:20,488][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 10:58:36,528][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 10:58:49,376][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 10:58:56,386][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 10:59:05,785][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 10:59:23,006][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 10:59:33,736][root][INFO] - Processing question number 20
[2025-03-06 10:59:33,739][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 10:59:42,564][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 10:59:53,582][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 11:00:02,548][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 11:00:13,918][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 11:00:23,352][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 11:00:29,337][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 11:00:42,736][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 11:00:55,875][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 11:01:10,978][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 11:01:21,230][root][INFO] - Processing question number 30
[2025-03-06 11:01:21,233][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 11:01:41,906][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 11:01:51,384][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 11:02:08,786][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 11:02:18,707][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 11:02:26,056][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 11:02:37,532][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 11:02:47,559][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 11:03:01,493][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 11:03:10,950][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 11:03:23,150][root][INFO] - Processing question number 40
[2025-03-06 11:03:23,154][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 11:03:30,396][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 11:03:42,370][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 11:04:09,315][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 11:04:19,742][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 11:04:32,383][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 11:04:43,875][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 11:04:54,972][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 11:05:03,203][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 11:05:10,872][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 11:05:23,975][root][INFO] - Processing question number 50
[2025-03-06 11:05:23,978][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 11:05:35,938][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 11:05:45,875][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 11:05:57,154][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 11:06:07,933][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 11:06:18,722][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 11:06:32,150][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 11:06:43,211][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 11:07:14,045][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 11:07:30,212][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 11:07:47,614][root][INFO] - Processing question number 60
[2025-03-06 11:07:47,618][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 11:07:53,851][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 11:08:02,433][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 11:08:17,301][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 11:08:24,556][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 11:08:32,815][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 11:09:03,968][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 11:09:16,327][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 11:09:41,969][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 11:09:52,482][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 11:10:23,838][root][INFO] - Processing question number 70
[2025-03-06 11:10:23,842][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 11:10:34,301][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 11:10:40,762][root][INFO] - Domain : Property, Question : 6
[2025-03-06 11:10:50,273][root][INFO] - Domain : Property, Question : 13
[2025-03-06 11:11:21,637][root][INFO] - Domain : Property, Question : 20
[2025-03-06 11:11:34,606][root][INFO] - Domain : Property, Question : 33
[2025-03-06 11:11:50,797][root][INFO] - Domain : Property, Question : 39
[2025-03-06 11:12:05,317][root][INFO] - Domain : Property, Question : 48
[2025-03-06 11:12:14,551][root][INFO] - Domain : Property, Question : 54
[2025-03-06 11:12:24,187][root][INFO] - Domain : Property, Question : 61
[2025-03-06 11:12:36,059][root][INFO] - Processing question number 80
[2025-03-06 11:12:36,064][root][INFO] - Domain : Property, Question : 67
[2025-03-06 11:12:43,915][root][INFO] - Domain : Property, Question : 75
[2025-03-06 11:12:56,991][root][INFO] - Domain : Property, Question : 83
[2025-03-06 11:13:05,898][root][INFO] - Domain : Property, Question : 89
[2025-03-06 11:13:17,890][root][INFO] - Domain : Property, Question : 97
[2025-03-06 11:13:33,018][root][INFO] - Domain : Property, Question : 100
[2025-03-06 11:14:04,443][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 11:14:16,191][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 11:14:27,539][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 11:14:58,767][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 11:15:06,790][root][INFO] - Processing question number 90
[2025-03-06 11:15:06,795][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 11:15:38,521][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 11:15:48,527][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 11:16:19,607][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 11:16:34,445][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 11:16:47,297][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 11:16:57,885][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 11:17:08,923][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 11:17:28,021][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 11:17:47,971][root][INFO] - Inference complete
[2025-03-06 11:17:47,971][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:17:47,977][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:17:47,978][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,979][root][WARNING] - |Q. 7||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:17:47,979][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,979][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:17:47,980][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,980][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 11:17:47,981][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,981][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,981][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 11:17:47,981][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,987][root][WARNING] - |Q. 5||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,987][root][WARNING] - |Q. 5||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:17:47,987][root][INFO] - |Q. 5||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,987][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:17:47,988][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,989][root][WARNING] - |Q. 53||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:17:47,989][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,989][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:17:47,990][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,990][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:17:47,990][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,990][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:17:47,991][root][WARNING] - |Q. 13||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,991][root][WARNING] - |Q. 13||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:17:47,991][root][INFO] - |Q. 13||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,991][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:17:47,993][root][WARNING] - |Q. 100||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,993][root][WARNING] - |Q. 100||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:17:47,993][root][INFO] - |Q. 100||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,993][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:17:47,994][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,994][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:17:47,994][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,994][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:17:47,994][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,995][root][WARNING] - |Q. 36||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:17:47,995][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,995][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:17:47,995][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:17:47,996][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:17:47,996][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:17:47,996][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:17:47,997][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:17:48,002][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:17:48,003][root][INFO] - Saved parsed outputs
[2025-03-06 11:17:48,003][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:17:48,004][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:17:48,004][root][INFO] - Saved parsing metadata
[2025-03-06 11:17:48,004][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:17:48,006][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:17:48,007][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 11:17:48,029][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 11:17:48,029][root][INFO] - Summary of metrics : {'label_accuracy': 0.43434343434343436, 'misclassification_rate': 0.5656565656565656, 'combined_accuracy': 0.36363636363636365, 'malformed_label': 9, 'malformed_domain': 15, 'total_predictions': 99, 'correct_predictions': 43, 'correct_label_and_domain': 36, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 48, 'correct_label_wrong_domain': 7, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 11:17:57,587][root][INFO] - Setting global seed to 206
[2025-03-06 11:17:57,594][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 11:17:57,595][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 11:17:57,596][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 11:17:57,609][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 11:17:57,614][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 11:17:57,614][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 11:17:57,793][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 11:17:58,336][root][INFO] - Full model selected, loading model
[2025-03-06 11:18:23,036][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 11:18:23,054][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 11:18:31,307][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 11:18:31,308][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:18:31,308][root][INFO] - Starting inference
[2025-03-06 11:18:31,506][root][INFO] - Processing question number 0
[2025-03-06 11:18:31,509][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 11:18:37,980][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 11:18:46,289][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 11:18:57,175][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 11:19:07,526][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 11:19:15,740][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 11:19:26,679][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 11:19:34,541][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 11:19:44,214][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 11:19:52,071][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 11:19:58,237][root][INFO] - Processing question number 10
[2025-03-06 11:19:58,239][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 11:20:08,450][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 11:20:16,980][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 11:20:27,161][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 11:20:35,571][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 11:20:42,251][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 11:20:47,786][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 11:20:56,416][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 11:21:06,734][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 11:21:14,348][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 11:21:20,403][root][INFO] - Processing question number 20
[2025-03-06 11:21:20,405][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 11:21:28,390][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 11:21:36,415][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 11:21:43,316][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 11:21:51,487][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 11:22:01,227][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 11:22:09,231][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 11:22:16,658][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 11:22:26,352][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 11:22:36,588][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 11:22:43,409][root][INFO] - Processing question number 30
[2025-03-06 11:22:43,411][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 11:22:51,373][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 11:22:59,898][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 11:23:08,674][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 11:23:17,705][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 11:23:24,905][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 11:23:34,514][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 11:23:41,236][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 11:23:51,266][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 11:23:59,486][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 11:24:07,519][root][INFO] - Processing question number 40
[2025-03-06 11:24:07,522][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 11:24:15,071][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 11:24:23,364][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 11:24:33,404][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 11:24:41,180][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 11:24:48,356][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 11:24:56,484][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 11:25:04,436][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 11:25:11,901][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 11:25:20,836][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 11:25:27,612][root][INFO] - Processing question number 50
[2025-03-06 11:25:27,615][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 11:25:34,588][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 11:25:45,314][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 11:25:52,262][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 11:26:01,006][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 11:26:13,554][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 11:26:21,337][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 11:26:29,078][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 11:26:37,458][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 11:26:45,266][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 11:26:54,157][root][INFO] - Processing question number 60
[2025-03-06 11:26:54,160][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 11:27:06,150][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 11:27:16,157][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 11:27:26,786][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 11:27:35,557][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 11:27:46,601][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 11:27:56,734][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 11:28:03,219][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 11:28:12,705][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 11:28:18,854][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 11:28:32,184][root][INFO] - Processing question number 70
[2025-03-06 11:28:32,189][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 11:28:40,473][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 11:28:48,308][root][INFO] - Domain : Property, Question : 6
[2025-03-06 11:28:55,306][root][INFO] - Domain : Property, Question : 13
[2025-03-06 11:29:06,770][root][INFO] - Domain : Property, Question : 20
[2025-03-06 11:29:12,845][root][INFO] - Domain : Property, Question : 33
[2025-03-06 11:29:19,370][root][INFO] - Domain : Property, Question : 39
[2025-03-06 11:29:28,838][root][INFO] - Domain : Property, Question : 48
[2025-03-06 11:29:36,679][root][INFO] - Domain : Property, Question : 54
[2025-03-06 11:29:47,120][root][INFO] - Domain : Property, Question : 61
[2025-03-06 11:29:58,742][root][INFO] - Processing question number 80
[2025-03-06 11:29:58,747][root][INFO] - Domain : Property, Question : 67
[2025-03-06 11:30:05,805][root][INFO] - Domain : Property, Question : 75
[2025-03-06 11:30:16,671][root][INFO] - Domain : Property, Question : 83
[2025-03-06 11:30:26,511][root][INFO] - Domain : Property, Question : 89
[2025-03-06 11:30:35,475][root][INFO] - Domain : Property, Question : 97
[2025-03-06 11:30:43,491][root][INFO] - Domain : Property, Question : 100
[2025-03-06 11:30:53,320][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 11:31:02,297][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 11:31:09,591][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 11:31:18,907][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 11:31:26,779][root][INFO] - Processing question number 90
[2025-03-06 11:31:26,784][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 11:31:36,410][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 11:31:43,452][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 11:31:53,344][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 11:31:59,022][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 11:32:08,936][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 11:32:16,031][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 11:32:24,695][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 11:32:33,947][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 11:32:41,187][root][INFO] - Inference complete
[2025-03-06 11:32:41,188][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:32:41,193][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:32:41,204][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:32:41,209][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:32:41,209][root][INFO] - Saved parsed outputs
[2025-03-06 11:32:41,209][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:32:41,210][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:32:41,210][root][INFO] - Saved parsing metadata
[2025-03-06 11:32:41,211][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:32:41,212][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:32:41,213][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 11:32:41,236][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 11:32:41,236][root][INFO] - Summary of metrics : {'label_accuracy': 0.5959595959595959, 'misclassification_rate': 0.4040404040404041, 'combined_accuracy': 0.30303030303030304, 'malformed_label': 0, 'malformed_domain': 47, 'total_predictions': 99, 'correct_predictions': 59, 'correct_label_and_domain': 30, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.46153846153846156, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.25, 'Constitutional_Law_confidence': 0.0707070707070707, 'Contracts_confidence': 0.06060606060606061, 'Criminal_Law_confidence': 0.08080808080808081, 'Evidence_confidence': 0.10101010101010101, 'Real_Property_confidence': 0.0707070707070707, 'Torts_confidence': 0.10101010101010101, 'Civil_Procedure_confidence': 0.06060606060606061, 'correct_domain_wrong_label': 22, 'correct_label_wrong_domain': 29, 'both_wrong': 18}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 11:32:47,726][root][INFO] - Setting global seed to 206
[2025-03-06 11:32:47,731][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 11:32:47,731][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 11:32:47,732][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 11:32:47,734][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 11:32:47,737][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 11:32:47,737][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 11:32:47,906][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 11:32:48,479][root][INFO] - Full model selected, loading model
[2025-03-06 11:33:11,826][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 11:34:57,462][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 11:34:57,463][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 11:35:30,849][root][INFO] - Peft model loaded successfully
[2025-03-06 11:35:38,328][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 11:35:38,330][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:35:38,330][root][INFO] - Starting inference
[2025-03-06 11:35:38,538][root][INFO] - Processing question number 0
[2025-03-06 11:35:38,541][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 11:35:46,855][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 11:35:56,814][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 11:36:08,695][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 11:36:24,907][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 11:36:40,846][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 11:36:51,547][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 11:37:04,801][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 11:37:18,402][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 11:37:27,792][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 11:37:36,584][root][INFO] - Processing question number 10
[2025-03-06 11:37:36,586][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 11:37:46,343][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 11:37:58,121][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 11:38:07,074][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 11:38:17,302][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 11:38:25,979][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 11:38:35,083][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 11:38:46,179][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 11:38:53,999][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 11:39:03,001][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 11:39:10,827][root][INFO] - Processing question number 20
[2025-03-06 11:39:10,829][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 11:39:22,539][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 11:39:36,426][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 11:39:46,625][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 11:40:17,441][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 11:40:27,482][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 11:40:38,150][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 11:40:48,246][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 11:40:57,195][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 11:41:07,534][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 11:41:16,262][root][INFO] - Processing question number 30
[2025-03-06 11:41:16,264][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 11:41:25,859][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 11:41:39,325][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 11:41:55,053][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 11:42:03,844][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 11:42:13,417][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 11:42:30,958][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 11:42:41,289][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 11:42:54,271][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 11:43:19,709][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 11:43:33,438][root][INFO] - Processing question number 40
[2025-03-06 11:43:33,441][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 11:43:41,430][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 11:43:54,166][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 11:44:13,821][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 11:44:28,249][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 11:44:48,024][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 11:44:57,025][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 11:45:18,177][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 11:45:31,520][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 11:45:41,021][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 11:45:51,808][root][INFO] - Processing question number 50
[2025-03-06 11:45:51,811][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 11:46:01,402][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 11:46:32,710][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 11:46:41,239][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 11:46:57,933][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 11:47:07,039][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 11:47:27,824][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 11:47:38,535][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 11:47:45,551][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 11:47:59,068][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 11:48:08,218][root][INFO] - Processing question number 60
[2025-03-06 11:48:08,222][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 11:48:14,022][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 11:48:24,432][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 11:48:55,842][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 11:49:03,885][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 11:49:16,035][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 11:49:29,175][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 11:49:42,236][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 11:49:58,532][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 11:50:04,737][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 11:50:15,909][root][INFO] - Processing question number 70
[2025-03-06 11:50:15,914][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 11:50:46,938][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 11:51:02,755][root][INFO] - Domain : Property, Question : 6
[2025-03-06 11:51:12,866][root][INFO] - Domain : Property, Question : 13
[2025-03-06 11:51:21,833][root][INFO] - Domain : Property, Question : 20
[2025-03-06 11:51:31,488][root][INFO] - Domain : Property, Question : 33
[2025-03-06 11:51:44,580][root][INFO] - Domain : Property, Question : 39
[2025-03-06 11:52:09,452][root][INFO] - Domain : Property, Question : 48
[2025-03-06 11:52:21,901][root][INFO] - Domain : Property, Question : 54
[2025-03-06 11:52:32,396][root][INFO] - Domain : Property, Question : 61
[2025-03-06 11:52:43,579][root][INFO] - Processing question number 80
[2025-03-06 11:52:43,584][root][INFO] - Domain : Property, Question : 67
[2025-03-06 11:52:55,892][root][INFO] - Domain : Property, Question : 75
[2025-03-06 11:53:05,656][root][INFO] - Domain : Property, Question : 83
[2025-03-06 11:53:13,384][root][INFO] - Domain : Property, Question : 89
[2025-03-06 11:53:25,428][root][INFO] - Domain : Property, Question : 97
[2025-03-06 11:53:34,910][root][INFO] - Domain : Property, Question : 100
[2025-03-06 11:53:48,018][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 11:53:56,558][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 11:54:06,250][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 11:54:16,736][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 11:54:26,078][root][INFO] - Processing question number 90
[2025-03-06 11:54:26,083][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 11:54:42,030][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 11:54:49,661][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 11:55:06,796][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 11:55:13,290][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 11:55:26,812][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 11:55:34,701][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 11:55:42,884][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 11:55:54,792][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 11:56:08,488][root][INFO] - Inference complete
[2025-03-06 11:56:08,488][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:56:08,495][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:56:08,496][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 11:56:08,496][root][WARNING] - |Q. 21||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:56:08,497][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 11:56:08,497][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:56:08,497][root][WARNING] - |Q. 35||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 11:56:08,497][root][WARNING] - |Q. 35||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 11:56:08,497][root][INFO] - |Q. 35||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 11:56:08,498][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 11:56:08,498][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 11:56:08,498][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 11:56:08,499][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:56:08,499][root][WARNING] - |Q. 2||D: Constitutional_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 11:56:08,499][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:56:08,500][root][WARNING] - |Q. 55||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 11:56:08,501][root][WARNING] - |Q. 55||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:56:08,501][root][INFO] - |Q. 55||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 11:56:08,501][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:56:08,502][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:56:08,502][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 11:56:08,502][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:56:08,505][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 11:56:08,505][root][WARNING] - |Q. 62||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:56:08,505][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 11:56:08,505][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:56:08,507][root][WARNING] - |Q. 34||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:56:08,507][root][WARNING] - |Q. 34||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:56:08,507][root][INFO] - |Q. 34||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:56:08,507][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:56:08,508][root][WARNING] - |Q. 86||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 11:56:08,509][root][WARNING] - |Q. 86||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 11:56:08,509][root][INFO] - |Q. 86||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 11:56:08,509][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 11:56:08,513][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:56:08,518][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:56:08,518][root][INFO] - Saved parsed outputs
[2025-03-06 11:56:08,518][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:56:08,519][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:56:08,519][root][INFO] - Saved parsing metadata
[2025-03-06 11:56:08,520][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:56:08,521][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:56:08,523][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 11:56:08,530][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 11:56:08,530][root][INFO] - Summary of metrics : {'label_accuracy': 0.47474747474747475, 'misclassification_rate': 0.5252525252525253, 'combined_accuracy': 0.37373737373737376, 'malformed_label': 5, 'malformed_domain': 20, 'total_predictions': 99, 'correct_predictions': 47, 'correct_label_and_domain': 37, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.2857142857142857, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.2857142857142857, 'Torts_accuracy': 0.5384615384615384, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.1414141414141414, 'Criminal_Law_confidence': 0.10101010101010101, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.10101010101010101, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.13131313131313133, 'correct_domain_wrong_label': 42, 'correct_label_wrong_domain': 10, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 11:56:14,858][root][INFO] - Setting global seed to 206
[2025-03-06 11:56:14,863][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 11:56:14,863][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 11:56:14,865][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 11:56:14,866][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 11:56:14,868][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 11:56:14,868][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 11:56:15,035][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 11:56:15,665][root][INFO] - Full model selected, loading model
[2025-03-06 11:56:41,534][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 11:56:41,557][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 11:56:49,506][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 11:56:49,507][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 11:56:49,507][root][INFO] - Starting inference
[2025-03-06 11:56:49,717][root][INFO] - Processing question number 0
[2025-03-06 11:56:49,719][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 11:56:58,378][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 11:57:06,881][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 11:57:15,878][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 11:57:24,117][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 11:57:35,183][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 11:57:46,964][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 11:57:54,676][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 11:58:05,883][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 11:58:12,656][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 11:58:18,376][root][INFO] - Processing question number 10
[2025-03-06 11:58:18,378][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 11:58:26,892][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 11:58:35,167][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 11:58:41,494][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 11:58:48,254][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 11:58:55,323][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 11:59:04,316][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 11:59:14,855][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 11:59:22,447][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 11:59:30,897][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 11:59:38,171][root][INFO] - Processing question number 20
[2025-03-06 11:59:38,173][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 11:59:44,626][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 11:59:52,795][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 12:00:00,819][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 12:00:07,712][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 12:00:17,335][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 12:00:25,820][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 12:00:33,988][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 12:00:44,013][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 12:00:54,040][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 12:01:02,369][root][INFO] - Processing question number 30
[2025-03-06 12:01:02,372][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 12:01:10,969][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 12:01:20,341][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 12:01:31,411][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 12:01:39,351][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 12:01:46,793][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 12:01:54,793][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 12:02:03,826][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 12:02:14,078][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 12:02:22,585][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 12:02:30,533][root][INFO] - Processing question number 40
[2025-03-06 12:02:30,536][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 12:02:39,752][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 12:02:48,518][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 12:02:58,774][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 12:03:09,192][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 12:03:16,530][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 12:03:25,966][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 12:03:36,236][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 12:03:43,780][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 12:03:52,129][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 12:03:59,793][root][INFO] - Processing question number 50
[2025-03-06 12:03:59,796][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 12:04:08,966][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 12:04:17,348][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 12:04:25,721][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 12:04:33,051][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 12:04:43,337][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 12:04:53,556][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 12:05:03,901][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 12:05:13,113][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 12:05:22,169][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 12:05:30,500][root][INFO] - Processing question number 60
[2025-03-06 12:05:30,503][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 12:05:36,826][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:05:42,501][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 12:05:53,522][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 12:06:00,085][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 12:06:08,286][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 12:06:21,366][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 12:06:29,425][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 12:06:38,151][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:06:46,909][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 12:06:57,366][root][INFO] - Processing question number 70
[2025-03-06 12:06:57,370][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 12:07:03,777][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 12:07:10,573][root][INFO] - Domain : Property, Question : 6
[2025-03-06 12:07:16,387][root][INFO] - Domain : Property, Question : 13
[2025-03-06 12:07:23,748][root][INFO] - Domain : Property, Question : 20
[2025-03-06 12:07:32,242][root][INFO] - Domain : Property, Question : 33
[2025-03-06 12:07:39,888][root][INFO] - Domain : Property, Question : 39
[2025-03-06 12:07:49,653][root][INFO] - Domain : Property, Question : 48
[2025-03-06 12:07:59,129][root][INFO] - Domain : Property, Question : 54
[2025-03-06 12:08:07,357][root][INFO] - Domain : Property, Question : 61
[2025-03-06 12:08:18,218][root][INFO] - Processing question number 80
[2025-03-06 12:08:18,223][root][INFO] - Domain : Property, Question : 67
[2025-03-06 12:08:25,226][root][INFO] - Domain : Property, Question : 75
[2025-03-06 12:08:35,827][root][INFO] - Domain : Property, Question : 83
[2025-03-06 12:08:43,395][root][INFO] - Domain : Property, Question : 89
[2025-03-06 12:08:50,977][root][INFO] - Domain : Property, Question : 97
[2025-03-06 12:09:00,290][root][INFO] - Domain : Property, Question : 100
[2025-03-06 12:09:09,015][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 12:09:17,781][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 12:09:25,023][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 12:09:34,078][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 12:09:41,604][root][INFO] - Processing question number 90
[2025-03-06 12:09:41,608][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 12:09:48,870][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 12:09:57,549][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 12:10:06,001][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 12:10:12,583][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 12:10:21,388][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 12:10:28,971][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 12:10:36,792][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 12:10:45,639][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 12:10:56,631][root][INFO] - Inference complete
[2025-03-06 12:10:56,631][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:10:56,637][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:10:56,645][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:10:56,646][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:10:56,646][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:10:56,648][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:10:56,653][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:10:56,653][root][INFO] - Saved parsed outputs
[2025-03-06 12:10:56,653][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:10:56,655][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:10:56,655][root][INFO] - Saved parsing metadata
[2025-03-06 12:10:56,655][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:10:56,657][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:10:56,658][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 12:10:56,686][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 12:10:56,686][root][INFO] - Summary of metrics : {'label_accuracy': 0.5959595959595959, 'misclassification_rate': 0.4040404040404041, 'combined_accuracy': 0.24242424242424243, 'malformed_label': 0, 'malformed_domain': 54, 'total_predictions': 99, 'correct_predictions': 59, 'correct_label_and_domain': 24, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.14285714285714285, 'Torts_accuracy': 0.07692307692307693, 'Civil_Procedure_accuracy': 0.0625, 'Constitutional_Law_confidence': 0.08080808080808081, 'Contracts_confidence': 0.030303030303030304, 'Criminal_Law_confidence': 0.08080808080808081, 'Evidence_confidence': 0.08080808080808081, 'Real_Property_confidence': 0.06060606060606061, 'Torts_confidence': 0.09090909090909091, 'Civil_Procedure_confidence': 0.04040404040404041, 'correct_domain_wrong_label': 21, 'correct_label_wrong_domain': 35, 'both_wrong': 19}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 12:11:03,711][root][INFO] - Setting global seed to 989
[2025-03-06 12:11:03,718][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 12:11:03,719][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 12:11:03,720][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 12:11:03,722][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 12:11:03,725][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 12:11:03,725][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 12:11:03,883][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 12:11:04,423][root][INFO] - Full model selected, loading model
[2025-03-06 12:11:31,436][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 12:13:15,944][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 12:13:15,944][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 12:13:52,031][root][INFO] - Peft model loaded successfully
[2025-03-06 12:13:59,668][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 12:13:59,670][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:13:59,670][root][INFO] - Starting inference
[2025-03-06 12:13:59,918][root][INFO] - Processing question number 0
[2025-03-06 12:13:59,920][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 12:14:08,432][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 12:14:18,601][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 12:14:31,220][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 12:14:41,667][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 12:14:52,930][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 12:15:09,637][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 12:15:18,824][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 12:15:33,655][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 12:15:45,451][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 12:15:53,772][root][INFO] - Processing question number 10
[2025-03-06 12:15:53,774][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 12:16:03,093][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 12:16:16,530][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 12:16:25,744][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 12:16:57,014][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 12:17:04,377][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 12:17:11,260][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 12:17:41,624][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 12:17:47,577][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 12:17:54,886][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 12:18:09,080][root][INFO] - Processing question number 20
[2025-03-06 12:18:09,082][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 12:18:20,778][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 12:18:32,291][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 12:18:42,299][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 12:18:52,888][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 12:19:04,722][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 12:19:12,798][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 12:19:21,256][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 12:19:33,871][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 12:19:44,462][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 12:19:52,335][root][INFO] - Processing question number 30
[2025-03-06 12:19:52,338][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 12:20:23,247][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 12:20:31,405][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 12:20:43,132][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 12:20:54,789][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 12:21:02,176][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 12:21:11,615][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 12:21:21,852][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 12:21:52,917][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 12:22:05,123][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 12:22:14,764][root][INFO] - Processing question number 40
[2025-03-06 12:22:14,767][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 12:22:23,029][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 12:22:33,954][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 12:22:53,946][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 12:23:10,075][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 12:23:17,747][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 12:23:29,885][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 12:23:39,877][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 12:23:49,152][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 12:23:55,390][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 12:24:04,846][root][INFO] - Processing question number 50
[2025-03-06 12:24:04,850][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 12:24:36,324][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 12:25:07,333][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 12:25:37,676][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 12:26:09,363][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 12:26:19,376][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 12:26:31,359][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 12:26:40,679][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 12:26:55,125][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 12:27:07,823][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 12:27:19,211][root][INFO] - Processing question number 60
[2025-03-06 12:27:19,215][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 12:27:26,173][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:27:34,678][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 12:27:45,068][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 12:27:52,651][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 12:28:07,384][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 12:28:38,280][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 12:28:47,063][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 12:29:18,082][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:29:27,770][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 12:29:39,883][root][INFO] - Processing question number 70
[2025-03-06 12:29:39,888][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 12:30:01,176][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 12:30:12,770][root][INFO] - Domain : Property, Question : 6
[2025-03-06 12:30:21,073][root][INFO] - Domain : Property, Question : 13
[2025-03-06 12:30:32,093][root][INFO] - Domain : Property, Question : 20
[2025-03-06 12:30:45,703][root][INFO] - Domain : Property, Question : 33
[2025-03-06 12:31:16,288][root][INFO] - Domain : Property, Question : 39
[2025-03-06 12:31:47,556][root][INFO] - Domain : Property, Question : 48
[2025-03-06 12:31:57,256][root][INFO] - Domain : Property, Question : 54
[2025-03-06 12:32:05,764][root][INFO] - Domain : Property, Question : 61
[2025-03-06 12:32:24,748][root][INFO] - Processing question number 80
[2025-03-06 12:32:24,753][root][INFO] - Domain : Property, Question : 67
[2025-03-06 12:32:35,856][root][INFO] - Domain : Property, Question : 75
[2025-03-06 12:32:47,365][root][INFO] - Domain : Property, Question : 83
[2025-03-06 12:32:58,543][root][INFO] - Domain : Property, Question : 89
[2025-03-06 12:33:09,341][root][INFO] - Domain : Property, Question : 97
[2025-03-06 12:33:40,614][root][INFO] - Domain : Property, Question : 100
[2025-03-06 12:33:53,314][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 12:34:01,828][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 12:34:11,555][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 12:34:42,520][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 12:34:54,026][root][INFO] - Processing question number 90
[2025-03-06 12:34:54,031][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 12:35:25,496][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 12:35:33,907][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 12:36:04,719][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 12:36:19,276][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 12:36:30,167][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 12:36:42,709][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 12:36:51,111][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 12:37:02,708][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 12:37:33,325][root][INFO] - Inference complete
[2025-03-06 12:37:33,325][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:37:33,331][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:37:33,332][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,332][root][WARNING] - |Q. 7||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:37:33,333][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,333][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,334][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:37:33,334][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,334][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,334][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 12:37:33,335][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,335][root][WARNING] - |Q. 84||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,335][root][WARNING] - |Q. 84||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,336][root][INFO] - |Q. 84||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,336][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,336][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,337][root][WARNING] - |Q. 2||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,337][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,337][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,339][root][WARNING] - |Q. 3||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,339][root][WARNING] - |Q. 3||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,339][root][INFO] - |Q. 3||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,339][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,340][root][WARNING] - |Q. 51||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,340][root][WARNING] - |Q. 51||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,340][root][INFO] - |Q. 51||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,340][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,342][root][WARNING] - |Q. 52||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,342][root][WARNING] - |Q. 52||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,343][root][INFO] - |Q. 52||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,343][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,343][root][WARNING] - |Q. 62||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,343][root][WARNING] - |Q. 62||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,343][root][INFO] - |Q. 62||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,343][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,344][root][WARNING] - |Q. 76||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,344][root][WARNING] - |Q. 76||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,344][root][INFO] - |Q. 76||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,344][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,344][root][WARNING] - |Q. 82||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,345][root][WARNING] - |Q. 82||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,345][root][INFO] - |Q. 82||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,345][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,346][root][WARNING] - |Q. 53||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,347][root][WARNING] - |Q. 53||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,347][root][INFO] - |Q. 53||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,347][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,347][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,348][root][WARNING] - |Q. 68||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,348][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,348][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,349][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,350][root][WARNING] - |Q. 33||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,350][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,350][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,350][root][WARNING] - |Q. 39||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,350][root][WARNING] - |Q. 39||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,350][root][INFO] - |Q. 39||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,350][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,351][root][WARNING] - |Q. 97||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,352][root][WARNING] - |Q. 97||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,352][root][INFO] - |Q. 97||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,352][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,352][root][WARNING] - |Q. 26||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,353][root][WARNING] - |Q. 26||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,353][root][INFO] - |Q. 26||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,353][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,353][root][WARNING] - |Q. 36||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,354][root][WARNING] - |Q. 36||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,354][root][INFO] - |Q. 36||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,354][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,354][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 12:37:33,354][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 12:37:33,354][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 12:37:33,355][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 12:37:33,356][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:37:33,361][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:37:33,361][root][INFO] - Saved parsed outputs
[2025-03-06 12:37:33,362][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:37:33,363][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:37:33,363][root][INFO] - Saved parsing metadata
[2025-03-06 12:37:33,364][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:37:33,365][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:37:33,377][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 12:37:33,386][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 12:37:33,386][root][INFO] - Summary of metrics : {'label_accuracy': 0.45454545454545453, 'misclassification_rate': 0.5454545454545454, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 16, 'malformed_domain': 14, 'total_predictions': 99, 'correct_predictions': 45, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.4666666666666667, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.1111111111111111, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 47, 'correct_label_wrong_domain': 7, 'both_wrong': 7}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 12:37:40,031][root][INFO] - Setting global seed to 989
[2025-03-06 12:37:40,037][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 12:37:40,037][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 12:37:40,038][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 12:37:40,040][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 12:37:40,042][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 12:37:40,042][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 12:37:40,200][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 12:37:40,802][root][INFO] - Full model selected, loading model
[2025-03-06 12:38:06,433][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 12:38:06,443][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 12:38:14,495][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 12:38:14,497][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:38:14,497][root][INFO] - Starting inference
[2025-03-06 12:38:14,698][root][INFO] - Processing question number 0
[2025-03-06 12:38:14,700][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 12:38:21,084][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 12:38:29,898][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 12:38:41,681][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 12:38:48,448][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 12:38:56,277][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 12:39:05,096][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 12:39:12,826][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 12:39:22,955][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 12:39:30,214][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 12:39:45,313][root][INFO] - Processing question number 10
[2025-03-06 12:39:45,315][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 12:39:52,949][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 12:40:00,191][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 12:40:07,203][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 12:40:13,863][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 12:40:20,539][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 12:40:26,751][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 12:40:35,461][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 12:40:43,533][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 12:40:49,041][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 12:40:55,339][root][INFO] - Processing question number 20
[2025-03-06 12:40:55,341][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 12:41:08,778][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 12:41:16,639][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 12:41:24,070][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 12:41:43,388][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 12:41:52,490][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 12:42:04,604][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 12:42:10,775][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 12:42:20,182][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 12:42:28,754][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 12:42:37,559][root][INFO] - Processing question number 30
[2025-03-06 12:42:37,561][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 12:42:46,385][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 12:42:53,355][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 12:43:04,190][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 12:43:13,342][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 12:43:20,139][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 12:43:26,994][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 12:43:34,782][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 12:43:43,663][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 12:43:51,126][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 12:44:00,862][root][INFO] - Processing question number 40
[2025-03-06 12:44:00,865][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 12:44:08,686][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 12:44:16,257][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 12:44:28,437][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 12:44:36,434][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 12:44:47,874][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 12:44:57,829][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 12:45:06,609][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 12:45:15,740][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 12:45:23,050][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 12:45:31,103][root][INFO] - Processing question number 50
[2025-03-06 12:45:31,106][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 12:45:40,555][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 12:45:50,704][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 12:45:58,577][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 12:46:06,000][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 12:46:17,098][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 12:46:23,954][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 12:46:33,421][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 12:46:38,829][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 12:46:44,853][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 12:46:53,069][root][INFO] - Processing question number 60
[2025-03-06 12:46:53,073][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 12:46:59,543][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 12:47:08,732][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 12:47:20,615][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 12:47:25,975][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 12:47:33,233][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 12:47:42,889][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 12:47:50,009][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 12:47:58,673][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 12:48:05,951][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 12:48:15,383][root][INFO] - Processing question number 70
[2025-03-06 12:48:15,387][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 12:48:22,580][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 12:48:29,427][root][INFO] - Domain : Property, Question : 6
[2025-03-06 12:48:36,368][root][INFO] - Domain : Property, Question : 13
[2025-03-06 12:48:52,715][root][INFO] - Domain : Property, Question : 20
[2025-03-06 12:49:00,550][root][INFO] - Domain : Property, Question : 33
[2025-03-06 12:49:09,697][root][INFO] - Domain : Property, Question : 39
[2025-03-06 12:49:20,433][root][INFO] - Domain : Property, Question : 48
[2025-03-06 12:49:30,930][root][INFO] - Domain : Property, Question : 54
[2025-03-06 12:49:39,092][root][INFO] - Domain : Property, Question : 61
[2025-03-06 12:49:49,529][root][INFO] - Processing question number 80
[2025-03-06 12:49:49,533][root][INFO] - Domain : Property, Question : 67
[2025-03-06 12:49:58,600][root][INFO] - Domain : Property, Question : 75
[2025-03-06 12:50:10,364][root][INFO] - Domain : Property, Question : 83
[2025-03-06 12:50:21,152][root][INFO] - Domain : Property, Question : 89
[2025-03-06 12:50:28,338][root][INFO] - Domain : Property, Question : 97
[2025-03-06 12:50:36,835][root][INFO] - Domain : Property, Question : 100
[2025-03-06 12:50:47,182][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 12:50:57,127][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 12:51:05,734][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 12:51:13,938][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 12:51:23,550][root][INFO] - Processing question number 90
[2025-03-06 12:51:23,555][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 12:51:32,500][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 12:51:39,533][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 12:51:50,030][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 12:51:57,286][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 12:52:05,824][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 12:52:11,994][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 12:52:22,105][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 12:52:30,498][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 12:52:40,358][root][INFO] - Inference complete
[2025-03-06 12:52:40,358][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:52:40,364][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:52:40,375][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:52:40,380][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:52:40,380][root][INFO] - Saved parsed outputs
[2025-03-06 12:52:40,380][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:52:40,382][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:52:40,382][root][INFO] - Saved parsing metadata
[2025-03-06 12:52:40,382][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:52:40,384][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:52:40,385][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 12:52:40,417][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 12:52:40,417][root][INFO] - Summary of metrics : {'label_accuracy': 0.6060606060606061, 'misclassification_rate': 0.3939393939393939, 'combined_accuracy': 0.35353535353535354, 'malformed_label': 0, 'malformed_domain': 46, 'total_predictions': 99, 'correct_predictions': 60, 'correct_label_and_domain': 35, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.14285714285714285, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.5384615384615384, 'Civil_Procedure_accuracy': 0.375, 'Constitutional_Law_confidence': 0.050505050505050504, 'Contracts_confidence': 0.050505050505050504, 'Criminal_Law_confidence': 0.08080808080808081, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.09090909090909091, 'Torts_confidence': 0.10101010101010101, 'Civil_Procedure_confidence': 0.06060606060606061, 'correct_domain_wrong_label': 18, 'correct_label_wrong_domain': 25, 'both_wrong': 21}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 12:52:48,373][root][INFO] - Setting global seed to 989
[2025-03-06 12:52:48,381][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 12:52:48,381][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 12:52:48,382][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 12:52:48,384][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 12:52:48,387][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 12:52:48,387][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 12:52:48,539][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 12:52:49,088][root][INFO] - Full model selected, loading model
[2025-03-06 12:53:07,461][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 12:54:52,656][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 12:54:52,656][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 12:55:28,176][root][INFO] - Peft model loaded successfully
[2025-03-06 12:55:35,717][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 12:55:35,718][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 12:55:35,718][root][INFO] - Starting inference
[2025-03-06 12:55:35,929][root][INFO] - Processing question number 0
[2025-03-06 12:55:35,931][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 12:55:46,014][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 12:56:01,428][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 12:56:12,363][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 12:56:43,685][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 12:56:56,961][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 12:57:12,221][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 12:57:25,159][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 12:57:36,648][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 12:57:45,589][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 12:57:52,351][root][INFO] - Processing question number 10
[2025-03-06 12:57:52,353][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 12:58:03,448][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 12:58:17,612][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 12:58:25,331][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 12:58:36,510][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 12:58:50,061][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 12:59:03,409][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 12:59:34,058][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 12:59:42,123][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 12:59:50,581][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 13:00:04,960][root][INFO] - Processing question number 20
[2025-03-06 13:00:04,972][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 13:00:16,731][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 13:00:29,556][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 13:00:43,217][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 13:00:55,235][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 13:01:05,221][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 13:01:13,075][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 13:01:22,868][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 13:01:39,781][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 13:01:50,614][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 13:02:00,427][root][INFO] - Processing question number 30
[2025-03-06 13:02:00,439][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 13:02:11,883][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 13:02:18,418][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 13:02:30,557][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 13:02:41,220][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 13:02:51,482][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 13:03:03,213][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 13:03:14,137][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 13:03:25,354][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 13:03:33,575][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 13:03:48,279][root][INFO] - Processing question number 40
[2025-03-06 13:03:48,282][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 13:03:58,712][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 13:04:13,913][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 13:04:27,866][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 13:04:36,389][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 13:05:07,388][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 13:05:20,075][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 13:05:31,843][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 13:05:43,021][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 13:05:52,319][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 13:06:03,050][root][INFO] - Processing question number 50
[2025-03-06 13:06:03,053][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 13:06:16,552][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 13:06:30,714][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 13:06:41,747][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 13:06:54,269][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 13:07:05,263][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 13:07:16,137][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 13:07:24,051][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 13:07:32,411][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 13:07:47,911][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 13:08:05,367][root][INFO] - Processing question number 60
[2025-03-06 13:08:05,371][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 13:08:12,977][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 13:08:43,979][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 13:08:57,431][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 13:09:05,082][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 13:09:27,049][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 13:09:38,184][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 13:09:47,837][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 13:10:19,132][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 13:10:29,502][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 13:10:44,358][root][INFO] - Processing question number 70
[2025-03-06 13:10:44,362][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 13:10:59,833][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 13:11:13,235][root][INFO] - Domain : Property, Question : 6
[2025-03-06 13:11:19,306][root][INFO] - Domain : Property, Question : 13
[2025-03-06 13:11:34,567][root][INFO] - Domain : Property, Question : 20
[2025-03-06 13:11:48,041][root][INFO] - Domain : Property, Question : 33
[2025-03-06 13:12:18,908][root][INFO] - Domain : Property, Question : 39
[2025-03-06 13:12:48,117][root][INFO] - Domain : Property, Question : 48
[2025-03-06 13:12:56,857][root][INFO] - Domain : Property, Question : 54
[2025-03-06 13:13:04,594][root][INFO] - Domain : Property, Question : 61
[2025-03-06 13:13:21,503][root][INFO] - Processing question number 80
[2025-03-06 13:13:21,507][root][INFO] - Domain : Property, Question : 67
[2025-03-06 13:13:34,118][root][INFO] - Domain : Property, Question : 75
[2025-03-06 13:13:49,174][root][INFO] - Domain : Property, Question : 83
[2025-03-06 13:13:59,166][root][INFO] - Domain : Property, Question : 89
[2025-03-06 13:14:13,968][root][INFO] - Domain : Property, Question : 97
[2025-03-06 13:14:29,718][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:14:41,864][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 13:14:49,950][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:14:57,498][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 13:15:12,491][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 13:15:21,546][root][INFO] - Processing question number 90
[2025-03-06 13:15:21,551][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 13:15:32,903][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 13:16:03,295][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 13:16:34,394][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 13:16:44,895][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:16:59,635][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 13:17:11,856][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 13:17:26,453][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 13:17:57,658][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 13:18:08,479][root][INFO] - Inference complete
[2025-03-06 13:18:08,479][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:18:08,485][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:18:08,487][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,487][root][WARNING] - |Q. 7||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,488][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,488][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,488][root][WARNING] - |Q. 21||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,488][root][WARNING] - |Q. 21||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,489][root][INFO] - |Q. 21||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,489][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,489][root][WARNING] - |Q. 49||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,489][root][WARNING] - |Q. 49||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:18:08,490][root][INFO] - |Q. 49||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,490][root][WARNING] - |Q. 70||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,490][root][WARNING] - |Q. 70||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:18:08,490][root][INFO] - |Q. 70||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,491][root][WARNING] - |Q. 2||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,491][root][WARNING] - |Q. 2||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,491][root][INFO] - |Q. 2||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,492][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,495][root][WARNING] - |Q. 4||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,495][root][WARNING] - |Q. 4||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,495][root][INFO] - |Q. 4||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,495][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,497][root][WARNING] - |Q. 31||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,498][root][WARNING] - |Q. 31||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,498][root][INFO] - |Q. 31||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,498][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,499][root][WARNING] - |Q. 68||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,499][root][WARNING] - |Q. 68||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,499][root][INFO] - |Q. 68||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,499][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,500][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,501][root][WARNING] - |Q. 33||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,501][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,501][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,503][root][WARNING] - |Q. 45||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,503][root][WARNING] - |Q. 45||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,503][root][INFO] - |Q. 45||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,503][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,504][root][WARNING] - |Q. 50||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,504][root][WARNING] - |Q. 50||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,504][root][INFO] - |Q. 50||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,504][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,505][root][WARNING] - |Q. 85||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:18:08,505][root][WARNING] - |Q. 85||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:18:08,505][root][INFO] - |Q. 85||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:18:08,505][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:18:08,506][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:18:08,512][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:18:08,512][root][INFO] - Saved parsed outputs
[2025-03-06 13:18:08,512][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:18:08,513][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:18:08,513][root][INFO] - Saved parsing metadata
[2025-03-06 13:18:08,514][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:18:08,516][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:18:08,519][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 13:18:08,546][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 13:18:08,547][root][INFO] - Summary of metrics : {'label_accuracy': 0.45454545454545453, 'misclassification_rate': 0.5454545454545454, 'combined_accuracy': 0.3838383838383838, 'malformed_label': 10, 'malformed_domain': 13, 'total_predictions': 99, 'correct_predictions': 45, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.3076923076923077, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.5, 'Torts_accuracy': 0.46153846153846156, 'Civil_Procedure_accuracy': 0.3125, 'Constitutional_Law_confidence': 0.13131313131313133, 'Contracts_confidence': 0.15151515151515152, 'Criminal_Law_confidence': 0.10101010101010101, 'Evidence_confidence': 0.12121212121212122, 'Real_Property_confidence': 0.1111111111111111, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 48, 'correct_label_wrong_domain': 7, 'both_wrong': 6}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 13:18:15,522][root][INFO] - Setting global seed to 989
[2025-03-06 13:18:15,527][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 13:18:15,528][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 13:18:15,529][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 13:18:15,549][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:18:15,551][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:18:15,551][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 13:18:15,707][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 13:18:16,350][root][INFO] - Full model selected, loading model
[2025-03-06 13:18:39,893][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 13:18:39,910][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 13:18:47,880][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 13:18:47,882][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:18:47,882][root][INFO] - Starting inference
[2025-03-06 13:18:48,103][root][INFO] - Processing question number 0
[2025-03-06 13:18:48,108][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 13:18:56,177][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 13:19:03,534][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 13:19:11,940][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 13:19:21,075][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 13:19:27,905][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 13:19:36,808][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 13:19:44,663][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 13:19:52,302][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 13:19:59,953][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 13:20:09,282][root][INFO] - Processing question number 10
[2025-03-06 13:20:09,285][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 13:20:16,311][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 13:20:23,752][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 13:20:31,848][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 13:20:39,950][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 13:20:46,919][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 13:20:53,755][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 13:21:01,932][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 13:21:08,389][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 13:21:14,423][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 13:21:26,976][root][INFO] - Processing question number 20
[2025-03-06 13:21:26,978][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 13:21:37,322][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 13:21:45,141][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 13:21:53,994][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 13:22:02,938][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 13:22:11,413][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 13:22:20,878][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 13:22:28,745][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 13:22:39,460][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 13:22:47,008][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 13:22:55,630][root][INFO] - Processing question number 30
[2025-03-06 13:22:55,633][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 13:23:04,075][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 13:23:13,794][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 13:23:26,862][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 13:23:37,707][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 13:23:44,944][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 13:23:52,593][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 13:24:01,125][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 13:24:10,819][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 13:24:17,449][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 13:24:27,154][root][INFO] - Processing question number 40
[2025-03-06 13:24:27,157][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 13:24:36,817][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 13:24:44,539][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 13:24:54,445][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 13:25:03,401][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 13:25:14,379][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 13:25:21,790][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 13:25:31,851][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 13:25:41,885][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 13:25:49,491][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 13:25:56,803][root][INFO] - Processing question number 50
[2025-03-06 13:25:56,811][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 13:26:06,381][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 13:26:16,006][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 13:26:24,082][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 13:26:33,523][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 13:26:45,754][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 13:26:52,948][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 13:27:00,276][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 13:27:07,523][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 13:27:22,422][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 13:27:28,235][root][INFO] - Processing question number 60
[2025-03-06 13:27:28,239][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 13:27:33,782][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 13:27:44,668][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 13:27:52,682][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 13:27:59,582][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 13:28:07,484][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 13:28:18,056][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 13:28:22,962][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 13:28:31,339][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 13:28:38,221][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 13:28:47,274][root][INFO] - Processing question number 70
[2025-03-06 13:28:47,278][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 13:28:56,489][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 13:29:04,071][root][INFO] - Domain : Property, Question : 6
[2025-03-06 13:29:10,620][root][INFO] - Domain : Property, Question : 13
[2025-03-06 13:29:20,469][root][INFO] - Domain : Property, Question : 20
[2025-03-06 13:29:28,959][root][INFO] - Domain : Property, Question : 33
[2025-03-06 13:29:38,810][root][INFO] - Domain : Property, Question : 39
[2025-03-06 13:29:48,817][root][INFO] - Domain : Property, Question : 48
[2025-03-06 13:29:58,340][root][INFO] - Domain : Property, Question : 54
[2025-03-06 13:30:05,364][root][INFO] - Domain : Property, Question : 61
[2025-03-06 13:30:15,726][root][INFO] - Processing question number 80
[2025-03-06 13:30:15,731][root][INFO] - Domain : Property, Question : 67
[2025-03-06 13:30:23,278][root][INFO] - Domain : Property, Question : 75
[2025-03-06 13:30:31,776][root][INFO] - Domain : Property, Question : 83
[2025-03-06 13:30:42,343][root][INFO] - Domain : Property, Question : 89
[2025-03-06 13:30:53,615][root][INFO] - Domain : Property, Question : 97
[2025-03-06 13:31:02,471][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:31:11,191][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 13:31:19,801][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:31:27,732][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 13:31:37,083][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 13:31:47,007][root][INFO] - Processing question number 90
[2025-03-06 13:31:47,014][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 13:31:54,472][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 13:32:01,651][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 13:32:10,195][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 13:32:15,185][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:32:23,837][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 13:32:29,855][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 13:32:38,952][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 13:32:52,141][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 13:33:00,767][root][INFO] - Inference complete
[2025-03-06 13:33:00,767][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:33:00,773][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:33:00,777][root][WARNING] - |Q. 8||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 13:33:00,777][root][WARNING] - |Q. 8||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:33:00,777][root][INFO] - |Q. 8||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 13:33:00,784][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:33:00,789][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:33:00,789][root][INFO] - Saved parsed outputs
[2025-03-06 13:33:00,789][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:33:00,791][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:33:00,791][root][INFO] - Saved parsing metadata
[2025-03-06 13:33:00,792][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:33:00,793][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:33:00,794][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 13:33:00,827][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 13:33:00,827][root][INFO] - Summary of metrics : {'label_accuracy': 0.5454545454545454, 'misclassification_rate': 0.4545454545454546, 'combined_accuracy': 0.24242424242424243, 'malformed_label': 0, 'malformed_domain': 54, 'total_predictions': 99, 'correct_predictions': 54, 'correct_label_and_domain': 24, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.0, 'Criminal_Law_accuracy': 0.38461538461538464, 'Evidence_accuracy': 0.5333333333333333, 'Real_Property_accuracy': 0.14285714285714285, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.06060606060606061, 'Contracts_confidence': 0.04040404040404041, 'Criminal_Law_confidence': 0.0707070707070707, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.0707070707070707, 'Torts_confidence': 0.08080808080808081, 'Civil_Procedure_confidence': 0.050505050505050504, 'correct_domain_wrong_label': 21, 'correct_label_wrong_domain': 30, 'both_wrong': 24}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 13:33:08,944][root][INFO] - Setting global seed to 989
[2025-03-06 13:33:08,951][root][INFO] - Running evaluation of the trained model on the test_set_1
[2025-03-06 13:33:08,952][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 13:33:08,953][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 13:33:08,992][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:33:08,996][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:33:08,996][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 13:33:09,172][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 13:33:09,798][root][INFO] - Full model selected, loading model
[2025-03-06 13:33:30,731][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 13:35:15,903][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 13:35:15,903][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 13:35:55,119][root][INFO] - Peft model loaded successfully
[2025-03-06 13:36:02,923][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 13:36:02,925][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:36:02,925][root][INFO] - Starting inference
[2025-03-06 13:36:03,155][root][INFO] - Processing question number 0
[2025-03-06 13:36:03,157][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 13:36:11,415][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 13:36:20,087][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 13:36:31,185][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 13:36:44,306][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 13:37:02,264][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 13:37:12,967][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 13:37:29,397][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 13:37:43,806][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 13:37:53,841][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 13:38:06,303][root][INFO] - Processing question number 10
[2025-03-06 13:38:06,305][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 13:38:16,117][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 13:38:30,087][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 13:38:41,875][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 13:38:51,805][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 13:39:05,360][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 13:39:17,865][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 13:39:31,589][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 13:39:38,536][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 13:40:09,859][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 13:40:25,159][root][INFO] - Processing question number 20
[2025-03-06 13:40:25,162][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 13:40:37,620][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 13:40:52,651][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 13:40:59,315][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 13:41:04,126][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 13:41:14,506][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 13:41:26,088][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 13:41:39,392][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 13:41:51,129][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 13:42:06,191][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 13:42:13,499][root][INFO] - Processing question number 30
[2025-03-06 13:42:13,502][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 13:42:24,698][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 13:42:32,875][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 13:42:45,822][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 13:43:06,448][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 13:43:13,359][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 13:43:28,391][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 13:43:38,572][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 13:43:51,045][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 13:44:02,156][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 13:44:11,825][root][INFO] - Processing question number 40
[2025-03-06 13:44:11,844][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 13:44:19,789][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 13:44:35,143][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 13:44:51,307][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 13:44:59,228][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 13:45:10,831][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 13:45:21,582][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 13:45:31,663][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 13:45:39,703][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 13:45:46,586][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 13:45:53,069][root][INFO] - Processing question number 50
[2025-03-06 13:45:53,072][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 13:46:19,916][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 13:46:33,174][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 13:46:40,233][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 13:46:51,736][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 13:47:01,089][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 13:47:10,679][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 13:47:20,488][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 13:47:29,073][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 13:47:45,346][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 13:47:52,431][root][INFO] - Processing question number 60
[2025-03-06 13:47:52,435][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 13:47:58,186][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 13:48:06,921][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 13:48:19,364][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 13:48:27,213][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 13:48:38,811][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 13:49:00,972][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 13:49:17,677][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 13:49:41,919][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 13:49:51,938][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 13:50:23,312][root][INFO] - Processing question number 70
[2025-03-06 13:50:23,316][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 13:50:36,932][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 13:50:45,758][root][INFO] - Domain : Property, Question : 6
[2025-03-06 13:50:56,613][root][INFO] - Domain : Property, Question : 13
[2025-03-06 13:51:14,130][root][INFO] - Domain : Property, Question : 20
[2025-03-06 13:51:23,478][root][INFO] - Domain : Property, Question : 33
[2025-03-06 13:51:54,344][root][INFO] - Domain : Property, Question : 39
[2025-03-06 13:52:13,749][root][INFO] - Domain : Property, Question : 48
[2025-03-06 13:52:25,998][root][INFO] - Domain : Property, Question : 54
[2025-03-06 13:52:32,991][root][INFO] - Domain : Property, Question : 61
[2025-03-06 13:52:47,532][root][INFO] - Processing question number 80
[2025-03-06 13:52:47,537][root][INFO] - Domain : Property, Question : 67
[2025-03-06 13:53:01,308][root][INFO] - Domain : Property, Question : 75
[2025-03-06 13:53:11,875][root][INFO] - Domain : Property, Question : 83
[2025-03-06 13:53:23,057][root][INFO] - Domain : Property, Question : 89
[2025-03-06 13:53:32,228][root][INFO] - Domain : Property, Question : 97
[2025-03-06 13:53:42,658][root][INFO] - Domain : Property, Question : 100
[2025-03-06 13:53:53,551][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 13:54:01,739][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 13:54:12,348][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 13:54:22,419][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 13:54:34,286][root][INFO] - Processing question number 90
[2025-03-06 13:54:34,291][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 13:54:47,379][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 13:54:59,360][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 13:55:27,194][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 13:55:37,985][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 13:55:52,475][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 13:56:02,722][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 13:56:11,937][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 13:56:26,509][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 13:56:39,194][root][INFO] - Inference complete
[2025-03-06 13:56:39,194][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:56:39,201][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:56:39,202][root][WARNING] - |Q. 7||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:56:39,203][root][WARNING] - |Q. 7||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:56:39,203][root][INFO] - |Q. 7||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:56:39,203][root][WARNING] - |Q. 14||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 13:56:39,203][root][WARNING] - |Q. 14||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:56:39,203][root][INFO] - |Q. 14||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 13:56:39,205][root][WARNING] - |Q. 17||D: Constitutional_law| has broken JSON output. Attempting to fix it.
[2025-03-06 13:56:39,206][root][WARNING] - |Q. 17||D: Constitutional_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:56:39,206][root][INFO] - |Q. 17||D: Constitutional_law| was made valid into Valid json. Extracting responses.
[2025-03-06 13:56:39,206][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:56:39,212][root][WARNING] - |Q. 78||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 13:56:39,213][root][WARNING] - |Q. 78||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:56:39,213][root][INFO] - |Q. 78||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 13:56:39,213][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:56:39,214][root][WARNING] - |Q. 33||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:56:39,214][root][WARNING] - |Q. 33||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 13:56:39,214][root][INFO] - |Q. 33||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:56:39,214][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 13:56:39,215][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 13:56:39,215][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 13:56:39,215][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 13:56:39,218][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:56:39,223][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:56:39,223][root][INFO] - Saved parsed outputs
[2025-03-06 13:56:39,223][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:56:39,225][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:56:39,225][root][INFO] - Saved parsing metadata
[2025-03-06 13:56:39,226][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:56:39,227][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:56:39,229][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 13:56:39,264][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 13:56:39,264][root][INFO] - Summary of metrics : {'label_accuracy': 0.5454545454545454, 'misclassification_rate': 0.4545454545454546, 'combined_accuracy': 0.42424242424242425, 'malformed_label': 3, 'malformed_domain': 17, 'total_predictions': 99, 'correct_predictions': 54, 'correct_label_and_domain': 42, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.35714285714285715, 'Criminal_Law_accuracy': 0.6153846153846154, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.35714285714285715, 'Torts_accuracy': 0.6923076923076923, 'Civil_Procedure_accuracy': 0.1875, 'Constitutional_Law_confidence': 0.1414141414141414, 'Contracts_confidence': 0.1414141414141414, 'Criminal_Law_confidence': 0.10101010101010101, 'Evidence_confidence': 0.1111111111111111, 'Real_Property_confidence': 0.09090909090909091, 'Torts_confidence': 0.1414141414141414, 'Civil_Procedure_confidence': 0.1414141414141414, 'correct_domain_wrong_label': 40, 'correct_label_wrong_domain': 12, 'both_wrong': 5}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 13:56:47,022][root][INFO] - Setting global seed to 989
[2025-03-06 13:56:47,028][root][INFO] - Running evaluation of the untrained model on the test_set_1
[2025-03-06 13:56:47,028][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 13:56:47,029][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_1.json
[2025-03-06 13:56:47,031][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 13:56:47,033][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 13:56:47,033][root][INFO] - Questions selected, dataset contains 99 questions with 14.142857142857142 questions per domain
[2025-03-06 13:56:47,221][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 13:56:47,848][root][INFO] - Full model selected, loading model
[2025-03-06 13:57:14,621][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 13:57:14,647][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 13:57:23,049][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 13:57:23,052][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 13:57:23,052][root][INFO] - Starting inference
[2025-03-06 13:57:23,252][root][INFO] - Processing question number 0
[2025-03-06 13:57:23,254][root][INFO] - Domain : Civil_procedure, Question : 1
[2025-03-06 13:57:31,604][root][INFO] - Domain : Civil_procedure, Question : 7
[2025-03-06 13:57:40,904][root][INFO] - Domain : Civil_procedure, Question : 14
[2025-03-06 13:57:48,569][root][INFO] - Domain : Civil_procedure, Question : 21
[2025-03-06 13:57:58,399][root][INFO] - Domain : Civil_procedure, Question : 28
[2025-03-06 13:58:05,128][root][INFO] - Domain : Civil_procedure, Question : 35
[2025-03-06 13:58:18,498][root][INFO] - Domain : Civil_procedure, Question : 42
[2025-03-06 13:58:26,445][root][INFO] - Domain : Civil_procedure, Question : 49
[2025-03-06 13:58:35,461][root][INFO] - Domain : Civil_procedure, Question : 56
[2025-03-06 13:58:41,349][root][INFO] - Domain : Civil_procedure, Question : 63
[2025-03-06 13:58:47,456][root][INFO] - Processing question number 10
[2025-03-06 13:58:47,459][root][INFO] - Domain : Civil_procedure, Question : 69
[2025-03-06 13:58:53,815][root][INFO] - Domain : Civil_procedure, Question : 70
[2025-03-06 13:59:03,461][root][INFO] - Domain : Civil_procedure, Question : 77
[2025-03-06 13:59:11,015][root][INFO] - Domain : Civil_procedure, Question : 84
[2025-03-06 13:59:17,523][root][INFO] - Domain : Civil_procedure, Question : 91
[2025-03-06 13:59:24,247][root][INFO] - Domain : Civil_procedure, Question : 98
[2025-03-06 13:59:30,546][root][INFO] - Domain : Constitutional_law, Question : 2
[2025-03-06 13:59:38,669][root][INFO] - Domain : Constitutional_law, Question : 9
[2025-03-06 13:59:44,928][root][INFO] - Domain : Constitutional_law, Question : 17
[2025-03-06 13:59:51,109][root][INFO] - Domain : Constitutional_law, Question : 25
[2025-03-06 13:59:59,754][root][INFO] - Processing question number 20
[2025-03-06 13:59:59,756][root][INFO] - Domain : Constitutional_law, Question : 29
[2025-03-06 14:00:09,801][root][INFO] - Domain : Constitutional_law, Question : 37
[2025-03-06 14:00:18,110][root][INFO] - Domain : Constitutional_law, Question : 43
[2025-03-06 14:00:25,881][root][INFO] - Domain : Constitutional_law, Question : 55
[2025-03-06 14:00:30,738][root][INFO] - Domain : Constitutional_law, Question : 60
[2025-03-06 14:00:40,957][root][INFO] - Domain : Constitutional_law, Question : 65
[2025-03-06 14:00:48,548][root][INFO] - Domain : Constitutional_law, Question : 71
[2025-03-06 14:00:55,409][root][INFO] - Domain : Constitutional_law, Question : 79
[2025-03-06 14:01:03,596][root][INFO] - Domain : Constitutional_law, Question : 87
[2025-03-06 14:01:12,325][root][INFO] - Domain : Constitutional_law, Question : 93
[2025-03-06 14:01:19,131][root][INFO] - Processing question number 30
[2025-03-06 14:01:19,134][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 14:01:28,215][root][INFO] - Domain : Contracts, Question : 8
[2025-03-06 14:01:35,133][root][INFO] - Domain : Contracts, Question : 16
[2025-03-06 14:01:45,792][root][INFO] - Domain : Contracts, Question : 22
[2025-03-06 14:01:57,532][root][INFO] - Domain : Contracts, Question : 27
[2025-03-06 14:02:04,919][root][INFO] - Domain : Contracts, Question : 38
[2025-03-06 14:02:14,621][root][INFO] - Domain : Contracts, Question : 46
[2025-03-06 14:02:21,531][root][INFO] - Domain : Contracts, Question : 51
[2025-03-06 14:02:30,122][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 14:02:37,586][root][INFO] - Domain : Contracts, Question : 66
[2025-03-06 14:02:49,759][root][INFO] - Processing question number 40
[2025-03-06 14:02:49,762][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 14:02:58,324][root][INFO] - Domain : Contracts, Question : 81
[2025-03-06 14:03:08,027][root][INFO] - Domain : Contracts, Question : 88
[2025-03-06 14:03:17,078][root][INFO] - Domain : Contracts, Question : 94
[2025-03-06 14:03:25,284][root][INFO] - Domain : Torts, Question : 4
[2025-03-06 14:03:33,444][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 14:03:40,901][root][INFO] - Domain : Torts, Question : 24
[2025-03-06 14:03:49,238][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 14:03:58,921][root][INFO] - Domain : Torts, Question : 41
[2025-03-06 14:04:06,526][root][INFO] - Domain : Torts, Question : 47
[2025-03-06 14:04:16,136][root][INFO] - Processing question number 50
[2025-03-06 14:04:16,140][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 14:04:26,916][root][INFO] - Domain : Torts, Question : 62
[2025-03-06 14:04:39,594][root][INFO] - Domain : Torts, Question : 76
[2025-03-06 14:04:47,133][root][INFO] - Domain : Torts, Question : 82
[2025-03-06 14:04:57,794][root][INFO] - Domain : Torts, Question : 90
[2025-03-06 14:05:06,334][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 14:05:13,093][root][INFO] - Domain : Torts, Question : 99
[2025-03-06 14:05:24,588][root][INFO] - Domain : Evidence, Question : 5
[2025-03-06 14:05:33,302][root][INFO] - Domain : Evidence, Question : 12
[2025-03-06 14:05:42,202][root][INFO] - Domain : Evidence, Question : 18
[2025-03-06 14:05:49,169][root][INFO] - Processing question number 60
[2025-03-06 14:05:49,173][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 14:05:54,907][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 14:06:00,381][root][INFO] - Domain : Evidence, Question : 34
[2025-03-06 14:06:09,842][root][INFO] - Domain : Evidence, Question : 40
[2025-03-06 14:06:15,814][root][INFO] - Domain : Evidence, Question : 44
[2025-03-06 14:06:27,840][root][INFO] - Domain : Evidence, Question : 53
[2025-03-06 14:06:39,955][root][INFO] - Domain : Evidence, Question : 59
[2025-03-06 14:06:49,144][root][INFO] - Domain : Evidence, Question : 68
[2025-03-06 14:06:56,912][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 14:07:06,144][root][INFO] - Domain : Evidence, Question : 78
[2025-03-06 14:07:15,618][root][INFO] - Processing question number 70
[2025-03-06 14:07:15,622][root][INFO] - Domain : Evidence, Question : 86
[2025-03-06 14:07:24,625][root][INFO] - Domain : Evidence, Question : 96
[2025-03-06 14:07:34,417][root][INFO] - Domain : Property, Question : 6
[2025-03-06 14:07:41,406][root][INFO] - Domain : Property, Question : 13
[2025-03-06 14:07:50,152][root][INFO] - Domain : Property, Question : 20
[2025-03-06 14:07:58,640][root][INFO] - Domain : Property, Question : 33
[2025-03-06 14:08:06,573][root][INFO] - Domain : Property, Question : 39
[2025-03-06 14:08:18,334][root][INFO] - Domain : Property, Question : 48
[2025-03-06 14:08:28,104][root][INFO] - Domain : Property, Question : 54
[2025-03-06 14:08:35,923][root][INFO] - Domain : Property, Question : 61
[2025-03-06 14:08:44,505][root][INFO] - Processing question number 80
[2025-03-06 14:08:44,509][root][INFO] - Domain : Property, Question : 67
[2025-03-06 14:08:52,050][root][INFO] - Domain : Property, Question : 75
[2025-03-06 14:09:02,192][root][INFO] - Domain : Property, Question : 83
[2025-03-06 14:09:11,377][root][INFO] - Domain : Property, Question : 89
[2025-03-06 14:09:18,071][root][INFO] - Domain : Property, Question : 97
[2025-03-06 14:09:26,576][root][INFO] - Domain : Property, Question : 100
[2025-03-06 14:09:37,446][root][INFO] - Domain : Criminal_law, Question : 10
[2025-03-06 14:09:44,663][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:09:53,620][root][INFO] - Domain : Criminal_law, Question : 26
[2025-03-06 14:10:05,519][root][INFO] - Domain : Criminal_law, Question : 30
[2025-03-06 14:10:12,552][root][INFO] - Processing question number 90
[2025-03-06 14:10:12,557][root][INFO] - Domain : Criminal_law, Question : 36
[2025-03-06 14:10:21,418][root][INFO] - Domain : Criminal_law, Question : 45
[2025-03-06 14:10:29,946][root][INFO] - Domain : Criminal_law, Question : 50
[2025-03-06 14:10:40,417][root][INFO] - Domain : Criminal_law, Question : 57
[2025-03-06 14:10:47,821][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:10:58,926][root][INFO] - Domain : Criminal_law, Question : 74
[2025-03-06 14:11:05,915][root][INFO] - Domain : Criminal_law, Question : 80
[2025-03-06 14:11:14,665][root][INFO] - Domain : Criminal_law, Question : 85
[2025-03-06 14:11:25,198][root][INFO] - Domain : Criminal_law, Question : 92
[2025-03-06 14:11:35,180][root][INFO] - Inference complete
[2025-03-06 14:11:35,180][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 14:11:35,186][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 14:11:35,194][root][WARNING] - |Q. 54||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:11:35,194][root][WARNING] - |Q. 54||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:11:35,194][root][INFO] - |Q. 54||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:11:35,197][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 14:11:35,202][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 14:11:35,202][root][INFO] - Saved parsed outputs
[2025-03-06 14:11:35,202][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 14:11:35,204][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 14:11:35,204][root][INFO] - Saved parsing metadata
[2025-03-06 14:11:35,204][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 14:11:35,206][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
[2025-03-06 14:11:35,207][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_1.json
Metrics successfully appended to master CSV.
[2025-03-06 14:11:35,219][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_1
[2025-03-06 14:11:35,219][root][INFO] - Summary of metrics : {'label_accuracy': 0.5555555555555556, 'misclassification_rate': 0.4444444444444444, 'combined_accuracy': 0.25252525252525254, 'malformed_label': 0, 'malformed_domain': 54, 'total_predictions': 99, 'correct_predictions': 55, 'correct_label_and_domain': 25, 'Constitutional_Law_accuracy': 0.2857142857142857, 'Contracts_accuracy': 0.21428571428571427, 'Criminal_Law_accuracy': 0.5384615384615384, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.07142857142857142, 'Torts_accuracy': 0.3076923076923077, 'Civil_Procedure_accuracy': 0.0, 'Constitutional_Law_confidence': 0.09090909090909091, 'Contracts_confidence': 0.0707070707070707, 'Criminal_Law_confidence': 0.08080808080808081, 'Evidence_confidence': 0.09090909090909091, 'Real_Property_confidence': 0.04040404040404041, 'Torts_confidence': 0.08080808080808081, 'Civil_Procedure_confidence': 0.020202020202020204, 'correct_domain_wrong_label': 20, 'correct_label_wrong_domain': 30, 'both_wrong': 24}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_1 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 14:11:41,402][root][INFO] - Setting global seed to 206
[2025-03-06 14:11:41,407][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 14:11:41,407][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 14:11:41,409][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 14:11:41,411][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:11:41,413][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:11:41,413][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 14:11:41,583][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 14:11:42,135][root][INFO] - Full model selected, loading model
[2025-03-06 14:12:04,464][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 14:13:48,454][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 14:13:48,454][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 14:14:26,014][root][INFO] - Peft model loaded successfully
[2025-03-06 14:14:33,925][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:14:33,926][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:14:33,927][root][INFO] - Starting inference
[2025-03-06 14:14:34,162][root][INFO] - Processing question number 0
[2025-03-06 14:14:34,164][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 14:14:42,528][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 14:15:02,000][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 14:15:13,488][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 14:15:26,173][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 14:15:38,077][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 14:15:48,454][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 14:16:02,472][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 14:16:14,613][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 14:16:23,395][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 14:16:36,556][root][INFO] - Processing question number 10
[2025-03-06 14:16:36,558][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 14:16:47,177][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 14:16:56,560][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 14:17:07,294][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 14:17:17,715][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 14:17:27,499][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 14:17:38,071][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:17:52,568][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 14:18:00,506][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 14:18:10,149][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 14:18:21,151][root][INFO] - Processing question number 20
[2025-03-06 14:18:21,153][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 14:18:31,030][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 14:18:38,525][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:18:54,978][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 14:19:02,606][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 14:19:11,749][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 14:19:20,689][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 14:19:30,864][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 14:19:46,900][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 14:19:54,439][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 14:20:05,899][root][INFO] - Processing question number 30
[2025-03-06 14:20:05,902][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 14:20:15,283][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 14:20:25,399][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 14:20:39,071][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 14:20:50,109][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 14:20:59,872][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 14:21:11,564][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 14:21:21,258][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 14:21:36,023][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 14:21:47,175][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 14:22:01,379][root][INFO] - Processing question number 40
[2025-03-06 14:22:01,382][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 14:22:11,247][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 14:22:41,978][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 14:22:54,745][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 14:23:25,008][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 14:23:45,145][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 14:23:51,478][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 14:24:04,430][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 14:24:14,313][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 14:24:45,231][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 14:25:16,394][root][INFO] - Processing question number 50
[2025-03-06 14:25:16,398][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 14:25:24,624][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 14:25:32,115][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 14:25:50,238][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 14:26:05,338][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 14:26:19,279][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 14:26:31,669][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 14:26:49,040][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 14:26:58,649][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 14:27:11,688][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 14:27:31,023][root][INFO] - Processing question number 60
[2025-03-06 14:27:31,027][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 14:27:42,833][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 14:28:13,746][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 14:28:23,416][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 14:28:35,925][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 14:28:47,357][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 14:29:04,704][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 14:29:12,930][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 14:29:22,167][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 14:29:36,021][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 14:29:45,770][root][INFO] - Processing question number 70
[2025-03-06 14:29:45,774][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 14:29:55,239][root][INFO] - Domain : Property, Question : 9
[2025-03-06 14:30:02,412][root][INFO] - Domain : Property, Question : 17
[2025-03-06 14:30:16,959][root][INFO] - Domain : Property, Question : 25
[2025-03-06 14:30:27,524][root][INFO] - Domain : Property, Question : 30
[2025-03-06 14:30:43,731][root][INFO] - Domain : Property, Question : 36
[2025-03-06 14:30:54,914][root][INFO] - Domain : Property, Question : 46
[2025-03-06 14:31:12,830][root][INFO] - Domain : Property, Question : 53
[2025-03-06 14:31:44,020][root][INFO] - Domain : Property, Question : 59
[2025-03-06 14:31:54,850][root][INFO] - Domain : Property, Question : 66
[2025-03-06 14:32:25,604][root][INFO] - Processing question number 80
[2025-03-06 14:32:25,609][root][INFO] - Domain : Property, Question : 69
[2025-03-06 14:32:32,985][root][INFO] - Domain : Property, Question : 81
[2025-03-06 14:32:42,056][root][INFO] - Domain : Property, Question : 88
[2025-03-06 14:32:52,669][root][INFO] - Domain : Property, Question : 91
[2025-03-06 14:33:00,451][root][INFO] - Domain : Property, Question : 94
[2025-03-06 14:33:10,033][root][INFO] - Domain : Property, Question : 100
[2025-03-06 14:33:19,736][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 14:33:34,422][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 14:33:42,295][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 14:33:49,882][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 14:34:20,811][root][INFO] - Processing question number 90
[2025-03-06 14:34:20,817][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 14:34:27,184][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 14:34:58,591][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 14:35:07,953][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 14:35:17,286][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 14:35:28,743][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 14:35:41,380][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 14:35:56,510][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 14:36:06,149][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 14:36:17,985][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 14:36:49,223][root][INFO] - Inference complete
[2025-03-06 14:36:49,223][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:36:49,230][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:36:49,236][root][WARNING] - |Q. 87||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,236][root][WARNING] - |Q. 87||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,237][root][INFO] - |Q. 87||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,237][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,237][root][WARNING] - |Q. 4||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,238][root][WARNING] - |Q. 4||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,238][root][INFO] - |Q. 4||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,238][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,239][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,239][root][WARNING] - |Q. 38||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,239][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,239][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,240][root][WARNING] - |Q. 43||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,240][root][WARNING] - |Q. 43||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,240][root][INFO] - |Q. 43||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,240][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,242][root][WARNING] - |Q. 26||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,242][root][WARNING] - |Q. 26||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,242][root][INFO] - |Q. 26||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,242][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,244][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,245][root][WARNING] - |Q. 53||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,245][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,245][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,245][root][WARNING] - |Q. 66||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,245][root][WARNING] - |Q. 66||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,246][root][INFO] - |Q. 66||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,246][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,247][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,247][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,247][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,247][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,248][root][WARNING] - |Q. 45||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,248][root][WARNING] - |Q. 45||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,248][root][INFO] - |Q. 45||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,248][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,249][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 14:36:49,250][root][WARNING] - |Q. 95||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 14:36:49,250][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 14:36:49,250][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 14:36:49,251][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:36:49,256][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:36:49,256][root][INFO] - Saved parsed outputs
[2025-03-06 14:36:49,256][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:36:49,257][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:36:49,257][root][INFO] - Saved parsing metadata
[2025-03-06 14:36:49,258][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:36:49,259][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:36:49,261][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 14:36:49,293][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 14:36:49,293][root][INFO] - Summary of metrics : {'label_accuracy': 0.47, 'misclassification_rate': 0.53, 'combined_accuracy': 0.34, 'malformed_label': 10, 'malformed_domain': 22, 'total_predictions': 100, 'correct_predictions': 47, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.4666666666666667, 'Torts_accuracy': 0.5, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.15, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.09, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 44, 'correct_label_wrong_domain': 13, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 14:37:02,096][root][INFO] - Setting global seed to 206
[2025-03-06 14:37:02,103][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 14:37:02,103][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 14:37:02,105][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 14:37:02,107][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:37:02,111][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:37:02,111][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 14:37:02,266][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 14:37:02,818][root][INFO] - Full model selected, loading model
[2025-03-06 14:37:29,585][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 14:37:29,611][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 14:37:38,081][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:37:38,082][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:37:38,082][root][INFO] - Starting inference
[2025-03-06 14:37:38,283][root][INFO] - Processing question number 0
[2025-03-06 14:37:38,285][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 14:37:49,632][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 14:37:58,428][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 14:38:10,026][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 14:38:16,960][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 14:38:25,203][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 14:38:31,090][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 14:38:37,997][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 14:38:44,582][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 14:38:51,047][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 14:38:59,043][root][INFO] - Processing question number 10
[2025-03-06 14:38:59,045][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 14:39:05,909][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 14:39:14,092][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 14:39:22,971][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 14:39:29,816][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 14:39:38,722][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 14:39:47,390][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:39:55,781][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 14:40:04,190][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 14:40:13,415][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 14:40:21,800][root][INFO] - Processing question number 20
[2025-03-06 14:40:21,802][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 14:40:32,205][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 14:40:40,035][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:40:48,431][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 14:40:56,112][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 14:41:03,887][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 14:41:11,685][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 14:41:18,830][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 14:41:26,825][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 14:41:33,243][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 14:41:43,053][root][INFO] - Processing question number 30
[2025-03-06 14:41:43,055][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 14:41:51,447][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 14:41:58,981][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 14:42:07,897][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 14:42:15,952][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 14:42:25,661][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 14:42:33,753][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 14:42:41,396][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 14:42:52,195][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 14:43:01,367][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 14:43:18,382][root][INFO] - Processing question number 40
[2025-03-06 14:43:18,385][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 14:43:25,650][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 14:43:34,546][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 14:43:46,015][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 14:43:53,132][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 14:44:03,790][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 14:44:11,539][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 14:44:20,401][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 14:44:27,883][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 14:44:39,972][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 14:44:47,487][root][INFO] - Processing question number 50
[2025-03-06 14:44:47,491][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 14:44:56,251][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 14:45:04,137][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 14:45:17,895][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 14:45:27,407][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 14:45:35,425][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 14:45:42,861][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 14:45:50,331][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 14:45:58,166][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 14:46:08,261][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 14:46:17,170][root][INFO] - Processing question number 60
[2025-03-06 14:46:17,173][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 14:46:24,836][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 14:46:33,027][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 14:46:41,296][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 14:46:51,067][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 14:47:00,351][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 14:47:09,208][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 14:47:16,515][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 14:47:24,437][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 14:47:36,418][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 14:47:44,267][root][INFO] - Processing question number 70
[2025-03-06 14:47:44,271][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 14:47:52,851][root][INFO] - Domain : Property, Question : 9
[2025-03-06 14:47:59,441][root][INFO] - Domain : Property, Question : 17
[2025-03-06 14:48:10,591][root][INFO] - Domain : Property, Question : 25
[2025-03-06 14:48:24,644][root][INFO] - Domain : Property, Question : 30
[2025-03-06 14:48:32,665][root][INFO] - Domain : Property, Question : 36
[2025-03-06 14:48:41,955][root][INFO] - Domain : Property, Question : 46
[2025-03-06 14:48:51,553][root][INFO] - Domain : Property, Question : 53
[2025-03-06 14:49:05,773][root][INFO] - Domain : Property, Question : 59
[2025-03-06 14:49:12,766][root][INFO] - Domain : Property, Question : 66
[2025-03-06 14:49:18,842][root][INFO] - Processing question number 80
[2025-03-06 14:49:18,846][root][INFO] - Domain : Property, Question : 69
[2025-03-06 14:49:26,419][root][INFO] - Domain : Property, Question : 81
[2025-03-06 14:49:34,893][root][INFO] - Domain : Property, Question : 88
[2025-03-06 14:49:43,972][root][INFO] - Domain : Property, Question : 91
[2025-03-06 14:49:49,796][root][INFO] - Domain : Property, Question : 94
[2025-03-06 14:49:58,727][root][INFO] - Domain : Property, Question : 100
[2025-03-06 14:50:06,137][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 14:50:18,401][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 14:50:26,915][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 14:50:35,579][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 14:50:44,709][root][INFO] - Processing question number 90
[2025-03-06 14:50:44,714][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 14:50:53,583][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 14:51:02,289][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 14:51:10,274][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 14:51:16,926][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 14:51:26,497][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 14:51:35,544][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 14:51:42,449][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 14:51:48,909][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 14:51:58,888][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 14:52:07,298][root][INFO] - Inference complete
[2025-03-06 14:52:07,298][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:52:07,305][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:52:07,312][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 14:52:07,313][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 14:52:07,313][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 14:52:07,317][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:52:07,322][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:52:07,322][root][INFO] - Saved parsed outputs
[2025-03-06 14:52:07,322][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:52:07,324][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:52:07,324][root][INFO] - Saved parsing metadata
[2025-03-06 14:52:07,325][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:52:07,326][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:52:07,327][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 14:52:07,352][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 14:52:07,352][root][INFO] - Summary of metrics : {'label_accuracy': 0.56, 'misclassification_rate': 0.43999999999999995, 'combined_accuracy': 0.3, 'malformed_label': 0, 'malformed_domain': 47, 'total_predictions': 100, 'correct_predictions': 56, 'correct_label_and_domain': 30, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.13333333333333333, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.35714285714285715, 'Civil_Procedure_accuracy': 0.23076923076923078, 'Constitutional_Law_confidence': 0.09, 'Contracts_confidence': 0.03, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.11, 'Civil_Procedure_confidence': 0.05, 'correct_domain_wrong_label': 23, 'correct_label_wrong_domain': 26, 'both_wrong': 21}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 14:52:14,128][root][INFO] - Setting global seed to 206
[2025-03-06 14:52:14,134][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 14:52:14,134][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 14:52:14,135][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 14:52:14,137][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 14:52:14,140][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 14:52:14,140][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 14:52:14,308][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 14:52:14,890][root][INFO] - Full model selected, loading model
[2025-03-06 14:52:41,627][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 14:54:28,564][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 14:54:28,564][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 14:55:06,575][root][INFO] - Peft model loaded successfully
[2025-03-06 14:55:14,104][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 14:55:14,106][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 14:55:14,106][root][INFO] - Starting inference
[2025-03-06 14:55:14,301][root][INFO] - Processing question number 0
[2025-03-06 14:55:14,303][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 14:55:23,346][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 14:55:35,448][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 14:55:48,836][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 14:55:57,271][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 14:56:08,351][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 14:56:26,255][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 14:56:35,092][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 14:56:45,703][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 14:56:55,110][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 14:57:04,159][root][INFO] - Processing question number 10
[2025-03-06 14:57:04,160][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 14:57:20,032][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 14:57:29,852][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 14:57:39,401][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 14:57:46,742][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 14:58:18,043][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 14:58:28,929][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 14:58:40,177][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 14:58:48,462][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 14:58:59,930][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 14:59:31,301][root][INFO] - Processing question number 20
[2025-03-06 14:59:31,304][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 14:59:39,546][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 14:59:48,137][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 14:59:57,050][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 15:00:04,608][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 15:00:11,665][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 15:00:20,831][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 15:00:32,841][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 15:01:04,035][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 15:01:18,916][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 15:01:44,278][root][INFO] - Processing question number 30
[2025-03-06 15:01:44,280][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 15:01:54,550][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 15:02:25,560][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 15:02:36,934][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 15:02:45,114][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 15:03:16,194][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 15:03:29,041][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 15:03:40,868][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 15:03:57,558][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 15:04:05,226][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 15:04:14,865][root][INFO] - Processing question number 40
[2025-03-06 15:04:14,868][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 15:04:23,083][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 15:04:30,875][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 15:04:45,169][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 15:04:55,182][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 15:05:26,830][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 15:05:34,396][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 15:05:46,260][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 15:06:00,346][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 15:06:31,538][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 15:06:41,229][root][INFO] - Processing question number 50
[2025-03-06 15:06:41,233][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 15:06:48,974][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 15:06:56,882][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 15:07:13,795][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 15:07:28,884][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 15:07:45,115][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 15:07:57,179][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 15:08:12,660][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 15:08:22,009][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 15:08:37,807][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 15:08:48,706][root][INFO] - Processing question number 60
[2025-03-06 15:08:48,710][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 15:09:19,960][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 15:09:35,893][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 15:09:48,651][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 15:10:01,277][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 15:10:32,681][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 15:10:47,313][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 15:10:55,766][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 15:11:04,794][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 15:11:35,776][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 15:11:45,124][root][INFO] - Processing question number 70
[2025-03-06 15:11:45,129][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 15:12:02,581][root][INFO] - Domain : Property, Question : 9
[2025-03-06 15:12:10,513][root][INFO] - Domain : Property, Question : 17
[2025-03-06 15:12:29,366][root][INFO] - Domain : Property, Question : 25
[2025-03-06 15:12:40,144][root][INFO] - Domain : Property, Question : 30
[2025-03-06 15:12:50,517][root][INFO] - Domain : Property, Question : 36
[2025-03-06 15:13:03,468][root][INFO] - Domain : Property, Question : 46
[2025-03-06 15:13:14,583][root][INFO] - Domain : Property, Question : 53
[2025-03-06 15:13:26,099][root][INFO] - Domain : Property, Question : 59
[2025-03-06 15:13:33,452][root][INFO] - Domain : Property, Question : 66
[2025-03-06 15:14:04,504][root][INFO] - Processing question number 80
[2025-03-06 15:14:04,509][root][INFO] - Domain : Property, Question : 69
[2025-03-06 15:14:14,363][root][INFO] - Domain : Property, Question : 81
[2025-03-06 15:14:25,327][root][INFO] - Domain : Property, Question : 88
[2025-03-06 15:14:56,987][root][INFO] - Domain : Property, Question : 91
[2025-03-06 15:15:05,481][root][INFO] - Domain : Property, Question : 94
[2025-03-06 15:15:14,334][root][INFO] - Domain : Property, Question : 100
[2025-03-06 15:15:23,731][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 15:15:41,944][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 15:15:55,366][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 15:16:03,216][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 15:16:13,483][root][INFO] - Processing question number 90
[2025-03-06 15:16:13,488][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 15:16:19,613][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 15:16:32,320][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 15:16:42,770][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 15:16:50,210][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 15:17:11,942][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 15:17:21,760][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 15:17:53,133][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 15:17:59,215][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 15:18:08,547][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 15:18:18,737][root][INFO] - Inference complete
[2025-03-06 15:18:18,737][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:18:18,744][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:18:18,747][root][WARNING] - |Q. 2||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,748][root][WARNING] - |Q. 2||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,748][root][INFO] - |Q. 2||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,748][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,749][root][WARNING] - |Q. 37||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,749][root][WARNING] - |Q. 37||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,749][root][INFO] - |Q. 37||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,749][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,750][root][WARNING] - |Q. 96||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,751][root][WARNING] - |Q. 96||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,751][root][INFO] - |Q. 96||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,751][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,751][root][WARNING] - |Q. 14||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,752][root][WARNING] - |Q. 14||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:18:18,752][root][INFO] - |Q. 14||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,752][root][WARNING] - |Q. 24||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,752][root][WARNING] - |Q. 24||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,752][root][INFO] - |Q. 24||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,753][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,753][root][WARNING] - |Q. 42||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,753][root][WARNING] - |Q. 42||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,754][root][INFO] - |Q. 42||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,754][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,755][root][WARNING] - |Q. 10||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,755][root][WARNING] - |Q. 10||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,755][root][INFO] - |Q. 10||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,755][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,756][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,756][root][WARNING] - |Q. 38||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,757][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,757][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,758][root][WARNING] - |Q. 19||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,759][root][WARNING] - |Q. 19||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,759][root][INFO] - |Q. 19||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,759][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,759][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,759][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:18:18,760][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,760][root][WARNING] - |Q. 47||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,760][root][WARNING] - |Q. 47||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,760][root][INFO] - |Q. 47||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,760][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,761][root][WARNING] - |Q. 75||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,761][root][WARNING] - |Q. 75||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,761][root][INFO] - |Q. 75||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,761][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,763][root][WARNING] - |Q. 66||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,763][root][WARNING] - |Q. 66||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,763][root][INFO] - |Q. 66||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,763][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,764][root][WARNING] - |Q. 88||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,764][root][WARNING] - |Q. 88||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,764][root][INFO] - |Q. 88||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,764][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,766][root][WARNING] - |Q. 74||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:18:18,766][root][WARNING] - |Q. 74||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:18:18,767][root][INFO] - |Q. 74||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:18:18,767][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:18:18,768][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:18:18,773][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:18:18,773][root][INFO] - Saved parsed outputs
[2025-03-06 15:18:18,773][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:18:18,775][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:18:18,775][root][INFO] - Saved parsing metadata
[2025-03-06 15:18:18,776][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:18:18,778][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:18:18,779][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 15:18:18,798][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 15:18:18,798][root][INFO] - Summary of metrics : {'label_accuracy': 0.47, 'misclassification_rate': 0.53, 'combined_accuracy': 0.33, 'malformed_label': 13, 'malformed_domain': 24, 'total_predictions': 100, 'correct_predictions': 47, 'correct_label_and_domain': 33, 'Constitutional_Law_accuracy': 0.5714285714285714, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.26666666666666666, 'Torts_accuracy': 0.5, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.15, 'Criminal_Law_confidence': 0.08, 'Evidence_confidence': 0.09, 'Real_Property_confidence': 0.08, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.14, 'correct_domain_wrong_label': 43, 'correct_label_wrong_domain': 14, 'both_wrong': 10}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 15:18:28,728][root][INFO] - Setting global seed to 206
[2025-03-06 15:18:28,735][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 15:18:28,736][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 15:18:28,737][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 15:18:28,752][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 15:18:28,754][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 15:18:28,754][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 15:18:28,911][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 15:18:29,529][root][INFO] - Full model selected, loading model
[2025-03-06 15:18:53,648][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 15:18:53,663][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 15:19:02,034][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 15:19:02,036][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:19:02,036][root][INFO] - Starting inference
[2025-03-06 15:19:02,245][root][INFO] - Processing question number 0
[2025-03-06 15:19:02,247][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 15:19:13,545][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 15:19:22,214][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 15:19:30,834][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 15:19:37,489][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 15:19:46,457][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 15:19:56,949][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 15:20:04,798][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 15:20:12,080][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 15:20:18,412][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 15:20:26,327][root][INFO] - Processing question number 10
[2025-03-06 15:20:26,329][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 15:20:33,642][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 15:20:41,939][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 15:20:50,552][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 15:20:57,857][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 15:21:07,045][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 15:21:17,385][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 15:21:25,308][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 15:21:35,817][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 15:21:45,485][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 15:21:54,400][root][INFO] - Processing question number 20
[2025-03-06 15:21:54,403][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 15:22:04,511][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 15:22:10,584][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 15:22:16,546][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 15:22:24,288][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 15:22:31,096][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 15:22:38,579][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 15:22:47,777][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 15:22:56,959][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 15:23:04,122][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 15:23:13,496][root][INFO] - Processing question number 30
[2025-03-06 15:23:13,498][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 15:23:20,077][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 15:23:26,055][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 15:23:34,307][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 15:23:41,936][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 15:23:50,295][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 15:23:58,209][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 15:24:07,194][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 15:24:17,829][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 15:24:25,455][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 15:24:35,795][root][INFO] - Processing question number 40
[2025-03-06 15:24:35,798][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 15:24:44,855][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 15:24:53,779][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 15:25:03,845][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 15:25:08,806][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 15:25:20,221][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 15:25:27,299][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 15:25:34,560][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 15:25:43,383][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 15:25:50,804][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 15:25:58,033][root][INFO] - Processing question number 50
[2025-03-06 15:25:58,036][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 15:26:06,021][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 15:26:14,709][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 15:26:27,109][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 15:26:37,820][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 15:26:45,515][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 15:26:52,866][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 15:27:03,956][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 15:27:11,997][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 15:27:19,465][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 15:27:29,485][root][INFO] - Processing question number 60
[2025-03-06 15:27:29,489][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 15:27:39,133][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 15:27:48,773][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 15:27:56,852][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 15:28:04,405][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 15:28:13,660][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 15:28:22,285][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 15:28:32,644][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 15:28:38,963][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 15:28:45,406][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 15:28:53,363][root][INFO] - Processing question number 70
[2025-03-06 15:28:53,367][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 15:28:59,333][root][INFO] - Domain : Property, Question : 9
[2025-03-06 15:29:06,457][root][INFO] - Domain : Property, Question : 17
[2025-03-06 15:29:16,781][root][INFO] - Domain : Property, Question : 25
[2025-03-06 15:29:28,845][root][INFO] - Domain : Property, Question : 30
[2025-03-06 15:29:37,136][root][INFO] - Domain : Property, Question : 36
[2025-03-06 15:29:45,701][root][INFO] - Domain : Property, Question : 46
[2025-03-06 15:29:53,860][root][INFO] - Domain : Property, Question : 53
[2025-03-06 15:30:07,957][root][INFO] - Domain : Property, Question : 59
[2025-03-06 15:30:14,344][root][INFO] - Domain : Property, Question : 66
[2025-03-06 15:30:19,296][root][INFO] - Processing question number 80
[2025-03-06 15:30:19,301][root][INFO] - Domain : Property, Question : 69
[2025-03-06 15:30:27,351][root][INFO] - Domain : Property, Question : 81
[2025-03-06 15:30:34,403][root][INFO] - Domain : Property, Question : 88
[2025-03-06 15:30:44,850][root][INFO] - Domain : Property, Question : 91
[2025-03-06 15:30:53,912][root][INFO] - Domain : Property, Question : 94
[2025-03-06 15:31:01,352][root][INFO] - Domain : Property, Question : 100
[2025-03-06 15:31:09,069][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 15:31:18,115][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 15:31:28,779][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 15:31:40,394][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 15:31:48,665][root][INFO] - Processing question number 90
[2025-03-06 15:31:48,669][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 15:31:56,386][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 15:32:06,410][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 15:32:13,357][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 15:32:18,284][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 15:32:27,403][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 15:32:37,207][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 15:32:48,419][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 15:32:56,317][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 15:33:06,548][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 15:33:17,435][root][INFO] - Inference complete
[2025-03-06 15:33:17,435][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:33:17,442][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:33:17,447][root][WARNING] - |Q. 51||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 15:33:17,448][root][WARNING] - |Q. 51||D: Evidence| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:33:17,448][root][INFO] - |Q. 51||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 15:33:17,450][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:33:17,450][root][WARNING] - |Q. 93||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:33:17,450][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:33:17,454][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:33:17,463][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:33:17,463][root][INFO] - Saved parsed outputs
[2025-03-06 15:33:17,463][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:33:17,464][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:33:17,465][root][INFO] - Saved parsing metadata
[2025-03-06 15:33:17,466][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:33:17,467][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:33:17,471][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 15:33:17,566][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 15:33:17,566][root][INFO] - Summary of metrics : {'label_accuracy': 0.55, 'misclassification_rate': 0.44999999999999996, 'combined_accuracy': 0.27, 'malformed_label': 0, 'malformed_domain': 55, 'total_predictions': 100, 'correct_predictions': 55, 'correct_label_and_domain': 27, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.2, 'Torts_accuracy': 0.2857142857142857, 'Civil_Procedure_accuracy': 0.15384615384615385, 'Constitutional_Law_confidence': 0.07, 'Contracts_confidence': 0.05, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.08, 'Real_Property_confidence': 0.06, 'Torts_confidence': 0.07, 'Civil_Procedure_confidence': 0.08, 'correct_domain_wrong_label': 18, 'correct_label_wrong_domain': 28, 'both_wrong': 27}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 15:33:27,965][root][INFO] - Setting global seed to 206
[2025-03-06 15:33:27,987][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 15:33:27,987][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 15:33:27,988][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 15:33:28,006][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 15:33:28,011][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 15:33:28,011][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 15:33:28,165][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 15:33:28,766][root][INFO] - Full model selected, loading model
[2025-03-06 15:33:52,077][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 15:35:41,397][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 15:35:41,404][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 15:36:18,697][root][INFO] - Peft model loaded successfully
[2025-03-06 15:36:26,611][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 15:36:26,613][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:36:26,613][root][INFO] - Starting inference
[2025-03-06 15:36:26,846][root][INFO] - Processing question number 0
[2025-03-06 15:36:26,849][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 15:36:37,497][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 15:36:48,110][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 15:37:08,729][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 15:37:22,139][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 15:37:34,651][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 15:37:44,822][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 15:37:58,981][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 15:38:07,968][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 15:38:16,089][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 15:38:28,813][root][INFO] - Processing question number 10
[2025-03-06 15:38:28,816][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 15:38:38,982][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 15:38:45,961][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 15:38:55,442][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 15:39:03,439][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 15:39:12,646][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 15:39:22,406][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 15:39:32,785][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 15:39:41,388][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 15:39:53,640][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 15:40:02,936][root][INFO] - Processing question number 20
[2025-03-06 15:40:02,943][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 15:40:13,267][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 15:40:23,995][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 15:40:32,489][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 15:40:40,849][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 15:40:54,792][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 15:41:03,382][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 15:41:16,780][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 15:41:35,889][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 15:41:42,930][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 15:41:50,843][root][INFO] - Processing question number 30
[2025-03-06 15:41:50,846][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 15:42:00,933][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 15:42:08,754][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 15:42:21,060][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 15:42:52,565][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 15:43:02,136][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 15:43:10,566][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 15:43:23,720][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 15:43:39,285][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 15:43:45,540][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 15:43:58,980][root][INFO] - Processing question number 40
[2025-03-06 15:43:59,002][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 15:44:09,026][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 15:44:20,904][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 15:44:30,443][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 15:44:38,172][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 15:44:52,938][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 15:44:58,999][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 15:45:08,259][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 15:45:14,387][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 15:45:45,654][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 15:45:54,503][root][INFO] - Processing question number 50
[2025-03-06 15:45:54,506][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 15:46:04,420][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 15:46:20,543][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 15:46:39,799][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 15:46:54,360][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 15:47:24,317][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 15:47:35,745][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 15:47:52,284][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 15:48:05,120][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 15:48:15,268][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 15:48:43,386][root][INFO] - Processing question number 60
[2025-03-06 15:48:43,390][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 15:49:01,826][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 15:49:17,429][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 15:49:49,301][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 15:49:58,222][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 15:50:29,679][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 15:50:45,237][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 15:50:58,961][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 15:51:09,188][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 15:51:23,414][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 15:51:31,691][root][INFO] - Processing question number 70
[2025-03-06 15:51:31,695][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 15:51:44,133][root][INFO] - Domain : Property, Question : 9
[2025-03-06 15:51:55,117][root][INFO] - Domain : Property, Question : 17
[2025-03-06 15:52:09,075][root][INFO] - Domain : Property, Question : 25
[2025-03-06 15:52:23,798][root][INFO] - Domain : Property, Question : 30
[2025-03-06 15:52:31,716][root][INFO] - Domain : Property, Question : 36
[2025-03-06 15:52:39,557][root][INFO] - Domain : Property, Question : 46
[2025-03-06 15:52:49,410][root][INFO] - Domain : Property, Question : 53
[2025-03-06 15:53:08,969][root][INFO] - Domain : Property, Question : 59
[2025-03-06 15:53:17,508][root][INFO] - Domain : Property, Question : 66
[2025-03-06 15:53:25,520][root][INFO] - Processing question number 80
[2025-03-06 15:53:25,546][root][INFO] - Domain : Property, Question : 69
[2025-03-06 15:53:33,401][root][INFO] - Domain : Property, Question : 81
[2025-03-06 15:54:05,109][root][INFO] - Domain : Property, Question : 88
[2025-03-06 15:54:16,094][root][INFO] - Domain : Property, Question : 91
[2025-03-06 15:54:25,303][root][INFO] - Domain : Property, Question : 94
[2025-03-06 15:54:37,502][root][INFO] - Domain : Property, Question : 100
[2025-03-06 15:54:49,404][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 15:55:03,117][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 15:55:15,024][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 15:55:25,283][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 15:55:41,361][root][INFO] - Processing question number 90
[2025-03-06 15:55:41,366][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 15:55:50,936][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 15:56:07,566][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 15:56:21,630][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 15:56:28,684][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 15:56:35,619][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 15:56:46,768][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 15:57:00,421][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 15:57:11,705][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 15:57:20,021][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 15:57:34,489][root][INFO] - Inference complete
[2025-03-06 15:57:34,489][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:57:34,533][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:57:34,536][root][WARNING] - |Q. 29||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 15:57:34,536][root][WARNING] - |Q. 29||D: Criminal_law| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:57:34,537][root][INFO] - |Q. 29||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 15:57:34,538][root][WARNING] - |Q. 14||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:57:34,538][root][WARNING] - |Q. 14||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:57:34,538][root][INFO] - |Q. 14||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:57:34,539][root][WARNING] - |Q. 34||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 15:57:34,539][root][WARNING] - |Q. 34||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:57:34,540][root][INFO] - |Q. 34||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 15:57:34,540][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:57:34,541][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 15:57:34,542][root][WARNING] - |Q. 38||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:57:34,542][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 15:57:34,542][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:57:34,544][root][WARNING] - |Q. 33||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:57:34,544][root][WARNING] - |Q. 33||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:57:34,545][root][INFO] - |Q. 33||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:57:34,545][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:57:34,545][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:57:34,545][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:57:34,545][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:57:34,545][root][WARNING] - |Q. 47||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:57:34,546][root][WARNING] - |Q. 47||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:57:34,546][root][INFO] - |Q. 47||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:57:34,546][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:57:34,546][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 15:57:34,546][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 15:57:34,546][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 15:57:34,548][root][WARNING] - |Q. 81||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 15:57:34,549][root][WARNING] - |Q. 81||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 15:57:34,549][root][INFO] - |Q. 81||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 15:57:34,549][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 15:57:34,552][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:57:34,557][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:57:34,557][root][INFO] - Saved parsed outputs
[2025-03-06 15:57:34,557][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:57:34,559][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:57:34,559][root][INFO] - Saved parsing metadata
[2025-03-06 15:57:34,560][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:57:34,562][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:57:34,564][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 15:57:34,681][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 15:57:34,681][root][INFO] - Summary of metrics : {'label_accuracy': 0.56, 'misclassification_rate': 0.43999999999999995, 'combined_accuracy': 0.38, 'malformed_label': 5, 'malformed_domain': 26, 'total_predictions': 100, 'correct_predictions': 56, 'correct_label_and_domain': 38, 'Constitutional_Law_accuracy': 0.7142857142857143, 'Contracts_accuracy': 0.3333333333333333, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.42857142857142855, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.14, 'Contracts_confidence': 0.13, 'Criminal_Law_confidence': 0.08, 'Evidence_confidence': 0.08, 'Real_Property_confidence': 0.1, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.13, 'correct_domain_wrong_label': 36, 'correct_label_wrong_domain': 18, 'both_wrong': 8}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 15:57:44,379][root][INFO] - Setting global seed to 206
[2025-03-06 15:57:44,387][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 15:57:44,388][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 15:57:44,389][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 15:57:44,407][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 15:57:44,410][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 15:57:44,410][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 15:57:44,577][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 15:57:45,128][root][INFO] - Full model selected, loading model
[2025-03-06 15:58:10,864][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 15:58:10,874][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 15:58:19,053][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 15:58:19,054][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 15:58:19,054][root][INFO] - Starting inference
[2025-03-06 15:58:19,274][root][INFO] - Processing question number 0
[2025-03-06 15:58:19,277][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 15:58:30,717][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 15:58:38,645][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 15:58:47,940][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 15:58:55,844][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 15:59:05,617][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 15:59:13,672][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 15:59:20,059][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 15:59:27,853][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 15:59:35,076][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 15:59:43,554][root][INFO] - Processing question number 10
[2025-03-06 15:59:43,556][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 15:59:50,793][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 15:59:58,959][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 16:00:06,110][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 16:00:12,739][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 16:00:20,552][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 16:00:27,780][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 16:00:33,988][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 16:00:40,953][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 16:00:52,705][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 16:01:00,040][root][INFO] - Processing question number 20
[2025-03-06 16:01:00,042][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 16:01:08,106][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 16:01:13,298][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 16:01:22,381][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 16:01:28,859][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 16:01:37,559][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 16:01:46,645][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 16:01:54,216][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 16:02:02,794][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 16:02:09,039][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 16:02:18,857][root][INFO] - Processing question number 30
[2025-03-06 16:02:18,859][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 16:02:28,239][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 16:02:34,187][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 16:02:44,296][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 16:02:54,907][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 16:03:02,250][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 16:03:08,452][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 16:03:16,271][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 16:03:27,737][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 16:03:35,567][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 16:03:44,120][root][INFO] - Processing question number 40
[2025-03-06 16:03:44,123][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 16:03:50,580][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 16:04:00,319][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 16:04:07,157][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 16:04:15,722][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 16:04:27,420][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 16:04:35,154][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 16:04:42,825][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 16:04:51,419][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 16:05:01,018][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 16:05:08,156][root][INFO] - Processing question number 50
[2025-03-06 16:05:08,160][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 16:05:16,011][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 16:05:22,458][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 16:05:29,481][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 16:05:38,599][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 16:05:47,560][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 16:05:57,972][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 16:06:04,552][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 16:06:15,677][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 16:06:25,182][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 16:06:32,227][root][INFO] - Processing question number 60
[2025-03-06 16:06:32,231][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 16:06:42,675][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 16:06:50,252][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 16:07:00,013][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 16:07:11,293][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 16:07:16,846][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 16:07:23,915][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 16:07:33,955][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 16:07:41,217][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 16:07:47,440][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 16:07:55,220][root][INFO] - Processing question number 70
[2025-03-06 16:07:55,224][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 16:08:01,652][root][INFO] - Domain : Property, Question : 9
[2025-03-06 16:08:07,118][root][INFO] - Domain : Property, Question : 17
[2025-03-06 16:08:16,466][root][INFO] - Domain : Property, Question : 25
[2025-03-06 16:08:26,224][root][INFO] - Domain : Property, Question : 30
[2025-03-06 16:08:34,870][root][INFO] - Domain : Property, Question : 36
[2025-03-06 16:08:43,152][root][INFO] - Domain : Property, Question : 46
[2025-03-06 16:08:53,054][root][INFO] - Domain : Property, Question : 53
[2025-03-06 16:09:02,714][root][INFO] - Domain : Property, Question : 59
[2025-03-06 16:09:09,152][root][INFO] - Domain : Property, Question : 66
[2025-03-06 16:09:16,960][root][INFO] - Processing question number 80
[2025-03-06 16:09:16,965][root][INFO] - Domain : Property, Question : 69
[2025-03-06 16:09:24,665][root][INFO] - Domain : Property, Question : 81
[2025-03-06 16:09:32,173][root][INFO] - Domain : Property, Question : 88
[2025-03-06 16:09:43,407][root][INFO] - Domain : Property, Question : 91
[2025-03-06 16:09:48,841][root][INFO] - Domain : Property, Question : 94
[2025-03-06 16:09:57,306][root][INFO] - Domain : Property, Question : 100
[2025-03-06 16:10:03,261][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 16:10:13,375][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 16:10:21,577][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 16:10:29,239][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 16:10:38,464][root][INFO] - Processing question number 90
[2025-03-06 16:10:38,468][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 16:10:47,331][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 16:10:55,352][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 16:11:01,960][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 16:11:08,274][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 16:11:14,753][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 16:11:23,679][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 16:11:38,500][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 16:11:47,895][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 16:11:55,769][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 16:12:03,446][root][INFO] - Inference complete
[2025-03-06 16:12:03,446][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:12:03,453][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:12:03,460][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 16:12:03,460][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 16:12:03,460][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 16:12:03,462][root][WARNING] - |Q. 94||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:12:03,462][root][WARNING] - |Q. 94||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:12:03,463][root][INFO] - |Q. 94||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:12:03,463][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:12:03,465][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:12:03,470][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:12:03,470][root][INFO] - Saved parsed outputs
[2025-03-06 16:12:03,470][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:12:03,471][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:12:03,471][root][INFO] - Saved parsing metadata
[2025-03-06 16:12:03,473][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:12:03,475][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:12:03,476][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_206/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 16:12:03,502][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 16:12:03,502][root][INFO] - Summary of metrics : {'label_accuracy': 0.53, 'misclassification_rate': 0.47, 'combined_accuracy': 0.18, 'malformed_label': 1, 'malformed_domain': 61, 'total_predictions': 100, 'correct_predictions': 53, 'correct_label_and_domain': 18, 'Constitutional_Law_accuracy': 0.14285714285714285, 'Contracts_accuracy': 0.06666666666666667, 'Criminal_Law_accuracy': 0.14285714285714285, 'Evidence_accuracy': 0.2, 'Real_Property_accuracy': 0.26666666666666666, 'Torts_accuracy': 0.35714285714285715, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.05, 'Contracts_confidence': 0.04, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.09, 'Real_Property_confidence': 0.06, 'Torts_confidence': 0.09, 'Civil_Procedure_confidence': 0.04, 'correct_domain_wrong_label': 21, 'correct_label_wrong_domain': 35, 'both_wrong': 26}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_206 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 16:12:10,666][root][INFO] - Setting global seed to 989
[2025-03-06 16:12:10,673][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 16:12:10,673][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 16:12:10,674][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 16:12:10,676][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 16:12:10,679][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 16:12:10,679][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 16:12:10,880][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 16:12:11,455][root][INFO] - Full model selected, loading model
[2025-03-06 16:12:33,514][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 16:14:24,770][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 16:14:24,770][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 16:15:03,755][root][INFO] - Peft model loaded successfully
[2025-03-06 16:15:11,351][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 16:15:11,353][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:15:11,354][root][INFO] - Starting inference
[2025-03-06 16:15:11,614][root][INFO] - Processing question number 0
[2025-03-06 16:15:11,616][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 16:15:19,945][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 16:15:39,471][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 16:15:50,986][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 16:16:03,704][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 16:16:15,642][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 16:16:26,047][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 16:16:40,109][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 16:16:52,279][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 16:17:01,080][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 16:17:14,274][root][INFO] - Processing question number 10
[2025-03-06 16:17:14,276][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 16:17:24,926][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 16:17:34,338][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 16:17:45,100][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 16:17:55,553][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 16:18:05,368][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 16:18:15,977][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 16:18:30,479][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 16:18:38,417][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 16:18:48,056][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 16:18:59,046][root][INFO] - Processing question number 20
[2025-03-06 16:18:59,049][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 16:19:08,930][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 16:19:16,438][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 16:19:32,915][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 16:19:40,555][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 16:19:49,707][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 16:19:58,669][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 16:20:08,861][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 16:20:24,923][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 16:20:32,474][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 16:20:43,950][root][INFO] - Processing question number 30
[2025-03-06 16:20:43,953][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 16:20:53,339][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 16:21:03,433][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 16:21:17,113][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 16:21:28,165][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 16:21:37,937][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 16:21:49,647][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 16:21:59,352][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 16:22:14,138][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 16:22:25,305][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 16:22:39,515][root][INFO] - Processing question number 40
[2025-03-06 16:22:39,518][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 16:22:49,398][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 16:23:20,165][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 16:23:32,955][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 16:24:03,246][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 16:24:23,404][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 16:24:29,746][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 16:24:42,708][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 16:24:52,600][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 16:25:23,561][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 16:25:54,754][root][INFO] - Processing question number 50
[2025-03-06 16:25:54,757][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 16:26:02,981][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 16:26:10,479][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 16:26:28,616][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 16:26:43,729][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 16:26:57,691][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 16:27:10,094][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 16:27:27,483][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 16:27:37,102][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 16:27:50,152][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 16:28:09,510][root][INFO] - Processing question number 60
[2025-03-06 16:28:09,514][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 16:28:21,335][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 16:28:52,301][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 16:29:02,046][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 16:29:14,570][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 16:29:26,010][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 16:29:43,366][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 16:29:51,598][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 16:30:00,841][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 16:30:14,713][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 16:30:24,480][root][INFO] - Processing question number 70
[2025-03-06 16:30:24,484][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 16:30:33,956][root][INFO] - Domain : Property, Question : 9
[2025-03-06 16:30:41,132][root][INFO] - Domain : Property, Question : 17
[2025-03-06 16:30:55,694][root][INFO] - Domain : Property, Question : 25
[2025-03-06 16:31:06,271][root][INFO] - Domain : Property, Question : 30
[2025-03-06 16:31:22,479][root][INFO] - Domain : Property, Question : 36
[2025-03-06 16:31:33,672][root][INFO] - Domain : Property, Question : 46
[2025-03-06 16:31:51,607][root][INFO] - Domain : Property, Question : 53
[2025-03-06 16:32:22,836][root][INFO] - Domain : Property, Question : 59
[2025-03-06 16:32:33,676][root][INFO] - Domain : Property, Question : 66
[2025-03-06 16:33:04,451][root][INFO] - Processing question number 80
[2025-03-06 16:33:04,457][root][INFO] - Domain : Property, Question : 69
[2025-03-06 16:33:11,841][root][INFO] - Domain : Property, Question : 81
[2025-03-06 16:33:20,919][root][INFO] - Domain : Property, Question : 88
[2025-03-06 16:33:31,548][root][INFO] - Domain : Property, Question : 91
[2025-03-06 16:33:39,340][root][INFO] - Domain : Property, Question : 94
[2025-03-06 16:33:48,934][root][INFO] - Domain : Property, Question : 100
[2025-03-06 16:33:58,655][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 16:34:13,370][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 16:34:21,275][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 16:34:28,927][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 16:35:00,002][root][INFO] - Processing question number 90
[2025-03-06 16:35:00,007][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 16:35:06,383][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 16:35:37,832][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 16:35:47,207][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 16:35:56,553][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 16:36:08,031][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 16:36:20,683][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 16:36:35,822][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 16:36:45,471][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 16:36:57,323][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 16:37:28,604][root][INFO] - Inference complete
[2025-03-06 16:37:28,604][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:37:28,612][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:37:28,618][root][WARNING] - |Q. 87||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,619][root][WARNING] - |Q. 87||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,619][root][INFO] - |Q. 87||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,619][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,620][root][WARNING] - |Q. 4||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,620][root][WARNING] - |Q. 4||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,620][root][INFO] - |Q. 4||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,620][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,621][root][WARNING] - |Q. 38||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,622][root][WARNING] - |Q. 38||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,622][root][INFO] - |Q. 38||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,622][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,622][root][WARNING] - |Q. 43||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,622][root][WARNING] - |Q. 43||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,623][root][INFO] - |Q. 43||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,623][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,624][root][WARNING] - |Q. 26||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,625][root][WARNING] - |Q. 26||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,625][root][INFO] - |Q. 26||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,625][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,627][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,627][root][WARNING] - |Q. 53||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,627][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,627][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,628][root][WARNING] - |Q. 66||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,628][root][WARNING] - |Q. 66||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,628][root][INFO] - |Q. 66||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,628][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,629][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,630][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,630][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,630][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,630][root][WARNING] - |Q. 45||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,630][root][WARNING] - |Q. 45||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,631][root][INFO] - |Q. 45||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,631][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,632][root][WARNING] - |Q. 95||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 16:37:28,632][root][WARNING] - |Q. 95||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 16:37:28,632][root][INFO] - |Q. 95||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 16:37:28,632][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 16:37:28,633][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:37:28,639][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:37:28,639][root][INFO] - Saved parsed outputs
[2025-03-06 16:37:28,639][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:37:28,640][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:37:28,640][root][INFO] - Saved parsing metadata
[2025-03-06 16:37:28,641][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:37:28,643][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:37:28,644][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 16:37:28,674][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 16:37:28,674][root][INFO] - Summary of metrics : {'label_accuracy': 0.47, 'misclassification_rate': 0.53, 'combined_accuracy': 0.34, 'malformed_label': 10, 'malformed_domain': 22, 'total_predictions': 100, 'correct_predictions': 47, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.5, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.4666666666666667, 'Torts_accuracy': 0.5, 'Civil_Procedure_accuracy': 0.3076923076923077, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.15, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.09, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 44, 'correct_label_wrong_domain': 13, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 16:37:36,050][root][INFO] - Setting global seed to 989
[2025-03-06 16:37:36,057][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 16:37:36,057][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 16:37:36,059][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 16:37:36,061][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 16:37:36,064][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 16:37:36,064][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 16:37:36,208][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 16:37:36,768][root][INFO] - Full model selected, loading model
[2025-03-06 16:38:02,149][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 16:38:02,149][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 16:38:10,241][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 16:38:10,244][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:38:10,244][root][INFO] - Starting inference
[2025-03-06 16:38:10,466][root][INFO] - Processing question number 0
[2025-03-06 16:38:10,468][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 16:38:21,549][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 16:38:30,358][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 16:38:41,981][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 16:38:48,928][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 16:38:57,190][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 16:39:03,089][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 16:39:10,009][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 16:39:16,607][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 16:39:23,087][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 16:39:31,096][root][INFO] - Processing question number 10
[2025-03-06 16:39:31,098][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 16:39:37,978][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 16:39:46,166][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 16:39:55,070][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 16:40:01,937][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 16:40:10,860][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 16:40:19,552][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 16:40:27,965][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 16:40:36,389][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 16:40:45,635][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 16:40:54,045][root][INFO] - Processing question number 20
[2025-03-06 16:40:54,048][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 16:41:04,469][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 16:41:12,314][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 16:41:20,727][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 16:41:28,422][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 16:41:36,212][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 16:41:44,028][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 16:41:51,187][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 16:41:59,200][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 16:42:05,630][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 16:42:15,458][root][INFO] - Processing question number 30
[2025-03-06 16:42:15,461][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 16:42:23,871][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 16:42:31,425][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 16:42:40,359][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 16:42:48,430][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 16:42:58,159][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 16:43:06,263][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 16:43:13,916][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 16:43:24,726][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 16:43:33,912][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 16:43:50,954][root][INFO] - Processing question number 40
[2025-03-06 16:43:50,956][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 16:43:58,235][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 16:44:07,147][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 16:44:18,642][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 16:44:25,777][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 16:44:36,457][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 16:44:44,217][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 16:44:53,089][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 16:45:00,571][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 16:45:12,681][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 16:45:20,205][root][INFO] - Processing question number 50
[2025-03-06 16:45:20,209][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 16:45:28,978][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 16:45:36,874][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 16:45:50,647][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 16:46:00,179][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 16:46:08,207][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 16:46:15,656][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 16:46:23,134][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 16:46:30,978][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 16:46:41,083][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 16:46:49,993][root][INFO] - Processing question number 60
[2025-03-06 16:46:49,996][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 16:46:57,665][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 16:47:05,864][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 16:47:14,138][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 16:47:23,923][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 16:47:33,215][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 16:47:42,087][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 16:47:49,402][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 16:47:57,333][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 16:48:09,328][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 16:48:17,187][root][INFO] - Processing question number 70
[2025-03-06 16:48:17,191][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 16:48:25,774][root][INFO] - Domain : Property, Question : 9
[2025-03-06 16:48:32,367][root][INFO] - Domain : Property, Question : 17
[2025-03-06 16:48:43,524][root][INFO] - Domain : Property, Question : 25
[2025-03-06 16:48:57,594][root][INFO] - Domain : Property, Question : 30
[2025-03-06 16:49:05,632][root][INFO] - Domain : Property, Question : 36
[2025-03-06 16:49:14,933][root][INFO] - Domain : Property, Question : 46
[2025-03-06 16:49:24,539][root][INFO] - Domain : Property, Question : 53
[2025-03-06 16:49:38,784][root][INFO] - Domain : Property, Question : 59
[2025-03-06 16:49:45,797][root][INFO] - Domain : Property, Question : 66
[2025-03-06 16:49:51,880][root][INFO] - Processing question number 80
[2025-03-06 16:49:51,884][root][INFO] - Domain : Property, Question : 69
[2025-03-06 16:49:59,469][root][INFO] - Domain : Property, Question : 81
[2025-03-06 16:50:07,950][root][INFO] - Domain : Property, Question : 88
[2025-03-06 16:50:17,033][root][INFO] - Domain : Property, Question : 91
[2025-03-06 16:50:22,865][root][INFO] - Domain : Property, Question : 94
[2025-03-06 16:50:31,804][root][INFO] - Domain : Property, Question : 100
[2025-03-06 16:50:39,227][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 16:50:51,497][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 16:51:00,024][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 16:51:08,699][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 16:51:17,845][root][INFO] - Processing question number 90
[2025-03-06 16:51:17,849][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 16:51:26,729][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 16:51:35,420][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 16:51:43,402][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 16:51:50,053][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 16:51:59,567][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 16:52:08,559][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 16:52:15,429][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 16:52:21,855][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 16:52:31,803][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 16:52:40,209][root][INFO] - Inference complete
[2025-03-06 16:52:40,210][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:52:40,217][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:52:40,223][root][WARNING] - |Q. 54||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 16:52:40,224][root][WARNING] - |Q. 54||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 16:52:40,224][root][INFO] - |Q. 54||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 16:52:40,228][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:52:40,233][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:52:40,233][root][INFO] - Saved parsed outputs
[2025-03-06 16:52:40,233][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:52:40,235][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:52:40,235][root][INFO] - Saved parsing metadata
[2025-03-06 16:52:40,236][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:52:40,237][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:52:40,239][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/greedy/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 16:52:40,256][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 16:52:40,256][root][INFO] - Summary of metrics : {'label_accuracy': 0.56, 'misclassification_rate': 0.43999999999999995, 'combined_accuracy': 0.3, 'malformed_label': 0, 'malformed_domain': 47, 'total_predictions': 100, 'correct_predictions': 56, 'correct_label_and_domain': 30, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.13333333333333333, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.3333333333333333, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.35714285714285715, 'Civil_Procedure_accuracy': 0.23076923076923078, 'Constitutional_Law_confidence': 0.09, 'Contracts_confidence': 0.03, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.1, 'Real_Property_confidence': 0.09, 'Torts_confidence': 0.11, 'Civil_Procedure_confidence': 0.05, 'correct_domain_wrong_label': 23, 'correct_label_wrong_domain': 26, 'both_wrong': 21}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=greedy evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 16:52:47,569][root][INFO] - Setting global seed to 989
[2025-03-06 16:52:47,576][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 16:52:47,576][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 16:52:47,578][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 16:52:47,579][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 16:52:47,581][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 16:52:47,582][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 16:52:47,728][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 16:52:48,304][root][INFO] - Full model selected, loading model
[2025-03-06 16:53:11,162][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 16:55:01,984][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 16:55:01,985][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 16:55:40,259][root][INFO] - Peft model loaded successfully
[2025-03-06 16:55:48,042][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 16:55:48,044][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 16:55:48,044][root][INFO] - Starting inference
[2025-03-06 16:55:48,263][root][INFO] - Processing question number 0
[2025-03-06 16:55:48,265][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 16:56:02,728][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 16:56:13,280][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 16:56:22,415][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 16:56:32,226][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 16:56:42,429][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 16:56:54,453][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 16:57:03,794][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 16:57:16,426][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 16:57:26,782][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 16:57:38,730][root][INFO] - Processing question number 10
[2025-03-06 16:57:38,732][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 16:57:47,653][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 16:58:02,092][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 16:58:15,321][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 16:58:27,200][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 16:58:38,200][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 16:58:48,641][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 16:59:01,054][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 16:59:09,693][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 16:59:20,772][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 16:59:31,207][root][INFO] - Processing question number 20
[2025-03-06 16:59:31,209][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 16:59:40,934][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 16:59:54,920][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 17:00:05,526][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 17:00:14,213][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 17:00:27,035][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 17:00:36,269][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 17:00:50,056][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 17:01:01,523][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 17:01:12,159][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 17:01:22,923][root][INFO] - Processing question number 30
[2025-03-06 17:01:22,926][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 17:01:31,752][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 17:02:02,815][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 17:02:14,806][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 17:02:27,517][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 17:02:38,016][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 17:02:48,621][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 17:02:59,506][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 17:03:09,644][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 17:03:22,293][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 17:03:32,879][root][INFO] - Processing question number 40
[2025-03-06 17:03:32,882][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 17:03:40,800][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 17:03:51,751][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 17:04:04,623][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 17:04:12,583][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 17:04:44,209][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 17:04:51,478][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 17:04:59,525][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 17:05:11,447][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 17:05:32,341][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 17:05:42,365][root][INFO] - Processing question number 50
[2025-03-06 17:05:42,369][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 17:05:49,850][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 17:06:03,168][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 17:06:13,326][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 17:06:44,784][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 17:06:53,933][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 17:07:04,723][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 17:07:36,520][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 17:07:49,332][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 17:08:02,523][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 17:08:19,931][root][INFO] - Processing question number 60
[2025-03-06 17:08:19,936][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 17:08:30,733][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 17:08:46,357][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 17:09:01,459][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 17:09:11,705][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 17:09:23,523][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 17:09:35,725][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 17:09:44,522][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 17:09:51,920][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 17:10:01,770][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 17:10:11,507][root][INFO] - Processing question number 70
[2025-03-06 17:10:11,512][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 17:10:42,844][root][INFO] - Domain : Property, Question : 9
[2025-03-06 17:10:51,512][root][INFO] - Domain : Property, Question : 17
[2025-03-06 17:11:22,950][root][INFO] - Domain : Property, Question : 25
[2025-03-06 17:11:35,697][root][INFO] - Domain : Property, Question : 30
[2025-03-06 17:11:51,069][root][INFO] - Domain : Property, Question : 36
[2025-03-06 17:12:00,942][root][INFO] - Domain : Property, Question : 46
[2025-03-06 17:12:12,267][root][INFO] - Domain : Property, Question : 53
[2025-03-06 17:12:43,732][root][INFO] - Domain : Property, Question : 59
[2025-03-06 17:12:51,124][root][INFO] - Domain : Property, Question : 66
[2025-03-06 17:12:56,075][root][INFO] - Processing question number 80
[2025-03-06 17:12:56,080][root][INFO] - Domain : Property, Question : 69
[2025-03-06 17:13:04,870][root][INFO] - Domain : Property, Question : 81
[2025-03-06 17:13:16,387][root][INFO] - Domain : Property, Question : 88
[2025-03-06 17:13:28,915][root][INFO] - Domain : Property, Question : 91
[2025-03-06 17:13:39,056][root][INFO] - Domain : Property, Question : 94
[2025-03-06 17:13:46,852][root][INFO] - Domain : Property, Question : 100
[2025-03-06 17:13:56,452][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 17:14:08,567][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 17:14:16,358][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 17:14:24,549][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 17:14:55,754][root][INFO] - Processing question number 90
[2025-03-06 17:14:55,759][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 17:15:03,909][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 17:15:17,063][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 17:15:28,313][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 17:15:36,302][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 17:15:44,980][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 17:15:54,390][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 17:16:12,915][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 17:16:22,290][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 17:16:32,106][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 17:16:44,358][root][INFO] - Inference complete
[2025-03-06 17:16:44,358][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:16:44,364][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:16:44,369][root][WARNING] - |Q. 14||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,369][root][WARNING] - |Q. 14||D: Contracts| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 17:16:44,370][root][INFO] - |Q. 14||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,370][root][WARNING] - |Q. 24||D: Contracts| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,370][root][WARNING] - |Q. 24||D: Contracts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:16:44,371][root][INFO] - |Q. 24||D: Contracts| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,371][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:16:44,372][root][WARNING] - |Q. 10||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,373][root][WARNING] - |Q. 10||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:16:44,373][root][INFO] - |Q. 10||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,373][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:16:44,374][root][WARNING] - |Q. 73||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,374][root][WARNING] - |Q. 73||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:16:44,374][root][INFO] - |Q. 73||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,375][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:16:44,375][root][WARNING] - |Q. 90||D: Evidence| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,375][root][WARNING] - |Q. 90||D: Evidence| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:16:44,376][root][INFO] - |Q. 90||D: Evidence| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,376][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:16:44,377][root][WARNING] - |Q. 33||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,377][root][WARNING] - |Q. 33||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 17:16:44,377][root][INFO] - |Q. 33||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,378][root][WARNING] - |Q. 93||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,378][root][WARNING] - |Q. 93||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:16:44,378][root][INFO] - |Q. 93||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,378][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:16:44,379][root][WARNING] - |Q. 17||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,379][root][WARNING] - |Q. 17||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:16:44,379][root][INFO] - |Q. 17||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,379][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:16:44,380][root][WARNING] - |Q. 53||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,380][root][WARNING] - |Q. 53||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:16:44,380][root][INFO] - |Q. 53||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,381][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:16:44,382][root][WARNING] - |Q. 32||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 17:16:44,382][root][WARNING] - |Q. 32||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:16:44,382][root][INFO] - |Q. 32||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 17:16:44,382][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:16:44,385][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:16:44,390][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:16:44,390][root][INFO] - Saved parsed outputs
[2025-03-06 17:16:44,390][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:16:44,392][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:16:44,392][root][INFO] - Saved parsing metadata
[2025-03-06 17:16:44,392][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:16:44,409][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:16:44,415][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 17:16:44,446][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 17:16:44,446][root][INFO] - Summary of metrics : {'label_accuracy': 0.49, 'misclassification_rate': 0.51, 'combined_accuracy': 0.34, 'malformed_label': 8, 'malformed_domain': 24, 'total_predictions': 100, 'correct_predictions': 49, 'correct_label_and_domain': 34, 'Constitutional_Law_accuracy': 0.42857142857142855, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.2857142857142857, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.4, 'Torts_accuracy': 0.42857142857142855, 'Civil_Procedure_accuracy': 0.46153846153846156, 'Constitutional_Law_confidence': 0.15, 'Contracts_confidence': 0.14, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.09, 'Real_Property_confidence': 0.11, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.15, 'correct_domain_wrong_label': 42, 'correct_label_wrong_domain': 15, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 17:16:58,425][root][INFO] - Setting global seed to 989
[2025-03-06 17:16:58,432][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 17:16:58,433][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 17:16:58,434][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 17:16:58,435][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 17:16:58,438][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 17:16:58,438][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 17:16:58,603][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 17:16:59,187][root][INFO] - Full model selected, loading model
[2025-03-06 17:17:22,661][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 17:17:22,661][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 17:17:30,410][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 17:17:30,411][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:17:30,412][root][INFO] - Starting inference
[2025-03-06 17:17:30,623][root][INFO] - Processing question number 0
[2025-03-06 17:17:30,626][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 17:17:42,333][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 17:17:53,935][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 17:18:05,953][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 17:18:13,690][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 17:18:20,832][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 17:18:29,506][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 17:18:39,145][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 17:18:46,879][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 17:18:53,165][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 17:19:01,191][root][INFO] - Processing question number 10
[2025-03-06 17:19:01,193][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 17:19:08,083][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 17:19:16,182][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 17:19:24,755][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 17:19:34,070][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 17:19:43,517][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 17:19:51,875][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 17:20:00,943][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 17:20:09,821][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 17:20:17,790][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 17:20:25,758][root][INFO] - Processing question number 20
[2025-03-06 17:20:25,760][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 17:20:56,332][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 17:21:02,804][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 17:21:12,665][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 17:21:20,266][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 17:21:27,571][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 17:21:35,296][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 17:21:43,500][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 17:21:52,266][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 17:21:57,960][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 17:22:06,606][root][INFO] - Processing question number 30
[2025-03-06 17:22:06,609][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 17:22:14,690][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 17:22:22,001][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 17:22:29,278][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 17:22:36,764][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 17:22:43,602][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 17:22:53,008][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 17:23:01,262][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 17:23:10,546][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 17:23:19,857][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 17:23:32,415][root][INFO] - Processing question number 40
[2025-03-06 17:23:32,417][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 17:23:39,259][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 17:23:48,241][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 17:23:57,066][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 17:24:04,103][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 17:24:15,591][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 17:24:22,965][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 17:24:31,218][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 17:24:45,512][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 17:24:53,829][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 17:25:01,808][root][INFO] - Processing question number 50
[2025-03-06 17:25:01,811][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 17:25:10,349][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 17:25:17,083][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 17:25:26,471][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 17:25:35,617][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 17:25:42,871][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 17:25:53,287][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 17:26:01,986][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 17:26:09,986][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 17:26:19,566][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 17:26:31,655][root][INFO] - Processing question number 60
[2025-03-06 17:26:31,658][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 17:26:39,835][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 17:26:49,039][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 17:26:57,986][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 17:27:06,044][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 17:27:14,764][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 17:27:23,057][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 17:27:29,542][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 17:27:40,005][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 17:27:52,952][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 17:28:01,804][root][INFO] - Processing question number 70
[2025-03-06 17:28:01,808][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 17:28:09,321][root][INFO] - Domain : Property, Question : 9
[2025-03-06 17:28:15,373][root][INFO] - Domain : Property, Question : 17
[2025-03-06 17:28:26,727][root][INFO] - Domain : Property, Question : 25
[2025-03-06 17:28:37,632][root][INFO] - Domain : Property, Question : 30
[2025-03-06 17:28:45,974][root][INFO] - Domain : Property, Question : 36
[2025-03-06 17:28:56,351][root][INFO] - Domain : Property, Question : 46
[2025-03-06 17:29:04,764][root][INFO] - Domain : Property, Question : 53
[2025-03-06 17:29:14,608][root][INFO] - Domain : Property, Question : 59
[2025-03-06 17:29:22,405][root][INFO] - Domain : Property, Question : 66
[2025-03-06 17:29:28,679][root][INFO] - Processing question number 80
[2025-03-06 17:29:28,683][root][INFO] - Domain : Property, Question : 69
[2025-03-06 17:29:35,779][root][INFO] - Domain : Property, Question : 81
[2025-03-06 17:29:41,969][root][INFO] - Domain : Property, Question : 88
[2025-03-06 17:29:50,517][root][INFO] - Domain : Property, Question : 91
[2025-03-06 17:29:56,733][root][INFO] - Domain : Property, Question : 94
[2025-03-06 17:30:06,248][root][INFO] - Domain : Property, Question : 100
[2025-03-06 17:30:14,214][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 17:30:23,457][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 17:30:32,850][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 17:30:44,399][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 17:30:52,714][root][INFO] - Processing question number 90
[2025-03-06 17:30:52,718][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 17:31:02,873][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 17:31:11,087][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 17:31:19,182][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 17:31:25,285][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 17:31:35,375][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 17:31:44,183][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 17:31:57,063][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 17:32:05,999][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 17:32:15,236][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 17:32:22,606][root][INFO] - Inference complete
[2025-03-06 17:32:22,606][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:32:22,615][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:32:22,618][root][WARNING] - |Q. 44||D: Criminal_law| has broken JSON output. Attempting to fix it.
[2025-03-06 17:32:22,618][root][WARNING] - |Q. 44||D: Criminal_law| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:32:22,619][root][INFO] - |Q. 44||D: Criminal_law| was made valid into Valid json. Extracting responses.
[2025-03-06 17:32:22,619][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:32:22,627][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:32:22,632][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:32:22,632][root][INFO] - Saved parsed outputs
[2025-03-06 17:32:22,632][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:32:22,634][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:32:22,634][root][INFO] - Saved parsing metadata
[2025-03-06 17:32:22,635][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:32:22,637][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:32:22,638][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_025/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 17:32:22,665][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 17:32:22,665][root][INFO] - Summary of metrics : {'label_accuracy': 0.52, 'misclassification_rate': 0.48, 'combined_accuracy': 0.21, 'malformed_label': 1, 'malformed_domain': 60, 'total_predictions': 100, 'correct_predictions': 52, 'correct_label_and_domain': 21, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.2, 'Criminal_Law_accuracy': 0.14285714285714285, 'Evidence_accuracy': 0.13333333333333333, 'Real_Property_accuracy': 0.26666666666666666, 'Torts_accuracy': 0.2857142857142857, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.07, 'Contracts_confidence': 0.04, 'Criminal_Law_confidence': 0.05, 'Evidence_confidence': 0.06, 'Real_Property_confidence': 0.06, 'Torts_confidence': 0.09, 'Civil_Procedure_confidence': 0.03, 'correct_domain_wrong_label': 19, 'correct_label_wrong_domain': 31, 'both_wrong': 29}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_025 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 17:32:29,838][root][INFO] - Setting global seed to 989
[2025-03-06 17:32:29,844][root][INFO] - Running evaluation of the trained model on the test_set_2
[2025-03-06 17:32:29,845][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 17:32:29,846][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 17:32:29,847][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 17:32:29,850][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 17:32:29,850][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 17:32:30,004][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 17:32:30,550][root][INFO] - Full model selected, loading model
[2025-03-06 17:32:51,316][root][INFO] - Tokenizer special tokens: {'bos_token': '<|begin_of_text|>', 'eos_token': '<|end_of_text|>', 'pad_token': '[PAD]'} have been added
[2025-03-06 17:34:40,310][root][INFO] - Fine-tuned model selected, loading adapter
[2025-03-06 17:34:40,348][root][WARNING] - Inference will be done using model.generate instead of hf pipeline since peft model is not compatible with it
[2025-03-06 17:35:20,180][root][INFO] - Peft model loaded successfully
[2025-03-06 17:35:27,835][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 17:35:27,837][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:35:27,837][root][INFO] - Starting inference
[2025-03-06 17:35:28,041][root][INFO] - Processing question number 0
[2025-03-06 17:35:28,043][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 17:35:42,501][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 17:35:58,487][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 17:36:29,495][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 17:36:46,818][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 17:36:55,489][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 17:37:04,360][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 17:37:12,813][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 17:37:24,041][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 17:37:33,718][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 17:37:43,675][root][INFO] - Processing question number 10
[2025-03-06 17:37:43,676][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 17:37:54,686][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 17:38:00,532][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 17:38:09,217][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 17:38:17,107][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 17:38:29,569][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 17:38:42,322][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 17:39:00,773][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 17:39:10,308][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 17:39:26,869][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 17:39:41,334][root][INFO] - Processing question number 20
[2025-03-06 17:39:41,336][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 17:39:57,922][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 17:40:04,644][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 17:40:16,496][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 17:40:24,454][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 17:40:34,287][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 17:40:49,066][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 17:40:56,238][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 17:41:06,048][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 17:41:15,396][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 17:41:30,578][root][INFO] - Processing question number 30
[2025-03-06 17:41:30,580][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 17:41:42,056][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 17:41:48,783][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 17:41:58,486][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 17:42:08,437][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 17:42:17,806][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 17:42:36,113][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 17:42:45,410][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 17:43:09,709][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 17:43:16,806][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 17:43:34,158][root][INFO] - Processing question number 40
[2025-03-06 17:43:34,161][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 17:43:43,331][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 17:43:56,051][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 17:44:10,616][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 17:44:16,203][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 17:44:35,111][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 17:44:46,469][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 17:44:54,680][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 17:45:03,521][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 17:45:22,481][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 17:45:31,418][root][INFO] - Processing question number 50
[2025-03-06 17:45:31,422][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 17:45:39,020][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 17:45:48,551][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 17:46:08,663][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 17:46:19,073][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 17:46:31,662][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 17:46:43,840][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 17:46:56,675][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 17:47:10,099][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 17:47:21,442][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 17:47:34,140][root][INFO] - Processing question number 60
[2025-03-06 17:47:34,143][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 17:47:42,320][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 17:47:57,804][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 17:48:29,642][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 17:48:42,935][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 17:48:55,882][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 17:49:05,422][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 17:49:16,939][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 17:49:29,338][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 17:49:39,353][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 17:49:46,835][root][INFO] - Processing question number 70
[2025-03-06 17:49:46,840][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 17:50:02,758][root][INFO] - Domain : Property, Question : 9
[2025-03-06 17:50:11,539][root][INFO] - Domain : Property, Question : 17
[2025-03-06 17:50:28,695][root][INFO] - Domain : Property, Question : 25
[2025-03-06 17:51:00,513][root][INFO] - Domain : Property, Question : 30
[2025-03-06 17:51:11,028][root][INFO] - Domain : Property, Question : 36
[2025-03-06 17:51:19,760][root][INFO] - Domain : Property, Question : 46
[2025-03-06 17:51:33,348][root][INFO] - Domain : Property, Question : 53
[2025-03-06 17:52:04,265][root][INFO] - Domain : Property, Question : 59
[2025-03-06 17:52:16,600][root][INFO] - Domain : Property, Question : 66
[2025-03-06 17:52:23,575][root][INFO] - Processing question number 80
[2025-03-06 17:52:23,581][root][INFO] - Domain : Property, Question : 69
[2025-03-06 17:52:32,279][root][INFO] - Domain : Property, Question : 81
[2025-03-06 17:52:44,213][root][INFO] - Domain : Property, Question : 88
[2025-03-06 17:52:55,341][root][INFO] - Domain : Property, Question : 91
[2025-03-06 17:53:03,647][root][INFO] - Domain : Property, Question : 94
[2025-03-06 17:53:16,445][root][INFO] - Domain : Property, Question : 100
[2025-03-06 17:53:45,556][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 17:53:54,808][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 17:54:08,082][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 17:54:18,282][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 17:54:29,444][root][INFO] - Processing question number 90
[2025-03-06 17:54:29,449][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 17:54:35,725][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 17:54:48,591][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 17:54:59,451][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 17:55:30,734][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 17:55:42,759][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 17:55:54,551][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 17:56:06,975][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 17:56:12,519][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 17:56:21,510][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 17:56:32,314][root][INFO] - Inference complete
[2025-03-06 17:56:32,314][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:56:32,321][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:56:32,330][root][WARNING] - |Q. 33||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 17:56:32,330][root][WARNING] - |Q. 33||D: Civil_procedure| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:56:32,331][root][INFO] - |Q. 33||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 17:56:32,331][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:56:32,331][root][WARNING] - |Q. 40||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 17:56:32,331][root][WARNING] - |Q. 40||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 17:56:32,331][root][INFO] - |Q. 40||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 17:56:32,332][root][WARNING] - |Q. 68||D: Civil_procedure| has broken JSON output. Attempting to fix it.
[2025-03-06 17:56:32,332][root][WARNING] - |Q. 68||D: Civil_procedure| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 17:56:32,332][root][INFO] - |Q. 68||D: Civil_procedure| was made valid into Valid json. Extracting responses.
[2025-03-06 17:56:32,333][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 17:56:32,333][root][WARNING] - |Q. 25||D: Property| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:56:32,334][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 17:56:32,334][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:56:32,336][root][WARNING] - |Q. 57||D: Torts| has broken JSON output. Attempting to fix it.
[2025-03-06 17:56:32,336][root][WARNING] - |Q. 57||D: Torts| Failed to fix invalid JSON, extracting as many fields as possible.
[2025-03-06 17:56:32,337][root][INFO] - |Q. 57||D: Torts| was made valid into Valid json. Extracting responses.
[2025-03-06 17:56:32,337][root][WARNING] - Expected a string for unstructured explanation but got different format.
[2025-03-06 17:56:32,338][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:56:32,343][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:56:32,343][root][INFO] - Saved parsed outputs
[2025-03-06 17:56:32,343][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:56:32,345][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:56:32,345][root][INFO] - Saved parsing metadata
[2025-03-06 17:56:32,346][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:56:32,347][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:56:32,349][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/trained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 17:56:32,390][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 17:56:32,390][root][INFO] - Summary of metrics : {'label_accuracy': 0.58, 'misclassification_rate': 0.42000000000000004, 'combined_accuracy': 0.37, 'malformed_label': 3, 'malformed_domain': 30, 'total_predictions': 100, 'correct_predictions': 58, 'correct_label_and_domain': 37, 'Constitutional_Law_accuracy': 0.7142857142857143, 'Contracts_accuracy': 0.26666666666666666, 'Criminal_Law_accuracy': 0.35714285714285715, 'Evidence_accuracy': 0.26666666666666666, 'Real_Property_accuracy': 0.3333333333333333, 'Torts_accuracy': 0.42857142857142855, 'Civil_Procedure_accuracy': 0.23076923076923078, 'Constitutional_Law_confidence': 0.16, 'Contracts_confidence': 0.13, 'Criminal_Law_confidence': 0.06, 'Evidence_confidence': 0.08, 'Real_Property_confidence': 0.1, 'Torts_confidence': 0.13, 'Civil_Procedure_confidence': 0.12, 'correct_domain_wrong_label': 33, 'correct_label_wrong_domain': 21, 'both_wrong': 9}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=trained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Running evaluation with config: seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'running']
Updating eval for job 12 to status running with exit code None
Eval status update completed for job 12
[2025-03-06 17:56:40,312][root][INFO] - Setting global seed to 989
[2025-03-06 17:56:40,319][root][INFO] - Running evaluation of the untrained model on the test_set_2
[2025-03-06 17:56:40,319][root][INFO] - Current evaluation config is : 
 Prompt type : few_shot 
 Response type : fact_first 
 Explanation type : unstructured 
 Response Format : json 
[2025-03-06 17:56:40,320][root][INFO] - Loading dataset from /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/dataset/test_sets/bar_set_2.json
[2025-03-06 17:56:40,322][root][INFO] - Dataset loaded successfully, indexing questions...
[2025-03-06 17:56:40,325][root][INFO] - Indexing complete, sampling of questions set to False
[2025-03-06 17:56:40,325][root][INFO] - Questions selected, dataset contains 100 questions with 14.285714285714286 questions per domain
[2025-03-06 17:56:40,537][root][INFO] - Loading model : meta-llama/Llama-3.1-8B-Instruct
[2025-03-06 17:56:41,403][root][INFO] - Full model selected, loading model
[2025-03-06 17:57:15,448][root][INFO] - Baseline model selected, no adapter needed
[2025-03-06 17:57:15,459][root][WARNING] - Inference will be done using hf pipeline since model.generate consistently generates gibberish
[2025-03-06 17:57:24,044][root][INFO] - Prompt Handler initialized with configuration: {'prompt_type': 'few_shot', 'example_path': '${hydra:runtime.cwd}/prompt/examples/unstructured_example.json', 'explanation_type': 'unstructured', 'response_type': 'fact_first', 'response_format': 'json', 'store_prompt': False, 'include_system_prompt': True, 'system_prompt': '${hydra:runtime.cwd}/prompt/system_prompt/system_${eval.prompt.response_format}_${eval.prompt.response_type}_${eval.prompt.explanation_type}.txt'}
[2025-03-06 17:57:24,046][root][INFO] - Raw output for this run will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 17:57:24,046][root][INFO] - Starting inference
[2025-03-06 17:57:24,248][root][INFO] - Processing question number 0
[2025-03-06 17:57:24,250][root][INFO] - Domain : Constitutional_law, Question : 1
[2025-03-06 17:57:36,828][root][INFO] - Domain : Constitutional_law, Question : 6
[2025-03-06 17:57:45,394][root][INFO] - Domain : Constitutional_law, Question : 13
[2025-03-06 17:57:53,560][root][INFO] - Domain : Constitutional_law, Question : 20
[2025-03-06 17:58:05,718][root][INFO] - Domain : Constitutional_law, Question : 27
[2025-03-06 17:58:14,779][root][INFO] - Domain : Constitutional_law, Question : 35
[2025-03-06 17:58:22,562][root][INFO] - Domain : Constitutional_law, Question : 41
[2025-03-06 17:58:32,137][root][INFO] - Domain : Constitutional_law, Question : 49
[2025-03-06 17:58:39,965][root][INFO] - Domain : Constitutional_law, Question : 56
[2025-03-06 17:58:45,768][root][INFO] - Domain : Constitutional_law, Question : 62
[2025-03-06 17:58:54,779][root][INFO] - Processing question number 10
[2025-03-06 17:58:54,781][root][INFO] - Domain : Constitutional_law, Question : 70
[2025-03-06 17:59:01,371][root][INFO] - Domain : Constitutional_law, Question : 78
[2025-03-06 17:59:10,404][root][INFO] - Domain : Constitutional_law, Question : 86
[2025-03-06 17:59:20,054][root][INFO] - Domain : Constitutional_law, Question : 99
[2025-03-06 17:59:28,230][root][INFO] - Domain : Criminal_law, Question : 2
[2025-03-06 17:59:36,668][root][INFO] - Domain : Criminal_law, Question : 8
[2025-03-06 17:59:44,033][root][INFO] - Domain : Criminal_law, Question : 15
[2025-03-06 17:59:50,622][root][INFO] - Domain : Criminal_law, Question : 21
[2025-03-06 17:59:58,954][root][INFO] - Domain : Criminal_law, Question : 29
[2025-03-06 18:00:09,467][root][INFO] - Domain : Criminal_law, Question : 37
[2025-03-06 18:00:17,874][root][INFO] - Processing question number 20
[2025-03-06 18:00:17,876][root][INFO] - Domain : Criminal_law, Question : 44
[2025-03-06 18:00:25,830][root][INFO] - Domain : Criminal_law, Question : 55
[2025-03-06 18:00:33,737][root][INFO] - Domain : Criminal_law, Question : 64
[2025-03-06 18:00:44,279][root][INFO] - Domain : Criminal_law, Question : 71
[2025-03-06 18:00:51,384][root][INFO] - Domain : Criminal_law, Question : 76
[2025-03-06 18:00:59,816][root][INFO] - Domain : Criminal_law, Question : 83
[2025-03-06 18:01:08,336][root][INFO] - Domain : Criminal_law, Question : 89
[2025-03-06 18:01:20,602][root][INFO] - Domain : Criminal_law, Question : 96
[2025-03-06 18:01:28,914][root][INFO] - Domain : Contracts, Question : 3
[2025-03-06 18:01:35,730][root][INFO] - Domain : Contracts, Question : 7
[2025-03-06 18:01:45,727][root][INFO] - Processing question number 30
[2025-03-06 18:01:45,729][root][INFO] - Domain : Contracts, Question : 14
[2025-03-06 18:01:53,997][root][INFO] - Domain : Contracts, Question : 24
[2025-03-06 18:02:01,941][root][INFO] - Domain : Contracts, Question : 28
[2025-03-06 18:02:10,198][root][INFO] - Domain : Contracts, Question : 34
[2025-03-06 18:02:20,591][root][INFO] - Domain : Contracts, Question : 42
[2025-03-06 18:02:28,902][root][INFO] - Domain : Contracts, Question : 48
[2025-03-06 18:02:35,531][root][INFO] - Domain : Contracts, Question : 58
[2025-03-06 18:02:44,811][root][INFO] - Domain : Contracts, Question : 65
[2025-03-06 18:02:54,241][root][INFO] - Domain : Contracts, Question : 72
[2025-03-06 18:03:01,957][root][INFO] - Domain : Contracts, Question : 77
[2025-03-06 18:03:13,852][root][INFO] - Processing question number 40
[2025-03-06 18:03:13,855][root][INFO] - Domain : Contracts, Question : 84
[2025-03-06 18:03:20,981][root][INFO] - Domain : Contracts, Question : 87
[2025-03-06 18:03:28,624][root][INFO] - Domain : Contracts, Question : 97
[2025-03-06 18:03:36,334][root][INFO] - Domain : Evidence, Question : 4
[2025-03-06 18:03:44,332][root][INFO] - Domain : Evidence, Question : 10
[2025-03-06 18:03:56,196][root][INFO] - Domain : Evidence, Question : 16
[2025-03-06 18:04:06,142][root][INFO] - Domain : Evidence, Question : 23
[2025-03-06 18:04:18,405][root][INFO] - Domain : Evidence, Question : 31
[2025-03-06 18:04:25,640][root][INFO] - Domain : Evidence, Question : 38
[2025-03-06 18:04:37,133][root][INFO] - Domain : Evidence, Question : 43
[2025-03-06 18:04:44,412][root][INFO] - Processing question number 50
[2025-03-06 18:04:44,415][root][INFO] - Domain : Evidence, Question : 50
[2025-03-06 18:04:54,907][root][INFO] - Domain : Evidence, Question : 51
[2025-03-06 18:05:02,858][root][INFO] - Domain : Evidence, Question : 60
[2025-03-06 18:05:14,496][root][INFO] - Domain : Evidence, Question : 73
[2025-03-06 18:05:23,885][root][INFO] - Domain : Evidence, Question : 80
[2025-03-06 18:05:32,800][root][INFO] - Domain : Evidence, Question : 85
[2025-03-06 18:05:45,258][root][INFO] - Domain : Evidence, Question : 90
[2025-03-06 18:05:52,337][root][INFO] - Domain : Evidence, Question : 98
[2025-03-06 18:06:01,023][root][INFO] - Domain : Civil_procedure, Question : 5
[2025-03-06 18:06:10,191][root][INFO] - Domain : Civil_procedure, Question : 12
[2025-03-06 18:06:19,411][root][INFO] - Processing question number 60
[2025-03-06 18:06:19,415][root][INFO] - Domain : Civil_procedure, Question : 19
[2025-03-06 18:06:29,412][root][INFO] - Domain : Civil_procedure, Question : 26
[2025-03-06 18:06:39,649][root][INFO] - Domain : Civil_procedure, Question : 33
[2025-03-06 18:06:46,972][root][INFO] - Domain : Civil_procedure, Question : 40
[2025-03-06 18:06:55,720][root][INFO] - Domain : Civil_procedure, Question : 47
[2025-03-06 18:07:04,428][root][INFO] - Domain : Civil_procedure, Question : 54
[2025-03-06 18:07:13,700][root][INFO] - Domain : Civil_procedure, Question : 61
[2025-03-06 18:07:21,206][root][INFO] - Domain : Civil_procedure, Question : 68
[2025-03-06 18:07:27,974][root][INFO] - Domain : Civil_procedure, Question : 75
[2025-03-06 18:07:34,521][root][INFO] - Domain : Civil_procedure, Question : 82
[2025-03-06 18:07:41,988][root][INFO] - Processing question number 70
[2025-03-06 18:07:41,992][root][INFO] - Domain : Civil_procedure, Question : 93
[2025-03-06 18:07:48,951][root][INFO] - Domain : Property, Question : 9
[2025-03-06 18:07:58,006][root][INFO] - Domain : Property, Question : 17
[2025-03-06 18:08:08,739][root][INFO] - Domain : Property, Question : 25
[2025-03-06 18:08:19,335][root][INFO] - Domain : Property, Question : 30
[2025-03-06 18:08:27,470][root][INFO] - Domain : Property, Question : 36
[2025-03-06 18:08:36,687][root][INFO] - Domain : Property, Question : 46
[2025-03-06 18:08:44,942][root][INFO] - Domain : Property, Question : 53
[2025-03-06 18:08:53,428][root][INFO] - Domain : Property, Question : 59
[2025-03-06 18:09:01,997][root][INFO] - Domain : Property, Question : 66
[2025-03-06 18:09:07,925][root][INFO] - Processing question number 80
[2025-03-06 18:09:07,930][root][INFO] - Domain : Property, Question : 69
[2025-03-06 18:09:16,720][root][INFO] - Domain : Property, Question : 81
[2025-03-06 18:09:26,212][root][INFO] - Domain : Property, Question : 88
[2025-03-06 18:09:34,449][root][INFO] - Domain : Property, Question : 91
[2025-03-06 18:09:42,390][root][INFO] - Domain : Property, Question : 94
[2025-03-06 18:09:52,808][root][INFO] - Domain : Property, Question : 100
[2025-03-06 18:10:01,210][root][INFO] - Domain : Torts, Question : 11
[2025-03-06 18:10:15,756][root][INFO] - Domain : Torts, Question : 18
[2025-03-06 18:10:23,981][root][INFO] - Domain : Torts, Question : 22
[2025-03-06 18:10:33,211][root][INFO] - Domain : Torts, Question : 32
[2025-03-06 18:10:44,057][root][INFO] - Processing question number 90
[2025-03-06 18:10:44,061][root][INFO] - Domain : Torts, Question : 39
[2025-03-06 18:10:52,157][root][INFO] - Domain : Torts, Question : 45
[2025-03-06 18:11:02,980][root][INFO] - Domain : Torts, Question : 52
[2025-03-06 18:11:09,767][root][INFO] - Domain : Torts, Question : 57
[2025-03-06 18:11:14,487][root][INFO] - Domain : Torts, Question : 63
[2025-03-06 18:11:23,454][root][INFO] - Domain : Torts, Question : 67
[2025-03-06 18:11:32,253][root][INFO] - Domain : Torts, Question : 74
[2025-03-06 18:11:40,006][root][INFO] - Domain : Torts, Question : 79
[2025-03-06 18:11:47,849][root][INFO] - Domain : Torts, Question : 92
[2025-03-06 18:11:56,339][root][INFO] - Domain : Torts, Question : 95
[2025-03-06 18:12:05,758][root][INFO] - Inference complete
[2025-03-06 18:12:05,758][root][INFO] - Saving raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 18:12:05,766][root][INFO] - Starting parsing of raw outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 18:12:05,773][root][WARNING] - |Q. 25||D: Property| has broken JSON output. Attempting to fix it.
[2025-03-06 18:12:05,774][root][WARNING] - |Q. 25||D: Property| Successfully fixed invalid JSON. Not all fields may be present.
[2025-03-06 18:12:05,774][root][INFO] - |Q. 25||D: Property| was made valid into Valid json. Extracting responses.
[2025-03-06 18:12:05,777][root][INFO] - Saving parsed outputs to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 18:12:05,783][root][INFO] - Dumped the response to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/parsed_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 18:12:05,783][root][INFO] - Saved parsed outputs
[2025-03-06 18:12:05,783][root][INFO] - Saving parsing metadata to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 18:12:05,785][root][INFO] - Dumped the stats to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/parsing_metadata/raw_responses/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 18:12:05,785][root][INFO] - Saved parsing metadata
[2025-03-06 18:12:05,786][root][INFO] - Metrics will be saved to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 18:12:05,788][root][INFO] - Metrics calculated, saving backup to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
[2025-03-06 18:12:05,789][root][INFO] - Dumped the metrics to /pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/model_outputs/metrics/llama3/seed_989/all_domains_1_samples/untrained_full_model/temp_06/json_fact_first_few_shot_unstructured/test_set_2.json
Metrics successfully appended to master CSV.
[2025-03-06 18:12:05,805][root][INFO] - Evaluation completed for json_fact_first_few_shot_unstructured, on test_set_2
[2025-03-06 18:12:05,805][root][INFO] - Summary of metrics : {'label_accuracy': 0.57, 'misclassification_rate': 0.43000000000000005, 'combined_accuracy': 0.22, 'malformed_label': 0, 'malformed_domain': 61, 'total_predictions': 100, 'correct_predictions': 57, 'correct_label_and_domain': 22, 'Constitutional_Law_accuracy': 0.35714285714285715, 'Contracts_accuracy': 0.13333333333333333, 'Criminal_Law_accuracy': 0.21428571428571427, 'Evidence_accuracy': 0.4, 'Real_Property_accuracy': 0.06666666666666667, 'Torts_accuracy': 0.2857142857142857, 'Civil_Procedure_accuracy': 0.07692307692307693, 'Constitutional_Law_confidence': 0.08, 'Contracts_confidence': 0.04, 'Criminal_Law_confidence': 0.04, 'Evidence_confidence': 0.09, 'Real_Property_confidence': 0.03, 'Torts_confidence': 0.09, 'Civil_Procedure_confidence': 0.05, 'correct_domain_wrong_label': 17, 'correct_label_wrong_domain': 35, 'both_wrong': 26}
Starting update_eval_status.py
Received arguments: ['/pfs/work7/workspace/scratch/fr_rf1031-model_temp_storage/bar-llama/scripts/update_eval_status.py', '12', 'seeds=seed_989 model=llama3 tokenizer=llama3 dataset=all_domains_1_samples generation=temp_06 evaluation_dataset=test_set_2 eval=json_fact_first_few_shot_unstructured ++eval.quantisation_status=full_model ++eval.training_status=untrained', 'completed', '0']
Updating eval for job 12 to status completed with exit code 0
Eval status update completed for job 12
Job 12 completed at Thu Mar  6 18:12:07 CET 2025

============================= JOB FEEDBACK =============================

NodeName=uc2n514
Job ID: 25358387
Cluster: uc2
User/Group: fr_rf1031/fr_fr
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 10
CPU Utilized: 08:03:26
CPU Efficiency: 9.86% of 3-09:43:30 core-walltime
Job Wall-clock time: 08:10:21
Memory Utilized: 35.23 GB
Memory Efficiency: 97.86% of 36.00 GB
